{"name": "query001_0", "input_sql": "with customer_total_return as\n(select sr_customer_sk as ctr_customer_sk\n,sr_store_sk as ctr_store_sk\n,sr_reason_sk as ctr_reason_sk\n,sum(SR_RETURN_AMT_INC_TAX) as ctr_total_return\nfrom store_returns\n,date_dim\nwhere sr_returned_date_sk = d_date_sk\nand d_year =1999\nand sr_return_amt / sr_return_quantity between 80 and 139\ngroup by sr_customer_sk\n,sr_store_sk, sr_reason_sk)\n select  c_customer_id\nfrom customer_total_return ctr1\n,store\n,customer\n,customer_demographics\nwhere ctr1.ctr_total_return > (select avg(ctr_total_return)*1.2\nfrom customer_total_return ctr2\nwhere ctr1.ctr_store_sk = ctr2.ctr_store_sk\n)\nand ctr1.ctr_reason_sk BETWEEN 72 AND 75\nand s_store_sk = ctr1.ctr_store_sk\nand s_state IN ('CO', 'GA', 'NE')\nand ctr1.ctr_customer_sk = c_customer_sk\nand c_current_cdemo_sk = cd_demo_sk\nand cd_marital_status IN ('M', 'M')\nand cd_education_status IN ('2 yr Degree', '2 yr Degree')\nand cd_gender = 'F'\nand c_birth_month = 8\nand c_birth_year BETWEEN 1987 AND 1993\norder by c_customer_id\nlimit 100;", "input_cost": 48.38, "output_sql": "SELECT \"t5\".\"c_customer_id\" AS \"ctr_customer_sk\"\r\nFROM (SELECT \"sr_customer_sk\" AS \"ctr_customer_sk\", \"sr_store_sk\" AS \"ctr_store_sk\", \"sr_reason_sk\" AS \"ctr_reason_sk\", SUM(\"sr_return_amt_inc_tax\") AS \"ctr_total_return\"\r\n        FROM (SELECT *\r\n                FROM \"store_returns\"\r\n                WHERE \"sr_return_amt\" / \"sr_return_quantity\" >= 80 AND \"sr_return_amt\" / \"sr_return_quantity\" <= 139 AND (\"sr_reason_sk\" >= 72 AND \"sr_reason_sk\" <= 75) AND \"sr_store_sk\" IS NOT NULL AND EXISTS (SELECT 1\r\n                        FROM (SELECT *\r\n                                FROM \"date_dim\"\r\n                                WHERE \"d_year\" = 1999) AS \"t0\"\r\n                        WHERE \"sr_returned_date_sk\" = \"t0\".\"d_date_sk\")) AS \"t\"\r\n        GROUP BY \"sr_customer_sk\", \"sr_store_sk\", \"sr_reason_sk\") AS \"t3\"\r\n    INNER JOIN (SELECT *\r\n        FROM \"store\"\r\n        WHERE CAST(\"s_state\" AS CHAR(2)) IN ('CO', 'GA', 'NE')) AS \"t4\" ON \"t3\".\"ctr_store_sk\" = \"t4\".\"s_store_sk\"\r\n    INNER JOIN (SELECT *\r\n        FROM \"customer\"\r\n        WHERE \"c_birth_month\" = 8 AND (\"c_birth_year\" >= 1987 AND \"c_birth_year\" <= 1993)) AS \"t5\" ON \"t3\".\"ctr_customer_sk\" = \"t5\".\"c_customer_sk\"\r\n    INNER JOIN (SELECT *\r\n        FROM \"customer_demographics\"\r\n        WHERE \"cd_marital_status\" = 'M' AND \"cd_education_status\" = '2 yr Degree' AND \"cd_gender\" = 'F') AS \"t6\" ON \"t5\".\"c_current_cdemo_sk\" = \"t6\".\"cd_demo_sk\"\r\n    INNER JOIN (SELECT \"sr_returned_date_sk0\", AVG(\"sr_return_time_sk0\") AS \"$f1\"\r\n        FROM (SELECT \"sr_store_sk0\" AS \"sr_returned_date_sk0\", SUM(\"sr_return_amt_inc_tax0\") AS \"sr_return_time_sk0\"\r\n                FROM (SELECT *\r\n                        FROM \"store_returns\" AS \"store_returns0\" (\"sr_returned_date_sk0\", \"sr_return_time_sk0\", \"sr_item_sk0\", \"sr_customer_sk0\", \"sr_cdemo_sk0\", \"sr_hdemo_sk0\", \"sr_addr_sk0\", \"sr_store_sk0\", \"sr_reason_sk0\", \"sr_ticket_number0\", \"sr_return_quantity0\", \"sr_return_amt0\", \"sr_return_tax0\", \"sr_return_amt_inc_tax0\", \"sr_fee0\", \"sr_return_ship_cost0\", \"sr_refunded_cash0\", \"sr_reversed_charge0\", \"sr_store_credit0\", \"sr_net_loss0\")\r\n                        WHERE \"sr_return_amt0\" / \"sr_return_quantity0\" >= 80 AND \"sr_return_amt0\" / \"sr_return_quantity0\" <= 139 AND \"sr_store_sk0\" IS NOT NULL AND EXISTS (SELECT 1\r\n                                FROM (SELECT *\r\n                                        FROM \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\")\r\n                                        WHERE \"d_year0\" = 1999) AS \"t8\"\r\n                                WHERE \"sr_returned_date_sk0\" = \"t8\".\"d_date_sk0\")) AS \"t7\"\r\n                GROUP BY \"sr_customer_sk0\", \"sr_store_sk0\", \"sr_reason_sk0\") AS \"t11\"\r\n        GROUP BY \"sr_returned_date_sk0\") AS \"t12\" ON \"t3\".\"ctr_store_sk\" = \"t12\".\"sr_returned_date_sk0\" AND \"t3\".\"ctr_total_return\" > \"t12\".\"$f1\" * 1.2\r\nORDER BY \"t5\".\"c_customer_id\"\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 64.15, "used_rules": ["FILTER_SUB_QUERY_TO_CORRELATE", "JOIN_ON_UNIQUE_TO_SEMI_JOIN", "JOIN_PUSH_TRANSITIVE_PREDICATES", "JOIN_EXTRACT_FILTER", "FILTER_INTO_JOIN", "FILTER_AGGREGATE_TRANSPOSE", "FILTER_PROJECT_TRANSPOSE", "FILTER_MERGE", "FILTER_INTO_JOIN", "FILTER_MERGE", "PROJECT_TO_CALC"], "rewrite_time": 5249}
{"name": "query001_1", "input_sql": "with customer_total_return as\n(select sr_customer_sk as ctr_customer_sk\n,sr_store_sk as ctr_store_sk\n,sr_reason_sk as ctr_reason_sk\n,sum(SR_REVERSED_CHARGE) as ctr_total_return\nfrom store_returns\n,date_dim\nwhere sr_returned_date_sk = d_date_sk\nand d_year =2002\nand sr_return_amt / sr_return_quantity between 149 and 208\ngroup by sr_customer_sk\n,sr_store_sk, sr_reason_sk)\n select  c_customer_id\nfrom customer_total_return ctr1\n,store\n,customer\n,customer_demographics\nwhere ctr1.ctr_total_return > (select avg(ctr_total_return)*1.2\nfrom customer_total_return ctr2\nwhere ctr1.ctr_store_sk = ctr2.ctr_store_sk\n)\nand ctr1.ctr_reason_sk BETWEEN 51 AND 54\nand s_store_sk = ctr1.ctr_store_sk\nand s_state IN ('GA', 'IL', 'KY')\nand ctr1.ctr_customer_sk = c_customer_sk\nand c_current_cdemo_sk = cd_demo_sk\nand cd_marital_status IN ('D', 'M')\nand cd_education_status IN ('Secondary', '4 yr Degree')\nand cd_gender = 'F'\nand c_birth_month = 1\nand c_birth_year BETWEEN 1938 AND 1944\norder by c_customer_id\nlimit 100;", "input_cost": 48.38, "output_sql": "SELECT \"t5\".\"c_customer_id\" AS \"ctr_customer_sk\"\r\nFROM (SELECT \"sr_customer_sk\" AS \"ctr_customer_sk\", \"sr_store_sk\" AS \"ctr_store_sk\", \"sr_reason_sk\" AS \"ctr_reason_sk\", SUM(\"sr_reversed_charge\") AS \"ctr_total_return\"\r\n        FROM (SELECT *\r\n                FROM \"store_returns\"\r\n                WHERE \"sr_return_amt\" / \"sr_return_quantity\" >= 149 AND \"sr_return_amt\" / \"sr_return_quantity\" <= 208 AND (\"sr_reason_sk\" >= 51 AND \"sr_reason_sk\" <= 54) AND \"sr_store_sk\" IS NOT NULL AND EXISTS (SELECT 1\r\n                        FROM (SELECT *\r\n                                FROM \"date_dim\"\r\n                                WHERE \"d_year\" = 2002) AS \"t0\"\r\n                        WHERE \"sr_returned_date_sk\" = \"t0\".\"d_date_sk\")) AS \"t\"\r\n        GROUP BY \"sr_customer_sk\", \"sr_store_sk\", \"sr_reason_sk\") AS \"t3\"\r\n    INNER JOIN (SELECT *\r\n        FROM \"store\"\r\n        WHERE CAST(\"s_state\" AS CHAR(2)) IN ('GA', 'IL', 'KY')) AS \"t4\" ON \"t3\".\"ctr_store_sk\" = \"t4\".\"s_store_sk\"\r\n    INNER JOIN (SELECT *\r\n        FROM \"customer\"\r\n        WHERE \"c_birth_month\" = 1 AND (\"c_birth_year\" >= 1938 AND \"c_birth_year\" <= 1944)) AS \"t5\" ON \"t3\".\"ctr_customer_sk\" = \"t5\".\"c_customer_sk\"\r\n    INNER JOIN (SELECT *\r\n        FROM \"customer_demographics\"\r\n        WHERE CAST(\"cd_marital_status\" AS CHAR(1)) IN ('D', 'M') AND (\"cd_education_status\" = 'Secondary' OR \"cd_education_status\" = '4 yr Degree') AND \"cd_gender\" = 'F') AS \"t6\" ON \"t5\".\"c_current_cdemo_sk\" = \"t6\".\"cd_demo_sk\"\r\n    INNER JOIN (SELECT \"sr_returned_date_sk0\", AVG(\"sr_return_time_sk0\") AS \"$f1\"\r\n        FROM (SELECT \"sr_store_sk0\" AS \"sr_returned_date_sk0\", SUM(\"sr_reversed_charge0\") AS \"sr_return_time_sk0\"\r\n                FROM (SELECT *\r\n                        FROM \"store_returns\" AS \"store_returns0\" (\"sr_returned_date_sk0\", \"sr_return_time_sk0\", \"sr_item_sk0\", \"sr_customer_sk0\", \"sr_cdemo_sk0\", \"sr_hdemo_sk0\", \"sr_addr_sk0\", \"sr_store_sk0\", \"sr_reason_sk0\", \"sr_ticket_number0\", \"sr_return_quantity0\", \"sr_return_amt0\", \"sr_return_tax0\", \"sr_return_amt_inc_tax0\", \"sr_fee0\", \"sr_return_ship_cost0\", \"sr_refunded_cash0\", \"sr_reversed_charge0\", \"sr_store_credit0\", \"sr_net_loss0\")\r\n                        WHERE \"sr_return_amt0\" / \"sr_return_quantity0\" >= 149 AND \"sr_return_amt0\" / \"sr_return_quantity0\" <= 208 AND \"sr_store_sk0\" IS NOT NULL AND EXISTS (SELECT 1\r\n                                FROM (SELECT *\r\n                                        FROM \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\")\r\n                                        WHERE \"d_year0\" = 2002) AS \"t8\"\r\n                                WHERE \"sr_returned_date_sk0\" = \"t8\".\"d_date_sk0\")) AS \"t7\"\r\n                GROUP BY \"sr_customer_sk0\", \"sr_store_sk0\", \"sr_reason_sk0\") AS \"t11\"\r\n        GROUP BY \"sr_returned_date_sk0\") AS \"t12\" ON \"t3\".\"ctr_store_sk\" = \"t12\".\"sr_returned_date_sk0\" AND \"t3\".\"ctr_total_return\" > \"t12\".\"$f1\" * 1.2\r\nORDER BY \"t5\".\"c_customer_id\"\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 64.15, "used_rules": ["FILTER_SUB_QUERY_TO_CORRELATE", "JOIN_ON_UNIQUE_TO_SEMI_JOIN", "JOIN_PUSH_TRANSITIVE_PREDICATES", "JOIN_EXTRACT_FILTER", "FILTER_INTO_JOIN", "FILTER_AGGREGATE_TRANSPOSE", "FILTER_PROJECT_TRANSPOSE", "FILTER_MERGE", "FILTER_INTO_JOIN", "FILTER_MERGE", "PROJECT_TO_CALC"], "rewrite_time": 2676}
{"name": "query010_0", "input_sql": "select \n  cd_gender,\n  cd_marital_status,\n  cd_education_status,\n  count(*) cnt1,\n  cd_purchase_estimate,\n  count(*) cnt2,\n  cd_credit_rating,\n  count(*) cnt3,\n  cd_dep_count,\n  count(*) cnt4,\n  cd_dep_employed_count,\n  count(*) cnt5,\n  cd_dep_college_count,\n  count(*) cnt6\n from\n  customer c,customer_address ca,customer_demographics\n where\n  c.c_current_addr_sk = ca.ca_address_sk and\n  ca_county in ('Northampton County','Pendleton County','Perry County','Randolph County','Woods County') and\n  c.c_birth_month in (7, 11) and\n  cd_demo_sk = c.c_current_cdemo_sk\n  and cd_marital_status in ('S', 'M', 'M')\n  and cd_education_status in ('4 yr Degree', 'Unknown', 'Unknown')\n  and cd_gender = 'F' and\n  exists (select *\n          from store_sales,date_dim, item\n          where c.c_customer_sk = ss_customer_sk and\n                ss_sold_date_sk = d_date_sk and\n                d_year = 2002 and\n                d_moy between 4 and 4+3 and\n                ss_item_sk = i_item_sk and\n                i_category in ('Books', 'Electronics', 'Sports')\n                and ss_sales_price / ss_list_price BETWEEN 77 * 0.01 AND 87 * 0.01\n                and i_manager_id BETWEEN 91 and 100\n                ) and\n   (exists (select *\n            from web_sales,date_dim, item\n            where c.c_customer_sk = ws_bill_customer_sk and\n                  ws_sold_date_sk = d_date_sk and\n                  d_year = 2002 and\n                  d_moy between 4 ANd 4+3 and\n                  ws_item_sk = i_item_sk and\n                  i_category in ('Books', 'Electronics', 'Sports')\n                  and i_manager_id BETWEEN 91 and 100\n                  and ws_sales_price / ws_list_price BETWEEN 77 * 0.01 AND 87 * 0.01\n                  ) or\n    exists (select *\n            from catalog_sales,date_dim, item\n            where c.c_customer_sk = cs_ship_customer_sk and\n                  cs_sold_date_sk = d_date_sk and\n                  d_year = 2002 and\n                  d_moy between 4 and 4+3 and\n                  cs_item_sk = i_item_sk and\n                  i_category in ('Books', 'Electronics', 'Sports')\n                  and i_manager_id BETWEEN 91 and 100\n                  and cs_sales_price / cs_list_price BETWEEN 77 * 0.01 AND 87 * 0.01\n                  ))\n group by cd_gender,\n          cd_marital_status,\n          cd_education_status,\n          cd_purchase_estimate,\n          cd_credit_rating,\n          cd_dep_count,\n          cd_dep_employed_count,\n          cd_dep_college_count\n order by cd_gender,\n          cd_marital_status,\n          cd_education_status,\n          cd_purchase_estimate,\n          cd_credit_rating,\n          cd_dep_count,\n          cd_dep_employed_count,\n          cd_dep_college_count\nlimit 100;", "input_cost": 144.15, "output_sql": "SELECT \"t8\".\"cd_gender\", \"t8\".\"cd_marital_status\", \"t8\".\"cd_education_status\", COUNT(*) AS \"cnt6\", \"t8\".\"cd_purchase_estimate\", COUNT(*) AS \"cnt60\", \"t8\".\"cd_credit_rating\", COUNT(*) AS \"cnt61\", \"t8\".\"cd_dep_count\", COUNT(*) AS \"cnt62\", \"t8\".\"cd_dep_employed_count\", COUNT(*) AS \"cnt63\", \"t8\".\"cd_dep_college_count\", COUNT(*) AS \"cnt64\"\r\nFROM (SELECT \"t\".\"c_customer_sk\", \"t\".\"c_customer_id\", \"t\".\"c_current_cdemo_sk\", \"t\".\"c_current_hdemo_sk\", \"t\".\"c_current_addr_sk\", \"t\".\"c_first_shipto_date_sk\", \"t\".\"c_first_sales_date_sk\", \"t\".\"c_salutation\", \"t\".\"c_first_name\", \"t\".\"c_last_name\", \"t\".\"c_preferred_cust_flag\", \"t\".\"c_birth_day\", \"t\".\"c_birth_month\", \"t\".\"c_birth_year\", \"t\".\"c_birth_country\", \"t\".\"c_login\", \"t\".\"c_email_address\", \"t\".\"c_last_review_date_sk\", \"t0\".\"ca_address_sk\", \"t0\".\"ca_address_id\", \"t0\".\"ca_street_number\", \"t0\".\"ca_street_name\", \"t0\".\"ca_street_type\", \"t0\".\"ca_suite_number\", \"t0\".\"ca_city\", \"t0\".\"ca_county\", \"t0\".\"ca_state\", \"t0\".\"ca_zip\", \"t0\".\"ca_country\", \"t0\".\"ca_gmt_offset\", \"t0\".\"ca_location_type\", \"t1\".\"cd_demo_sk\", \"t1\".\"cd_gender\", \"t1\".\"cd_marital_status\", \"t1\".\"cd_education_status\", \"t1\".\"cd_purchase_estimate\", \"t1\".\"cd_credit_rating\", \"t1\".\"cd_dep_count\", \"t1\".\"cd_dep_employed_count\", \"t1\".\"cd_dep_college_count\", \"t7\".\"ss_customer_sk\", TRUE AS \"$f1\"\r\n        FROM (SELECT *\r\n                FROM \"customer\"\r\n                WHERE \"c_birth_month\" IN (7, 11) AND \"c_customer_sk\" IS NOT NULL) AS \"t\"\r\n            INNER JOIN (SELECT *\r\n                FROM \"customer_address\"\r\n                WHERE \"ca_county\" = 'Northampton County' OR \"ca_county\" = 'Pendleton County' OR CAST(\"ca_county\" AS VARCHAR(12)) IN ('Perry County', 'Woods County') OR \"ca_county\" = 'Randolph County') AS \"t0\" ON \"t\".\"c_current_addr_sk\" = \"t0\".\"ca_address_sk\"\r\n            INNER JOIN (SELECT *\r\n                FROM \"customer_demographics\"\r\n                WHERE CAST(\"cd_marital_status\" AS CHAR(1)) IN ('M', 'S') AND (\"cd_education_status\" = '4 yr Degree' OR \"cd_education_status\" = 'Unknown') AND \"cd_gender\" = 'F') AS \"t1\" ON \"t\".\"c_current_cdemo_sk\" = \"t1\".\"cd_demo_sk\"\r\n            INNER JOIN (SELECT \"t5\".\"ss_customer_sk\"\r\n                FROM (SELECT \"t3\".\"ss_item_sk\", \"t3\".\"ss_customer_sk\"\r\n                        FROM (SELECT \"ss_sold_date_sk\", \"ss_item_sk\", \"ss_customer_sk\"\r\n                                FROM \"store_sales\"\r\n                                WHERE \"ss_sales_price\" / \"ss_list_price\" >= 0.77 AND \"ss_sales_price\" / \"ss_list_price\" <= 0.87 AND \"ss_customer_sk\" IS NOT NULL\r\n                                GROUP BY \"ss_sold_date_sk\", \"ss_item_sk\", \"ss_customer_sk\") AS \"t3\"\r\n                            INNER JOIN (SELECT *\r\n                                FROM \"date_dim\"\r\n                                WHERE \"d_year\" = 2002 AND (\"d_moy\" >= 4 AND \"d_moy\" <= 7)) AS \"t4\" ON \"t3\".\"ss_sold_date_sk\" = \"t4\".\"d_date_sk\"\r\n                        GROUP BY \"t3\".\"ss_item_sk\", \"t3\".\"ss_customer_sk\") AS \"t5\"\r\n                    INNER JOIN (SELECT *\r\n                        FROM \"item\"\r\n                        WHERE (\"i_category\" = 'Books' OR \"i_category\" = 'Electronics' OR \"i_category\" = 'Sports') AND (\"i_manager_id\" >= 91 AND \"i_manager_id\" <= 100)) AS \"t6\" ON \"t5\".\"ss_item_sk\" = \"t6\".\"i_item_sk\"\r\n                GROUP BY \"t5\".\"ss_customer_sk\") AS \"t7\" ON \"t\".\"c_customer_sk\" = \"t7\".\"ss_customer_sk\") AS \"t8\"\r\n    LEFT JOIN (SELECT \"t12\".\"ws_bill_customer_sk\", TRUE AS \"$f1\"\r\n        FROM (SELECT \"t10\".\"ws_item_sk\", \"t10\".\"ws_bill_customer_sk\"\r\n                FROM (SELECT \"ws_sold_date_sk\", \"ws_item_sk\", \"ws_bill_customer_sk\"\r\n                        FROM \"web_sales\"\r\n                        WHERE \"ws_sales_price\" / \"ws_list_price\" >= 0.77 AND \"ws_sales_price\" / \"ws_list_price\" <= 0.87 AND \"ws_bill_customer_sk\" IS NOT NULL\r\n                        GROUP BY \"ws_sold_date_sk\", \"ws_item_sk\", \"ws_bill_customer_sk\") AS \"t10\"\r\n                    INNER JOIN (SELECT *\r\n                        FROM \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\")\r\n                        WHERE \"d_year0\" = 2002 AND (\"d_moy0\" >= 4 AND \"d_moy0\" <= 7)) AS \"t11\" ON \"t10\".\"ws_sold_date_sk\" = \"t11\".\"d_date_sk0\"\r\n                GROUP BY \"t10\".\"ws_item_sk\", \"t10\".\"ws_bill_customer_sk\") AS \"t12\"\r\n            INNER JOIN (SELECT *\r\n                FROM \"item\" AS \"item0\" (\"i_item_sk0\", \"i_item_id0\", \"i_rec_start_date0\", \"i_rec_end_date0\", \"i_item_desc0\", \"i_current_price0\", \"i_wholesale_cost0\", \"i_brand_id0\", \"i_brand0\", \"i_class_id0\", \"i_class0\", \"i_category_id0\", \"i_category0\", \"i_manufact_id0\", \"i_manufact0\", \"i_size0\", \"i_formulation0\", \"i_color0\", \"i_units0\", \"i_container0\", \"i_manager_id0\", \"i_product_name0\")\r\n                WHERE (\"i_category0\" = 'Books' OR \"i_category0\" = 'Electronics' OR \"i_category0\" = 'Sports') AND (\"i_manager_id0\" >= 91 AND \"i_manager_id0\" <= 100)) AS \"t13\" ON \"t12\".\"ws_item_sk\" = \"t13\".\"i_item_sk0\"\r\n        GROUP BY \"t12\".\"ws_bill_customer_sk\") AS \"t15\" ON \"t8\".\"c_customer_sk\" = \"t15\".\"ws_bill_customer_sk\"\r\n    LEFT JOIN (SELECT \"t19\".\"cs_ship_customer_sk\", TRUE AS \"$f10\"\r\n        FROM (SELECT \"t17\".\"cs_ship_customer_sk\", \"t17\".\"cs_item_sk\"\r\n                FROM (SELECT \"cs_sold_date_sk\", \"cs_ship_customer_sk\", \"cs_item_sk\"\r\n                        FROM \"catalog_sales\"\r\n                        WHERE \"cs_sales_price\" / \"cs_list_price\" >= 0.77 AND \"cs_sales_price\" / \"cs_list_price\" <= 0.87 AND \"cs_ship_customer_sk\" IS NOT NULL\r\n                        GROUP BY \"cs_sold_date_sk\", \"cs_ship_customer_sk\", \"cs_item_sk\") AS \"t17\"\r\n                    INNER JOIN (SELECT *\r\n                        FROM \"date_dim\" AS \"date_dim1\" (\"d_date_sk1\", \"d_date_id1\", \"d_date1\", \"d_month_seq1\", \"d_week_seq1\", \"d_quarter_seq1\", \"d_year1\", \"d_dow1\", \"d_moy1\", \"d_dom1\", \"d_qoy1\", \"d_fy_year1\", \"d_fy_quarter_seq1\", \"d_fy_week_seq1\", \"d_day_name1\", \"d_quarter_name1\", \"d_holiday1\", \"d_weekend1\", \"d_following_holiday1\", \"d_first_dom1\", \"d_last_dom1\", \"d_same_day_ly1\", \"d_same_day_lq1\", \"d_current_day1\", \"d_current_week1\", \"d_current_month1\", \"d_current_quarter1\", \"d_current_year1\")\r\n                        WHERE \"d_year1\" = 2002 AND (\"d_moy1\" >= 4 AND \"d_moy1\" <= 7)) AS \"t18\" ON \"t17\".\"cs_sold_date_sk\" = \"t18\".\"d_date_sk1\"\r\n                GROUP BY \"t17\".\"cs_ship_customer_sk\", \"t17\".\"cs_item_sk\") AS \"t19\"\r\n            INNER JOIN (SELECT *\r\n                FROM \"item\" AS \"item1\" (\"i_item_sk1\", \"i_item_id1\", \"i_rec_start_date1\", \"i_rec_end_date1\", \"i_item_desc1\", \"i_current_price1\", \"i_wholesale_cost1\", \"i_brand_id1\", \"i_brand1\", \"i_class_id1\", \"i_class1\", \"i_category_id1\", \"i_category1\", \"i_manufact_id1\", \"i_manufact1\", \"i_size1\", \"i_formulation1\", \"i_color1\", \"i_units1\", \"i_container1\", \"i_manager_id1\", \"i_product_name1\")\r\n                WHERE (\"i_category1\" = 'Books' OR \"i_category1\" = 'Electronics' OR \"i_category1\" = 'Sports') AND (\"i_manager_id1\" >= 91 AND \"i_manager_id1\" <= 100)) AS \"t20\" ON \"t19\".\"cs_item_sk\" = \"t20\".\"i_item_sk1\"\r\n        GROUP BY \"t19\".\"cs_ship_customer_sk\") AS \"t22\" ON \"t8\".\"c_customer_sk\" = \"t22\".\"cs_ship_customer_sk\"\r\nWHERE \"t15\".\"$f1\" IS NOT NULL OR \"t22\".\"$f10\" IS NOT NULL\r\nGROUP BY \"t8\".\"cd_gender\", \"t8\".\"cd_marital_status\", \"t8\".\"cd_education_status\", \"t8\".\"cd_purchase_estimate\", \"t8\".\"cd_credit_rating\", \"t8\".\"cd_dep_count\", \"t8\".\"cd_dep_employed_count\", \"t8\".\"cd_dep_college_count\"\r\nORDER BY \"t8\".\"cd_gender\", \"t8\".\"cd_marital_status\", \"t8\".\"cd_education_status\", \"t8\".\"cd_purchase_estimate\", \"t8\".\"cd_credit_rating\", \"t8\".\"cd_dep_count\", \"t8\".\"cd_dep_employed_count\", \"t8\".\"cd_dep_college_count\"\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 132.07, "used_rules": ["FILTER_SUB_QUERY_TO_CORRELATE", "FILTER_REDUCE_EXPRESSIONS", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_JOIN_TRANSPOSE_EXTENDED", "JOIN_PUSH_TRANSITIVE_PREDICATES", "JOIN_EXTRACT_FILTER", "JOIN_PROJECT_RIGHT_TRANSPOSE", "FILTER_INTO_JOIN", "FILTER_PROJECT_TRANSPOSE", "FILTER_MERGE", "FILTER_INTO_JOIN", "AGGREGATE_PROJECT_MERGE"], "rewrite_time": 5537}
{"name": "query010_1", "input_sql": "select \n  cd_gender,\n  cd_marital_status,\n  cd_education_status,\n  count(*) cnt1,\n  cd_purchase_estimate,\n  count(*) cnt2,\n  cd_credit_rating,\n  count(*) cnt3,\n  cd_dep_count,\n  count(*) cnt4,\n  cd_dep_employed_count,\n  count(*) cnt5,\n  cd_dep_college_count,\n  count(*) cnt6\n from\n  customer c,customer_address ca,customer_demographics\n where\n  c.c_current_addr_sk = ca.ca_address_sk and\n  ca_county in ('Caledonia County','Cleveland County','Montezuma County','Pearl River County','Pinal County') and\n  c.c_birth_month in (4, 5) and\n  cd_demo_sk = c.c_current_cdemo_sk\n  and cd_marital_status in ('D', 'S', 'M')\n  and cd_education_status in ('4 yr Degree', 'Unknown', '2 yr Degree')\n  and cd_gender = 'F' and\n  exists (select *\n          from store_sales,date_dim, item\n          where c.c_customer_sk = ss_customer_sk and\n                ss_sold_date_sk = d_date_sk and\n                d_year = 2001 and\n                d_moy between 9 and 9+3 and\n                ss_item_sk = i_item_sk and\n                i_category in ('Home', 'Jewelry', 'Shoes')\n                and ss_sales_price / ss_list_price BETWEEN 53 * 0.01 AND 63 * 0.01\n                and i_manager_id BETWEEN 28 and 37\n                ) and\n   (exists (select *\n            from web_sales,date_dim, item\n            where c.c_customer_sk = ws_bill_customer_sk and\n                  ws_sold_date_sk = d_date_sk and\n                  d_year = 2001 and\n                  d_moy between 9 ANd 9+3 and\n                  ws_item_sk = i_item_sk and\n                  i_category in ('Home', 'Jewelry', 'Shoes')\n                  and i_manager_id BETWEEN 28 and 37\n                  and ws_sales_price / ws_list_price BETWEEN 53 * 0.01 AND 63 * 0.01\n                  ) or\n    exists (select *\n            from catalog_sales,date_dim, item\n            where c.c_customer_sk = cs_ship_customer_sk and\n                  cs_sold_date_sk = d_date_sk and\n                  d_year = 2001 and\n                  d_moy between 9 and 9+3 and\n                  cs_item_sk = i_item_sk and\n                  i_category in ('Home', 'Jewelry', 'Shoes')\n                  and i_manager_id BETWEEN 28 and 37\n                  and cs_sales_price / cs_list_price BETWEEN 53 * 0.01 AND 63 * 0.01\n                  ))\n group by cd_gender,\n          cd_marital_status,\n          cd_education_status,\n          cd_purchase_estimate,\n          cd_credit_rating,\n          cd_dep_count,\n          cd_dep_employed_count,\n          cd_dep_college_count\n order by cd_gender,\n          cd_marital_status,\n          cd_education_status,\n          cd_purchase_estimate,\n          cd_credit_rating,\n          cd_dep_count,\n          cd_dep_employed_count,\n          cd_dep_college_count\nlimit 100;", "input_cost": 144.15, "output_sql": "SELECT \"t8\".\"cd_gender\", \"t8\".\"cd_marital_status\", \"t8\".\"cd_education_status\", COUNT(*) AS \"cnt6\", \"t8\".\"cd_purchase_estimate\", COUNT(*) AS \"cnt60\", \"t8\".\"cd_credit_rating\", COUNT(*) AS \"cnt61\", \"t8\".\"cd_dep_count\", COUNT(*) AS \"cnt62\", \"t8\".\"cd_dep_employed_count\", COUNT(*) AS \"cnt63\", \"t8\".\"cd_dep_college_count\", COUNT(*) AS \"cnt64\"\r\nFROM (SELECT \"t\".\"c_customer_sk\", \"t\".\"c_customer_id\", \"t\".\"c_current_cdemo_sk\", \"t\".\"c_current_hdemo_sk\", \"t\".\"c_current_addr_sk\", \"t\".\"c_first_shipto_date_sk\", \"t\".\"c_first_sales_date_sk\", \"t\".\"c_salutation\", \"t\".\"c_first_name\", \"t\".\"c_last_name\", \"t\".\"c_preferred_cust_flag\", \"t\".\"c_birth_day\", \"t\".\"c_birth_month\", \"t\".\"c_birth_year\", \"t\".\"c_birth_country\", \"t\".\"c_login\", \"t\".\"c_email_address\", \"t\".\"c_last_review_date_sk\", \"t0\".\"ca_address_sk\", \"t0\".\"ca_address_id\", \"t0\".\"ca_street_number\", \"t0\".\"ca_street_name\", \"t0\".\"ca_street_type\", \"t0\".\"ca_suite_number\", \"t0\".\"ca_city\", \"t0\".\"ca_county\", \"t0\".\"ca_state\", \"t0\".\"ca_zip\", \"t0\".\"ca_country\", \"t0\".\"ca_gmt_offset\", \"t0\".\"ca_location_type\", \"t1\".\"cd_demo_sk\", \"t1\".\"cd_gender\", \"t1\".\"cd_marital_status\", \"t1\".\"cd_education_status\", \"t1\".\"cd_purchase_estimate\", \"t1\".\"cd_credit_rating\", \"t1\".\"cd_dep_count\", \"t1\".\"cd_dep_employed_count\", \"t1\".\"cd_dep_college_count\", \"t7\".\"ss_customer_sk\", TRUE AS \"$f1\"\r\n        FROM (SELECT *\r\n                FROM \"customer\"\r\n                WHERE \"c_birth_month\" IN (4, 5) AND \"c_customer_sk\" IS NOT NULL) AS \"t\"\r\n            INNER JOIN (SELECT *\r\n                FROM \"customer_address\"\r\n                WHERE CAST(\"ca_county\" AS VARCHAR(16)) IN ('Caledonia County', 'Cleveland County', 'Montezuma County') OR \"ca_county\" = 'Pearl River County' OR \"ca_county\" = 'Pinal County') AS \"t0\" ON \"t\".\"c_current_addr_sk\" = \"t0\".\"ca_address_sk\"\r\n            INNER JOIN (SELECT *\r\n                FROM \"customer_demographics\"\r\n                WHERE CAST(\"cd_marital_status\" AS CHAR(1)) IN ('D', 'M', 'S') AND (CAST(\"cd_education_status\" AS CHAR(11)) IN ('2 yr Degree', '4 yr Degree') OR \"cd_education_status\" = 'Unknown') AND \"cd_gender\" = 'F') AS \"t1\" ON \"t\".\"c_current_cdemo_sk\" = \"t1\".\"cd_demo_sk\"\r\n            INNER JOIN (SELECT \"t5\".\"ss_customer_sk\"\r\n                FROM (SELECT \"t3\".\"ss_item_sk\", \"t3\".\"ss_customer_sk\"\r\n                        FROM (SELECT \"ss_sold_date_sk\", \"ss_item_sk\", \"ss_customer_sk\"\r\n                                FROM \"store_sales\"\r\n                                WHERE \"ss_sales_price\" / \"ss_list_price\" >= 0.53 AND \"ss_sales_price\" / \"ss_list_price\" <= 0.63 AND \"ss_customer_sk\" IS NOT NULL\r\n                                GROUP BY \"ss_sold_date_sk\", \"ss_item_sk\", \"ss_customer_sk\") AS \"t3\"\r\n                            INNER JOIN (SELECT *\r\n                                FROM \"date_dim\"\r\n                                WHERE \"d_year\" = 2001 AND (\"d_moy\" >= 9 AND \"d_moy\" <= 12)) AS \"t4\" ON \"t3\".\"ss_sold_date_sk\" = \"t4\".\"d_date_sk\"\r\n                        GROUP BY \"t3\".\"ss_item_sk\", \"t3\".\"ss_customer_sk\") AS \"t5\"\r\n                    INNER JOIN (SELECT *\r\n                        FROM \"item\"\r\n                        WHERE (\"i_category\" = 'Home' OR \"i_category\" = 'Jewelry' OR \"i_category\" = 'Shoes') AND (\"i_manager_id\" >= 28 AND \"i_manager_id\" <= 37)) AS \"t6\" ON \"t5\".\"ss_item_sk\" = \"t6\".\"i_item_sk\"\r\n                GROUP BY \"t5\".\"ss_customer_sk\") AS \"t7\" ON \"t\".\"c_customer_sk\" = \"t7\".\"ss_customer_sk\") AS \"t8\"\r\n    LEFT JOIN (SELECT \"t12\".\"ws_bill_customer_sk\", TRUE AS \"$f1\"\r\n        FROM (SELECT \"t10\".\"ws_item_sk\", \"t10\".\"ws_bill_customer_sk\"\r\n                FROM (SELECT \"ws_sold_date_sk\", \"ws_item_sk\", \"ws_bill_customer_sk\"\r\n                        FROM \"web_sales\"\r\n                        WHERE \"ws_sales_price\" / \"ws_list_price\" >= 0.53 AND \"ws_sales_price\" / \"ws_list_price\" <= 0.63 AND \"ws_bill_customer_sk\" IS NOT NULL\r\n                        GROUP BY \"ws_sold_date_sk\", \"ws_item_sk\", \"ws_bill_customer_sk\") AS \"t10\"\r\n                    INNER JOIN (SELECT *\r\n                        FROM \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\")\r\n                        WHERE \"d_year0\" = 2001 AND (\"d_moy0\" >= 9 AND \"d_moy0\" <= 12)) AS \"t11\" ON \"t10\".\"ws_sold_date_sk\" = \"t11\".\"d_date_sk0\"\r\n                GROUP BY \"t10\".\"ws_item_sk\", \"t10\".\"ws_bill_customer_sk\") AS \"t12\"\r\n            INNER JOIN (SELECT *\r\n                FROM \"item\" AS \"item0\" (\"i_item_sk0\", \"i_item_id0\", \"i_rec_start_date0\", \"i_rec_end_date0\", \"i_item_desc0\", \"i_current_price0\", \"i_wholesale_cost0\", \"i_brand_id0\", \"i_brand0\", \"i_class_id0\", \"i_class0\", \"i_category_id0\", \"i_category0\", \"i_manufact_id0\", \"i_manufact0\", \"i_size0\", \"i_formulation0\", \"i_color0\", \"i_units0\", \"i_container0\", \"i_manager_id0\", \"i_product_name0\")\r\n                WHERE (\"i_category0\" = 'Home' OR \"i_category0\" = 'Jewelry' OR \"i_category0\" = 'Shoes') AND (\"i_manager_id0\" >= 28 AND \"i_manager_id0\" <= 37)) AS \"t13\" ON \"t12\".\"ws_item_sk\" = \"t13\".\"i_item_sk0\"\r\n        GROUP BY \"t12\".\"ws_bill_customer_sk\") AS \"t15\" ON \"t8\".\"c_customer_sk\" = \"t15\".\"ws_bill_customer_sk\"\r\n    LEFT JOIN (SELECT \"t19\".\"cs_ship_customer_sk\", TRUE AS \"$f10\"\r\n        FROM (SELECT \"t17\".\"cs_ship_customer_sk\", \"t17\".\"cs_item_sk\"\r\n                FROM (SELECT \"cs_sold_date_sk\", \"cs_ship_customer_sk\", \"cs_item_sk\"\r\n                        FROM \"catalog_sales\"\r\n                        WHERE \"cs_sales_price\" / \"cs_list_price\" >= 0.53 AND \"cs_sales_price\" / \"cs_list_price\" <= 0.63 AND \"cs_ship_customer_sk\" IS NOT NULL\r\n                        GROUP BY \"cs_sold_date_sk\", \"cs_ship_customer_sk\", \"cs_item_sk\") AS \"t17\"\r\n                    INNER JOIN (SELECT *\r\n                        FROM \"date_dim\" AS \"date_dim1\" (\"d_date_sk1\", \"d_date_id1\", \"d_date1\", \"d_month_seq1\", \"d_week_seq1\", \"d_quarter_seq1\", \"d_year1\", \"d_dow1\", \"d_moy1\", \"d_dom1\", \"d_qoy1\", \"d_fy_year1\", \"d_fy_quarter_seq1\", \"d_fy_week_seq1\", \"d_day_name1\", \"d_quarter_name1\", \"d_holiday1\", \"d_weekend1\", \"d_following_holiday1\", \"d_first_dom1\", \"d_last_dom1\", \"d_same_day_ly1\", \"d_same_day_lq1\", \"d_current_day1\", \"d_current_week1\", \"d_current_month1\", \"d_current_quarter1\", \"d_current_year1\")\r\n                        WHERE \"d_year1\" = 2001 AND (\"d_moy1\" >= 9 AND \"d_moy1\" <= 12)) AS \"t18\" ON \"t17\".\"cs_sold_date_sk\" = \"t18\".\"d_date_sk1\"\r\n                GROUP BY \"t17\".\"cs_ship_customer_sk\", \"t17\".\"cs_item_sk\") AS \"t19\"\r\n            INNER JOIN (SELECT *\r\n                FROM \"item\" AS \"item1\" (\"i_item_sk1\", \"i_item_id1\", \"i_rec_start_date1\", \"i_rec_end_date1\", \"i_item_desc1\", \"i_current_price1\", \"i_wholesale_cost1\", \"i_brand_id1\", \"i_brand1\", \"i_class_id1\", \"i_class1\", \"i_category_id1\", \"i_category1\", \"i_manufact_id1\", \"i_manufact1\", \"i_size1\", \"i_formulation1\", \"i_color1\", \"i_units1\", \"i_container1\", \"i_manager_id1\", \"i_product_name1\")\r\n                WHERE (\"i_category1\" = 'Home' OR \"i_category1\" = 'Jewelry' OR \"i_category1\" = 'Shoes') AND (\"i_manager_id1\" >= 28 AND \"i_manager_id1\" <= 37)) AS \"t20\" ON \"t19\".\"cs_item_sk\" = \"t20\".\"i_item_sk1\"\r\n        GROUP BY \"t19\".\"cs_ship_customer_sk\") AS \"t22\" ON \"t8\".\"c_customer_sk\" = \"t22\".\"cs_ship_customer_sk\"\r\nWHERE \"t15\".\"$f1\" IS NOT NULL OR \"t22\".\"$f10\" IS NOT NULL\r\nGROUP BY \"t8\".\"cd_gender\", \"t8\".\"cd_marital_status\", \"t8\".\"cd_education_status\", \"t8\".\"cd_purchase_estimate\", \"t8\".\"cd_credit_rating\", \"t8\".\"cd_dep_count\", \"t8\".\"cd_dep_employed_count\", \"t8\".\"cd_dep_college_count\"\r\nORDER BY \"t8\".\"cd_gender\", \"t8\".\"cd_marital_status\", \"t8\".\"cd_education_status\", \"t8\".\"cd_purchase_estimate\", \"t8\".\"cd_credit_rating\", \"t8\".\"cd_dep_count\", \"t8\".\"cd_dep_employed_count\", \"t8\".\"cd_dep_college_count\"\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 132.08, "used_rules": ["FILTER_SUB_QUERY_TO_CORRELATE", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_JOIN_TRANSPOSE_EXTENDED", "JOIN_PUSH_TRANSITIVE_PREDICATES", "JOIN_EXTRACT_FILTER", "JOIN_PROJECT_RIGHT_TRANSPOSE", "FILTER_INTO_JOIN", "FILTER_PROJECT_TRANSPOSE", "FILTER_MERGE", "FILTER_REDUCE_EXPRESSIONS", "FILTER_INTO_JOIN", "AGGREGATE_PROJECT_MERGE"], "rewrite_time": 4567}
{"name": "query013_0", "input_sql": "select avg(ss_quantity)\n,avg(ss_ext_sales_price)\n,avg(ss_ext_wholesale_cost)\n,sum(ss_ext_wholesale_cost)\nfrom store_sales\n   ,store\n   ,customer_demographics\n   ,household_demographics\n   ,customer_address\n   ,date_dim\nwhere s_store_sk = ss_store_sk\nand  ss_sold_date_sk = d_date_sk and d_year = 2001\nand((ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'S'\nand cd_education_status = 'Unknown'\nand ss_sales_price between 100.00 and 150.00\nand hd_dep_count = 3\n   )or\n   (ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'D'\nand cd_education_status = 'Unknown'\nand ss_sales_price between 50.00 and 100.00\nand hd_dep_count = 1\n   ) or\n   (ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'W'\nand cd_education_status = 'Unknown'\nand ss_sales_price between 150.00 and 200.00\nand hd_dep_count = 1\n   ))\nand((ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('KS', 'LA', 'OK')\nand ss_net_profit between 100 and 200\n   ) or\n   (ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('GA', 'ME', 'NC')\nand ss_net_profit between 150 and 300\n   ) or\n   (ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('IA', 'IL', 'MI')\nand ss_net_profit between 50 and 250\n   ));", "input_cost": 51.4, "output_sql": "SELECT CAST(CASE WHEN COALESCE(SUM(\"t2\".\"$f2\"), 0) = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"$f1\"), 0) END / COALESCE(SUM(\"t2\".\"$f2\"), 0) AS INTEGER), CASE WHEN COALESCE(SUM(\"t2\".\"$f4\"), 0) = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"$f3\"), 0) END / COALESCE(SUM(\"t2\".\"$f4\"), 0), CASE WHEN COALESCE(SUM(\"t2\".\"$f6\"), 0) = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"$f5\"), 0) END / COALESCE(SUM(\"t2\".\"$f6\"), 0), CASE WHEN COALESCE(SUM(\"t2\".\"$f6\"), 0) = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"$f5\"), 0) END\r\nFROM (SELECT \"t0\".\"ss_sold_date_sk\", COALESCE(SUM(\"t0\".\"ss_quantity\"), 0) AS \"$f1\", COUNT(\"t0\".\"ss_quantity\") AS \"$f2\", COALESCE(SUM(\"t0\".\"ss_ext_sales_price\"), 0) AS \"$f3\", COUNT(\"t0\".\"ss_ext_sales_price\") AS \"$f4\", COALESCE(SUM(\"t0\".\"ss_ext_wholesale_cost\"), 0) AS \"$f5\", COUNT(\"t0\".\"ss_ext_wholesale_cost\") AS \"$f6\"\r\n        FROM (SELECT *\r\n                FROM (SELECT *\r\n                        FROM \"store_sales\",\r\n                            \"store\"\r\n                        WHERE \"store\".\"s_store_sk\" = \"store_sales\".\"ss_store_sk\") AS \"t\",\r\n                    \"customer_demographics\",\r\n                    \"household_demographics\"\r\n                WHERE \"t\".\"ss_hdemo_sk\" = \"household_demographics\".\"hd_demo_sk\" AND (\"customer_demographics\".\"cd_demo_sk\" = \"t\".\"ss_cdemo_sk\" AND \"customer_demographics\".\"cd_marital_status\" = 'S') AND (\"customer_demographics\".\"cd_education_status\" = 'Unknown' AND (\"t\".\"ss_sales_price\" >= 100.00 AND \"t\".\"ss_sales_price\" <= 150.00 AND \"household_demographics\".\"hd_dep_count\" = 3)) OR \"t\".\"ss_hdemo_sk\" = \"household_demographics\".\"hd_demo_sk\" AND (\"customer_demographics\".\"cd_demo_sk\" = \"t\".\"ss_cdemo_sk\" AND \"customer_demographics\".\"cd_marital_status\" = 'D') AND (\"customer_demographics\".\"cd_education_status\" = 'Unknown' AND (\"t\".\"ss_sales_price\" >= 50.00 AND \"t\".\"ss_sales_price\" <= 100.00 AND \"household_demographics\".\"hd_dep_count\" = 1)) OR \"t\".\"ss_hdemo_sk\" = \"household_demographics\".\"hd_demo_sk\" AND (\"customer_demographics\".\"cd_demo_sk\" = \"t\".\"ss_cdemo_sk\" AND \"customer_demographics\".\"cd_marital_status\" = 'W') AND (\"customer_demographics\".\"cd_education_status\" = 'Unknown' AND (\"t\".\"ss_sales_price\" >= 150.00 AND \"t\".\"ss_sales_price\" <= 200.00 AND \"household_demographics\".\"hd_dep_count\" = 1))) AS \"t0\",\r\n            \"customer_address\"\r\n        WHERE \"t0\".\"ss_addr_sk\" = \"customer_address\".\"ca_address_sk\" AND \"customer_address\".\"ca_country\" = 'United States' AND CAST(\"customer_address\".\"ca_state\" AS CHAR(2)) IN ('KS', 'LA', 'OK') AND (\"t0\".\"ss_net_profit\" >= 100 AND \"t0\".\"ss_net_profit\" <= 200) OR \"t0\".\"ss_addr_sk\" = \"customer_address\".\"ca_address_sk\" AND \"customer_address\".\"ca_country\" = 'United States' AND CAST(\"customer_address\".\"ca_state\" AS CHAR(2)) IN ('GA', 'ME', 'NC') AND (\"t0\".\"ss_net_profit\" >= 150 AND \"t0\".\"ss_net_profit\" <= 300) OR \"t0\".\"ss_addr_sk\" = \"customer_address\".\"ca_address_sk\" AND \"customer_address\".\"ca_country\" = 'United States' AND CAST(\"customer_address\".\"ca_state\" AS CHAR(2)) IN ('IA', 'IL', 'MI') AND (\"t0\".\"ss_net_profit\" >= 50 AND \"t0\".\"ss_net_profit\" <= 250)\r\n        GROUP BY \"t0\".\"ss_sold_date_sk\") AS \"t2\",\r\n        (SELECT \"d_date_sk\"\r\n        FROM \"date_dim\"\r\n        WHERE \"d_year\" = 2001) AS \"t4\"\r\nWHERE \"t2\".\"ss_sold_date_sk\" = \"t4\".\"d_date_sk\";", "output_cost": 58.26, "used_rules": ["FILTER_INTO_JOIN", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_REDUCE_FUNCTIONS", "AGGREGATE_JOIN_TRANSPOSE_EXTENDED", "PROJECT_TO_CALC", "CALC_MERGE", "JOIN_EXTRACT_FILTER"], "rewrite_time": 1586}
{"name": "query013_1", "input_sql": "select avg(ss_quantity)\n,avg(ss_ext_sales_price)\n,avg(ss_ext_wholesale_cost)\n,sum(ss_ext_wholesale_cost)\nfrom store_sales\n   ,store\n   ,customer_demographics\n   ,household_demographics\n   ,customer_address\n   ,date_dim\nwhere s_store_sk = ss_store_sk\nand  ss_sold_date_sk = d_date_sk and d_year = 2001\nand((ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'S'\nand cd_education_status = '4 yr Degree'\nand ss_sales_price between 100.00 and 150.00\nand hd_dep_count = 3\n   )or\n   (ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'S'\nand cd_education_status = '4 yr Degree'\nand ss_sales_price between 50.00 and 100.00\nand hd_dep_count = 1\n   ) or\n   (ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'D'\nand cd_education_status = 'Advanced Degree'\nand ss_sales_price between 150.00 and 200.00\nand hd_dep_count = 1\n   ))\nand((ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('KS', 'MD', 'NC')\nand ss_net_profit between 100 and 200\n   ) or\n   (ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('IN', 'MN', 'TN')\nand ss_net_profit between 150 and 300\n   ) or\n   (ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('MN', 'PA', 'WI')\nand ss_net_profit between 50 and 250\n   ));", "input_cost": 51.42, "output_sql": "SELECT CAST(CASE WHEN COALESCE(SUM(\"t2\".\"$f2\"), 0) = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"$f1\"), 0) END / COALESCE(SUM(\"t2\".\"$f2\"), 0) AS INTEGER), CASE WHEN COALESCE(SUM(\"t2\".\"$f4\"), 0) = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"$f3\"), 0) END / COALESCE(SUM(\"t2\".\"$f4\"), 0), CASE WHEN COALESCE(SUM(\"t2\".\"$f6\"), 0) = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"$f5\"), 0) END / COALESCE(SUM(\"t2\".\"$f6\"), 0), CASE WHEN COALESCE(SUM(\"t2\".\"$f6\"), 0) = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"$f5\"), 0) END\r\nFROM (SELECT \"t0\".\"ss_sold_date_sk\", COALESCE(SUM(\"t0\".\"ss_quantity\"), 0) AS \"$f1\", COUNT(\"t0\".\"ss_quantity\") AS \"$f2\", COALESCE(SUM(\"t0\".\"ss_ext_sales_price\"), 0) AS \"$f3\", COUNT(\"t0\".\"ss_ext_sales_price\") AS \"$f4\", COALESCE(SUM(\"t0\".\"ss_ext_wholesale_cost\"), 0) AS \"$f5\", COUNT(\"t0\".\"ss_ext_wholesale_cost\") AS \"$f6\"\r\n        FROM (SELECT *\r\n                FROM (SELECT *\r\n                        FROM \"store_sales\",\r\n                            \"store\"\r\n                        WHERE \"store\".\"s_store_sk\" = \"store_sales\".\"ss_store_sk\") AS \"t\",\r\n                    \"customer_demographics\",\r\n                    \"household_demographics\"\r\n                WHERE \"t\".\"ss_hdemo_sk\" = \"household_demographics\".\"hd_demo_sk\" AND (\"customer_demographics\".\"cd_demo_sk\" = \"t\".\"ss_cdemo_sk\" AND \"customer_demographics\".\"cd_marital_status\" = 'S') AND (\"customer_demographics\".\"cd_education_status\" = '4 yr Degree' AND (\"t\".\"ss_sales_price\" >= 100.00 AND \"t\".\"ss_sales_price\" <= 150.00 AND \"household_demographics\".\"hd_dep_count\" = 3)) OR \"t\".\"ss_hdemo_sk\" = \"household_demographics\".\"hd_demo_sk\" AND (\"customer_demographics\".\"cd_demo_sk\" = \"t\".\"ss_cdemo_sk\" AND \"customer_demographics\".\"cd_marital_status\" = 'S') AND (\"customer_demographics\".\"cd_education_status\" = '4 yr Degree' AND (\"t\".\"ss_sales_price\" >= 50.00 AND \"t\".\"ss_sales_price\" <= 100.00 AND \"household_demographics\".\"hd_dep_count\" = 1)) OR \"t\".\"ss_hdemo_sk\" = \"household_demographics\".\"hd_demo_sk\" AND (\"customer_demographics\".\"cd_demo_sk\" = \"t\".\"ss_cdemo_sk\" AND \"customer_demographics\".\"cd_marital_status\" = 'D') AND (\"customer_demographics\".\"cd_education_status\" = 'Advanced Degree' AND (\"t\".\"ss_sales_price\" >= 150.00 AND \"t\".\"ss_sales_price\" <= 200.00 AND \"household_demographics\".\"hd_dep_count\" = 1))) AS \"t0\",\r\n            \"customer_address\"\r\n        WHERE \"t0\".\"ss_addr_sk\" = \"customer_address\".\"ca_address_sk\" AND \"customer_address\".\"ca_country\" = 'United States' AND CAST(\"customer_address\".\"ca_state\" AS CHAR(2)) IN ('KS', 'MD', 'NC') AND (\"t0\".\"ss_net_profit\" >= 100 AND \"t0\".\"ss_net_profit\" <= 200) OR \"t0\".\"ss_addr_sk\" = \"customer_address\".\"ca_address_sk\" AND \"customer_address\".\"ca_country\" = 'United States' AND CAST(\"customer_address\".\"ca_state\" AS CHAR(2)) IN ('IN', 'MN', 'TN') AND (\"t0\".\"ss_net_profit\" >= 150 AND \"t0\".\"ss_net_profit\" <= 300) OR \"t0\".\"ss_addr_sk\" = \"customer_address\".\"ca_address_sk\" AND \"customer_address\".\"ca_country\" = 'United States' AND CAST(\"customer_address\".\"ca_state\" AS CHAR(2)) IN ('MN', 'PA', 'WI') AND (\"t0\".\"ss_net_profit\" >= 50 AND \"t0\".\"ss_net_profit\" <= 250)\r\n        GROUP BY \"t0\".\"ss_sold_date_sk\") AS \"t2\",\r\n        (SELECT \"d_date_sk\"\r\n        FROM \"date_dim\"\r\n        WHERE \"d_year\" = 2001) AS \"t4\"\r\nWHERE \"t2\".\"ss_sold_date_sk\" = \"t4\".\"d_date_sk\";", "output_cost": 58.27, "used_rules": ["FILTER_INTO_JOIN", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_REDUCE_FUNCTIONS", "AGGREGATE_JOIN_TRANSPOSE_EXTENDED", "PROJECT_TO_CALC", "CALC_MERGE", "JOIN_EXTRACT_FILTER"], "rewrite_time": 1550}
{"name": "query014_0", "input_sql": "with  cross_items as\n (select i_item_sk ss_item_sk\n from item,\n (select iss.i_brand_id brand_id\n     ,iss.i_class_id class_id\n     ,iss.i_category_id category_id\n from store_sales\n     ,item iss\n     ,date_dim d1\n where ss_item_sk = iss.i_item_sk\n   and ss_sold_date_sk = d1.d_date_sk\n   and d1.d_year between 1998 AND 1998 + 2\n   and i_category IN ('Books', 'Jewelry', 'Shoes')\n   and i_manager_id BETWEEN 91 and 100\n   and ss_wholesale_cost BETWEEN 73 AND 93\nintersect\n select ics.i_brand_id\n     ,ics.i_class_id\n     ,ics.i_category_id\n from catalog_sales\n     ,item ics\n     ,date_dim d2\n where cs_item_sk = ics.i_item_sk\n   and cs_sold_date_sk = d2.d_date_sk\n   and d2.d_year between 1998 AND 1998 + 2\n   and i_category IN ('Books', 'Jewelry', 'Shoes')\n   and i_manager_id BETWEEN 91 and 100\n   and cs_wholesale_cost BETWEEN 73 AND 93\nintersect\n select iws.i_brand_id\n     ,iws.i_class_id\n     ,iws.i_category_id\n from web_sales\n     ,item iws\n     ,date_dim d3\n where ws_item_sk = iws.i_item_sk\n   and ws_sold_date_sk = d3.d_date_sk\n   and ws_wholesale_cost BETWEEN 73 AND 93\n   and d3.d_year between 1998 AND 1998 + 2) x\n where i_brand_id = brand_id\n      and i_class_id = class_id\n      and i_category_id = category_id\n      and i_category IN ('Books', 'Jewelry', 'Shoes')\n      and i_manager_id BETWEEN 91 and 100\n),\n avg_sales as\n(select avg(quantity*list_price) average_sales\n  from (select ss_quantity quantity\n             ,ss_list_price list_price\n       from store_sales\n           ,date_dim\n       where ss_sold_date_sk = d_date_sk\n         and d_year between 1998 and 1998 + 2\n         and ss_wholesale_cost BETWEEN 73 AND 93\n       union all\n       select cs_quantity quantity\n             ,cs_list_price list_price\n       from catalog_sales\n           ,date_dim\n       where cs_sold_date_sk = d_date_sk\n         and d_year between 1998 and 1998 + 2\n         and cs_wholesale_cost BETWEEN 73 AND 93\n       union all\n       select ws_quantity quantity\n             ,ws_list_price list_price\n       from web_sales\n           ,date_dim\n       where ws_sold_date_sk = d_date_sk\n        and ws_wholesale_cost BETWEEN 73 AND 93\n         and d_year between 1998 and 1998 + 2) x)\n  select  this_year.channel ty_channel\n                           ,this_year.i_brand_id ty_brand\n                           ,this_year.i_class_id ty_class\n                           ,this_year.i_category_id ty_category\n                           ,this_year.sales ty_sales\n                           ,this_year.number_sales ty_number_sales\n                           ,last_year.channel ly_channel\n                           ,last_year.i_brand_id ly_brand\n                           ,last_year.i_class_id ly_class\n                           ,last_year.i_category_id ly_category\n                           ,last_year.sales ly_sales\n                           ,last_year.number_sales ly_number_sales\n from\n (select 'store' channel, i_brand_id,i_class_id,i_category_id\n        ,sum(ss_quantity*ss_list_price) sales, count(*) number_sales\n from store_sales\n     ,item\n     ,date_dim\n where ss_item_sk in (select ss_item_sk from cross_items)\n   and ss_item_sk = i_item_sk\n   and ss_sold_date_sk = d_date_sk\n   and d_week_seq = (select d_week_seq\n                     from date_dim\n                     where d_year = 1998 + 1\n                       and d_moy = 12\n                       and d_dom = 13)\n   and i_category IN ('Books', 'Jewelry', 'Shoes')\n   and i_manager_id BETWEEN 91 and 100\n   and ss_wholesale_cost BETWEEN 73 AND 93\n group by i_brand_id,i_class_id,i_category_id\n having sum(ss_quantity*ss_list_price) > (select average_sales from avg_sales)) this_year,\n (select 'store' channel, i_brand_id,i_class_id\n        ,i_category_id, sum(ss_quantity*ss_list_price) sales, count(*) number_sales\n from store_sales\n     ,item\n     ,date_dim\n where ss_item_sk in (select ss_item_sk from cross_items)\n   and ss_item_sk = i_item_sk\n   and ss_sold_date_sk = d_date_sk\n   and d_week_seq = (select d_week_seq\n                     from date_dim\n                     where d_year = 1998\n                       and d_moy = 12\n                       and d_dom = 13)\n   and i_category IN ('Books', 'Jewelry', 'Shoes')\n   and ss_wholesale_cost BETWEEN 73 AND 93\n   and i_manager_id BETWEEN 91 and 100\ngroup by i_brand_id,i_class_id,i_category_id\n having sum(ss_quantity*ss_list_price) > (select average_sales from avg_sales)) last_year\n where this_year.i_brand_id= last_year.i_brand_id\n   and this_year.i_class_id = last_year.i_class_id\n   and this_year.i_category_id = last_year.i_category_id\n order by this_year.channel, this_year.i_brand_id, this_year.i_class_id, this_year.i_category_id\n limit 100;", "input_cost": 212.62, "output_sql": "SELECT 'store' AS \"ty_channel\", \"t57\".\"i_brand_id3\", \"t57\".\"i_class_id3\", \"t57\".\"i_category_id3\", \"t57\".\"sales\", \"t57\".\"number_sales\", 'store' AS \"ly_channel\", \"t116\".\"i_brand_id8\", \"t116\".\"i_class_id8\", \"t116\".\"i_category_id8\", \"t116\".\"sales0\", \"t116\".\"number_sales\" AS \"number_sales0\"\r\nFROM (SELECT 'store' AS \"channel\", \"t40\".\"i_brand_id3\", \"t40\".\"i_class_id3\", \"t40\".\"i_category_id3\", \"t40\".\"sales\", \"t40\".\"number_sales\"\r\n        FROM (SELECT \"t34\".\"i_brand_id3\", \"t34\".\"i_class_id3\", \"t34\".\"i_category_id3\", CASE WHEN COUNT(\"t33\".\"ss_quantity\" * \"t33\".\"ss_list_price\") = 0 THEN NULL ELSE COALESCE(SUM(\"t33\".\"ss_quantity\" * \"t33\".\"ss_list_price\"), 0) END AS \"sales\", COUNT(*) AS \"number_sales\"\r\n                FROM (SELECT \"t\".\"ss_sold_date_sk\", \"t\".\"ss_sold_time_sk\", \"t\".\"ss_item_sk\", \"t\".\"ss_customer_sk\", \"t\".\"ss_cdemo_sk\", \"t\".\"ss_hdemo_sk\", \"t\".\"ss_addr_sk\", \"t\".\"ss_store_sk\", \"t\".\"ss_promo_sk\", \"t\".\"ss_ticket_number\", \"t\".\"ss_quantity\", \"t\".\"ss_wholesale_cost\", \"t\".\"ss_list_price\", \"t\".\"ss_sales_price\", \"t\".\"ss_ext_discount_amt\", \"t\".\"ss_ext_sales_price\", \"t\".\"ss_ext_wholesale_cost\", \"t\".\"ss_ext_list_price\", \"t\".\"ss_ext_tax\", \"t\".\"ss_coupon_amt\", \"t\".\"ss_net_paid\", \"t\".\"ss_net_paid_inc_tax\", \"t\".\"ss_net_profit\"\r\n                        FROM (SELECT *\r\n                                FROM \"store_sales\"\r\n                                WHERE \"ss_wholesale_cost\" >= 73 AND \"ss_wholesale_cost\" <= 93) AS \"t\"\r\n                            INNER JOIN (SELECT \"t0\".\"i_item_sk\"\r\n                                FROM (SELECT *\r\n                                        FROM \"item\"\r\n                                        WHERE (CAST(\"i_category\" AS CHAR(5)) IN ('Books', 'Shoes') OR \"i_category\" = 'Jewelry') AND (\"i_manager_id\" >= 91 AND \"i_manager_id\" <= 100)) AS \"t0\"\r\n                                    INNER JOIN (SELECT \"i_brand_id0\", \"i_class_id0\", \"i_category_id0\"\r\n                                        FROM (SELECT \"i_brand_id0\", \"i_class_id0\", \"i_category_id0\", 1 AS \"$f3\"\r\n                                                    FROM (SELECT \"t5\".\"i_brand_id0\", \"t5\".\"i_class_id0\", \"t5\".\"i_category_id0\", COALESCE(SUM(\"t5\".\"$f4\"), 0) AS \"$f3\"\r\n                                                                FROM (SELECT \"t2\".\"ss_sold_date_sk0\", \"t4\".\"i_brand_id0\", \"t4\".\"i_class_id0\", \"t4\".\"i_category_id0\", COALESCE(SUM(\"t2\".\"$f2\"), 0) AS \"$f4\"\r\n                                                                        FROM (SELECT \"ss_sold_date_sk0\", \"ss_item_sk0\", COUNT(*) AS \"$f2\"\r\n                                                                                FROM \"store_sales\" AS \"store_sales0\" (\"ss_sold_date_sk0\", \"ss_sold_time_sk0\", \"ss_item_sk0\", \"ss_customer_sk0\", \"ss_cdemo_sk0\", \"ss_hdemo_sk0\", \"ss_addr_sk0\", \"ss_store_sk0\", \"ss_promo_sk0\", \"ss_ticket_number0\", \"ss_quantity0\", \"ss_wholesale_cost0\", \"ss_list_price0\", \"ss_sales_price0\", \"ss_ext_discount_amt0\", \"ss_ext_sales_price0\", \"ss_ext_wholesale_cost0\", \"ss_ext_list_price0\", \"ss_ext_tax0\", \"ss_coupon_amt0\", \"ss_net_paid0\", \"ss_net_paid_inc_tax0\", \"ss_net_profit0\")\r\n                                                                                WHERE \"ss_wholesale_cost0\" >= 73 AND \"ss_wholesale_cost0\" <= 93\r\n                                                                                GROUP BY \"ss_sold_date_sk0\", \"ss_item_sk0\") AS \"t2\"\r\n                                                                            INNER JOIN (SELECT \"i_item_sk0\", \"i_brand_id0\", \"i_class_id0\", \"i_category_id0\"\r\n                                                                                FROM \"item\" AS \"item0\" (\"i_item_sk0\", \"i_item_id0\", \"i_rec_start_date0\", \"i_rec_end_date0\", \"i_item_desc0\", \"i_current_price0\", \"i_wholesale_cost0\", \"i_brand_id0\", \"i_brand0\", \"i_class_id0\", \"i_class0\", \"i_category_id0\", \"i_category0\", \"i_manufact_id0\", \"i_manufact0\", \"i_size0\", \"i_formulation0\", \"i_color0\", \"i_units0\", \"i_container0\", \"i_manager_id0\", \"i_product_name0\")\r\n                                                                                WHERE (CAST(\"i_category0\" AS CHAR(5)) IN ('Books', 'Shoes') OR \"i_category0\" = 'Jewelry') AND (\"i_manager_id0\" >= 91 AND \"i_manager_id0\" <= 100)) AS \"t4\" ON \"t2\".\"ss_item_sk0\" = \"t4\".\"i_item_sk0\"\r\n                                                                        GROUP BY \"t2\".\"ss_sold_date_sk0\", \"t4\".\"i_brand_id0\", \"t4\".\"i_class_id0\", \"t4\".\"i_category_id0\") AS \"t5\"\r\n                                                                    INNER JOIN (SELECT \"d_date_sk\"\r\n                                                                        FROM \"date_dim\"\r\n                                                                        WHERE \"d_year\" >= 1998 AND \"d_year\" <= 2000) AS \"t7\" ON \"t5\".\"ss_sold_date_sk0\" = \"t7\".\"d_date_sk\"\r\n                                                                GROUP BY \"t5\".\"i_brand_id0\", \"t5\".\"i_class_id0\", \"t5\".\"i_category_id0\"\r\n                                                                UNION ALL\r\n                                                                SELECT \"t13\".\"i_brand_id1\", \"t13\".\"i_class_id1\", \"t13\".\"i_category_id1\", COALESCE(SUM(\"t13\".\"$f4\"), 0) AS \"$f3\"\r\n                                                                FROM (SELECT \"t10\".\"cs_sold_date_sk\", \"t12\".\"i_brand_id1\", \"t12\".\"i_class_id1\", \"t12\".\"i_category_id1\", COALESCE(SUM(\"t10\".\"$f2\"), 0) AS \"$f4\"\r\n                                                                        FROM (SELECT \"cs_sold_date_sk\", \"cs_item_sk\", COUNT(*) AS \"$f2\"\r\n                                                                                FROM \"catalog_sales\"\r\n                                                                                WHERE \"cs_wholesale_cost\" >= 73 AND \"cs_wholesale_cost\" <= 93\r\n                                                                                GROUP BY \"cs_sold_date_sk\", \"cs_item_sk\") AS \"t10\"\r\n                                                                            INNER JOIN (SELECT \"i_item_sk1\", \"i_brand_id1\", \"i_class_id1\", \"i_category_id1\"\r\n                                                                                FROM \"item\" AS \"item1\" (\"i_item_sk1\", \"i_item_id1\", \"i_rec_start_date1\", \"i_rec_end_date1\", \"i_item_desc1\", \"i_current_price1\", \"i_wholesale_cost1\", \"i_brand_id1\", \"i_brand1\", \"i_class_id1\", \"i_class1\", \"i_category_id1\", \"i_category1\", \"i_manufact_id1\", \"i_manufact1\", \"i_size1\", \"i_formulation1\", \"i_color1\", \"i_units1\", \"i_container1\", \"i_manager_id1\", \"i_product_name1\")\r\n                                                                                WHERE (CAST(\"i_category1\" AS CHAR(5)) IN ('Books', 'Shoes') OR \"i_category1\" = 'Jewelry') AND (\"i_manager_id1\" >= 91 AND \"i_manager_id1\" <= 100)) AS \"t12\" ON \"t10\".\"cs_item_sk\" = \"t12\".\"i_item_sk1\"\r\n                                                                        GROUP BY \"t10\".\"cs_sold_date_sk\", \"t12\".\"i_brand_id1\", \"t12\".\"i_class_id1\", \"t12\".\"i_category_id1\") AS \"t13\"\r\n                                                                    INNER JOIN (SELECT \"d_date_sk0\"\r\n                                                                        FROM \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\")\r\n                                                                        WHERE \"d_year0\" >= 1998 AND \"d_year0\" <= 2000) AS \"t15\" ON \"t13\".\"cs_sold_date_sk\" = \"t15\".\"d_date_sk0\"\r\n                                                                GROUP BY \"t13\".\"i_brand_id1\", \"t13\".\"i_class_id1\", \"t13\".\"i_category_id1\") AS \"t17\"\r\n                                                    GROUP BY \"i_brand_id0\", \"i_class_id0\", \"i_category_id0\"\r\n                                                    HAVING COUNT(*) = 2\r\n                                                    UNION ALL\r\n                                                    SELECT \"t24\".\"i_brand_id2\", \"t24\".\"i_class_id2\", \"t24\".\"i_category_id2\", COALESCE(SUM(\"t24\".\"$f4\"), 0) AS \"$f3\"\r\n                                                    FROM (SELECT \"t22\".\"ws_sold_date_sk\", \"t23\".\"i_brand_id2\", \"t23\".\"i_class_id2\", \"t23\".\"i_category_id2\", COALESCE(SUM(\"t22\".\"$f2\"), 0) AS \"$f4\"\r\n                                                            FROM (SELECT \"ws_sold_date_sk\", \"ws_item_sk\", COUNT(*) AS \"$f2\"\r\n                                                                    FROM \"web_sales\"\r\n                                                                    WHERE \"ws_wholesale_cost\" >= 73 AND \"ws_wholesale_cost\" <= 93\r\n                                                                    GROUP BY \"ws_sold_date_sk\", \"ws_item_sk\") AS \"t22\"\r\n                                                                INNER JOIN (SELECT \"i_item_sk2\", \"i_brand_id2\", \"i_class_id2\", \"i_category_id2\"\r\n                                                                    FROM \"item\" AS \"item2\" (\"i_item_sk2\", \"i_item_id2\", \"i_rec_start_date2\", \"i_rec_end_date2\", \"i_item_desc2\", \"i_current_price2\", \"i_wholesale_cost2\", \"i_brand_id2\", \"i_brand2\", \"i_class_id2\", \"i_class2\", \"i_category_id2\", \"i_category2\", \"i_manufact_id2\", \"i_manufact2\", \"i_size2\", \"i_formulation2\", \"i_color2\", \"i_units2\", \"i_container2\", \"i_manager_id2\", \"i_product_name2\")) AS \"t23\" ON \"t22\".\"ws_item_sk\" = \"t23\".\"i_item_sk2\"\r\n                                                            GROUP BY \"t22\".\"ws_sold_date_sk\", \"t23\".\"i_brand_id2\", \"t23\".\"i_class_id2\", \"t23\".\"i_category_id2\") AS \"t24\"\r\n                                                        INNER JOIN (SELECT \"d_date_sk1\"\r\n                                                            FROM \"date_dim\" AS \"date_dim1\" (\"d_date_sk1\", \"d_date_id1\", \"d_date1\", \"d_month_seq1\", \"d_week_seq1\", \"d_quarter_seq1\", \"d_year1\", \"d_dow1\", \"d_moy1\", \"d_dom1\", \"d_qoy1\", \"d_fy_year1\", \"d_fy_quarter_seq1\", \"d_fy_week_seq1\", \"d_day_name1\", \"d_quarter_name1\", \"d_holiday1\", \"d_weekend1\", \"d_following_holiday1\", \"d_first_dom1\", \"d_last_dom1\", \"d_same_day_ly1\", \"d_same_day_lq1\", \"d_current_day1\", \"d_current_week1\", \"d_current_month1\", \"d_current_quarter1\", \"d_current_year1\")\r\n                                                            WHERE \"d_year1\" >= 1998 AND \"d_year1\" <= 2000) AS \"t26\" ON \"t24\".\"ws_sold_date_sk\" = \"t26\".\"d_date_sk1\"\r\n                                                    GROUP BY \"t24\".\"i_brand_id2\", \"t24\".\"i_class_id2\", \"t24\".\"i_category_id2\") AS \"t28\"\r\n                                        GROUP BY \"i_brand_id0\", \"i_class_id0\", \"i_category_id0\"\r\n                                        HAVING COUNT(*) = 2) AS \"t31\" ON \"t0\".\"i_brand_id\" = \"t31\".\"i_brand_id0\" AND \"t0\".\"i_class_id\" = \"t31\".\"i_class_id0\" AND \"t0\".\"i_category_id\" = \"t31\".\"i_category_id0\") AS \"t32\" ON \"t\".\"ss_item_sk\" = \"t32\".\"i_item_sk\") AS \"t33\"\r\n                    INNER JOIN (SELECT *\r\n                        FROM \"item\" AS \"item3\" (\"i_item_sk3\", \"i_item_id3\", \"i_rec_start_date3\", \"i_rec_end_date3\", \"i_item_desc3\", \"i_current_price3\", \"i_wholesale_cost3\", \"i_brand_id3\", \"i_brand3\", \"i_class_id3\", \"i_class3\", \"i_category_id3\", \"i_category3\", \"i_manufact_id3\", \"i_manufact3\", \"i_size3\", \"i_formulation3\", \"i_color3\", \"i_units3\", \"i_container3\", \"i_manager_id3\", \"i_product_name3\")\r\n                        WHERE (CAST(\"i_category3\" AS CHAR(5)) IN ('Books', 'Shoes') OR \"i_category3\" = 'Jewelry') AND (\"i_manager_id3\" >= 91 AND \"i_manager_id3\" <= 100)) AS \"t34\" ON \"t33\".\"ss_item_sk\" = \"t34\".\"i_item_sk3\"\r\n                    INNER JOIN (SELECT \"date_dim2\".\"d_date_sk2\", \"date_dim2\".\"d_date_id2\", \"date_dim2\".\"d_date2\", \"date_dim2\".\"d_month_seq2\", \"date_dim2\".\"d_week_seq2\", \"date_dim2\".\"d_quarter_seq2\", \"date_dim2\".\"d_year2\", \"date_dim2\".\"d_dow2\", \"date_dim2\".\"d_moy2\", \"date_dim2\".\"d_dom2\", \"date_dim2\".\"d_qoy2\", \"date_dim2\".\"d_fy_year2\", \"date_dim2\".\"d_fy_quarter_seq2\", \"date_dim2\".\"d_fy_week_seq2\", \"date_dim2\".\"d_day_name2\", \"date_dim2\".\"d_quarter_name2\", \"date_dim2\".\"d_holiday2\", \"date_dim2\".\"d_weekend2\", \"date_dim2\".\"d_following_holiday2\", \"date_dim2\".\"d_first_dom2\", \"date_dim2\".\"d_last_dom2\", \"date_dim2\".\"d_same_day_ly2\", \"date_dim2\".\"d_same_day_lq2\", \"date_dim2\".\"d_current_day2\", \"date_dim2\".\"d_current_week2\", \"date_dim2\".\"d_current_month2\", \"date_dim2\".\"d_current_quarter2\", \"date_dim2\".\"d_current_year2\"\r\n                        FROM \"date_dim\" AS \"date_dim2\" (\"d_date_sk2\", \"d_date_id2\", \"d_date2\", \"d_month_seq2\", \"d_week_seq2\", \"d_quarter_seq2\", \"d_year2\", \"d_dow2\", \"d_moy2\", \"d_dom2\", \"d_qoy2\", \"d_fy_year2\", \"d_fy_quarter_seq2\", \"d_fy_week_seq2\", \"d_day_name2\", \"d_quarter_name2\", \"d_holiday2\", \"d_weekend2\", \"d_following_holiday2\", \"d_first_dom2\", \"d_last_dom2\", \"d_same_day_ly2\", \"d_same_day_lq2\", \"d_current_day2\", \"d_current_week2\", \"d_current_month2\", \"d_current_quarter2\", \"d_current_year2\")\r\n                            INNER JOIN (SELECT CASE COUNT(*) WHEN 0 THEN NULL WHEN 1 THEN MIN(\"d_week_seq3\") ELSE (SELECT CAST(NULL AS INTEGER)\r\n                                                UNION ALL\r\n                                                SELECT CAST(NULL AS INTEGER)) END AS \"$f0\"\r\n                                FROM \"date_dim\" AS \"date_dim3\" (\"d_date_sk3\", \"d_date_id3\", \"d_date3\", \"d_month_seq3\", \"d_week_seq3\", \"d_quarter_seq3\", \"d_year3\", \"d_dow3\", \"d_moy3\", \"d_dom3\", \"d_qoy3\", \"d_fy_year3\", \"d_fy_quarter_seq3\", \"d_fy_week_seq3\", \"d_day_name3\", \"d_quarter_name3\", \"d_holiday3\", \"d_weekend3\", \"d_following_holiday3\", \"d_first_dom3\", \"d_last_dom3\", \"d_same_day_ly3\", \"d_same_day_lq3\", \"d_current_day3\", \"d_current_week3\", \"d_current_month3\", \"d_current_quarter3\", \"d_current_year3\")\r\n                                WHERE \"d_year3\" = 1999 AND \"d_moy3\" = 12 AND \"d_dom3\" = 13) AS \"t36\" ON \"date_dim2\".\"d_week_seq2\" = \"t36\".\"$f0\") AS \"t37\" ON \"t33\".\"ss_sold_date_sk\" = \"t37\".\"d_date_sk2\"\r\n                GROUP BY \"t34\".\"i_brand_id3\", \"t34\".\"i_class_id3\", \"t34\".\"i_category_id3\") AS \"t40\"\r\n            INNER JOIN (SELECT CAST(CAST(CASE WHEN COUNT(\"ss_quantity1\" * \"ss_list_price1\") = 0 THEN NULL ELSE COALESCE(SUM(\"ss_quantity1\" * \"ss_list_price1\"), 0) END AS DECIMAL(17, 2)) / COUNT(\"ss_quantity1\" * \"ss_list_price1\") AS DECIMAL(17, 2)) AS \"average_sales\"\r\n                FROM (SELECT \"t41\".\"ss_quantity1\", \"t41\".\"ss_list_price1\"\r\n                            FROM (SELECT *\r\n                                    FROM \"store_sales\" AS \"store_sales1\" (\"ss_sold_date_sk1\", \"ss_sold_time_sk1\", \"ss_item_sk1\", \"ss_customer_sk1\", \"ss_cdemo_sk1\", \"ss_hdemo_sk1\", \"ss_addr_sk1\", \"ss_store_sk1\", \"ss_promo_sk1\", \"ss_ticket_number1\", \"ss_quantity1\", \"ss_wholesale_cost1\", \"ss_list_price1\", \"ss_sales_price1\", \"ss_ext_discount_amt1\", \"ss_ext_sales_price1\", \"ss_ext_wholesale_cost1\", \"ss_ext_list_price1\", \"ss_ext_tax1\", \"ss_coupon_amt1\", \"ss_net_paid1\", \"ss_net_paid_inc_tax1\", \"ss_net_profit1\")\r\n                                    WHERE \"ss_wholesale_cost1\" >= 73 AND \"ss_wholesale_cost1\" <= 93) AS \"t41\"\r\n                                INNER JOIN (SELECT *\r\n                                    FROM \"date_dim\" AS \"date_dim4\" (\"d_date_sk4\", \"d_date_id4\", \"d_date4\", \"d_month_seq4\", \"d_week_seq4\", \"d_quarter_seq4\", \"d_year4\", \"d_dow4\", \"d_moy4\", \"d_dom4\", \"d_qoy4\", \"d_fy_year4\", \"d_fy_quarter_seq4\", \"d_fy_week_seq4\", \"d_day_name4\", \"d_quarter_name4\", \"d_holiday4\", \"d_weekend4\", \"d_following_holiday4\", \"d_first_dom4\", \"d_last_dom4\", \"d_same_day_ly4\", \"d_same_day_lq4\", \"d_current_day4\", \"d_current_week4\", \"d_current_month4\", \"d_current_quarter4\", \"d_current_year4\")\r\n                                    WHERE \"d_year4\" >= 1998 AND \"d_year4\" <= 2000) AS \"t42\" ON \"t41\".\"ss_sold_date_sk1\" = \"t42\".\"d_date_sk4\"\r\n                            UNION ALL\r\n                            SELECT \"t44\".\"cs_quantity0\", \"t44\".\"cs_list_price0\"\r\n                            FROM (SELECT *\r\n                                    FROM \"catalog_sales\" AS \"catalog_sales0\" (\"cs_sold_date_sk0\", \"cs_sold_time_sk0\", \"cs_ship_date_sk0\", \"cs_bill_customer_sk0\", \"cs_bill_cdemo_sk0\", \"cs_bill_hdemo_sk0\", \"cs_bill_addr_sk0\", \"cs_ship_customer_sk0\", \"cs_ship_cdemo_sk0\", \"cs_ship_hdemo_sk0\", \"cs_ship_addr_sk0\", \"cs_call_center_sk0\", \"cs_catalog_page_sk0\", \"cs_ship_mode_sk0\", \"cs_warehouse_sk0\", \"cs_item_sk0\", \"cs_promo_sk0\", \"cs_order_number0\", \"cs_quantity0\", \"cs_wholesale_cost0\", \"cs_list_price0\", \"cs_sales_price0\", \"cs_ext_discount_amt0\", \"cs_ext_sales_price0\", \"cs_ext_wholesale_cost0\", \"cs_ext_list_price0\", \"cs_ext_tax0\", \"cs_coupon_amt0\", \"cs_ext_ship_cost0\", \"cs_net_paid0\", \"cs_net_paid_inc_tax0\", \"cs_net_paid_inc_ship0\", \"cs_net_paid_inc_ship_tax0\", \"cs_net_profit0\")\r\n                                    WHERE \"cs_wholesale_cost0\" >= 73 AND \"cs_wholesale_cost0\" <= 93) AS \"t44\"\r\n                                INNER JOIN (SELECT *\r\n                                    FROM \"date_dim\" AS \"date_dim5\" (\"d_date_sk5\", \"d_date_id5\", \"d_date5\", \"d_month_seq5\", \"d_week_seq5\", \"d_quarter_seq5\", \"d_year5\", \"d_dow5\", \"d_moy5\", \"d_dom5\", \"d_qoy5\", \"d_fy_year5\", \"d_fy_quarter_seq5\", \"d_fy_week_seq5\", \"d_day_name5\", \"d_quarter_name5\", \"d_holiday5\", \"d_weekend5\", \"d_following_holiday5\", \"d_first_dom5\", \"d_last_dom5\", \"d_same_day_ly5\", \"d_same_day_lq5\", \"d_current_day5\", \"d_current_week5\", \"d_current_month5\", \"d_current_quarter5\", \"d_current_year5\")\r\n                                    WHERE \"d_year5\" >= 1998 AND \"d_year5\" <= 2000) AS \"t45\" ON \"t44\".\"cs_sold_date_sk0\" = \"t45\".\"d_date_sk5\"\r\n                            UNION ALL\r\n                            SELECT \"t47\".\"ws_quantity0\", \"t47\".\"ws_list_price0\"\r\n                            FROM (SELECT *\r\n                                    FROM \"web_sales\" AS \"web_sales0\" (\"ws_sold_date_sk0\", \"ws_sold_time_sk0\", \"ws_ship_date_sk0\", \"ws_item_sk0\", \"ws_bill_customer_sk0\", \"ws_bill_cdemo_sk0\", \"ws_bill_hdemo_sk0\", \"ws_bill_addr_sk0\", \"ws_ship_customer_sk0\", \"ws_ship_cdemo_sk0\", \"ws_ship_hdemo_sk0\", \"ws_ship_addr_sk0\", \"ws_web_page_sk0\", \"ws_web_site_sk0\", \"ws_ship_mode_sk0\", \"ws_warehouse_sk0\", \"ws_promo_sk0\", \"ws_order_number0\", \"ws_quantity0\", \"ws_wholesale_cost0\", \"ws_list_price0\", \"ws_sales_price0\", \"ws_ext_discount_amt0\", \"ws_ext_sales_price0\", \"ws_ext_wholesale_cost0\", \"ws_ext_list_price0\", \"ws_ext_tax0\", \"ws_coupon_amt0\", \"ws_ext_ship_cost0\", \"ws_net_paid0\", \"ws_net_paid_inc_tax0\", \"ws_net_paid_inc_ship0\", \"ws_net_paid_inc_ship_tax0\", \"ws_net_profit0\")\r\n                                    WHERE \"ws_wholesale_cost0\" >= 73 AND \"ws_wholesale_cost0\" <= 93) AS \"t47\"\r\n                                INNER JOIN (SELECT *\r\n                                    FROM \"date_dim\" AS \"date_dim6\" (\"d_date_sk6\", \"d_date_id6\", \"d_date6\", \"d_month_seq6\", \"d_week_seq6\", \"d_quarter_seq6\", \"d_year6\", \"d_dow6\", \"d_moy6\", \"d_dom6\", \"d_qoy6\", \"d_fy_year6\", \"d_fy_quarter_seq6\", \"d_fy_week_seq6\", \"d_day_name6\", \"d_quarter_name6\", \"d_holiday6\", \"d_weekend6\", \"d_following_holiday6\", \"d_first_dom6\", \"d_last_dom6\", \"d_same_day_ly6\", \"d_same_day_lq6\", \"d_current_day6\", \"d_current_week6\", \"d_current_month6\", \"d_current_quarter6\", \"d_current_year6\")\r\n                                    WHERE \"d_year6\" >= 1998 AND \"d_year6\" <= 2000) AS \"t48\" ON \"t47\".\"ws_sold_date_sk0\" = \"t48\".\"d_date_sk6\") AS \"t50\") AS \"t55\" ON \"t40\".\"sales\" > \"t55\".\"average_sales\") AS \"t57\"\r\n    INNER JOIN (SELECT 'store' AS \"channel0\", \"t99\".\"i_brand_id8\", \"t99\".\"i_class_id8\", \"t99\".\"i_category_id8\", \"t99\".\"sales0\", \"t99\".\"number_sales\"\r\n        FROM (SELECT \"t93\".\"i_brand_id8\", \"t93\".\"i_class_id8\", \"t93\".\"i_category_id8\", CASE WHEN COUNT(\"t92\".\"ss_quantity2\" * \"t92\".\"ss_list_price2\") = 0 THEN NULL ELSE COALESCE(SUM(\"t92\".\"ss_quantity2\" * \"t92\".\"ss_list_price2\"), 0) END AS \"sales0\", COUNT(*) AS \"number_sales\"\r\n                FROM (SELECT \"t58\".\"ss_sold_date_sk2\", \"t58\".\"ss_sold_time_sk2\", \"t58\".\"ss_item_sk2\", \"t58\".\"ss_customer_sk2\", \"t58\".\"ss_cdemo_sk2\", \"t58\".\"ss_hdemo_sk2\", \"t58\".\"ss_addr_sk2\", \"t58\".\"ss_store_sk2\", \"t58\".\"ss_promo_sk2\", \"t58\".\"ss_ticket_number2\", \"t58\".\"ss_quantity2\", \"t58\".\"ss_wholesale_cost2\", \"t58\".\"ss_list_price2\", \"t58\".\"ss_sales_price2\", \"t58\".\"ss_ext_discount_amt2\", \"t58\".\"ss_ext_sales_price2\", \"t58\".\"ss_ext_wholesale_cost2\", \"t58\".\"ss_ext_list_price2\", \"t58\".\"ss_ext_tax2\", \"t58\".\"ss_coupon_amt2\", \"t58\".\"ss_net_paid2\", \"t58\".\"ss_net_paid_inc_tax2\", \"t58\".\"ss_net_profit2\"\r\n                        FROM (SELECT *\r\n                                FROM \"store_sales\" AS \"store_sales2\" (\"ss_sold_date_sk2\", \"ss_sold_time_sk2\", \"ss_item_sk2\", \"ss_customer_sk2\", \"ss_cdemo_sk2\", \"ss_hdemo_sk2\", \"ss_addr_sk2\", \"ss_store_sk2\", \"ss_promo_sk2\", \"ss_ticket_number2\", \"ss_quantity2\", \"ss_wholesale_cost2\", \"ss_list_price2\", \"ss_sales_price2\", \"ss_ext_discount_amt2\", \"ss_ext_sales_price2\", \"ss_ext_wholesale_cost2\", \"ss_ext_list_price2\", \"ss_ext_tax2\", \"ss_coupon_amt2\", \"ss_net_paid2\", \"ss_net_paid_inc_tax2\", \"ss_net_profit2\")\r\n                                WHERE \"ss_wholesale_cost2\" >= 73 AND \"ss_wholesale_cost2\" <= 93) AS \"t58\"\r\n                            INNER JOIN (SELECT \"t59\".\"i_item_sk4\"\r\n                                FROM (SELECT *\r\n                                        FROM \"item\" AS \"item4\" (\"i_item_sk4\", \"i_item_id4\", \"i_rec_start_date4\", \"i_rec_end_date4\", \"i_item_desc4\", \"i_current_price4\", \"i_wholesale_cost4\", \"i_brand_id4\", \"i_brand4\", \"i_class_id4\", \"i_class4\", \"i_category_id4\", \"i_category4\", \"i_manufact_id4\", \"i_manufact4\", \"i_size4\", \"i_formulation4\", \"i_color4\", \"i_units4\", \"i_container4\", \"i_manager_id4\", \"i_product_name4\")\r\n                                        WHERE (CAST(\"i_category4\" AS CHAR(5)) IN ('Books', 'Shoes') OR \"i_category4\" = 'Jewelry') AND (\"i_manager_id4\" >= 91 AND \"i_manager_id4\" <= 100)) AS \"t59\"\r\n                                    INNER JOIN (SELECT \"i_brand_id5\", \"i_class_id5\", \"i_category_id5\"\r\n                                        FROM (SELECT \"i_brand_id5\", \"i_class_id5\", \"i_category_id5\", 1 AS \"$f31\"\r\n                                                    FROM (SELECT \"t64\".\"i_brand_id5\", \"t64\".\"i_class_id5\", \"t64\".\"i_category_id5\", COALESCE(SUM(\"t64\".\"$f4\"), 0) AS \"$f3\"\r\n                                                                FROM (SELECT \"t61\".\"ss_sold_date_sk3\", \"t63\".\"i_brand_id5\", \"t63\".\"i_class_id5\", \"t63\".\"i_category_id5\", COALESCE(SUM(\"t61\".\"$f2\"), 0) AS \"$f4\"\r\n                                                                        FROM (SELECT \"ss_sold_date_sk3\", \"ss_item_sk3\", COUNT(*) AS \"$f2\"\r\n                                                                                FROM \"store_sales\" AS \"store_sales3\" (\"ss_sold_date_sk3\", \"ss_sold_time_sk3\", \"ss_item_sk3\", \"ss_customer_sk3\", \"ss_cdemo_sk3\", \"ss_hdemo_sk3\", \"ss_addr_sk3\", \"ss_store_sk3\", \"ss_promo_sk3\", \"ss_ticket_number3\", \"ss_quantity3\", \"ss_wholesale_cost3\", \"ss_list_price3\", \"ss_sales_price3\", \"ss_ext_discount_amt3\", \"ss_ext_sales_price3\", \"ss_ext_wholesale_cost3\", \"ss_ext_list_price3\", \"ss_ext_tax3\", \"ss_coupon_amt3\", \"ss_net_paid3\", \"ss_net_paid_inc_tax3\", \"ss_net_profit3\")\r\n                                                                                WHERE \"ss_wholesale_cost3\" >= 73 AND \"ss_wholesale_cost3\" <= 93\r\n                                                                                GROUP BY \"ss_sold_date_sk3\", \"ss_item_sk3\") AS \"t61\"\r\n                                                                            INNER JOIN (SELECT \"i_item_sk5\", \"i_brand_id5\", \"i_class_id5\", \"i_category_id5\"\r\n                                                                                FROM \"item\" AS \"item5\" (\"i_item_sk5\", \"i_item_id5\", \"i_rec_start_date5\", \"i_rec_end_date5\", \"i_item_desc5\", \"i_current_price5\", \"i_wholesale_cost5\", \"i_brand_id5\", \"i_brand5\", \"i_class_id5\", \"i_class5\", \"i_category_id5\", \"i_category5\", \"i_manufact_id5\", \"i_manufact5\", \"i_size5\", \"i_formulation5\", \"i_color5\", \"i_units5\", \"i_container5\", \"i_manager_id5\", \"i_product_name5\")\r\n                                                                                WHERE (CAST(\"i_category5\" AS CHAR(5)) IN ('Books', 'Shoes') OR \"i_category5\" = 'Jewelry') AND (\"i_manager_id5\" >= 91 AND \"i_manager_id5\" <= 100)) AS \"t63\" ON \"t61\".\"ss_item_sk3\" = \"t63\".\"i_item_sk5\"\r\n                                                                        GROUP BY \"t61\".\"ss_sold_date_sk3\", \"t63\".\"i_brand_id5\", \"t63\".\"i_class_id5\", \"t63\".\"i_category_id5\") AS \"t64\"\r\n                                                                    INNER JOIN (SELECT \"d_date_sk7\"\r\n                                                                        FROM \"date_dim\" AS \"date_dim7\" (\"d_date_sk7\", \"d_date_id7\", \"d_date7\", \"d_month_seq7\", \"d_week_seq7\", \"d_quarter_seq7\", \"d_year7\", \"d_dow7\", \"d_moy7\", \"d_dom7\", \"d_qoy7\", \"d_fy_year7\", \"d_fy_quarter_seq7\", \"d_fy_week_seq7\", \"d_day_name7\", \"d_quarter_name7\", \"d_holiday7\", \"d_weekend7\", \"d_following_holiday7\", \"d_first_dom7\", \"d_last_dom7\", \"d_same_day_ly7\", \"d_same_day_lq7\", \"d_current_day7\", \"d_current_week7\", \"d_current_month7\", \"d_current_quarter7\", \"d_current_year7\")\r\n                                                                        WHERE \"d_year7\" >= 1998 AND \"d_year7\" <= 2000) AS \"t66\" ON \"t64\".\"ss_sold_date_sk3\" = \"t66\".\"d_date_sk7\"\r\n                                                                GROUP BY \"t64\".\"i_brand_id5\", \"t64\".\"i_class_id5\", \"t64\".\"i_category_id5\"\r\n                                                                UNION ALL\r\n                                                                SELECT \"t72\".\"i_brand_id6\", \"t72\".\"i_class_id6\", \"t72\".\"i_category_id6\", COALESCE(SUM(\"t72\".\"$f4\"), 0) AS \"$f3\"\r\n                                                                FROM (SELECT \"t69\".\"cs_sold_date_sk1\", \"t71\".\"i_brand_id6\", \"t71\".\"i_class_id6\", \"t71\".\"i_category_id6\", COALESCE(SUM(\"t69\".\"$f2\"), 0) AS \"$f4\"\r\n                                                                        FROM (SELECT \"cs_sold_date_sk1\", \"cs_item_sk1\", COUNT(*) AS \"$f2\"\r\n                                                                                FROM \"catalog_sales\" AS \"catalog_sales1\" (\"cs_sold_date_sk1\", \"cs_sold_time_sk1\", \"cs_ship_date_sk1\", \"cs_bill_customer_sk1\", \"cs_bill_cdemo_sk1\", \"cs_bill_hdemo_sk1\", \"cs_bill_addr_sk1\", \"cs_ship_customer_sk1\", \"cs_ship_cdemo_sk1\", \"cs_ship_hdemo_sk1\", \"cs_ship_addr_sk1\", \"cs_call_center_sk1\", \"cs_catalog_page_sk1\", \"cs_ship_mode_sk1\", \"cs_warehouse_sk1\", \"cs_item_sk1\", \"cs_promo_sk1\", \"cs_order_number1\", \"cs_quantity1\", \"cs_wholesale_cost1\", \"cs_list_price1\", \"cs_sales_price1\", \"cs_ext_discount_amt1\", \"cs_ext_sales_price1\", \"cs_ext_wholesale_cost1\", \"cs_ext_list_price1\", \"cs_ext_tax1\", \"cs_coupon_amt1\", \"cs_ext_ship_cost1\", \"cs_net_paid1\", \"cs_net_paid_inc_tax1\", \"cs_net_paid_inc_ship1\", \"cs_net_paid_inc_ship_tax1\", \"cs_net_profit1\")\r\n                                                                                WHERE \"cs_wholesale_cost1\" >= 73 AND \"cs_wholesale_cost1\" <= 93\r\n                                                                                GROUP BY \"cs_sold_date_sk1\", \"cs_item_sk1\") AS \"t69\"\r\n                                                                            INNER JOIN (SELECT \"i_item_sk6\", \"i_brand_id6\", \"i_class_id6\", \"i_category_id6\"\r\n                                                                                FROM \"item\" AS \"item6\" (\"i_item_sk6\", \"i_item_id6\", \"i_rec_start_date6\", \"i_rec_end_date6\", \"i_item_desc6\", \"i_current_price6\", \"i_wholesale_cost6\", \"i_brand_id6\", \"i_brand6\", \"i_class_id6\", \"i_class6\", \"i_category_id6\", \"i_category6\", \"i_manufact_id6\", \"i_manufact6\", \"i_size6\", \"i_formulation6\", \"i_color6\", \"i_units6\", \"i_container6\", \"i_manager_id6\", \"i_product_name6\")\r\n                                                                                WHERE (CAST(\"i_category6\" AS CHAR(5)) IN ('Books', 'Shoes') OR \"i_category6\" = 'Jewelry') AND (\"i_manager_id6\" >= 91 AND \"i_manager_id6\" <= 100)) AS \"t71\" ON \"t69\".\"cs_item_sk1\" = \"t71\".\"i_item_sk6\"\r\n                                                                        GROUP BY \"t69\".\"cs_sold_date_sk1\", \"t71\".\"i_brand_id6\", \"t71\".\"i_class_id6\", \"t71\".\"i_category_id6\") AS \"t72\"\r\n                                                                    INNER JOIN (SELECT \"d_date_sk8\"\r\n                                                                        FROM \"date_dim\" AS \"date_dim8\" (\"d_date_sk8\", \"d_date_id8\", \"d_date8\", \"d_month_seq8\", \"d_week_seq8\", \"d_quarter_seq8\", \"d_year8\", \"d_dow8\", \"d_moy8\", \"d_dom8\", \"d_qoy8\", \"d_fy_year8\", \"d_fy_quarter_seq8\", \"d_fy_week_seq8\", \"d_day_name8\", \"d_quarter_name8\", \"d_holiday8\", \"d_weekend8\", \"d_following_holiday8\", \"d_first_dom8\", \"d_last_dom8\", \"d_same_day_ly8\", \"d_same_day_lq8\", \"d_current_day8\", \"d_current_week8\", \"d_current_month8\", \"d_current_quarter8\", \"d_current_year8\")\r\n                                                                        WHERE \"d_year8\" >= 1998 AND \"d_year8\" <= 2000) AS \"t74\" ON \"t72\".\"cs_sold_date_sk1\" = \"t74\".\"d_date_sk8\"\r\n                                                                GROUP BY \"t72\".\"i_brand_id6\", \"t72\".\"i_class_id6\", \"t72\".\"i_category_id6\") AS \"t76\"\r\n                                                    GROUP BY \"i_brand_id5\", \"i_class_id5\", \"i_category_id5\"\r\n                                                    HAVING COUNT(*) = 2\r\n                                                    UNION ALL\r\n                                                    SELECT \"t83\".\"i_brand_id7\", \"t83\".\"i_class_id7\", \"t83\".\"i_category_id7\", COALESCE(SUM(\"t83\".\"$f4\"), 0) AS \"$f3\"\r\n                                                    FROM (SELECT \"t81\".\"ws_sold_date_sk1\", \"t82\".\"i_brand_id7\", \"t82\".\"i_class_id7\", \"t82\".\"i_category_id7\", COALESCE(SUM(\"t81\".\"$f2\"), 0) AS \"$f4\"\r\n                                                            FROM (SELECT \"ws_sold_date_sk1\", \"ws_item_sk1\", COUNT(*) AS \"$f2\"\r\n                                                                    FROM \"web_sales\" AS \"web_sales1\" (\"ws_sold_date_sk1\", \"ws_sold_time_sk1\", \"ws_ship_date_sk1\", \"ws_item_sk1\", \"ws_bill_customer_sk1\", \"ws_bill_cdemo_sk1\", \"ws_bill_hdemo_sk1\", \"ws_bill_addr_sk1\", \"ws_ship_customer_sk1\", \"ws_ship_cdemo_sk1\", \"ws_ship_hdemo_sk1\", \"ws_ship_addr_sk1\", \"ws_web_page_sk1\", \"ws_web_site_sk1\", \"ws_ship_mode_sk1\", \"ws_warehouse_sk1\", \"ws_promo_sk1\", \"ws_order_number1\", \"ws_quantity1\", \"ws_wholesale_cost1\", \"ws_list_price1\", \"ws_sales_price1\", \"ws_ext_discount_amt1\", \"ws_ext_sales_price1\", \"ws_ext_wholesale_cost1\", \"ws_ext_list_price1\", \"ws_ext_tax1\", \"ws_coupon_amt1\", \"ws_ext_ship_cost1\", \"ws_net_paid1\", \"ws_net_paid_inc_tax1\", \"ws_net_paid_inc_ship1\", \"ws_net_paid_inc_ship_tax1\", \"ws_net_profit1\")\r\n                                                                    WHERE \"ws_wholesale_cost1\" >= 73 AND \"ws_wholesale_cost1\" <= 93\r\n                                                                    GROUP BY \"ws_sold_date_sk1\", \"ws_item_sk1\") AS \"t81\"\r\n                                                                INNER JOIN (SELECT \"i_item_sk7\", \"i_brand_id7\", \"i_class_id7\", \"i_category_id7\"\r\n                                                                    FROM \"item\" AS \"item7\" (\"i_item_sk7\", \"i_item_id7\", \"i_rec_start_date7\", \"i_rec_end_date7\", \"i_item_desc7\", \"i_current_price7\", \"i_wholesale_cost7\", \"i_brand_id7\", \"i_brand7\", \"i_class_id7\", \"i_class7\", \"i_category_id7\", \"i_category7\", \"i_manufact_id7\", \"i_manufact7\", \"i_size7\", \"i_formulation7\", \"i_color7\", \"i_units7\", \"i_container7\", \"i_manager_id7\", \"i_product_name7\")) AS \"t82\" ON \"t81\".\"ws_item_sk1\" = \"t82\".\"i_item_sk7\"\r\n                                                            GROUP BY \"t81\".\"ws_sold_date_sk1\", \"t82\".\"i_brand_id7\", \"t82\".\"i_class_id7\", \"t82\".\"i_category_id7\") AS \"t83\"\r\n                                                        INNER JOIN (SELECT \"d_date_sk9\"\r\n                                                            FROM \"date_dim\" AS \"date_dim9\" (\"d_date_sk9\", \"d_date_id9\", \"d_date9\", \"d_month_seq9\", \"d_week_seq9\", \"d_quarter_seq9\", \"d_year9\", \"d_dow9\", \"d_moy9\", \"d_dom9\", \"d_qoy9\", \"d_fy_year9\", \"d_fy_quarter_seq9\", \"d_fy_week_seq9\", \"d_day_name9\", \"d_quarter_name9\", \"d_holiday9\", \"d_weekend9\", \"d_following_holiday9\", \"d_first_dom9\", \"d_last_dom9\", \"d_same_day_ly9\", \"d_same_day_lq9\", \"d_current_day9\", \"d_current_week9\", \"d_current_month9\", \"d_current_quarter9\", \"d_current_year9\")\r\n                                                            WHERE \"d_year9\" >= 1998 AND \"d_year9\" <= 2000) AS \"t85\" ON \"t83\".\"ws_sold_date_sk1\" = \"t85\".\"d_date_sk9\"\r\n                                                    GROUP BY \"t83\".\"i_brand_id7\", \"t83\".\"i_class_id7\", \"t83\".\"i_category_id7\") AS \"t87\"\r\n                                        GROUP BY \"i_brand_id5\", \"i_class_id5\", \"i_category_id5\"\r\n                                        HAVING COUNT(*) = 2) AS \"t90\" ON \"t59\".\"i_brand_id4\" = \"t90\".\"i_brand_id5\" AND \"t59\".\"i_class_id4\" = \"t90\".\"i_class_id5\" AND \"t59\".\"i_category_id4\" = \"t90\".\"i_category_id5\") AS \"t91\" ON \"t58\".\"ss_item_sk2\" = \"t91\".\"i_item_sk4\") AS \"t92\"\r\n                    INNER JOIN (SELECT *\r\n                        FROM \"item\" AS \"item8\" (\"i_item_sk8\", \"i_item_id8\", \"i_rec_start_date8\", \"i_rec_end_date8\", \"i_item_desc8\", \"i_current_price8\", \"i_wholesale_cost8\", \"i_brand_id8\", \"i_brand8\", \"i_class_id8\", \"i_class8\", \"i_category_id8\", \"i_category8\", \"i_manufact_id8\", \"i_manufact8\", \"i_size8\", \"i_formulation8\", \"i_color8\", \"i_units8\", \"i_container8\", \"i_manager_id8\", \"i_product_name8\")\r\n                        WHERE (CAST(\"i_category8\" AS CHAR(5)) IN ('Books', 'Shoes') OR \"i_category8\" = 'Jewelry') AND (\"i_manager_id8\" >= 91 AND \"i_manager_id8\" <= 100)) AS \"t93\" ON \"t92\".\"ss_item_sk2\" = \"t93\".\"i_item_sk8\"\r\n                    INNER JOIN (SELECT \"date_dim10\".\"d_date_sk10\", \"date_dim10\".\"d_date_id10\", \"date_dim10\".\"d_date10\", \"date_dim10\".\"d_month_seq10\", \"date_dim10\".\"d_week_seq10\", \"date_dim10\".\"d_quarter_seq10\", \"date_dim10\".\"d_year10\", \"date_dim10\".\"d_dow10\", \"date_dim10\".\"d_moy10\", \"date_dim10\".\"d_dom10\", \"date_dim10\".\"d_qoy10\", \"date_dim10\".\"d_fy_year10\", \"date_dim10\".\"d_fy_quarter_seq10\", \"date_dim10\".\"d_fy_week_seq10\", \"date_dim10\".\"d_day_name10\", \"date_dim10\".\"d_quarter_name10\", \"date_dim10\".\"d_holiday10\", \"date_dim10\".\"d_weekend10\", \"date_dim10\".\"d_following_holiday10\", \"date_dim10\".\"d_first_dom10\", \"date_dim10\".\"d_last_dom10\", \"date_dim10\".\"d_same_day_ly10\", \"date_dim10\".\"d_same_day_lq10\", \"date_dim10\".\"d_current_day10\", \"date_dim10\".\"d_current_week10\", \"date_dim10\".\"d_current_month10\", \"date_dim10\".\"d_current_quarter10\", \"date_dim10\".\"d_current_year10\"\r\n                        FROM \"date_dim\" AS \"date_dim10\" (\"d_date_sk10\", \"d_date_id10\", \"d_date10\", \"d_month_seq10\", \"d_week_seq10\", \"d_quarter_seq10\", \"d_year10\", \"d_dow10\", \"d_moy10\", \"d_dom10\", \"d_qoy10\", \"d_fy_year10\", \"d_fy_quarter_seq10\", \"d_fy_week_seq10\", \"d_day_name10\", \"d_quarter_name10\", \"d_holiday10\", \"d_weekend10\", \"d_following_holiday10\", \"d_first_dom10\", \"d_last_dom10\", \"d_same_day_ly10\", \"d_same_day_lq10\", \"d_current_day10\", \"d_current_week10\", \"d_current_month10\", \"d_current_quarter10\", \"d_current_year10\")\r\n                            INNER JOIN (SELECT CASE COUNT(*) WHEN 0 THEN NULL WHEN 1 THEN MIN(\"d_week_seq11\") ELSE (SELECT CAST(NULL AS INTEGER)\r\n                                                UNION ALL\r\n                                                SELECT CAST(NULL AS INTEGER)) END AS \"$f0\"\r\n                                FROM \"date_dim\" AS \"date_dim11\" (\"d_date_sk11\", \"d_date_id11\", \"d_date11\", \"d_month_seq11\", \"d_week_seq11\", \"d_quarter_seq11\", \"d_year11\", \"d_dow11\", \"d_moy11\", \"d_dom11\", \"d_qoy11\", \"d_fy_year11\", \"d_fy_quarter_seq11\", \"d_fy_week_seq11\", \"d_day_name11\", \"d_quarter_name11\", \"d_holiday11\", \"d_weekend11\", \"d_following_holiday11\", \"d_first_dom11\", \"d_last_dom11\", \"d_same_day_ly11\", \"d_same_day_lq11\", \"d_current_day11\", \"d_current_week11\", \"d_current_month11\", \"d_current_quarter11\", \"d_current_year11\")\r\n                                WHERE \"d_year11\" = 1998 AND \"d_moy11\" = 12 AND \"d_dom11\" = 13) AS \"t95\" ON \"date_dim10\".\"d_week_seq10\" = \"t95\".\"$f0\") AS \"t96\" ON \"t92\".\"ss_sold_date_sk2\" = \"t96\".\"d_date_sk10\"\r\n                GROUP BY \"t93\".\"i_brand_id8\", \"t93\".\"i_class_id8\", \"t93\".\"i_category_id8\") AS \"t99\"\r\n            INNER JOIN (SELECT CAST(CAST(CASE WHEN COUNT(\"ss_quantity4\" * \"ss_list_price4\") = 0 THEN NULL ELSE COALESCE(SUM(\"ss_quantity4\" * \"ss_list_price4\"), 0) END AS DECIMAL(17, 2)) / COUNT(\"ss_quantity4\" * \"ss_list_price4\") AS DECIMAL(17, 2)) AS \"average_sales0\"\r\n                FROM (SELECT \"t100\".\"ss_quantity4\", \"t100\".\"ss_list_price4\"\r\n                            FROM (SELECT *\r\n                                    FROM \"store_sales\" AS \"store_sales4\" (\"ss_sold_date_sk4\", \"ss_sold_time_sk4\", \"ss_item_sk4\", \"ss_customer_sk4\", \"ss_cdemo_sk4\", \"ss_hdemo_sk4\", \"ss_addr_sk4\", \"ss_store_sk4\", \"ss_promo_sk4\", \"ss_ticket_number4\", \"ss_quantity4\", \"ss_wholesale_cost4\", \"ss_list_price4\", \"ss_sales_price4\", \"ss_ext_discount_amt4\", \"ss_ext_sales_price4\", \"ss_ext_wholesale_cost4\", \"ss_ext_list_price4\", \"ss_ext_tax4\", \"ss_coupon_amt4\", \"ss_net_paid4\", \"ss_net_paid_inc_tax4\", \"ss_net_profit4\")\r\n                                    WHERE \"ss_wholesale_cost4\" >= 73 AND \"ss_wholesale_cost4\" <= 93) AS \"t100\"\r\n                                INNER JOIN (SELECT *\r\n                                    FROM \"date_dim\" AS \"date_dim12\" (\"d_date_sk12\", \"d_date_id12\", \"d_date12\", \"d_month_seq12\", \"d_week_seq12\", \"d_quarter_seq12\", \"d_year12\", \"d_dow12\", \"d_moy12\", \"d_dom12\", \"d_qoy12\", \"d_fy_year12\", \"d_fy_quarter_seq12\", \"d_fy_week_seq12\", \"d_day_name12\", \"d_quarter_name12\", \"d_holiday12\", \"d_weekend12\", \"d_following_holiday12\", \"d_first_dom12\", \"d_last_dom12\", \"d_same_day_ly12\", \"d_same_day_lq12\", \"d_current_day12\", \"d_current_week12\", \"d_current_month12\", \"d_current_quarter12\", \"d_current_year12\")\r\n                                    WHERE \"d_year12\" >= 1998 AND \"d_year12\" <= 2000) AS \"t101\" ON \"t100\".\"ss_sold_date_sk4\" = \"t101\".\"d_date_sk12\"\r\n                            UNION ALL\r\n                            SELECT \"t103\".\"cs_quantity2\", \"t103\".\"cs_list_price2\"\r\n                            FROM (SELECT *\r\n                                    FROM \"catalog_sales\" AS \"catalog_sales2\" (\"cs_sold_date_sk2\", \"cs_sold_time_sk2\", \"cs_ship_date_sk2\", \"cs_bill_customer_sk2\", \"cs_bill_cdemo_sk2\", \"cs_bill_hdemo_sk2\", \"cs_bill_addr_sk2\", \"cs_ship_customer_sk2\", \"cs_ship_cdemo_sk2\", \"cs_ship_hdemo_sk2\", \"cs_ship_addr_sk2\", \"cs_call_center_sk2\", \"cs_catalog_page_sk2\", \"cs_ship_mode_sk2\", \"cs_warehouse_sk2\", \"cs_item_sk2\", \"cs_promo_sk2\", \"cs_order_number2\", \"cs_quantity2\", \"cs_wholesale_cost2\", \"cs_list_price2\", \"cs_sales_price2\", \"cs_ext_discount_amt2\", \"cs_ext_sales_price2\", \"cs_ext_wholesale_cost2\", \"cs_ext_list_price2\", \"cs_ext_tax2\", \"cs_coupon_amt2\", \"cs_ext_ship_cost2\", \"cs_net_paid2\", \"cs_net_paid_inc_tax2\", \"cs_net_paid_inc_ship2\", \"cs_net_paid_inc_ship_tax2\", \"cs_net_profit2\")\r\n                                    WHERE \"cs_wholesale_cost2\" >= 73 AND \"cs_wholesale_cost2\" <= 93) AS \"t103\"\r\n                                INNER JOIN (SELECT *\r\n                                    FROM \"date_dim\" AS \"date_dim13\" (\"d_date_sk13\", \"d_date_id13\", \"d_date13\", \"d_month_seq13\", \"d_week_seq13\", \"d_quarter_seq13\", \"d_year13\", \"d_dow13\", \"d_moy13\", \"d_dom13\", \"d_qoy13\", \"d_fy_year13\", \"d_fy_quarter_seq13\", \"d_fy_week_seq13\", \"d_day_name13\", \"d_quarter_name13\", \"d_holiday13\", \"d_weekend13\", \"d_following_holiday13\", \"d_first_dom13\", \"d_last_dom13\", \"d_same_day_ly13\", \"d_same_day_lq13\", \"d_current_day13\", \"d_current_week13\", \"d_current_month13\", \"d_current_quarter13\", \"d_current_year13\")\r\n                                    WHERE \"d_year13\" >= 1998 AND \"d_year13\" <= 2000) AS \"t104\" ON \"t103\".\"cs_sold_date_sk2\" = \"t104\".\"d_date_sk13\"\r\n                            UNION ALL\r\n                            SELECT \"t106\".\"ws_quantity2\", \"t106\".\"ws_list_price2\"\r\n                            FROM (SELECT *\r\n                                    FROM \"web_sales\" AS \"web_sales2\" (\"ws_sold_date_sk2\", \"ws_sold_time_sk2\", \"ws_ship_date_sk2\", \"ws_item_sk2\", \"ws_bill_customer_sk2\", \"ws_bill_cdemo_sk2\", \"ws_bill_hdemo_sk2\", \"ws_bill_addr_sk2\", \"ws_ship_customer_sk2\", \"ws_ship_cdemo_sk2\", \"ws_ship_hdemo_sk2\", \"ws_ship_addr_sk2\", \"ws_web_page_sk2\", \"ws_web_site_sk2\", \"ws_ship_mode_sk2\", \"ws_warehouse_sk2\", \"ws_promo_sk2\", \"ws_order_number2\", \"ws_quantity2\", \"ws_wholesale_cost2\", \"ws_list_price2\", \"ws_sales_price2\", \"ws_ext_discount_amt2\", \"ws_ext_sales_price2\", \"ws_ext_wholesale_cost2\", \"ws_ext_list_price2\", \"ws_ext_tax2\", \"ws_coupon_amt2\", \"ws_ext_ship_cost2\", \"ws_net_paid2\", \"ws_net_paid_inc_tax2\", \"ws_net_paid_inc_ship2\", \"ws_net_paid_inc_ship_tax2\", \"ws_net_profit2\")\r\n                                    WHERE \"ws_wholesale_cost2\" >= 73 AND \"ws_wholesale_cost2\" <= 93) AS \"t106\"\r\n                                INNER JOIN (SELECT *\r\n                                    FROM \"date_dim\" AS \"date_dim14\" (\"d_date_sk14\", \"d_date_id14\", \"d_date14\", \"d_month_seq14\", \"d_week_seq14\", \"d_quarter_seq14\", \"d_year14\", \"d_dow14\", \"d_moy14\", \"d_dom14\", \"d_qoy14\", \"d_fy_year14\", \"d_fy_quarter_seq14\", \"d_fy_week_seq14\", \"d_day_name14\", \"d_quarter_name14\", \"d_holiday14\", \"d_weekend14\", \"d_following_holiday14\", \"d_first_dom14\", \"d_last_dom14\", \"d_same_day_ly14\", \"d_same_day_lq14\", \"d_current_day14\", \"d_current_week14\", \"d_current_month14\", \"d_current_quarter14\", \"d_current_year14\")\r\n                                    WHERE \"d_year14\" >= 1998 AND \"d_year14\" <= 2000) AS \"t107\" ON \"t106\".\"ws_sold_date_sk2\" = \"t107\".\"d_date_sk14\") AS \"t109\") AS \"t114\" ON \"t99\".\"sales0\" > \"t114\".\"average_sales0\") AS \"t116\" ON \"t57\".\"i_brand_id3\" = \"t116\".\"i_brand_id8\" AND \"t57\".\"i_class_id3\" = \"t116\".\"i_class_id8\" AND \"t57\".\"i_category_id3\" = \"t116\".\"i_category_id8\"\r\nORDER BY \"t57\".\"i_brand_id3\", \"t57\".\"i_class_id3\", \"t57\".\"i_category_id3\"\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 367.74, "used_rules": ["FILTER_INTO_JOIN", "FILTER_SUB_QUERY_TO_CORRELATE", "PROJECT_REDUCE_EXPRESSIONS", "FILTER_INTO_JOIN", "FILTER_REDUCE_EXPRESSIONS", "UNION_MERGE", "INTERSECT_TO_DISTINCT", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_REDUCE_FUNCTIONS", "AGGREGATE_REMOVE", "AGGREGATE_JOIN_TRANSPOSE_EXTENDED", "SORT_REMOVE_CONSTANT_KEYS", "SORT_PROJECT_TRANSPOSE"], "rewrite_time": 11303}
{"name": "query014_1", "input_sql": "with  cross_items as\n (select i_item_sk ss_item_sk\n from item,\n (select iss.i_brand_id brand_id\n     ,iss.i_class_id class_id\n     ,iss.i_category_id category_id\n from store_sales\n     ,item iss\n     ,date_dim d1\n where ss_item_sk = iss.i_item_sk\n   and ss_sold_date_sk = d1.d_date_sk\n   and d1.d_year between 1999 AND 1999 + 2\n   and i_category IN ('Books', 'Children', 'Home')\n   and i_manager_id BETWEEN 7 and 16\n   and ss_wholesale_cost BETWEEN 43 AND 63\nintersect\n select ics.i_brand_id\n     ,ics.i_class_id\n     ,ics.i_category_id\n from catalog_sales\n     ,item ics\n     ,date_dim d2\n where cs_item_sk = ics.i_item_sk\n   and cs_sold_date_sk = d2.d_date_sk\n   and d2.d_year between 1999 AND 1999 + 2\n   and i_category IN ('Books', 'Children', 'Home')\n   and i_manager_id BETWEEN 7 and 16\n   and cs_wholesale_cost BETWEEN 43 AND 63\nintersect\n select iws.i_brand_id\n     ,iws.i_class_id\n     ,iws.i_category_id\n from web_sales\n     ,item iws\n     ,date_dim d3\n where ws_item_sk = iws.i_item_sk\n   and ws_sold_date_sk = d3.d_date_sk\n   and ws_wholesale_cost BETWEEN 43 AND 63\n   and d3.d_year between 1999 AND 1999 + 2) x\n where i_brand_id = brand_id\n      and i_class_id = class_id\n      and i_category_id = category_id\n      and i_category IN ('Books', 'Children', 'Home')\n      and i_manager_id BETWEEN 7 and 16\n),\n avg_sales as\n(select avg(quantity*list_price) average_sales\n  from (select ss_quantity quantity\n             ,ss_list_price list_price\n       from store_sales\n           ,date_dim\n       where ss_sold_date_sk = d_date_sk\n         and d_year between 1999 and 1999 + 2\n         and ss_wholesale_cost BETWEEN 43 AND 63\n       union all\n       select cs_quantity quantity\n             ,cs_list_price list_price\n       from catalog_sales\n           ,date_dim\n       where cs_sold_date_sk = d_date_sk\n         and d_year between 1999 and 1999 + 2\n         and cs_wholesale_cost BETWEEN 43 AND 63\n       union all\n       select ws_quantity quantity\n             ,ws_list_price list_price\n       from web_sales\n           ,date_dim\n       where ws_sold_date_sk = d_date_sk\n        and ws_wholesale_cost BETWEEN 43 AND 63\n         and d_year between 1999 and 1999 + 2) x)\n  select  this_year.channel ty_channel\n                           ,this_year.i_brand_id ty_brand\n                           ,this_year.i_class_id ty_class\n                           ,this_year.i_category_id ty_category\n                           ,this_year.sales ty_sales\n                           ,this_year.number_sales ty_number_sales\n                           ,last_year.channel ly_channel\n                           ,last_year.i_brand_id ly_brand\n                           ,last_year.i_class_id ly_class\n                           ,last_year.i_category_id ly_category\n                           ,last_year.sales ly_sales\n                           ,last_year.number_sales ly_number_sales\n from\n (select 'store' channel, i_brand_id,i_class_id,i_category_id\n        ,sum(ss_quantity*ss_list_price) sales, count(*) number_sales\n from store_sales\n     ,item\n     ,date_dim\n where ss_item_sk in (select ss_item_sk from cross_items)\n   and ss_item_sk = i_item_sk\n   and ss_sold_date_sk = d_date_sk\n   and d_week_seq = (select d_week_seq\n                     from date_dim\n                     where d_year = 1999 + 1\n                       and d_moy = 12\n                       and d_dom = 24)\n   and i_category IN ('Books', 'Children', 'Home')\n   and i_manager_id BETWEEN 7 and 16\n   and ss_wholesale_cost BETWEEN 43 AND 63\n group by i_brand_id,i_class_id,i_category_id\n having sum(ss_quantity*ss_list_price) > (select average_sales from avg_sales)) this_year,\n (select 'store' channel, i_brand_id,i_class_id\n        ,i_category_id, sum(ss_quantity*ss_list_price) sales, count(*) number_sales\n from store_sales\n     ,item\n     ,date_dim\n where ss_item_sk in (select ss_item_sk from cross_items)\n   and ss_item_sk = i_item_sk\n   and ss_sold_date_sk = d_date_sk\n   and d_week_seq = (select d_week_seq\n                     from date_dim\n                     where d_year = 1999\n                       and d_moy = 12\n                       and d_dom = 24)\n   and i_category IN ('Books', 'Children', 'Home')\n   and ss_wholesale_cost BETWEEN 43 AND 63\n   and i_manager_id BETWEEN 7 and 16\ngroup by i_brand_id,i_class_id,i_category_id\n having sum(ss_quantity*ss_list_price) > (select average_sales from avg_sales)) last_year\n where this_year.i_brand_id= last_year.i_brand_id\n   and this_year.i_class_id = last_year.i_class_id\n   and this_year.i_category_id = last_year.i_category_id\n order by this_year.channel, this_year.i_brand_id, this_year.i_class_id, this_year.i_category_id\n limit 100;", "input_cost": 212.62, "output_sql": "SELECT 'store' AS \"ty_channel\", \"t57\".\"i_brand_id3\", \"t57\".\"i_class_id3\", \"t57\".\"i_category_id3\", \"t57\".\"sales\", \"t57\".\"number_sales\", 'store' AS \"ly_channel\", \"t116\".\"i_brand_id8\", \"t116\".\"i_class_id8\", \"t116\".\"i_category_id8\", \"t116\".\"sales0\", \"t116\".\"number_sales\" AS \"number_sales0\"\r\nFROM (SELECT 'store' AS \"channel\", \"t40\".\"i_brand_id3\", \"t40\".\"i_class_id3\", \"t40\".\"i_category_id3\", \"t40\".\"sales\", \"t40\".\"number_sales\"\r\n        FROM (SELECT \"t34\".\"i_brand_id3\", \"t34\".\"i_class_id3\", \"t34\".\"i_category_id3\", CASE WHEN COUNT(\"t33\".\"ss_quantity\" * \"t33\".\"ss_list_price\") = 0 THEN NULL ELSE COALESCE(SUM(\"t33\".\"ss_quantity\" * \"t33\".\"ss_list_price\"), 0) END AS \"sales\", COUNT(*) AS \"number_sales\"\r\n                FROM (SELECT \"t\".\"ss_sold_date_sk\", \"t\".\"ss_sold_time_sk\", \"t\".\"ss_item_sk\", \"t\".\"ss_customer_sk\", \"t\".\"ss_cdemo_sk\", \"t\".\"ss_hdemo_sk\", \"t\".\"ss_addr_sk\", \"t\".\"ss_store_sk\", \"t\".\"ss_promo_sk\", \"t\".\"ss_ticket_number\", \"t\".\"ss_quantity\", \"t\".\"ss_wholesale_cost\", \"t\".\"ss_list_price\", \"t\".\"ss_sales_price\", \"t\".\"ss_ext_discount_amt\", \"t\".\"ss_ext_sales_price\", \"t\".\"ss_ext_wholesale_cost\", \"t\".\"ss_ext_list_price\", \"t\".\"ss_ext_tax\", \"t\".\"ss_coupon_amt\", \"t\".\"ss_net_paid\", \"t\".\"ss_net_paid_inc_tax\", \"t\".\"ss_net_profit\"\r\n                        FROM (SELECT *\r\n                                FROM \"store_sales\"\r\n                                WHERE \"ss_wholesale_cost\" >= 43 AND \"ss_wholesale_cost\" <= 63) AS \"t\"\r\n                            INNER JOIN (SELECT \"t0\".\"i_item_sk\"\r\n                                FROM (SELECT *\r\n                                        FROM \"item\"\r\n                                        WHERE (\"i_category\" = 'Books' OR \"i_category\" = 'Children' OR \"i_category\" = 'Home') AND (\"i_manager_id\" >= 7 AND \"i_manager_id\" <= 16)) AS \"t0\"\r\n                                    INNER JOIN (SELECT \"i_brand_id0\", \"i_class_id0\", \"i_category_id0\"\r\n                                        FROM (SELECT \"i_brand_id0\", \"i_class_id0\", \"i_category_id0\", 1 AS \"$f3\"\r\n                                                    FROM (SELECT \"t5\".\"i_brand_id0\", \"t5\".\"i_class_id0\", \"t5\".\"i_category_id0\", COALESCE(SUM(\"t5\".\"$f4\"), 0) AS \"$f3\"\r\n                                                                FROM (SELECT \"t2\".\"ss_sold_date_sk0\", \"t4\".\"i_brand_id0\", \"t4\".\"i_class_id0\", \"t4\".\"i_category_id0\", COALESCE(SUM(\"t2\".\"$f2\"), 0) AS \"$f4\"\r\n                                                                        FROM (SELECT \"ss_sold_date_sk0\", \"ss_item_sk0\", COUNT(*) AS \"$f2\"\r\n                                                                                FROM \"store_sales\" AS \"store_sales0\" (\"ss_sold_date_sk0\", \"ss_sold_time_sk0\", \"ss_item_sk0\", \"ss_customer_sk0\", \"ss_cdemo_sk0\", \"ss_hdemo_sk0\", \"ss_addr_sk0\", \"ss_store_sk0\", \"ss_promo_sk0\", \"ss_ticket_number0\", \"ss_quantity0\", \"ss_wholesale_cost0\", \"ss_list_price0\", \"ss_sales_price0\", \"ss_ext_discount_amt0\", \"ss_ext_sales_price0\", \"ss_ext_wholesale_cost0\", \"ss_ext_list_price0\", \"ss_ext_tax0\", \"ss_coupon_amt0\", \"ss_net_paid0\", \"ss_net_paid_inc_tax0\", \"ss_net_profit0\")\r\n                                                                                WHERE \"ss_wholesale_cost0\" >= 43 AND \"ss_wholesale_cost0\" <= 63\r\n                                                                                GROUP BY \"ss_sold_date_sk0\", \"ss_item_sk0\") AS \"t2\"\r\n                                                                            INNER JOIN (SELECT \"i_item_sk0\", \"i_brand_id0\", \"i_class_id0\", \"i_category_id0\"\r\n                                                                                FROM \"item\" AS \"item0\" (\"i_item_sk0\", \"i_item_id0\", \"i_rec_start_date0\", \"i_rec_end_date0\", \"i_item_desc0\", \"i_current_price0\", \"i_wholesale_cost0\", \"i_brand_id0\", \"i_brand0\", \"i_class_id0\", \"i_class0\", \"i_category_id0\", \"i_category0\", \"i_manufact_id0\", \"i_manufact0\", \"i_size0\", \"i_formulation0\", \"i_color0\", \"i_units0\", \"i_container0\", \"i_manager_id0\", \"i_product_name0\")\r\n                                                                                WHERE (\"i_category0\" = 'Books' OR \"i_category0\" = 'Children' OR \"i_category0\" = 'Home') AND (\"i_manager_id0\" >= 7 AND \"i_manager_id0\" <= 16)) AS \"t4\" ON \"t2\".\"ss_item_sk0\" = \"t4\".\"i_item_sk0\"\r\n                                                                        GROUP BY \"t2\".\"ss_sold_date_sk0\", \"t4\".\"i_brand_id0\", \"t4\".\"i_class_id0\", \"t4\".\"i_category_id0\") AS \"t5\"\r\n                                                                    INNER JOIN (SELECT \"d_date_sk\"\r\n                                                                        FROM \"date_dim\"\r\n                                                                        WHERE \"d_year\" >= 1999 AND \"d_year\" <= 2001) AS \"t7\" ON \"t5\".\"ss_sold_date_sk0\" = \"t7\".\"d_date_sk\"\r\n                                                                GROUP BY \"t5\".\"i_brand_id0\", \"t5\".\"i_class_id0\", \"t5\".\"i_category_id0\"\r\n                                                                UNION ALL\r\n                                                                SELECT \"t13\".\"i_brand_id1\", \"t13\".\"i_class_id1\", \"t13\".\"i_category_id1\", COALESCE(SUM(\"t13\".\"$f4\"), 0) AS \"$f3\"\r\n                                                                FROM (SELECT \"t10\".\"cs_sold_date_sk\", \"t12\".\"i_brand_id1\", \"t12\".\"i_class_id1\", \"t12\".\"i_category_id1\", COALESCE(SUM(\"t10\".\"$f2\"), 0) AS \"$f4\"\r\n                                                                        FROM (SELECT \"cs_sold_date_sk\", \"cs_item_sk\", COUNT(*) AS \"$f2\"\r\n                                                                                FROM \"catalog_sales\"\r\n                                                                                WHERE \"cs_wholesale_cost\" >= 43 AND \"cs_wholesale_cost\" <= 63\r\n                                                                                GROUP BY \"cs_sold_date_sk\", \"cs_item_sk\") AS \"t10\"\r\n                                                                            INNER JOIN (SELECT \"i_item_sk1\", \"i_brand_id1\", \"i_class_id1\", \"i_category_id1\"\r\n                                                                                FROM \"item\" AS \"item1\" (\"i_item_sk1\", \"i_item_id1\", \"i_rec_start_date1\", \"i_rec_end_date1\", \"i_item_desc1\", \"i_current_price1\", \"i_wholesale_cost1\", \"i_brand_id1\", \"i_brand1\", \"i_class_id1\", \"i_class1\", \"i_category_id1\", \"i_category1\", \"i_manufact_id1\", \"i_manufact1\", \"i_size1\", \"i_formulation1\", \"i_color1\", \"i_units1\", \"i_container1\", \"i_manager_id1\", \"i_product_name1\")\r\n                                                                                WHERE (\"i_category1\" = 'Books' OR \"i_category1\" = 'Children' OR \"i_category1\" = 'Home') AND (\"i_manager_id1\" >= 7 AND \"i_manager_id1\" <= 16)) AS \"t12\" ON \"t10\".\"cs_item_sk\" = \"t12\".\"i_item_sk1\"\r\n                                                                        GROUP BY \"t10\".\"cs_sold_date_sk\", \"t12\".\"i_brand_id1\", \"t12\".\"i_class_id1\", \"t12\".\"i_category_id1\") AS \"t13\"\r\n                                                                    INNER JOIN (SELECT \"d_date_sk0\"\r\n                                                                        FROM \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\")\r\n                                                                        WHERE \"d_year0\" >= 1999 AND \"d_year0\" <= 2001) AS \"t15\" ON \"t13\".\"cs_sold_date_sk\" = \"t15\".\"d_date_sk0\"\r\n                                                                GROUP BY \"t13\".\"i_brand_id1\", \"t13\".\"i_class_id1\", \"t13\".\"i_category_id1\") AS \"t17\"\r\n                                                    GROUP BY \"i_brand_id0\", \"i_class_id0\", \"i_category_id0\"\r\n                                                    HAVING COUNT(*) = 2\r\n                                                    UNION ALL\r\n                                                    SELECT \"t24\".\"i_brand_id2\", \"t24\".\"i_class_id2\", \"t24\".\"i_category_id2\", COALESCE(SUM(\"t24\".\"$f4\"), 0) AS \"$f3\"\r\n                                                    FROM (SELECT \"t22\".\"ws_sold_date_sk\", \"t23\".\"i_brand_id2\", \"t23\".\"i_class_id2\", \"t23\".\"i_category_id2\", COALESCE(SUM(\"t22\".\"$f2\"), 0) AS \"$f4\"\r\n                                                            FROM (SELECT \"ws_sold_date_sk\", \"ws_item_sk\", COUNT(*) AS \"$f2\"\r\n                                                                    FROM \"web_sales\"\r\n                                                                    WHERE \"ws_wholesale_cost\" >= 43 AND \"ws_wholesale_cost\" <= 63\r\n                                                                    GROUP BY \"ws_sold_date_sk\", \"ws_item_sk\") AS \"t22\"\r\n                                                                INNER JOIN (SELECT \"i_item_sk2\", \"i_brand_id2\", \"i_class_id2\", \"i_category_id2\"\r\n                                                                    FROM \"item\" AS \"item2\" (\"i_item_sk2\", \"i_item_id2\", \"i_rec_start_date2\", \"i_rec_end_date2\", \"i_item_desc2\", \"i_current_price2\", \"i_wholesale_cost2\", \"i_brand_id2\", \"i_brand2\", \"i_class_id2\", \"i_class2\", \"i_category_id2\", \"i_category2\", \"i_manufact_id2\", \"i_manufact2\", \"i_size2\", \"i_formulation2\", \"i_color2\", \"i_units2\", \"i_container2\", \"i_manager_id2\", \"i_product_name2\")) AS \"t23\" ON \"t22\".\"ws_item_sk\" = \"t23\".\"i_item_sk2\"\r\n                                                            GROUP BY \"t22\".\"ws_sold_date_sk\", \"t23\".\"i_brand_id2\", \"t23\".\"i_class_id2\", \"t23\".\"i_category_id2\") AS \"t24\"\r\n                                                        INNER JOIN (SELECT \"d_date_sk1\"\r\n                                                            FROM \"date_dim\" AS \"date_dim1\" (\"d_date_sk1\", \"d_date_id1\", \"d_date1\", \"d_month_seq1\", \"d_week_seq1\", \"d_quarter_seq1\", \"d_year1\", \"d_dow1\", \"d_moy1\", \"d_dom1\", \"d_qoy1\", \"d_fy_year1\", \"d_fy_quarter_seq1\", \"d_fy_week_seq1\", \"d_day_name1\", \"d_quarter_name1\", \"d_holiday1\", \"d_weekend1\", \"d_following_holiday1\", \"d_first_dom1\", \"d_last_dom1\", \"d_same_day_ly1\", \"d_same_day_lq1\", \"d_current_day1\", \"d_current_week1\", \"d_current_month1\", \"d_current_quarter1\", \"d_current_year1\")\r\n                                                            WHERE \"d_year1\" >= 1999 AND \"d_year1\" <= 2001) AS \"t26\" ON \"t24\".\"ws_sold_date_sk\" = \"t26\".\"d_date_sk1\"\r\n                                                    GROUP BY \"t24\".\"i_brand_id2\", \"t24\".\"i_class_id2\", \"t24\".\"i_category_id2\") AS \"t28\"\r\n                                        GROUP BY \"i_brand_id0\", \"i_class_id0\", \"i_category_id0\"\r\n                                        HAVING COUNT(*) = 2) AS \"t31\" ON \"t0\".\"i_brand_id\" = \"t31\".\"i_brand_id0\" AND \"t0\".\"i_class_id\" = \"t31\".\"i_class_id0\" AND \"t0\".\"i_category_id\" = \"t31\".\"i_category_id0\") AS \"t32\" ON \"t\".\"ss_item_sk\" = \"t32\".\"i_item_sk\") AS \"t33\"\r\n                    INNER JOIN (SELECT *\r\n                        FROM \"item\" AS \"item3\" (\"i_item_sk3\", \"i_item_id3\", \"i_rec_start_date3\", \"i_rec_end_date3\", \"i_item_desc3\", \"i_current_price3\", \"i_wholesale_cost3\", \"i_brand_id3\", \"i_brand3\", \"i_class_id3\", \"i_class3\", \"i_category_id3\", \"i_category3\", \"i_manufact_id3\", \"i_manufact3\", \"i_size3\", \"i_formulation3\", \"i_color3\", \"i_units3\", \"i_container3\", \"i_manager_id3\", \"i_product_name3\")\r\n                        WHERE (\"i_category3\" = 'Books' OR \"i_category3\" = 'Children' OR \"i_category3\" = 'Home') AND (\"i_manager_id3\" >= 7 AND \"i_manager_id3\" <= 16)) AS \"t34\" ON \"t33\".\"ss_item_sk\" = \"t34\".\"i_item_sk3\"\r\n                    INNER JOIN (SELECT \"date_dim2\".\"d_date_sk2\", \"date_dim2\".\"d_date_id2\", \"date_dim2\".\"d_date2\", \"date_dim2\".\"d_month_seq2\", \"date_dim2\".\"d_week_seq2\", \"date_dim2\".\"d_quarter_seq2\", \"date_dim2\".\"d_year2\", \"date_dim2\".\"d_dow2\", \"date_dim2\".\"d_moy2\", \"date_dim2\".\"d_dom2\", \"date_dim2\".\"d_qoy2\", \"date_dim2\".\"d_fy_year2\", \"date_dim2\".\"d_fy_quarter_seq2\", \"date_dim2\".\"d_fy_week_seq2\", \"date_dim2\".\"d_day_name2\", \"date_dim2\".\"d_quarter_name2\", \"date_dim2\".\"d_holiday2\", \"date_dim2\".\"d_weekend2\", \"date_dim2\".\"d_following_holiday2\", \"date_dim2\".\"d_first_dom2\", \"date_dim2\".\"d_last_dom2\", \"date_dim2\".\"d_same_day_ly2\", \"date_dim2\".\"d_same_day_lq2\", \"date_dim2\".\"d_current_day2\", \"date_dim2\".\"d_current_week2\", \"date_dim2\".\"d_current_month2\", \"date_dim2\".\"d_current_quarter2\", \"date_dim2\".\"d_current_year2\"\r\n                        FROM \"date_dim\" AS \"date_dim2\" (\"d_date_sk2\", \"d_date_id2\", \"d_date2\", \"d_month_seq2\", \"d_week_seq2\", \"d_quarter_seq2\", \"d_year2\", \"d_dow2\", \"d_moy2\", \"d_dom2\", \"d_qoy2\", \"d_fy_year2\", \"d_fy_quarter_seq2\", \"d_fy_week_seq2\", \"d_day_name2\", \"d_quarter_name2\", \"d_holiday2\", \"d_weekend2\", \"d_following_holiday2\", \"d_first_dom2\", \"d_last_dom2\", \"d_same_day_ly2\", \"d_same_day_lq2\", \"d_current_day2\", \"d_current_week2\", \"d_current_month2\", \"d_current_quarter2\", \"d_current_year2\")\r\n                            INNER JOIN (SELECT CASE COUNT(*) WHEN 0 THEN NULL WHEN 1 THEN MIN(\"d_week_seq3\") ELSE (SELECT CAST(NULL AS INTEGER)\r\n                                                UNION ALL\r\n                                                SELECT CAST(NULL AS INTEGER)) END AS \"$f0\"\r\n                                FROM \"date_dim\" AS \"date_dim3\" (\"d_date_sk3\", \"d_date_id3\", \"d_date3\", \"d_month_seq3\", \"d_week_seq3\", \"d_quarter_seq3\", \"d_year3\", \"d_dow3\", \"d_moy3\", \"d_dom3\", \"d_qoy3\", \"d_fy_year3\", \"d_fy_quarter_seq3\", \"d_fy_week_seq3\", \"d_day_name3\", \"d_quarter_name3\", \"d_holiday3\", \"d_weekend3\", \"d_following_holiday3\", \"d_first_dom3\", \"d_last_dom3\", \"d_same_day_ly3\", \"d_same_day_lq3\", \"d_current_day3\", \"d_current_week3\", \"d_current_month3\", \"d_current_quarter3\", \"d_current_year3\")\r\n                                WHERE \"d_year3\" = 2000 AND \"d_moy3\" = 12 AND \"d_dom3\" = 24) AS \"t36\" ON \"date_dim2\".\"d_week_seq2\" = \"t36\".\"$f0\") AS \"t37\" ON \"t33\".\"ss_sold_date_sk\" = \"t37\".\"d_date_sk2\"\r\n                GROUP BY \"t34\".\"i_brand_id3\", \"t34\".\"i_class_id3\", \"t34\".\"i_category_id3\") AS \"t40\"\r\n            INNER JOIN (SELECT CAST(CAST(CASE WHEN COUNT(\"ss_quantity1\" * \"ss_list_price1\") = 0 THEN NULL ELSE COALESCE(SUM(\"ss_quantity1\" * \"ss_list_price1\"), 0) END AS DECIMAL(17, 2)) / COUNT(\"ss_quantity1\" * \"ss_list_price1\") AS DECIMAL(17, 2)) AS \"average_sales\"\r\n                FROM (SELECT \"t41\".\"ss_quantity1\", \"t41\".\"ss_list_price1\"\r\n                            FROM (SELECT *\r\n                                    FROM \"store_sales\" AS \"store_sales1\" (\"ss_sold_date_sk1\", \"ss_sold_time_sk1\", \"ss_item_sk1\", \"ss_customer_sk1\", \"ss_cdemo_sk1\", \"ss_hdemo_sk1\", \"ss_addr_sk1\", \"ss_store_sk1\", \"ss_promo_sk1\", \"ss_ticket_number1\", \"ss_quantity1\", \"ss_wholesale_cost1\", \"ss_list_price1\", \"ss_sales_price1\", \"ss_ext_discount_amt1\", \"ss_ext_sales_price1\", \"ss_ext_wholesale_cost1\", \"ss_ext_list_price1\", \"ss_ext_tax1\", \"ss_coupon_amt1\", \"ss_net_paid1\", \"ss_net_paid_inc_tax1\", \"ss_net_profit1\")\r\n                                    WHERE \"ss_wholesale_cost1\" >= 43 AND \"ss_wholesale_cost1\" <= 63) AS \"t41\"\r\n                                INNER JOIN (SELECT *\r\n                                    FROM \"date_dim\" AS \"date_dim4\" (\"d_date_sk4\", \"d_date_id4\", \"d_date4\", \"d_month_seq4\", \"d_week_seq4\", \"d_quarter_seq4\", \"d_year4\", \"d_dow4\", \"d_moy4\", \"d_dom4\", \"d_qoy4\", \"d_fy_year4\", \"d_fy_quarter_seq4\", \"d_fy_week_seq4\", \"d_day_name4\", \"d_quarter_name4\", \"d_holiday4\", \"d_weekend4\", \"d_following_holiday4\", \"d_first_dom4\", \"d_last_dom4\", \"d_same_day_ly4\", \"d_same_day_lq4\", \"d_current_day4\", \"d_current_week4\", \"d_current_month4\", \"d_current_quarter4\", \"d_current_year4\")\r\n                                    WHERE \"d_year4\" >= 1999 AND \"d_year4\" <= 2001) AS \"t42\" ON \"t41\".\"ss_sold_date_sk1\" = \"t42\".\"d_date_sk4\"\r\n                            UNION ALL\r\n                            SELECT \"t44\".\"cs_quantity0\", \"t44\".\"cs_list_price0\"\r\n                            FROM (SELECT *\r\n                                    FROM \"catalog_sales\" AS \"catalog_sales0\" (\"cs_sold_date_sk0\", \"cs_sold_time_sk0\", \"cs_ship_date_sk0\", \"cs_bill_customer_sk0\", \"cs_bill_cdemo_sk0\", \"cs_bill_hdemo_sk0\", \"cs_bill_addr_sk0\", \"cs_ship_customer_sk0\", \"cs_ship_cdemo_sk0\", \"cs_ship_hdemo_sk0\", \"cs_ship_addr_sk0\", \"cs_call_center_sk0\", \"cs_catalog_page_sk0\", \"cs_ship_mode_sk0\", \"cs_warehouse_sk0\", \"cs_item_sk0\", \"cs_promo_sk0\", \"cs_order_number0\", \"cs_quantity0\", \"cs_wholesale_cost0\", \"cs_list_price0\", \"cs_sales_price0\", \"cs_ext_discount_amt0\", \"cs_ext_sales_price0\", \"cs_ext_wholesale_cost0\", \"cs_ext_list_price0\", \"cs_ext_tax0\", \"cs_coupon_amt0\", \"cs_ext_ship_cost0\", \"cs_net_paid0\", \"cs_net_paid_inc_tax0\", \"cs_net_paid_inc_ship0\", \"cs_net_paid_inc_ship_tax0\", \"cs_net_profit0\")\r\n                                    WHERE \"cs_wholesale_cost0\" >= 43 AND \"cs_wholesale_cost0\" <= 63) AS \"t44\"\r\n                                INNER JOIN (SELECT *\r\n                                    FROM \"date_dim\" AS \"date_dim5\" (\"d_date_sk5\", \"d_date_id5\", \"d_date5\", \"d_month_seq5\", \"d_week_seq5\", \"d_quarter_seq5\", \"d_year5\", \"d_dow5\", \"d_moy5\", \"d_dom5\", \"d_qoy5\", \"d_fy_year5\", \"d_fy_quarter_seq5\", \"d_fy_week_seq5\", \"d_day_name5\", \"d_quarter_name5\", \"d_holiday5\", \"d_weekend5\", \"d_following_holiday5\", \"d_first_dom5\", \"d_last_dom5\", \"d_same_day_ly5\", \"d_same_day_lq5\", \"d_current_day5\", \"d_current_week5\", \"d_current_month5\", \"d_current_quarter5\", \"d_current_year5\")\r\n                                    WHERE \"d_year5\" >= 1999 AND \"d_year5\" <= 2001) AS \"t45\" ON \"t44\".\"cs_sold_date_sk0\" = \"t45\".\"d_date_sk5\"\r\n                            UNION ALL\r\n                            SELECT \"t47\".\"ws_quantity0\", \"t47\".\"ws_list_price0\"\r\n                            FROM (SELECT *\r\n                                    FROM \"web_sales\" AS \"web_sales0\" (\"ws_sold_date_sk0\", \"ws_sold_time_sk0\", \"ws_ship_date_sk0\", \"ws_item_sk0\", \"ws_bill_customer_sk0\", \"ws_bill_cdemo_sk0\", \"ws_bill_hdemo_sk0\", \"ws_bill_addr_sk0\", \"ws_ship_customer_sk0\", \"ws_ship_cdemo_sk0\", \"ws_ship_hdemo_sk0\", \"ws_ship_addr_sk0\", \"ws_web_page_sk0\", \"ws_web_site_sk0\", \"ws_ship_mode_sk0\", \"ws_warehouse_sk0\", \"ws_promo_sk0\", \"ws_order_number0\", \"ws_quantity0\", \"ws_wholesale_cost0\", \"ws_list_price0\", \"ws_sales_price0\", \"ws_ext_discount_amt0\", \"ws_ext_sales_price0\", \"ws_ext_wholesale_cost0\", \"ws_ext_list_price0\", \"ws_ext_tax0\", \"ws_coupon_amt0\", \"ws_ext_ship_cost0\", \"ws_net_paid0\", \"ws_net_paid_inc_tax0\", \"ws_net_paid_inc_ship0\", \"ws_net_paid_inc_ship_tax0\", \"ws_net_profit0\")\r\n                                    WHERE \"ws_wholesale_cost0\" >= 43 AND \"ws_wholesale_cost0\" <= 63) AS \"t47\"\r\n                                INNER JOIN (SELECT *\r\n                                    FROM \"date_dim\" AS \"date_dim6\" (\"d_date_sk6\", \"d_date_id6\", \"d_date6\", \"d_month_seq6\", \"d_week_seq6\", \"d_quarter_seq6\", \"d_year6\", \"d_dow6\", \"d_moy6\", \"d_dom6\", \"d_qoy6\", \"d_fy_year6\", \"d_fy_quarter_seq6\", \"d_fy_week_seq6\", \"d_day_name6\", \"d_quarter_name6\", \"d_holiday6\", \"d_weekend6\", \"d_following_holiday6\", \"d_first_dom6\", \"d_last_dom6\", \"d_same_day_ly6\", \"d_same_day_lq6\", \"d_current_day6\", \"d_current_week6\", \"d_current_month6\", \"d_current_quarter6\", \"d_current_year6\")\r\n                                    WHERE \"d_year6\" >= 1999 AND \"d_year6\" <= 2001) AS \"t48\" ON \"t47\".\"ws_sold_date_sk0\" = \"t48\".\"d_date_sk6\") AS \"t50\") AS \"t55\" ON \"t40\".\"sales\" > \"t55\".\"average_sales\") AS \"t57\"\r\n    INNER JOIN (SELECT 'store' AS \"channel0\", \"t99\".\"i_brand_id8\", \"t99\".\"i_class_id8\", \"t99\".\"i_category_id8\", \"t99\".\"sales0\", \"t99\".\"number_sales\"\r\n        FROM (SELECT \"t93\".\"i_brand_id8\", \"t93\".\"i_class_id8\", \"t93\".\"i_category_id8\", CASE WHEN COUNT(\"t92\".\"ss_quantity2\" * \"t92\".\"ss_list_price2\") = 0 THEN NULL ELSE COALESCE(SUM(\"t92\".\"ss_quantity2\" * \"t92\".\"ss_list_price2\"), 0) END AS \"sales0\", COUNT(*) AS \"number_sales\"\r\n                FROM (SELECT \"t58\".\"ss_sold_date_sk2\", \"t58\".\"ss_sold_time_sk2\", \"t58\".\"ss_item_sk2\", \"t58\".\"ss_customer_sk2\", \"t58\".\"ss_cdemo_sk2\", \"t58\".\"ss_hdemo_sk2\", \"t58\".\"ss_addr_sk2\", \"t58\".\"ss_store_sk2\", \"t58\".\"ss_promo_sk2\", \"t58\".\"ss_ticket_number2\", \"t58\".\"ss_quantity2\", \"t58\".\"ss_wholesale_cost2\", \"t58\".\"ss_list_price2\", \"t58\".\"ss_sales_price2\", \"t58\".\"ss_ext_discount_amt2\", \"t58\".\"ss_ext_sales_price2\", \"t58\".\"ss_ext_wholesale_cost2\", \"t58\".\"ss_ext_list_price2\", \"t58\".\"ss_ext_tax2\", \"t58\".\"ss_coupon_amt2\", \"t58\".\"ss_net_paid2\", \"t58\".\"ss_net_paid_inc_tax2\", \"t58\".\"ss_net_profit2\"\r\n                        FROM (SELECT *\r\n                                FROM \"store_sales\" AS \"store_sales2\" (\"ss_sold_date_sk2\", \"ss_sold_time_sk2\", \"ss_item_sk2\", \"ss_customer_sk2\", \"ss_cdemo_sk2\", \"ss_hdemo_sk2\", \"ss_addr_sk2\", \"ss_store_sk2\", \"ss_promo_sk2\", \"ss_ticket_number2\", \"ss_quantity2\", \"ss_wholesale_cost2\", \"ss_list_price2\", \"ss_sales_price2\", \"ss_ext_discount_amt2\", \"ss_ext_sales_price2\", \"ss_ext_wholesale_cost2\", \"ss_ext_list_price2\", \"ss_ext_tax2\", \"ss_coupon_amt2\", \"ss_net_paid2\", \"ss_net_paid_inc_tax2\", \"ss_net_profit2\")\r\n                                WHERE \"ss_wholesale_cost2\" >= 43 AND \"ss_wholesale_cost2\" <= 63) AS \"t58\"\r\n                            INNER JOIN (SELECT \"t59\".\"i_item_sk4\"\r\n                                FROM (SELECT *\r\n                                        FROM \"item\" AS \"item4\" (\"i_item_sk4\", \"i_item_id4\", \"i_rec_start_date4\", \"i_rec_end_date4\", \"i_item_desc4\", \"i_current_price4\", \"i_wholesale_cost4\", \"i_brand_id4\", \"i_brand4\", \"i_class_id4\", \"i_class4\", \"i_category_id4\", \"i_category4\", \"i_manufact_id4\", \"i_manufact4\", \"i_size4\", \"i_formulation4\", \"i_color4\", \"i_units4\", \"i_container4\", \"i_manager_id4\", \"i_product_name4\")\r\n                                        WHERE (\"i_category4\" = 'Books' OR \"i_category4\" = 'Children' OR \"i_category4\" = 'Home') AND (\"i_manager_id4\" >= 7 AND \"i_manager_id4\" <= 16)) AS \"t59\"\r\n                                    INNER JOIN (SELECT \"i_brand_id5\", \"i_class_id5\", \"i_category_id5\"\r\n                                        FROM (SELECT \"i_brand_id5\", \"i_class_id5\", \"i_category_id5\", 1 AS \"$f31\"\r\n                                                    FROM (SELECT \"t64\".\"i_brand_id5\", \"t64\".\"i_class_id5\", \"t64\".\"i_category_id5\", COALESCE(SUM(\"t64\".\"$f4\"), 0) AS \"$f3\"\r\n                                                                FROM (SELECT \"t61\".\"ss_sold_date_sk3\", \"t63\".\"i_brand_id5\", \"t63\".\"i_class_id5\", \"t63\".\"i_category_id5\", COALESCE(SUM(\"t61\".\"$f2\"), 0) AS \"$f4\"\r\n                                                                        FROM (SELECT \"ss_sold_date_sk3\", \"ss_item_sk3\", COUNT(*) AS \"$f2\"\r\n                                                                                FROM \"store_sales\" AS \"store_sales3\" (\"ss_sold_date_sk3\", \"ss_sold_time_sk3\", \"ss_item_sk3\", \"ss_customer_sk3\", \"ss_cdemo_sk3\", \"ss_hdemo_sk3\", \"ss_addr_sk3\", \"ss_store_sk3\", \"ss_promo_sk3\", \"ss_ticket_number3\", \"ss_quantity3\", \"ss_wholesale_cost3\", \"ss_list_price3\", \"ss_sales_price3\", \"ss_ext_discount_amt3\", \"ss_ext_sales_price3\", \"ss_ext_wholesale_cost3\", \"ss_ext_list_price3\", \"ss_ext_tax3\", \"ss_coupon_amt3\", \"ss_net_paid3\", \"ss_net_paid_inc_tax3\", \"ss_net_profit3\")\r\n                                                                                WHERE \"ss_wholesale_cost3\" >= 43 AND \"ss_wholesale_cost3\" <= 63\r\n                                                                                GROUP BY \"ss_sold_date_sk3\", \"ss_item_sk3\") AS \"t61\"\r\n                                                                            INNER JOIN (SELECT \"i_item_sk5\", \"i_brand_id5\", \"i_class_id5\", \"i_category_id5\"\r\n                                                                                FROM \"item\" AS \"item5\" (\"i_item_sk5\", \"i_item_id5\", \"i_rec_start_date5\", \"i_rec_end_date5\", \"i_item_desc5\", \"i_current_price5\", \"i_wholesale_cost5\", \"i_brand_id5\", \"i_brand5\", \"i_class_id5\", \"i_class5\", \"i_category_id5\", \"i_category5\", \"i_manufact_id5\", \"i_manufact5\", \"i_size5\", \"i_formulation5\", \"i_color5\", \"i_units5\", \"i_container5\", \"i_manager_id5\", \"i_product_name5\")\r\n                                                                                WHERE (\"i_category5\" = 'Books' OR \"i_category5\" = 'Children' OR \"i_category5\" = 'Home') AND (\"i_manager_id5\" >= 7 AND \"i_manager_id5\" <= 16)) AS \"t63\" ON \"t61\".\"ss_item_sk3\" = \"t63\".\"i_item_sk5\"\r\n                                                                        GROUP BY \"t61\".\"ss_sold_date_sk3\", \"t63\".\"i_brand_id5\", \"t63\".\"i_class_id5\", \"t63\".\"i_category_id5\") AS \"t64\"\r\n                                                                    INNER JOIN (SELECT \"d_date_sk7\"\r\n                                                                        FROM \"date_dim\" AS \"date_dim7\" (\"d_date_sk7\", \"d_date_id7\", \"d_date7\", \"d_month_seq7\", \"d_week_seq7\", \"d_quarter_seq7\", \"d_year7\", \"d_dow7\", \"d_moy7\", \"d_dom7\", \"d_qoy7\", \"d_fy_year7\", \"d_fy_quarter_seq7\", \"d_fy_week_seq7\", \"d_day_name7\", \"d_quarter_name7\", \"d_holiday7\", \"d_weekend7\", \"d_following_holiday7\", \"d_first_dom7\", \"d_last_dom7\", \"d_same_day_ly7\", \"d_same_day_lq7\", \"d_current_day7\", \"d_current_week7\", \"d_current_month7\", \"d_current_quarter7\", \"d_current_year7\")\r\n                                                                        WHERE \"d_year7\" >= 1999 AND \"d_year7\" <= 2001) AS \"t66\" ON \"t64\".\"ss_sold_date_sk3\" = \"t66\".\"d_date_sk7\"\r\n                                                                GROUP BY \"t64\".\"i_brand_id5\", \"t64\".\"i_class_id5\", \"t64\".\"i_category_id5\"\r\n                                                                UNION ALL\r\n                                                                SELECT \"t72\".\"i_brand_id6\", \"t72\".\"i_class_id6\", \"t72\".\"i_category_id6\", COALESCE(SUM(\"t72\".\"$f4\"), 0) AS \"$f3\"\r\n                                                                FROM (SELECT \"t69\".\"cs_sold_date_sk1\", \"t71\".\"i_brand_id6\", \"t71\".\"i_class_id6\", \"t71\".\"i_category_id6\", COALESCE(SUM(\"t69\".\"$f2\"), 0) AS \"$f4\"\r\n                                                                        FROM (SELECT \"cs_sold_date_sk1\", \"cs_item_sk1\", COUNT(*) AS \"$f2\"\r\n                                                                                FROM \"catalog_sales\" AS \"catalog_sales1\" (\"cs_sold_date_sk1\", \"cs_sold_time_sk1\", \"cs_ship_date_sk1\", \"cs_bill_customer_sk1\", \"cs_bill_cdemo_sk1\", \"cs_bill_hdemo_sk1\", \"cs_bill_addr_sk1\", \"cs_ship_customer_sk1\", \"cs_ship_cdemo_sk1\", \"cs_ship_hdemo_sk1\", \"cs_ship_addr_sk1\", \"cs_call_center_sk1\", \"cs_catalog_page_sk1\", \"cs_ship_mode_sk1\", \"cs_warehouse_sk1\", \"cs_item_sk1\", \"cs_promo_sk1\", \"cs_order_number1\", \"cs_quantity1\", \"cs_wholesale_cost1\", \"cs_list_price1\", \"cs_sales_price1\", \"cs_ext_discount_amt1\", \"cs_ext_sales_price1\", \"cs_ext_wholesale_cost1\", \"cs_ext_list_price1\", \"cs_ext_tax1\", \"cs_coupon_amt1\", \"cs_ext_ship_cost1\", \"cs_net_paid1\", \"cs_net_paid_inc_tax1\", \"cs_net_paid_inc_ship1\", \"cs_net_paid_inc_ship_tax1\", \"cs_net_profit1\")\r\n                                                                                WHERE \"cs_wholesale_cost1\" >= 43 AND \"cs_wholesale_cost1\" <= 63\r\n                                                                                GROUP BY \"cs_sold_date_sk1\", \"cs_item_sk1\") AS \"t69\"\r\n                                                                            INNER JOIN (SELECT \"i_item_sk6\", \"i_brand_id6\", \"i_class_id6\", \"i_category_id6\"\r\n                                                                                FROM \"item\" AS \"item6\" (\"i_item_sk6\", \"i_item_id6\", \"i_rec_start_date6\", \"i_rec_end_date6\", \"i_item_desc6\", \"i_current_price6\", \"i_wholesale_cost6\", \"i_brand_id6\", \"i_brand6\", \"i_class_id6\", \"i_class6\", \"i_category_id6\", \"i_category6\", \"i_manufact_id6\", \"i_manufact6\", \"i_size6\", \"i_formulation6\", \"i_color6\", \"i_units6\", \"i_container6\", \"i_manager_id6\", \"i_product_name6\")\r\n                                                                                WHERE (\"i_category6\" = 'Books' OR \"i_category6\" = 'Children' OR \"i_category6\" = 'Home') AND (\"i_manager_id6\" >= 7 AND \"i_manager_id6\" <= 16)) AS \"t71\" ON \"t69\".\"cs_item_sk1\" = \"t71\".\"i_item_sk6\"\r\n                                                                        GROUP BY \"t69\".\"cs_sold_date_sk1\", \"t71\".\"i_brand_id6\", \"t71\".\"i_class_id6\", \"t71\".\"i_category_id6\") AS \"t72\"\r\n                                                                    INNER JOIN (SELECT \"d_date_sk8\"\r\n                                                                        FROM \"date_dim\" AS \"date_dim8\" (\"d_date_sk8\", \"d_date_id8\", \"d_date8\", \"d_month_seq8\", \"d_week_seq8\", \"d_quarter_seq8\", \"d_year8\", \"d_dow8\", \"d_moy8\", \"d_dom8\", \"d_qoy8\", \"d_fy_year8\", \"d_fy_quarter_seq8\", \"d_fy_week_seq8\", \"d_day_name8\", \"d_quarter_name8\", \"d_holiday8\", \"d_weekend8\", \"d_following_holiday8\", \"d_first_dom8\", \"d_last_dom8\", \"d_same_day_ly8\", \"d_same_day_lq8\", \"d_current_day8\", \"d_current_week8\", \"d_current_month8\", \"d_current_quarter8\", \"d_current_year8\")\r\n                                                                        WHERE \"d_year8\" >= 1999 AND \"d_year8\" <= 2001) AS \"t74\" ON \"t72\".\"cs_sold_date_sk1\" = \"t74\".\"d_date_sk8\"\r\n                                                                GROUP BY \"t72\".\"i_brand_id6\", \"t72\".\"i_class_id6\", \"t72\".\"i_category_id6\") AS \"t76\"\r\n                                                    GROUP BY \"i_brand_id5\", \"i_class_id5\", \"i_category_id5\"\r\n                                                    HAVING COUNT(*) = 2\r\n                                                    UNION ALL\r\n                                                    SELECT \"t83\".\"i_brand_id7\", \"t83\".\"i_class_id7\", \"t83\".\"i_category_id7\", COALESCE(SUM(\"t83\".\"$f4\"), 0) AS \"$f3\"\r\n                                                    FROM (SELECT \"t81\".\"ws_sold_date_sk1\", \"t82\".\"i_brand_id7\", \"t82\".\"i_class_id7\", \"t82\".\"i_category_id7\", COALESCE(SUM(\"t81\".\"$f2\"), 0) AS \"$f4\"\r\n                                                            FROM (SELECT \"ws_sold_date_sk1\", \"ws_item_sk1\", COUNT(*) AS \"$f2\"\r\n                                                                    FROM \"web_sales\" AS \"web_sales1\" (\"ws_sold_date_sk1\", \"ws_sold_time_sk1\", \"ws_ship_date_sk1\", \"ws_item_sk1\", \"ws_bill_customer_sk1\", \"ws_bill_cdemo_sk1\", \"ws_bill_hdemo_sk1\", \"ws_bill_addr_sk1\", \"ws_ship_customer_sk1\", \"ws_ship_cdemo_sk1\", \"ws_ship_hdemo_sk1\", \"ws_ship_addr_sk1\", \"ws_web_page_sk1\", \"ws_web_site_sk1\", \"ws_ship_mode_sk1\", \"ws_warehouse_sk1\", \"ws_promo_sk1\", \"ws_order_number1\", \"ws_quantity1\", \"ws_wholesale_cost1\", \"ws_list_price1\", \"ws_sales_price1\", \"ws_ext_discount_amt1\", \"ws_ext_sales_price1\", \"ws_ext_wholesale_cost1\", \"ws_ext_list_price1\", \"ws_ext_tax1\", \"ws_coupon_amt1\", \"ws_ext_ship_cost1\", \"ws_net_paid1\", \"ws_net_paid_inc_tax1\", \"ws_net_paid_inc_ship1\", \"ws_net_paid_inc_ship_tax1\", \"ws_net_profit1\")\r\n                                                                    WHERE \"ws_wholesale_cost1\" >= 43 AND \"ws_wholesale_cost1\" <= 63\r\n                                                                    GROUP BY \"ws_sold_date_sk1\", \"ws_item_sk1\") AS \"t81\"\r\n                                                                INNER JOIN (SELECT \"i_item_sk7\", \"i_brand_id7\", \"i_class_id7\", \"i_category_id7\"\r\n                                                                    FROM \"item\" AS \"item7\" (\"i_item_sk7\", \"i_item_id7\", \"i_rec_start_date7\", \"i_rec_end_date7\", \"i_item_desc7\", \"i_current_price7\", \"i_wholesale_cost7\", \"i_brand_id7\", \"i_brand7\", \"i_class_id7\", \"i_class7\", \"i_category_id7\", \"i_category7\", \"i_manufact_id7\", \"i_manufact7\", \"i_size7\", \"i_formulation7\", \"i_color7\", \"i_units7\", \"i_container7\", \"i_manager_id7\", \"i_product_name7\")) AS \"t82\" ON \"t81\".\"ws_item_sk1\" = \"t82\".\"i_item_sk7\"\r\n                                                            GROUP BY \"t81\".\"ws_sold_date_sk1\", \"t82\".\"i_brand_id7\", \"t82\".\"i_class_id7\", \"t82\".\"i_category_id7\") AS \"t83\"\r\n                                                        INNER JOIN (SELECT \"d_date_sk9\"\r\n                                                            FROM \"date_dim\" AS \"date_dim9\" (\"d_date_sk9\", \"d_date_id9\", \"d_date9\", \"d_month_seq9\", \"d_week_seq9\", \"d_quarter_seq9\", \"d_year9\", \"d_dow9\", \"d_moy9\", \"d_dom9\", \"d_qoy9\", \"d_fy_year9\", \"d_fy_quarter_seq9\", \"d_fy_week_seq9\", \"d_day_name9\", \"d_quarter_name9\", \"d_holiday9\", \"d_weekend9\", \"d_following_holiday9\", \"d_first_dom9\", \"d_last_dom9\", \"d_same_day_ly9\", \"d_same_day_lq9\", \"d_current_day9\", \"d_current_week9\", \"d_current_month9\", \"d_current_quarter9\", \"d_current_year9\")\r\n                                                            WHERE \"d_year9\" >= 1999 AND \"d_year9\" <= 2001) AS \"t85\" ON \"t83\".\"ws_sold_date_sk1\" = \"t85\".\"d_date_sk9\"\r\n                                                    GROUP BY \"t83\".\"i_brand_id7\", \"t83\".\"i_class_id7\", \"t83\".\"i_category_id7\") AS \"t87\"\r\n                                        GROUP BY \"i_brand_id5\", \"i_class_id5\", \"i_category_id5\"\r\n                                        HAVING COUNT(*) = 2) AS \"t90\" ON \"t59\".\"i_brand_id4\" = \"t90\".\"i_brand_id5\" AND \"t59\".\"i_class_id4\" = \"t90\".\"i_class_id5\" AND \"t59\".\"i_category_id4\" = \"t90\".\"i_category_id5\") AS \"t91\" ON \"t58\".\"ss_item_sk2\" = \"t91\".\"i_item_sk4\") AS \"t92\"\r\n                    INNER JOIN (SELECT *\r\n                        FROM \"item\" AS \"item8\" (\"i_item_sk8\", \"i_item_id8\", \"i_rec_start_date8\", \"i_rec_end_date8\", \"i_item_desc8\", \"i_current_price8\", \"i_wholesale_cost8\", \"i_brand_id8\", \"i_brand8\", \"i_class_id8\", \"i_class8\", \"i_category_id8\", \"i_category8\", \"i_manufact_id8\", \"i_manufact8\", \"i_size8\", \"i_formulation8\", \"i_color8\", \"i_units8\", \"i_container8\", \"i_manager_id8\", \"i_product_name8\")\r\n                        WHERE (\"i_category8\" = 'Books' OR \"i_category8\" = 'Children' OR \"i_category8\" = 'Home') AND (\"i_manager_id8\" >= 7 AND \"i_manager_id8\" <= 16)) AS \"t93\" ON \"t92\".\"ss_item_sk2\" = \"t93\".\"i_item_sk8\"\r\n                    INNER JOIN (SELECT \"date_dim10\".\"d_date_sk10\", \"date_dim10\".\"d_date_id10\", \"date_dim10\".\"d_date10\", \"date_dim10\".\"d_month_seq10\", \"date_dim10\".\"d_week_seq10\", \"date_dim10\".\"d_quarter_seq10\", \"date_dim10\".\"d_year10\", \"date_dim10\".\"d_dow10\", \"date_dim10\".\"d_moy10\", \"date_dim10\".\"d_dom10\", \"date_dim10\".\"d_qoy10\", \"date_dim10\".\"d_fy_year10\", \"date_dim10\".\"d_fy_quarter_seq10\", \"date_dim10\".\"d_fy_week_seq10\", \"date_dim10\".\"d_day_name10\", \"date_dim10\".\"d_quarter_name10\", \"date_dim10\".\"d_holiday10\", \"date_dim10\".\"d_weekend10\", \"date_dim10\".\"d_following_holiday10\", \"date_dim10\".\"d_first_dom10\", \"date_dim10\".\"d_last_dom10\", \"date_dim10\".\"d_same_day_ly10\", \"date_dim10\".\"d_same_day_lq10\", \"date_dim10\".\"d_current_day10\", \"date_dim10\".\"d_current_week10\", \"date_dim10\".\"d_current_month10\", \"date_dim10\".\"d_current_quarter10\", \"date_dim10\".\"d_current_year10\"\r\n                        FROM \"date_dim\" AS \"date_dim10\" (\"d_date_sk10\", \"d_date_id10\", \"d_date10\", \"d_month_seq10\", \"d_week_seq10\", \"d_quarter_seq10\", \"d_year10\", \"d_dow10\", \"d_moy10\", \"d_dom10\", \"d_qoy10\", \"d_fy_year10\", \"d_fy_quarter_seq10\", \"d_fy_week_seq10\", \"d_day_name10\", \"d_quarter_name10\", \"d_holiday10\", \"d_weekend10\", \"d_following_holiday10\", \"d_first_dom10\", \"d_last_dom10\", \"d_same_day_ly10\", \"d_same_day_lq10\", \"d_current_day10\", \"d_current_week10\", \"d_current_month10\", \"d_current_quarter10\", \"d_current_year10\")\r\n                            INNER JOIN (SELECT CASE COUNT(*) WHEN 0 THEN NULL WHEN 1 THEN MIN(\"d_week_seq11\") ELSE (SELECT CAST(NULL AS INTEGER)\r\n                                                UNION ALL\r\n                                                SELECT CAST(NULL AS INTEGER)) END AS \"$f0\"\r\n                                FROM \"date_dim\" AS \"date_dim11\" (\"d_date_sk11\", \"d_date_id11\", \"d_date11\", \"d_month_seq11\", \"d_week_seq11\", \"d_quarter_seq11\", \"d_year11\", \"d_dow11\", \"d_moy11\", \"d_dom11\", \"d_qoy11\", \"d_fy_year11\", \"d_fy_quarter_seq11\", \"d_fy_week_seq11\", \"d_day_name11\", \"d_quarter_name11\", \"d_holiday11\", \"d_weekend11\", \"d_following_holiday11\", \"d_first_dom11\", \"d_last_dom11\", \"d_same_day_ly11\", \"d_same_day_lq11\", \"d_current_day11\", \"d_current_week11\", \"d_current_month11\", \"d_current_quarter11\", \"d_current_year11\")\r\n                                WHERE \"d_year11\" = 1999 AND \"d_moy11\" = 12 AND \"d_dom11\" = 24) AS \"t95\" ON \"date_dim10\".\"d_week_seq10\" = \"t95\".\"$f0\") AS \"t96\" ON \"t92\".\"ss_sold_date_sk2\" = \"t96\".\"d_date_sk10\"\r\n                GROUP BY \"t93\".\"i_brand_id8\", \"t93\".\"i_class_id8\", \"t93\".\"i_category_id8\") AS \"t99\"\r\n            INNER JOIN (SELECT CAST(CAST(CASE WHEN COUNT(\"ss_quantity4\" * \"ss_list_price4\") = 0 THEN NULL ELSE COALESCE(SUM(\"ss_quantity4\" * \"ss_list_price4\"), 0) END AS DECIMAL(17, 2)) / COUNT(\"ss_quantity4\" * \"ss_list_price4\") AS DECIMAL(17, 2)) AS \"average_sales0\"\r\n                FROM (SELECT \"t100\".\"ss_quantity4\", \"t100\".\"ss_list_price4\"\r\n                            FROM (SELECT *\r\n                                    FROM \"store_sales\" AS \"store_sales4\" (\"ss_sold_date_sk4\", \"ss_sold_time_sk4\", \"ss_item_sk4\", \"ss_customer_sk4\", \"ss_cdemo_sk4\", \"ss_hdemo_sk4\", \"ss_addr_sk4\", \"ss_store_sk4\", \"ss_promo_sk4\", \"ss_ticket_number4\", \"ss_quantity4\", \"ss_wholesale_cost4\", \"ss_list_price4\", \"ss_sales_price4\", \"ss_ext_discount_amt4\", \"ss_ext_sales_price4\", \"ss_ext_wholesale_cost4\", \"ss_ext_list_price4\", \"ss_ext_tax4\", \"ss_coupon_amt4\", \"ss_net_paid4\", \"ss_net_paid_inc_tax4\", \"ss_net_profit4\")\r\n                                    WHERE \"ss_wholesale_cost4\" >= 43 AND \"ss_wholesale_cost4\" <= 63) AS \"t100\"\r\n                                INNER JOIN (SELECT *\r\n                                    FROM \"date_dim\" AS \"date_dim12\" (\"d_date_sk12\", \"d_date_id12\", \"d_date12\", \"d_month_seq12\", \"d_week_seq12\", \"d_quarter_seq12\", \"d_year12\", \"d_dow12\", \"d_moy12\", \"d_dom12\", \"d_qoy12\", \"d_fy_year12\", \"d_fy_quarter_seq12\", \"d_fy_week_seq12\", \"d_day_name12\", \"d_quarter_name12\", \"d_holiday12\", \"d_weekend12\", \"d_following_holiday12\", \"d_first_dom12\", \"d_last_dom12\", \"d_same_day_ly12\", \"d_same_day_lq12\", \"d_current_day12\", \"d_current_week12\", \"d_current_month12\", \"d_current_quarter12\", \"d_current_year12\")\r\n                                    WHERE \"d_year12\" >= 1999 AND \"d_year12\" <= 2001) AS \"t101\" ON \"t100\".\"ss_sold_date_sk4\" = \"t101\".\"d_date_sk12\"\r\n                            UNION ALL\r\n                            SELECT \"t103\".\"cs_quantity2\", \"t103\".\"cs_list_price2\"\r\n                            FROM (SELECT *\r\n                                    FROM \"catalog_sales\" AS \"catalog_sales2\" (\"cs_sold_date_sk2\", \"cs_sold_time_sk2\", \"cs_ship_date_sk2\", \"cs_bill_customer_sk2\", \"cs_bill_cdemo_sk2\", \"cs_bill_hdemo_sk2\", \"cs_bill_addr_sk2\", \"cs_ship_customer_sk2\", \"cs_ship_cdemo_sk2\", \"cs_ship_hdemo_sk2\", \"cs_ship_addr_sk2\", \"cs_call_center_sk2\", \"cs_catalog_page_sk2\", \"cs_ship_mode_sk2\", \"cs_warehouse_sk2\", \"cs_item_sk2\", \"cs_promo_sk2\", \"cs_order_number2\", \"cs_quantity2\", \"cs_wholesale_cost2\", \"cs_list_price2\", \"cs_sales_price2\", \"cs_ext_discount_amt2\", \"cs_ext_sales_price2\", \"cs_ext_wholesale_cost2\", \"cs_ext_list_price2\", \"cs_ext_tax2\", \"cs_coupon_amt2\", \"cs_ext_ship_cost2\", \"cs_net_paid2\", \"cs_net_paid_inc_tax2\", \"cs_net_paid_inc_ship2\", \"cs_net_paid_inc_ship_tax2\", \"cs_net_profit2\")\r\n                                    WHERE \"cs_wholesale_cost2\" >= 43 AND \"cs_wholesale_cost2\" <= 63) AS \"t103\"\r\n                                INNER JOIN (SELECT *\r\n                                    FROM \"date_dim\" AS \"date_dim13\" (\"d_date_sk13\", \"d_date_id13\", \"d_date13\", \"d_month_seq13\", \"d_week_seq13\", \"d_quarter_seq13\", \"d_year13\", \"d_dow13\", \"d_moy13\", \"d_dom13\", \"d_qoy13\", \"d_fy_year13\", \"d_fy_quarter_seq13\", \"d_fy_week_seq13\", \"d_day_name13\", \"d_quarter_name13\", \"d_holiday13\", \"d_weekend13\", \"d_following_holiday13\", \"d_first_dom13\", \"d_last_dom13\", \"d_same_day_ly13\", \"d_same_day_lq13\", \"d_current_day13\", \"d_current_week13\", \"d_current_month13\", \"d_current_quarter13\", \"d_current_year13\")\r\n                                    WHERE \"d_year13\" >= 1999 AND \"d_year13\" <= 2001) AS \"t104\" ON \"t103\".\"cs_sold_date_sk2\" = \"t104\".\"d_date_sk13\"\r\n                            UNION ALL\r\n                            SELECT \"t106\".\"ws_quantity2\", \"t106\".\"ws_list_price2\"\r\n                            FROM (SELECT *\r\n                                    FROM \"web_sales\" AS \"web_sales2\" (\"ws_sold_date_sk2\", \"ws_sold_time_sk2\", \"ws_ship_date_sk2\", \"ws_item_sk2\", \"ws_bill_customer_sk2\", \"ws_bill_cdemo_sk2\", \"ws_bill_hdemo_sk2\", \"ws_bill_addr_sk2\", \"ws_ship_customer_sk2\", \"ws_ship_cdemo_sk2\", \"ws_ship_hdemo_sk2\", \"ws_ship_addr_sk2\", \"ws_web_page_sk2\", \"ws_web_site_sk2\", \"ws_ship_mode_sk2\", \"ws_warehouse_sk2\", \"ws_promo_sk2\", \"ws_order_number2\", \"ws_quantity2\", \"ws_wholesale_cost2\", \"ws_list_price2\", \"ws_sales_price2\", \"ws_ext_discount_amt2\", \"ws_ext_sales_price2\", \"ws_ext_wholesale_cost2\", \"ws_ext_list_price2\", \"ws_ext_tax2\", \"ws_coupon_amt2\", \"ws_ext_ship_cost2\", \"ws_net_paid2\", \"ws_net_paid_inc_tax2\", \"ws_net_paid_inc_ship2\", \"ws_net_paid_inc_ship_tax2\", \"ws_net_profit2\")\r\n                                    WHERE \"ws_wholesale_cost2\" >= 43 AND \"ws_wholesale_cost2\" <= 63) AS \"t106\"\r\n                                INNER JOIN (SELECT *\r\n                                    FROM \"date_dim\" AS \"date_dim14\" (\"d_date_sk14\", \"d_date_id14\", \"d_date14\", \"d_month_seq14\", \"d_week_seq14\", \"d_quarter_seq14\", \"d_year14\", \"d_dow14\", \"d_moy14\", \"d_dom14\", \"d_qoy14\", \"d_fy_year14\", \"d_fy_quarter_seq14\", \"d_fy_week_seq14\", \"d_day_name14\", \"d_quarter_name14\", \"d_holiday14\", \"d_weekend14\", \"d_following_holiday14\", \"d_first_dom14\", \"d_last_dom14\", \"d_same_day_ly14\", \"d_same_day_lq14\", \"d_current_day14\", \"d_current_week14\", \"d_current_month14\", \"d_current_quarter14\", \"d_current_year14\")\r\n                                    WHERE \"d_year14\" >= 1999 AND \"d_year14\" <= 2001) AS \"t107\" ON \"t106\".\"ws_sold_date_sk2\" = \"t107\".\"d_date_sk14\") AS \"t109\") AS \"t114\" ON \"t99\".\"sales0\" > \"t114\".\"average_sales0\") AS \"t116\" ON \"t57\".\"i_brand_id3\" = \"t116\".\"i_brand_id8\" AND \"t57\".\"i_class_id3\" = \"t116\".\"i_class_id8\" AND \"t57\".\"i_category_id3\" = \"t116\".\"i_category_id8\"\r\nORDER BY \"t57\".\"i_brand_id3\", \"t57\".\"i_class_id3\", \"t57\".\"i_category_id3\"\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 367.74, "used_rules": ["FILTER_INTO_JOIN", "FILTER_SUB_QUERY_TO_CORRELATE", "PROJECT_REDUCE_EXPRESSIONS", "FILTER_INTO_JOIN", "FILTER_REDUCE_EXPRESSIONS", "UNION_MERGE", "INTERSECT_TO_DISTINCT", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_REDUCE_FUNCTIONS", "AGGREGATE_REMOVE", "AGGREGATE_JOIN_TRANSPOSE_EXTENDED", "SORT_REMOVE_CONSTANT_KEYS", "SORT_PROJECT_TRANSPOSE"], "rewrite_time": 10988}
{"name": "query018_0", "input_sql": "select  i_item_id,\n        ca_country,\n        ca_state,\n        ca_county,\n        avg( cast(cs_quantity as decimal(12,2))) agg1,\n        avg( cast(cs_list_price as decimal(12,2))) agg2,\n        avg( cast(cs_coupon_amt as decimal(12,2))) agg3,\n        avg( cast(cs_sales_price as decimal(12,2))) agg4,\n        avg( cast(cs_net_profit as decimal(12,2))) agg5,\n        avg( cast(c_birth_year as decimal(12,2))) agg6\nfrom catalog_sales, customer_demographics, customer, customer_address, date_dim, item\nwhere cs_sold_date_sk = d_date_sk and\n      cs_item_sk = i_item_sk and\n      cs_bill_cdemo_sk = cd_demo_sk and\n      cs_bill_customer_sk = c_customer_sk and\n      cd_gender = 'F' and\n      cd_education_status = '2 yr Degree' and\n      c_current_addr_sk = ca_address_sk and\n      d_year = 2000 and\n      c_birth_month = 3 and\n      ca_state in ('GA', 'ME', 'NC')\n      and cs_wholesale_cost BETWEEN 84 AND 89\n      AND i_category = 'Books'\n group by rollup (i_item_id, ca_country, ca_state, ca_county)\n order by ca_country,\n        ca_state,\n        ca_county,\n\ti_item_id\n limit 100;", "input_cost": 55.31, "output_sql": "SELECT \"t13\".\"i_item_id\", \"t13\".\"ca_country\", \"t13\".\"ca_state\", \"t13\".\"ca_county\", CAST(CAST(\"t13\".\"$f4\" AS DECIMAL(12, 2)) / \"t13\".\"$f5\" AS DECIMAL(12, 2)) AS \"agg1\", CAST(CAST(\"t13\".\"$f6\" AS DECIMAL(12, 2)) / \"t13\".\"$f7\" AS DECIMAL(12, 2)) AS \"agg2\", CAST(CAST(\"t13\".\"$f8\" AS DECIMAL(12, 2)) / \"t13\".\"$f9\" AS DECIMAL(12, 2)) AS \"agg3\", CAST(CAST(\"t13\".\"$f10\" AS DECIMAL(12, 2)) / \"t13\".\"$f11\" AS DECIMAL(12, 2)) AS \"agg4\", CAST(CAST(\"t13\".\"$f12\" AS DECIMAL(12, 2)) / \"t13\".\"$f13\" AS DECIMAL(12, 2)) AS \"agg5\", CAST(CAST(\"t13\".\"$f14\" AS DECIMAL(12, 2)) / \"t13\".\"$f15\" AS DECIMAL(12, 2)) AS \"agg6\"\r\nFROM (SELECT \"t8\".\"i_item_id\", \"t7\".\"ca_country\", \"t7\".\"ca_state\", \"t7\".\"ca_county\", CASE WHEN COUNT(CAST(\"t7\".\"cs_quantity\" AS DECIMAL(12, 2))) = 0 THEN NULL ELSE COALESCE(SUM(CAST(\"t7\".\"cs_quantity\" AS DECIMAL(12, 2))), 0) END AS \"$f4\", COUNT(CAST(\"t7\".\"cs_quantity\" AS DECIMAL(12, 2))) AS \"$f5\", CASE WHEN COUNT(CAST(\"t7\".\"cs_list_price\" AS DECIMAL(12, 2))) = 0 THEN NULL ELSE COALESCE(SUM(CAST(\"t7\".\"cs_list_price\" AS DECIMAL(12, 2))), 0) END AS \"$f6\", COUNT(CAST(\"t7\".\"cs_list_price\" AS DECIMAL(12, 2))) AS \"$f7\", CASE WHEN COUNT(CAST(\"t7\".\"cs_coupon_amt\" AS DECIMAL(12, 2))) = 0 THEN NULL ELSE COALESCE(SUM(CAST(\"t7\".\"cs_coupon_amt\" AS DECIMAL(12, 2))), 0) END AS \"$f8\", COUNT(CAST(\"t7\".\"cs_coupon_amt\" AS DECIMAL(12, 2))) AS \"$f9\", CASE WHEN COUNT(CAST(\"t7\".\"cs_sales_price\" AS DECIMAL(12, 2))) = 0 THEN NULL ELSE COALESCE(SUM(CAST(\"t7\".\"cs_sales_price\" AS DECIMAL(12, 2))), 0) END AS \"$f10\", COUNT(CAST(\"t7\".\"cs_sales_price\" AS DECIMAL(12, 2))) AS \"$f11\", CASE WHEN COUNT(CAST(\"t7\".\"cs_net_profit\" AS DECIMAL(12, 2))) = 0 THEN NULL ELSE COALESCE(SUM(CAST(\"t7\".\"cs_net_profit\" AS DECIMAL(12, 2))), 0) END AS \"$f12\", COUNT(CAST(\"t7\".\"cs_net_profit\" AS DECIMAL(12, 2))) AS \"$f13\", CASE WHEN COUNT(CAST(\"t7\".\"c_birth_year\" AS DECIMAL(12, 2))) = 0 THEN NULL ELSE COALESCE(SUM(CAST(\"t7\".\"c_birth_year\" AS DECIMAL(12, 2))), 0) END AS \"$f14\", COUNT(CAST(\"t7\".\"c_birth_year\" AS DECIMAL(12, 2))) AS \"$f15\"\r\n        FROM (SELECT *\r\n                FROM (SELECT *\r\n                        FROM (SELECT *\r\n                                FROM (SELECT *\r\n                                        FROM (SELECT *\r\n                                                FROM \"catalog_sales\"\r\n                                                WHERE \"cs_wholesale_cost\" >= 84 AND \"cs_wholesale_cost\" <= 89) AS \"t\",\r\n                                                (SELECT *\r\n                                                FROM \"customer_demographics\"\r\n                                                WHERE \"cd_gender\" = 'F' AND \"cd_education_status\" = '2 yr Degree') AS \"t0\"\r\n                                        WHERE \"t\".\"cs_bill_cdemo_sk\" = \"t0\".\"cd_demo_sk\") AS \"t1\",\r\n                                        (SELECT *\r\n                                        FROM \"customer\"\r\n                                        WHERE \"c_birth_month\" = 3) AS \"t2\"\r\n                                WHERE \"t1\".\"cs_bill_customer_sk\" = \"t2\".\"c_customer_sk\") AS \"t3\",\r\n                                (SELECT *\r\n                                FROM \"customer_address\"\r\n                                WHERE CAST(\"ca_state\" AS CHAR(2)) IN ('GA', 'ME', 'NC')) AS \"t4\"\r\n                        WHERE \"t3\".\"c_current_addr_sk\" = \"t4\".\"ca_address_sk\") AS \"t5\",\r\n                        (SELECT *\r\n                        FROM \"date_dim\"\r\n                        WHERE \"d_year\" = 2000) AS \"t6\"\r\n                WHERE \"t5\".\"cs_sold_date_sk\" = \"t6\".\"d_date_sk\") AS \"t7\",\r\n                (SELECT *\r\n                FROM \"item\"\r\n                WHERE \"i_category\" = 'Books') AS \"t8\"\r\n        WHERE \"t7\".\"cs_item_sk\" = \"t8\".\"i_item_sk\"\r\n        GROUP BY ROLLUP(\"t8\".\"i_item_id\", \"t7\".\"ca_country\", \"t7\".\"ca_state\", \"t7\".\"ca_county\")\r\n        ORDER BY \"t7\".\"ca_country\", \"t7\".\"ca_state\", \"t7\".\"ca_county\", \"t8\".\"i_item_id\"\r\n        FETCH NEXT 100 ROWS ONLY) AS \"t13\";", "output_cost": 55.71, "used_rules": ["FILTER_INTO_JOIN", "PROJECT_TO_CALC", "AGGREGATE_REDUCE_FUNCTIONS", "SORT_PROJECT_TRANSPOSE", "JOIN_EXTRACT_FILTER"], "rewrite_time": 1935}
{"name": "query018_1", "input_sql": "select  i_item_id,\n        ca_country,\n        ca_state,\n        ca_county,\n        avg( cast(cs_quantity as decimal(12,2))) agg1,\n        avg( cast(cs_list_price as decimal(12,2))) agg2,\n        avg( cast(cs_coupon_amt as decimal(12,2))) agg3,\n        avg( cast(cs_sales_price as decimal(12,2))) agg4,\n        avg( cast(cs_net_profit as decimal(12,2))) agg5,\n        avg( cast(c_birth_year as decimal(12,2))) agg6\nfrom catalog_sales, customer_demographics, customer, customer_address, date_dim, item\nwhere cs_sold_date_sk = d_date_sk and\n      cs_item_sk = i_item_sk and\n      cs_bill_cdemo_sk = cd_demo_sk and\n      cs_bill_customer_sk = c_customer_sk and\n      cd_gender = 'F' and\n      cd_education_status = 'Advanced Degree' and\n      c_current_addr_sk = ca_address_sk and\n      d_year = 2002 and\n      c_birth_month = 11 and\n      ca_state in ('CO', 'GA', 'TN')\n      and cs_wholesale_cost BETWEEN 43 AND 48\n      AND i_category = 'Sports'\n group by rollup (i_item_id, ca_country, ca_state, ca_county)\n order by ca_country,\n        ca_state,\n        ca_county,\n\ti_item_id\n limit 100;", "input_cost": 55.31, "output_sql": "SELECT \"t13\".\"i_item_id\", \"t13\".\"ca_country\", \"t13\".\"ca_state\", \"t13\".\"ca_county\", CAST(CAST(\"t13\".\"$f4\" AS DECIMAL(12, 2)) / \"t13\".\"$f5\" AS DECIMAL(12, 2)) AS \"agg1\", CAST(CAST(\"t13\".\"$f6\" AS DECIMAL(12, 2)) / \"t13\".\"$f7\" AS DECIMAL(12, 2)) AS \"agg2\", CAST(CAST(\"t13\".\"$f8\" AS DECIMAL(12, 2)) / \"t13\".\"$f9\" AS DECIMAL(12, 2)) AS \"agg3\", CAST(CAST(\"t13\".\"$f10\" AS DECIMAL(12, 2)) / \"t13\".\"$f11\" AS DECIMAL(12, 2)) AS \"agg4\", CAST(CAST(\"t13\".\"$f12\" AS DECIMAL(12, 2)) / \"t13\".\"$f13\" AS DECIMAL(12, 2)) AS \"agg5\", CAST(CAST(\"t13\".\"$f14\" AS DECIMAL(12, 2)) / \"t13\".\"$f15\" AS DECIMAL(12, 2)) AS \"agg6\"\r\nFROM (SELECT \"t8\".\"i_item_id\", \"t7\".\"ca_country\", \"t7\".\"ca_state\", \"t7\".\"ca_county\", CASE WHEN COUNT(CAST(\"t7\".\"cs_quantity\" AS DECIMAL(12, 2))) = 0 THEN NULL ELSE COALESCE(SUM(CAST(\"t7\".\"cs_quantity\" AS DECIMAL(12, 2))), 0) END AS \"$f4\", COUNT(CAST(\"t7\".\"cs_quantity\" AS DECIMAL(12, 2))) AS \"$f5\", CASE WHEN COUNT(CAST(\"t7\".\"cs_list_price\" AS DECIMAL(12, 2))) = 0 THEN NULL ELSE COALESCE(SUM(CAST(\"t7\".\"cs_list_price\" AS DECIMAL(12, 2))), 0) END AS \"$f6\", COUNT(CAST(\"t7\".\"cs_list_price\" AS DECIMAL(12, 2))) AS \"$f7\", CASE WHEN COUNT(CAST(\"t7\".\"cs_coupon_amt\" AS DECIMAL(12, 2))) = 0 THEN NULL ELSE COALESCE(SUM(CAST(\"t7\".\"cs_coupon_amt\" AS DECIMAL(12, 2))), 0) END AS \"$f8\", COUNT(CAST(\"t7\".\"cs_coupon_amt\" AS DECIMAL(12, 2))) AS \"$f9\", CASE WHEN COUNT(CAST(\"t7\".\"cs_sales_price\" AS DECIMAL(12, 2))) = 0 THEN NULL ELSE COALESCE(SUM(CAST(\"t7\".\"cs_sales_price\" AS DECIMAL(12, 2))), 0) END AS \"$f10\", COUNT(CAST(\"t7\".\"cs_sales_price\" AS DECIMAL(12, 2))) AS \"$f11\", CASE WHEN COUNT(CAST(\"t7\".\"cs_net_profit\" AS DECIMAL(12, 2))) = 0 THEN NULL ELSE COALESCE(SUM(CAST(\"t7\".\"cs_net_profit\" AS DECIMAL(12, 2))), 0) END AS \"$f12\", COUNT(CAST(\"t7\".\"cs_net_profit\" AS DECIMAL(12, 2))) AS \"$f13\", CASE WHEN COUNT(CAST(\"t7\".\"c_birth_year\" AS DECIMAL(12, 2))) = 0 THEN NULL ELSE COALESCE(SUM(CAST(\"t7\".\"c_birth_year\" AS DECIMAL(12, 2))), 0) END AS \"$f14\", COUNT(CAST(\"t7\".\"c_birth_year\" AS DECIMAL(12, 2))) AS \"$f15\"\r\n        FROM (SELECT *\r\n                FROM (SELECT *\r\n                        FROM (SELECT *\r\n                                FROM (SELECT *\r\n                                        FROM (SELECT *\r\n                                                FROM \"catalog_sales\"\r\n                                                WHERE \"cs_wholesale_cost\" >= 43 AND \"cs_wholesale_cost\" <= 48) AS \"t\",\r\n                                                (SELECT *\r\n                                                FROM \"customer_demographics\"\r\n                                                WHERE \"cd_gender\" = 'F' AND \"cd_education_status\" = 'Advanced Degree') AS \"t0\"\r\n                                        WHERE \"t\".\"cs_bill_cdemo_sk\" = \"t0\".\"cd_demo_sk\") AS \"t1\",\r\n                                        (SELECT *\r\n                                        FROM \"customer\"\r\n                                        WHERE \"c_birth_month\" = 11) AS \"t2\"\r\n                                WHERE \"t1\".\"cs_bill_customer_sk\" = \"t2\".\"c_customer_sk\") AS \"t3\",\r\n                                (SELECT *\r\n                                FROM \"customer_address\"\r\n                                WHERE CAST(\"ca_state\" AS CHAR(2)) IN ('CO', 'GA', 'TN')) AS \"t4\"\r\n                        WHERE \"t3\".\"c_current_addr_sk\" = \"t4\".\"ca_address_sk\") AS \"t5\",\r\n                        (SELECT *\r\n                        FROM \"date_dim\"\r\n                        WHERE \"d_year\" = 2002) AS \"t6\"\r\n                WHERE \"t5\".\"cs_sold_date_sk\" = \"t6\".\"d_date_sk\") AS \"t7\",\r\n                (SELECT *\r\n                FROM \"item\"\r\n                WHERE \"i_category\" = 'Sports') AS \"t8\"\r\n        WHERE \"t7\".\"cs_item_sk\" = \"t8\".\"i_item_sk\"\r\n        GROUP BY ROLLUP(\"t8\".\"i_item_id\", \"t7\".\"ca_country\", \"t7\".\"ca_state\", \"t7\".\"ca_county\")\r\n        ORDER BY \"t7\".\"ca_country\", \"t7\".\"ca_state\", \"t7\".\"ca_county\", \"t8\".\"i_item_id\"\r\n        FETCH NEXT 100 ROWS ONLY) AS \"t13\";", "output_cost": 55.71, "used_rules": ["FILTER_INTO_JOIN", "PROJECT_TO_CALC", "AGGREGATE_REDUCE_FUNCTIONS", "SORT_PROJECT_TRANSPOSE", "JOIN_EXTRACT_FILTER"], "rewrite_time": 1855}
{"name": "query019_0", "input_sql": "select  i_brand_id brand_id, i_brand brand, i_manufact_id, i_manufact,\n \tsum(ss_ext_sales_price) ext_price\n  from date_dim, store_sales, item,customer,customer_address,store\n  where  d_date_sk = ss_sold_date_sk\n    and ss_item_sk = i_item_sk\n    and ss_customer_sk = c_customer_sk\n    and c_current_addr_sk = ca_address_sk\n    and ss_store_sk = s_store_sk\n    AND i_category  = 'Books'\n    and d_year=2001\n    and d_moy = 2\n    and substring(ca_zip,1,5) <> substring(s_zip,1,5)\n    and ca_state  = 'IL'\n    and c_birth_month = 9\n    and ss_wholesale_cost BETWEEN 73 AND 93\n group by i_brand\n      ,i_brand_id\n      ,i_manufact_id\n      ,i_manufact\n order by ext_price desc\n         ,i_brand\n         ,i_brand_id\n         ,i_manufact_id\n         ,i_manufact\nlimit 100;", "input_cost": 47.3, "output_sql": "SELECT \"t7\".\"i_brand_id\", \"t7\".\"i_brand\", \"t7\".\"i_manufact_id\", \"t7\".\"i_manufact\", CASE WHEN COUNT(\"t7\".\"ss_ext_sales_price\") = 0 THEN NULL ELSE COALESCE(SUM(\"t7\".\"ss_ext_sales_price\"), 0) END AS \"ext_price\"\r\nFROM (SELECT *\r\n        FROM (SELECT *\r\n                FROM (SELECT *\r\n                        FROM (SELECT *\r\n                                FROM (SELECT *\r\n                                        FROM \"date_dim\"\r\n                                        WHERE \"d_year\" = 2001 AND \"d_moy\" = 2) AS \"t\",\r\n                                        (SELECT *\r\n                                        FROM \"store_sales\"\r\n                                        WHERE \"ss_wholesale_cost\" >= 73 AND \"ss_wholesale_cost\" <= 93) AS \"t0\"\r\n                                WHERE \"t\".\"d_date_sk\" = \"t0\".\"ss_sold_date_sk\") AS \"t1\",\r\n                                (SELECT *\r\n                                FROM \"item\"\r\n                                WHERE \"i_category\" = 'Books') AS \"t2\"\r\n                        WHERE \"t1\".\"ss_item_sk\" = \"t2\".\"i_item_sk\") AS \"t3\",\r\n                        (SELECT *\r\n                        FROM \"customer\"\r\n                        WHERE \"c_birth_month\" = 9) AS \"t4\"\r\n                WHERE \"t3\".\"ss_customer_sk\" = \"t4\".\"c_customer_sk\") AS \"t5\",\r\n                (SELECT *\r\n                FROM \"customer_address\"\r\n                WHERE \"ca_state\" = 'IL') AS \"t6\"\r\n        WHERE \"t5\".\"c_current_addr_sk\" = \"t6\".\"ca_address_sk\") AS \"t7\",\r\n    \"store\"\r\nWHERE \"t7\".\"ss_store_sk\" = \"store\".\"s_store_sk\" AND SUBSTRING(\"t7\".\"ca_zip\", 1, 5) <> SUBSTRING(\"store\".\"s_zip\", 1, 5)\r\nGROUP BY \"t7\".\"i_brand_id\", \"t7\".\"i_brand\", \"t7\".\"i_manufact_id\", \"t7\".\"i_manufact\"\r\nORDER BY 5 DESC, \"t7\".\"i_brand\", \"t7\".\"i_brand_id\", \"t7\".\"i_manufact_id\", \"t7\".\"i_manufact\"\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 47.31, "used_rules": ["FILTER_INTO_JOIN", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_REDUCE_FUNCTIONS", "PROJECT_TO_CALC", "CALC_MERGE", "JOIN_EXTRACT_FILTER"], "rewrite_time": 1556}
{"name": "query019_1", "input_sql": "select  i_brand_id brand_id, i_brand brand, i_manufact_id, i_manufact,\n \tsum(ss_ext_sales_price) ext_price\n  from date_dim, store_sales, item,customer,customer_address,store\n  where  d_date_sk = ss_sold_date_sk\n    and ss_item_sk = i_item_sk\n    and ss_customer_sk = c_customer_sk\n    and c_current_addr_sk = ca_address_sk\n    and ss_store_sk = s_store_sk\n    AND i_category  = 'Sports'\n    and d_year=1999\n    and d_moy = 3\n    and substring(ca_zip,1,5) <> substring(s_zip,1,5)\n    and ca_state  = 'OK'\n    and c_birth_month = 11\n    and ss_wholesale_cost BETWEEN 71 AND 91\n group by i_brand\n      ,i_brand_id\n      ,i_manufact_id\n      ,i_manufact\n order by ext_price desc\n         ,i_brand\n         ,i_brand_id\n         ,i_manufact_id\n         ,i_manufact\nlimit 100;", "input_cost": 47.3, "output_sql": "SELECT \"t7\".\"i_brand_id\", \"t7\".\"i_brand\", \"t7\".\"i_manufact_id\", \"t7\".\"i_manufact\", CASE WHEN COUNT(\"t7\".\"ss_ext_sales_price\") = 0 THEN NULL ELSE COALESCE(SUM(\"t7\".\"ss_ext_sales_price\"), 0) END AS \"ext_price\"\r\nFROM (SELECT *\r\n        FROM (SELECT *\r\n                FROM (SELECT *\r\n                        FROM (SELECT *\r\n                                FROM (SELECT *\r\n                                        FROM \"date_dim\"\r\n                                        WHERE \"d_year\" = 1999 AND \"d_moy\" = 3) AS \"t\",\r\n                                        (SELECT *\r\n                                        FROM \"store_sales\"\r\n                                        WHERE \"ss_wholesale_cost\" >= 71 AND \"ss_wholesale_cost\" <= 91) AS \"t0\"\r\n                                WHERE \"t\".\"d_date_sk\" = \"t0\".\"ss_sold_date_sk\") AS \"t1\",\r\n                                (SELECT *\r\n                                FROM \"item\"\r\n                                WHERE \"i_category\" = 'Sports') AS \"t2\"\r\n                        WHERE \"t1\".\"ss_item_sk\" = \"t2\".\"i_item_sk\") AS \"t3\",\r\n                        (SELECT *\r\n                        FROM \"customer\"\r\n                        WHERE \"c_birth_month\" = 11) AS \"t4\"\r\n                WHERE \"t3\".\"ss_customer_sk\" = \"t4\".\"c_customer_sk\") AS \"t5\",\r\n                (SELECT *\r\n                FROM \"customer_address\"\r\n                WHERE \"ca_state\" = 'OK') AS \"t6\"\r\n        WHERE \"t5\".\"c_current_addr_sk\" = \"t6\".\"ca_address_sk\") AS \"t7\",\r\n    \"store\"\r\nWHERE \"t7\".\"ss_store_sk\" = \"store\".\"s_store_sk\" AND SUBSTRING(\"t7\".\"ca_zip\", 1, 5) <> SUBSTRING(\"store\".\"s_zip\", 1, 5)\r\nGROUP BY \"t7\".\"i_brand_id\", \"t7\".\"i_brand\", \"t7\".\"i_manufact_id\", \"t7\".\"i_manufact\"\r\nORDER BY 5 DESC, \"t7\".\"i_brand\", \"t7\".\"i_brand_id\", \"t7\".\"i_manufact_id\", \"t7\".\"i_manufact\"\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 47.31, "used_rules": ["FILTER_INTO_JOIN", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_REDUCE_FUNCTIONS", "PROJECT_TO_CALC", "CALC_MERGE", "JOIN_EXTRACT_FILTER"], "rewrite_time": 1603}
{"name": "query023_0", "input_sql": "with frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year = 1999\n    and i_manager_id BETWEEN 7 and 26\n     AND i_category IN ('Books', 'Jewelry', 'Shoes')\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim\n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year = 1999\n         and ss_wholesale_cost BETWEEN 77 AND 87\n        group by c_customer_sk) tmp1),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  and c_birth_year BETWEEN 1932 AND 1938\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\nfrom\n max_store_sales))\n  select  sum(sales)\n from (select cs_quantity*cs_list_price sales\n       from catalog_sales\n           ,date_dim\n       where d_year = 1999\n         and d_moy = 3\n         and cs_sold_date_sk = d_date_sk\n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_wholesale_cost BETWEEN 77 AND 87\n      union all\n      select ws_quantity*ws_list_price sales\n       from web_sales\n           ,date_dim\n       where d_year = 1999\n         and d_moy = 3\n         and ws_sold_date_sk = d_date_sk\n         and ws_item_sk in (select item_sk from frequent_ss_items)\n         and ws_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and ws_wholesale_cost BETWEEN 77 AND 87) tmp2\n limit 100;", "input_cost": 104.02, "output_sql": "SELECT CASE WHEN COALESCE(SUM(\"$f1\"), 0) = 0 THEN NULL ELSE COALESCE(SUM(\"EXPR$0\"), 0) END\r\nFROM (SELECT COALESCE(SUM(\"t19\".\"cs_quantity\" * \"t19\".\"cs_list_price\"), 0) AS \"EXPR$0\", COUNT(\"t19\".\"cs_quantity\" * \"t19\".\"cs_list_price\") AS \"$f1\"\r\n            FROM (SELECT \"t\".\"cs_sold_date_sk\", \"t\".\"cs_sold_time_sk\", \"t\".\"cs_ship_date_sk\", \"t\".\"cs_bill_customer_sk\", \"t\".\"cs_bill_cdemo_sk\", \"t\".\"cs_bill_hdemo_sk\", \"t\".\"cs_bill_addr_sk\", \"t\".\"cs_ship_customer_sk\", \"t\".\"cs_ship_cdemo_sk\", \"t\".\"cs_ship_hdemo_sk\", \"t\".\"cs_ship_addr_sk\", \"t\".\"cs_call_center_sk\", \"t\".\"cs_catalog_page_sk\", \"t\".\"cs_ship_mode_sk\", \"t\".\"cs_warehouse_sk\", \"t\".\"cs_item_sk\", \"t\".\"cs_promo_sk\", \"t\".\"cs_order_number\", \"t\".\"cs_quantity\", \"t\".\"cs_wholesale_cost\", \"t\".\"cs_list_price\", \"t\".\"cs_sales_price\", \"t\".\"cs_ext_discount_amt\", \"t\".\"cs_ext_sales_price\", \"t\".\"cs_ext_wholesale_cost\", \"t\".\"cs_ext_list_price\", \"t\".\"cs_ext_tax\", \"t\".\"cs_coupon_amt\", \"t\".\"cs_ext_ship_cost\", \"t\".\"cs_net_paid\", \"t\".\"cs_net_paid_inc_tax\", \"t\".\"cs_net_paid_inc_ship\", \"t\".\"cs_net_paid_inc_ship_tax\", \"t\".\"cs_net_profit\"\r\n                    FROM (SELECT *\r\n                            FROM \"catalog_sales\"\r\n                            WHERE \"cs_wholesale_cost\" >= 77 AND \"cs_wholesale_cost\" <= 87) AS \"t\"\r\n                        INNER JOIN (SELECT \"t5\".\"item_sk\"\r\n                            FROM (SELECT \"t1\".\"i_item_sk\" AS \"item_sk\"\r\n                                    FROM \"store_sales\"\r\n                                        INNER JOIN (SELECT *\r\n                                            FROM \"date_dim\"\r\n                                            WHERE \"d_year\" = 1999) AS \"t0\" ON \"store_sales\".\"ss_sold_date_sk\" = \"t0\".\"d_date_sk\"\r\n                                        INNER JOIN (SELECT *\r\n                                            FROM \"item\"\r\n                                            WHERE \"i_manager_id\" >= 7 AND \"i_manager_id\" <= 26 AND (CAST(\"i_category\" AS CHAR(5)) IN ('Books', 'Shoes') OR \"i_category\" = 'Jewelry')) AS \"t1\" ON \"store_sales\".\"ss_item_sk\" = \"t1\".\"i_item_sk\"\r\n                                    GROUP BY SUBSTRING(\"t1\".\"i_item_desc\", 1, 30), \"t1\".\"i_item_sk\", \"t0\".\"d_date\"\r\n                                    HAVING COUNT(*) > 4) AS \"t5\"\r\n                            GROUP BY \"t5\".\"item_sk\") AS \"t6\" ON \"t\".\"cs_item_sk\" = \"t6\".\"item_sk\"\r\n                        INNER JOIN (SELECT \"t10\".\"ss_sold_date_sk0\"\r\n                            FROM (SELECT \"t7\".\"c_customer_sk\" AS \"ss_sold_date_sk0\", CASE WHEN COUNT(\"store_sales0\".\"ss_quantity0\" * \"store_sales0\".\"ss_sales_price0\") = 0 THEN NULL ELSE COALESCE(SUM(\"store_sales0\".\"ss_quantity0\" * \"store_sales0\".\"ss_sales_price0\"), 0) END AS \"ssales\"\r\n                                    FROM \"store_sales\" AS \"store_sales0\" (\"ss_sold_date_sk0\", \"ss_sold_time_sk0\", \"ss_item_sk0\", \"ss_customer_sk0\", \"ss_cdemo_sk0\", \"ss_hdemo_sk0\", \"ss_addr_sk0\", \"ss_store_sk0\", \"ss_promo_sk0\", \"ss_ticket_number0\", \"ss_quantity0\", \"ss_wholesale_cost0\", \"ss_list_price0\", \"ss_sales_price0\", \"ss_ext_discount_amt0\", \"ss_ext_sales_price0\", \"ss_ext_wholesale_cost0\", \"ss_ext_list_price0\", \"ss_ext_tax0\", \"ss_coupon_amt0\", \"ss_net_paid0\", \"ss_net_paid_inc_tax0\", \"ss_net_profit0\")\r\n                                        INNER JOIN (SELECT *\r\n                                            FROM \"customer\"\r\n                                            WHERE \"c_birth_year\" >= 1932 AND \"c_birth_year\" <= 1938) AS \"t7\" ON \"store_sales0\".\"ss_customer_sk0\" = \"t7\".\"c_customer_sk\"\r\n                                    GROUP BY \"t7\".\"c_customer_sk\") AS \"t10\"\r\n                                INNER JOIN (SELECT MAX(\"t16\".\"ss_sold_date_sk1\") AS \"tpcds_cmax\"\r\n                                    FROM (SELECT CASE WHEN COUNT(\"t11\".\"ss_quantity1\" * \"t11\".\"ss_sales_price1\") = 0 THEN NULL ELSE COALESCE(SUM(\"t11\".\"ss_quantity1\" * \"t11\".\"ss_sales_price1\"), 0) END AS \"ss_sold_date_sk1\"\r\n                                            FROM (SELECT *\r\n                                                    FROM \"store_sales\" AS \"store_sales1\" (\"ss_sold_date_sk1\", \"ss_sold_time_sk1\", \"ss_item_sk1\", \"ss_customer_sk1\", \"ss_cdemo_sk1\", \"ss_hdemo_sk1\", \"ss_addr_sk1\", \"ss_store_sk1\", \"ss_promo_sk1\", \"ss_ticket_number1\", \"ss_quantity1\", \"ss_wholesale_cost1\", \"ss_list_price1\", \"ss_sales_price1\", \"ss_ext_discount_amt1\", \"ss_ext_sales_price1\", \"ss_ext_wholesale_cost1\", \"ss_ext_list_price1\", \"ss_ext_tax1\", \"ss_coupon_amt1\", \"ss_net_paid1\", \"ss_net_paid_inc_tax1\", \"ss_net_profit1\")\r\n                                                    WHERE \"ss_wholesale_cost1\" >= 77 AND \"ss_wholesale_cost1\" <= 87) AS \"t11\"\r\n                                                INNER JOIN \"customer\" AS \"customer0\" (\"c_customer_sk0\", \"c_customer_id0\", \"c_current_cdemo_sk0\", \"c_current_hdemo_sk0\", \"c_current_addr_sk0\", \"c_first_shipto_date_sk0\", \"c_first_sales_date_sk0\", \"c_salutation0\", \"c_first_name0\", \"c_last_name0\", \"c_preferred_cust_flag0\", \"c_birth_day0\", \"c_birth_month0\", \"c_birth_year0\", \"c_birth_country0\", \"c_login0\", \"c_email_address0\", \"c_last_review_date_sk0\") ON \"t11\".\"ss_customer_sk1\" = \"customer0\".\"c_customer_sk0\"\r\n                                                INNER JOIN (SELECT *\r\n                                                    FROM \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\")\r\n                                                    WHERE \"d_year0\" = 1999) AS \"t12\" ON \"t11\".\"ss_sold_date_sk1\" = \"t12\".\"d_date_sk0\"\r\n                                            GROUP BY \"customer0\".\"c_customer_sk0\") AS \"t16\") AS \"t17\" ON \"t10\".\"ssales\" > 0.95 * \"t17\".\"tpcds_cmax\") AS \"t18\" ON \"t\".\"cs_bill_customer_sk\" = \"t18\".\"ss_sold_date_sk0\") AS \"t19\"\r\n                INNER JOIN (SELECT *\r\n                    FROM \"date_dim\" AS \"date_dim1\" (\"d_date_sk1\", \"d_date_id1\", \"d_date1\", \"d_month_seq1\", \"d_week_seq1\", \"d_quarter_seq1\", \"d_year1\", \"d_dow1\", \"d_moy1\", \"d_dom1\", \"d_qoy1\", \"d_fy_year1\", \"d_fy_quarter_seq1\", \"d_fy_week_seq1\", \"d_day_name1\", \"d_quarter_name1\", \"d_holiday1\", \"d_weekend1\", \"d_following_holiday1\", \"d_first_dom1\", \"d_last_dom1\", \"d_same_day_ly1\", \"d_same_day_lq1\", \"d_current_day1\", \"d_current_week1\", \"d_current_month1\", \"d_current_quarter1\", \"d_current_year1\")\r\n                    WHERE \"d_year1\" = 1999 AND \"d_moy1\" = 3) AS \"t20\" ON \"t19\".\"cs_sold_date_sk\" = \"t20\".\"d_date_sk1\"\r\n            UNION ALL\r\n            SELECT COALESCE(SUM(\"t43\".\"ws_quantity\" * \"t43\".\"ws_list_price\"), 0) AS \"EXPR$0\", COUNT(\"t43\".\"ws_quantity\" * \"t43\".\"ws_list_price\") AS \"$f1\"\r\n            FROM (SELECT \"t23\".\"ws_sold_date_sk\", \"t23\".\"ws_sold_time_sk\", \"t23\".\"ws_ship_date_sk\", \"t23\".\"ws_item_sk\", \"t23\".\"ws_bill_customer_sk\", \"t23\".\"ws_bill_cdemo_sk\", \"t23\".\"ws_bill_hdemo_sk\", \"t23\".\"ws_bill_addr_sk\", \"t23\".\"ws_ship_customer_sk\", \"t23\".\"ws_ship_cdemo_sk\", \"t23\".\"ws_ship_hdemo_sk\", \"t23\".\"ws_ship_addr_sk\", \"t23\".\"ws_web_page_sk\", \"t23\".\"ws_web_site_sk\", \"t23\".\"ws_ship_mode_sk\", \"t23\".\"ws_warehouse_sk\", \"t23\".\"ws_promo_sk\", \"t23\".\"ws_order_number\", \"t23\".\"ws_quantity\", \"t23\".\"ws_wholesale_cost\", \"t23\".\"ws_list_price\", \"t23\".\"ws_sales_price\", \"t23\".\"ws_ext_discount_amt\", \"t23\".\"ws_ext_sales_price\", \"t23\".\"ws_ext_wholesale_cost\", \"t23\".\"ws_ext_list_price\", \"t23\".\"ws_ext_tax\", \"t23\".\"ws_coupon_amt\", \"t23\".\"ws_ext_ship_cost\", \"t23\".\"ws_net_paid\", \"t23\".\"ws_net_paid_inc_tax\", \"t23\".\"ws_net_paid_inc_ship\", \"t23\".\"ws_net_paid_inc_ship_tax\", \"t23\".\"ws_net_profit\"\r\n                    FROM (SELECT *\r\n                            FROM \"web_sales\"\r\n                            WHERE \"ws_wholesale_cost\" >= 77 AND \"ws_wholesale_cost\" <= 87) AS \"t23\"\r\n                        INNER JOIN (SELECT \"t29\".\"ss_sold_date_sk2\"\r\n                            FROM (SELECT \"t25\".\"i_item_sk0\" AS \"ss_sold_date_sk2\"\r\n                                    FROM \"store_sales\" AS \"store_sales2\" (\"ss_sold_date_sk2\", \"ss_sold_time_sk2\", \"ss_item_sk2\", \"ss_customer_sk2\", \"ss_cdemo_sk2\", \"ss_hdemo_sk2\", \"ss_addr_sk2\", \"ss_store_sk2\", \"ss_promo_sk2\", \"ss_ticket_number2\", \"ss_quantity2\", \"ss_wholesale_cost2\", \"ss_list_price2\", \"ss_sales_price2\", \"ss_ext_discount_amt2\", \"ss_ext_sales_price2\", \"ss_ext_wholesale_cost2\", \"ss_ext_list_price2\", \"ss_ext_tax2\", \"ss_coupon_amt2\", \"ss_net_paid2\", \"ss_net_paid_inc_tax2\", \"ss_net_profit2\")\r\n                                        INNER JOIN (SELECT *\r\n                                            FROM \"date_dim\" AS \"date_dim2\" (\"d_date_sk2\", \"d_date_id2\", \"d_date2\", \"d_month_seq2\", \"d_week_seq2\", \"d_quarter_seq2\", \"d_year2\", \"d_dow2\", \"d_moy2\", \"d_dom2\", \"d_qoy2\", \"d_fy_year2\", \"d_fy_quarter_seq2\", \"d_fy_week_seq2\", \"d_day_name2\", \"d_quarter_name2\", \"d_holiday2\", \"d_weekend2\", \"d_following_holiday2\", \"d_first_dom2\", \"d_last_dom2\", \"d_same_day_ly2\", \"d_same_day_lq2\", \"d_current_day2\", \"d_current_week2\", \"d_current_month2\", \"d_current_quarter2\", \"d_current_year2\")\r\n                                            WHERE \"d_year2\" = 1999) AS \"t24\" ON \"store_sales2\".\"ss_sold_date_sk2\" = \"t24\".\"d_date_sk2\"\r\n                                        INNER JOIN (SELECT *\r\n                                            FROM \"item\" AS \"item0\" (\"i_item_sk0\", \"i_item_id0\", \"i_rec_start_date0\", \"i_rec_end_date0\", \"i_item_desc0\", \"i_current_price0\", \"i_wholesale_cost0\", \"i_brand_id0\", \"i_brand0\", \"i_class_id0\", \"i_class0\", \"i_category_id0\", \"i_category0\", \"i_manufact_id0\", \"i_manufact0\", \"i_size0\", \"i_formulation0\", \"i_color0\", \"i_units0\", \"i_container0\", \"i_manager_id0\", \"i_product_name0\")\r\n                                            WHERE \"i_manager_id0\" >= 7 AND \"i_manager_id0\" <= 26 AND (CAST(\"i_category0\" AS CHAR(5)) IN ('Books', 'Shoes') OR \"i_category0\" = 'Jewelry')) AS \"t25\" ON \"store_sales2\".\"ss_item_sk2\" = \"t25\".\"i_item_sk0\"\r\n                                    GROUP BY SUBSTRING(\"t25\".\"i_item_desc0\", 1, 30), \"t25\".\"i_item_sk0\", \"t24\".\"d_date2\"\r\n                                    HAVING COUNT(*) > 4) AS \"t29\"\r\n                            GROUP BY \"t29\".\"ss_sold_date_sk2\") AS \"t30\" ON \"t23\".\"ws_item_sk\" = \"t30\".\"ss_sold_date_sk2\"\r\n                        INNER JOIN (SELECT \"t34\".\"ss_sold_date_sk3\"\r\n                            FROM (SELECT \"t31\".\"c_customer_sk1\" AS \"ss_sold_date_sk3\", CASE WHEN COUNT(\"store_sales3\".\"ss_quantity3\" * \"store_sales3\".\"ss_sales_price3\") = 0 THEN NULL ELSE COALESCE(SUM(\"store_sales3\".\"ss_quantity3\" * \"store_sales3\".\"ss_sales_price3\"), 0) END AS \"ssales0\"\r\n                                    FROM \"store_sales\" AS \"store_sales3\" (\"ss_sold_date_sk3\", \"ss_sold_time_sk3\", \"ss_item_sk3\", \"ss_customer_sk3\", \"ss_cdemo_sk3\", \"ss_hdemo_sk3\", \"ss_addr_sk3\", \"ss_store_sk3\", \"ss_promo_sk3\", \"ss_ticket_number3\", \"ss_quantity3\", \"ss_wholesale_cost3\", \"ss_list_price3\", \"ss_sales_price3\", \"ss_ext_discount_amt3\", \"ss_ext_sales_price3\", \"ss_ext_wholesale_cost3\", \"ss_ext_list_price3\", \"ss_ext_tax3\", \"ss_coupon_amt3\", \"ss_net_paid3\", \"ss_net_paid_inc_tax3\", \"ss_net_profit3\")\r\n                                        INNER JOIN (SELECT *\r\n                                            FROM \"customer\" AS \"customer1\" (\"c_customer_sk1\", \"c_customer_id1\", \"c_current_cdemo_sk1\", \"c_current_hdemo_sk1\", \"c_current_addr_sk1\", \"c_first_shipto_date_sk1\", \"c_first_sales_date_sk1\", \"c_salutation1\", \"c_first_name1\", \"c_last_name1\", \"c_preferred_cust_flag1\", \"c_birth_day1\", \"c_birth_month1\", \"c_birth_year1\", \"c_birth_country1\", \"c_login1\", \"c_email_address1\", \"c_last_review_date_sk1\")\r\n                                            WHERE \"c_birth_year1\" >= 1932 AND \"c_birth_year1\" <= 1938) AS \"t31\" ON \"store_sales3\".\"ss_customer_sk3\" = \"t31\".\"c_customer_sk1\"\r\n                                    GROUP BY \"t31\".\"c_customer_sk1\") AS \"t34\"\r\n                                INNER JOIN (SELECT MAX(\"t40\".\"ss_sold_date_sk4\") AS \"tpcds_cmax\"\r\n                                    FROM (SELECT CASE WHEN COUNT(\"t35\".\"ss_quantity4\" * \"t35\".\"ss_sales_price4\") = 0 THEN NULL ELSE COALESCE(SUM(\"t35\".\"ss_quantity4\" * \"t35\".\"ss_sales_price4\"), 0) END AS \"ss_sold_date_sk4\"\r\n                                            FROM (SELECT *\r\n                                                    FROM \"store_sales\" AS \"store_sales4\" (\"ss_sold_date_sk4\", \"ss_sold_time_sk4\", \"ss_item_sk4\", \"ss_customer_sk4\", \"ss_cdemo_sk4\", \"ss_hdemo_sk4\", \"ss_addr_sk4\", \"ss_store_sk4\", \"ss_promo_sk4\", \"ss_ticket_number4\", \"ss_quantity4\", \"ss_wholesale_cost4\", \"ss_list_price4\", \"ss_sales_price4\", \"ss_ext_discount_amt4\", \"ss_ext_sales_price4\", \"ss_ext_wholesale_cost4\", \"ss_ext_list_price4\", \"ss_ext_tax4\", \"ss_coupon_amt4\", \"ss_net_paid4\", \"ss_net_paid_inc_tax4\", \"ss_net_profit4\")\r\n                                                    WHERE \"ss_wholesale_cost4\" >= 77 AND \"ss_wholesale_cost4\" <= 87) AS \"t35\"\r\n                                                INNER JOIN \"customer\" AS \"customer2\" (\"c_customer_sk2\", \"c_customer_id2\", \"c_current_cdemo_sk2\", \"c_current_hdemo_sk2\", \"c_current_addr_sk2\", \"c_first_shipto_date_sk2\", \"c_first_sales_date_sk2\", \"c_salutation2\", \"c_first_name2\", \"c_last_name2\", \"c_preferred_cust_flag2\", \"c_birth_day2\", \"c_birth_month2\", \"c_birth_year2\", \"c_birth_country2\", \"c_login2\", \"c_email_address2\", \"c_last_review_date_sk2\") ON \"t35\".\"ss_customer_sk4\" = \"customer2\".\"c_customer_sk2\"\r\n                                                INNER JOIN (SELECT *\r\n                                                    FROM \"date_dim\" AS \"date_dim3\" (\"d_date_sk3\", \"d_date_id3\", \"d_date3\", \"d_month_seq3\", \"d_week_seq3\", \"d_quarter_seq3\", \"d_year3\", \"d_dow3\", \"d_moy3\", \"d_dom3\", \"d_qoy3\", \"d_fy_year3\", \"d_fy_quarter_seq3\", \"d_fy_week_seq3\", \"d_day_name3\", \"d_quarter_name3\", \"d_holiday3\", \"d_weekend3\", \"d_following_holiday3\", \"d_first_dom3\", \"d_last_dom3\", \"d_same_day_ly3\", \"d_same_day_lq3\", \"d_current_day3\", \"d_current_week3\", \"d_current_month3\", \"d_current_quarter3\", \"d_current_year3\")\r\n                                                    WHERE \"d_year3\" = 1999) AS \"t36\" ON \"t35\".\"ss_sold_date_sk4\" = \"t36\".\"d_date_sk3\"\r\n                                            GROUP BY \"customer2\".\"c_customer_sk2\") AS \"t40\") AS \"t41\" ON \"t34\".\"ssales0\" > 0.95 * \"t41\".\"tpcds_cmax\") AS \"t42\" ON \"t23\".\"ws_bill_customer_sk\" = \"t42\".\"ss_sold_date_sk3\") AS \"t43\"\r\n                INNER JOIN (SELECT *\r\n                    FROM \"date_dim\" AS \"date_dim4\" (\"d_date_sk4\", \"d_date_id4\", \"d_date4\", \"d_month_seq4\", \"d_week_seq4\", \"d_quarter_seq4\", \"d_year4\", \"d_dow4\", \"d_moy4\", \"d_dom4\", \"d_qoy4\", \"d_fy_year4\", \"d_fy_quarter_seq4\", \"d_fy_week_seq4\", \"d_day_name4\", \"d_quarter_name4\", \"d_holiday4\", \"d_weekend4\", \"d_following_holiday4\", \"d_first_dom4\", \"d_last_dom4\", \"d_same_day_ly4\", \"d_same_day_lq4\", \"d_current_day4\", \"d_current_week4\", \"d_current_month4\", \"d_current_quarter4\", \"d_current_year4\")\r\n                    WHERE \"d_year4\" = 1999 AND \"d_moy4\" = 3) AS \"t44\" ON \"t43\".\"ws_sold_date_sk\" = \"t44\".\"d_date_sk4\") AS \"t47\"\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 175.34, "used_rules": ["FILTER_INTO_JOIN", "FILTER_SUB_QUERY_TO_CORRELATE", "FILTER_INTO_JOIN", "PROJECT_REMOVE", "PROJECT_TO_CALC", "CALC_MERGE", "JOIN_REDUCE_EXPRESSIONS", "AGGREGATE_REDUCE_FUNCTIONS", "AGGREGATE_UNION_TRANSPOSE"], "rewrite_time": 5363}
{"name": "query023_1", "input_sql": "with frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year = 1999\n    and i_manager_id BETWEEN 40 and 59\n     AND i_category IN ('Books', 'Children', 'Home')\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim\n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year = 1999\n         and ss_wholesale_cost BETWEEN 23 AND 33\n        group by c_customer_sk) tmp1),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  and c_birth_year BETWEEN 1980 AND 1986\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\nfrom\n max_store_sales))\n  select  sum(sales)\n from (select cs_quantity*cs_list_price sales\n       from catalog_sales\n           ,date_dim\n       where d_year = 1999\n         and d_moy = 8\n         and cs_sold_date_sk = d_date_sk\n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_wholesale_cost BETWEEN 23 AND 33\n      union all\n      select ws_quantity*ws_list_price sales\n       from web_sales\n           ,date_dim\n       where d_year = 1999\n         and d_moy = 8\n         and ws_sold_date_sk = d_date_sk\n         and ws_item_sk in (select item_sk from frequent_ss_items)\n         and ws_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and ws_wholesale_cost BETWEEN 23 AND 33) tmp2\n limit 100;", "input_cost": 104.02, "output_sql": "SELECT CASE WHEN COALESCE(SUM(\"$f1\"), 0) = 0 THEN NULL ELSE COALESCE(SUM(\"EXPR$0\"), 0) END\r\nFROM (SELECT COALESCE(SUM(\"t19\".\"cs_quantity\" * \"t19\".\"cs_list_price\"), 0) AS \"EXPR$0\", COUNT(\"t19\".\"cs_quantity\" * \"t19\".\"cs_list_price\") AS \"$f1\"\r\n            FROM (SELECT \"t\".\"cs_sold_date_sk\", \"t\".\"cs_sold_time_sk\", \"t\".\"cs_ship_date_sk\", \"t\".\"cs_bill_customer_sk\", \"t\".\"cs_bill_cdemo_sk\", \"t\".\"cs_bill_hdemo_sk\", \"t\".\"cs_bill_addr_sk\", \"t\".\"cs_ship_customer_sk\", \"t\".\"cs_ship_cdemo_sk\", \"t\".\"cs_ship_hdemo_sk\", \"t\".\"cs_ship_addr_sk\", \"t\".\"cs_call_center_sk\", \"t\".\"cs_catalog_page_sk\", \"t\".\"cs_ship_mode_sk\", \"t\".\"cs_warehouse_sk\", \"t\".\"cs_item_sk\", \"t\".\"cs_promo_sk\", \"t\".\"cs_order_number\", \"t\".\"cs_quantity\", \"t\".\"cs_wholesale_cost\", \"t\".\"cs_list_price\", \"t\".\"cs_sales_price\", \"t\".\"cs_ext_discount_amt\", \"t\".\"cs_ext_sales_price\", \"t\".\"cs_ext_wholesale_cost\", \"t\".\"cs_ext_list_price\", \"t\".\"cs_ext_tax\", \"t\".\"cs_coupon_amt\", \"t\".\"cs_ext_ship_cost\", \"t\".\"cs_net_paid\", \"t\".\"cs_net_paid_inc_tax\", \"t\".\"cs_net_paid_inc_ship\", \"t\".\"cs_net_paid_inc_ship_tax\", \"t\".\"cs_net_profit\"\r\n                    FROM (SELECT *\r\n                            FROM \"catalog_sales\"\r\n                            WHERE \"cs_wholesale_cost\" >= 23 AND \"cs_wholesale_cost\" <= 33) AS \"t\"\r\n                        INNER JOIN (SELECT \"t5\".\"item_sk\"\r\n                            FROM (SELECT \"t1\".\"i_item_sk\" AS \"item_sk\"\r\n                                    FROM \"store_sales\"\r\n                                        INNER JOIN (SELECT *\r\n                                            FROM \"date_dim\"\r\n                                            WHERE \"d_year\" = 1999) AS \"t0\" ON \"store_sales\".\"ss_sold_date_sk\" = \"t0\".\"d_date_sk\"\r\n                                        INNER JOIN (SELECT *\r\n                                            FROM \"item\"\r\n                                            WHERE \"i_manager_id\" >= 40 AND \"i_manager_id\" <= 59 AND (\"i_category\" = 'Books' OR \"i_category\" = 'Children' OR \"i_category\" = 'Home')) AS \"t1\" ON \"store_sales\".\"ss_item_sk\" = \"t1\".\"i_item_sk\"\r\n                                    GROUP BY SUBSTRING(\"t1\".\"i_item_desc\", 1, 30), \"t1\".\"i_item_sk\", \"t0\".\"d_date\"\r\n                                    HAVING COUNT(*) > 4) AS \"t5\"\r\n                            GROUP BY \"t5\".\"item_sk\") AS \"t6\" ON \"t\".\"cs_item_sk\" = \"t6\".\"item_sk\"\r\n                        INNER JOIN (SELECT \"t10\".\"ss_sold_date_sk0\"\r\n                            FROM (SELECT \"t7\".\"c_customer_sk\" AS \"ss_sold_date_sk0\", CASE WHEN COUNT(\"store_sales0\".\"ss_quantity0\" * \"store_sales0\".\"ss_sales_price0\") = 0 THEN NULL ELSE COALESCE(SUM(\"store_sales0\".\"ss_quantity0\" * \"store_sales0\".\"ss_sales_price0\"), 0) END AS \"ssales\"\r\n                                    FROM \"store_sales\" AS \"store_sales0\" (\"ss_sold_date_sk0\", \"ss_sold_time_sk0\", \"ss_item_sk0\", \"ss_customer_sk0\", \"ss_cdemo_sk0\", \"ss_hdemo_sk0\", \"ss_addr_sk0\", \"ss_store_sk0\", \"ss_promo_sk0\", \"ss_ticket_number0\", \"ss_quantity0\", \"ss_wholesale_cost0\", \"ss_list_price0\", \"ss_sales_price0\", \"ss_ext_discount_amt0\", \"ss_ext_sales_price0\", \"ss_ext_wholesale_cost0\", \"ss_ext_list_price0\", \"ss_ext_tax0\", \"ss_coupon_amt0\", \"ss_net_paid0\", \"ss_net_paid_inc_tax0\", \"ss_net_profit0\")\r\n                                        INNER JOIN (SELECT *\r\n                                            FROM \"customer\"\r\n                                            WHERE \"c_birth_year\" >= 1980 AND \"c_birth_year\" <= 1986) AS \"t7\" ON \"store_sales0\".\"ss_customer_sk0\" = \"t7\".\"c_customer_sk\"\r\n                                    GROUP BY \"t7\".\"c_customer_sk\") AS \"t10\"\r\n                                INNER JOIN (SELECT MAX(\"t16\".\"ss_sold_date_sk1\") AS \"tpcds_cmax\"\r\n                                    FROM (SELECT CASE WHEN COUNT(\"t11\".\"ss_quantity1\" * \"t11\".\"ss_sales_price1\") = 0 THEN NULL ELSE COALESCE(SUM(\"t11\".\"ss_quantity1\" * \"t11\".\"ss_sales_price1\"), 0) END AS \"ss_sold_date_sk1\"\r\n                                            FROM (SELECT *\r\n                                                    FROM \"store_sales\" AS \"store_sales1\" (\"ss_sold_date_sk1\", \"ss_sold_time_sk1\", \"ss_item_sk1\", \"ss_customer_sk1\", \"ss_cdemo_sk1\", \"ss_hdemo_sk1\", \"ss_addr_sk1\", \"ss_store_sk1\", \"ss_promo_sk1\", \"ss_ticket_number1\", \"ss_quantity1\", \"ss_wholesale_cost1\", \"ss_list_price1\", \"ss_sales_price1\", \"ss_ext_discount_amt1\", \"ss_ext_sales_price1\", \"ss_ext_wholesale_cost1\", \"ss_ext_list_price1\", \"ss_ext_tax1\", \"ss_coupon_amt1\", \"ss_net_paid1\", \"ss_net_paid_inc_tax1\", \"ss_net_profit1\")\r\n                                                    WHERE \"ss_wholesale_cost1\" >= 23 AND \"ss_wholesale_cost1\" <= 33) AS \"t11\"\r\n                                                INNER JOIN \"customer\" AS \"customer0\" (\"c_customer_sk0\", \"c_customer_id0\", \"c_current_cdemo_sk0\", \"c_current_hdemo_sk0\", \"c_current_addr_sk0\", \"c_first_shipto_date_sk0\", \"c_first_sales_date_sk0\", \"c_salutation0\", \"c_first_name0\", \"c_last_name0\", \"c_preferred_cust_flag0\", \"c_birth_day0\", \"c_birth_month0\", \"c_birth_year0\", \"c_birth_country0\", \"c_login0\", \"c_email_address0\", \"c_last_review_date_sk0\") ON \"t11\".\"ss_customer_sk1\" = \"customer0\".\"c_customer_sk0\"\r\n                                                INNER JOIN (SELECT *\r\n                                                    FROM \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\")\r\n                                                    WHERE \"d_year0\" = 1999) AS \"t12\" ON \"t11\".\"ss_sold_date_sk1\" = \"t12\".\"d_date_sk0\"\r\n                                            GROUP BY \"customer0\".\"c_customer_sk0\") AS \"t16\") AS \"t17\" ON \"t10\".\"ssales\" > 0.95 * \"t17\".\"tpcds_cmax\") AS \"t18\" ON \"t\".\"cs_bill_customer_sk\" = \"t18\".\"ss_sold_date_sk0\") AS \"t19\"\r\n                INNER JOIN (SELECT *\r\n                    FROM \"date_dim\" AS \"date_dim1\" (\"d_date_sk1\", \"d_date_id1\", \"d_date1\", \"d_month_seq1\", \"d_week_seq1\", \"d_quarter_seq1\", \"d_year1\", \"d_dow1\", \"d_moy1\", \"d_dom1\", \"d_qoy1\", \"d_fy_year1\", \"d_fy_quarter_seq1\", \"d_fy_week_seq1\", \"d_day_name1\", \"d_quarter_name1\", \"d_holiday1\", \"d_weekend1\", \"d_following_holiday1\", \"d_first_dom1\", \"d_last_dom1\", \"d_same_day_ly1\", \"d_same_day_lq1\", \"d_current_day1\", \"d_current_week1\", \"d_current_month1\", \"d_current_quarter1\", \"d_current_year1\")\r\n                    WHERE \"d_year1\" = 1999 AND \"d_moy1\" = 8) AS \"t20\" ON \"t19\".\"cs_sold_date_sk\" = \"t20\".\"d_date_sk1\"\r\n            UNION ALL\r\n            SELECT COALESCE(SUM(\"t43\".\"ws_quantity\" * \"t43\".\"ws_list_price\"), 0) AS \"EXPR$0\", COUNT(\"t43\".\"ws_quantity\" * \"t43\".\"ws_list_price\") AS \"$f1\"\r\n            FROM (SELECT \"t23\".\"ws_sold_date_sk\", \"t23\".\"ws_sold_time_sk\", \"t23\".\"ws_ship_date_sk\", \"t23\".\"ws_item_sk\", \"t23\".\"ws_bill_customer_sk\", \"t23\".\"ws_bill_cdemo_sk\", \"t23\".\"ws_bill_hdemo_sk\", \"t23\".\"ws_bill_addr_sk\", \"t23\".\"ws_ship_customer_sk\", \"t23\".\"ws_ship_cdemo_sk\", \"t23\".\"ws_ship_hdemo_sk\", \"t23\".\"ws_ship_addr_sk\", \"t23\".\"ws_web_page_sk\", \"t23\".\"ws_web_site_sk\", \"t23\".\"ws_ship_mode_sk\", \"t23\".\"ws_warehouse_sk\", \"t23\".\"ws_promo_sk\", \"t23\".\"ws_order_number\", \"t23\".\"ws_quantity\", \"t23\".\"ws_wholesale_cost\", \"t23\".\"ws_list_price\", \"t23\".\"ws_sales_price\", \"t23\".\"ws_ext_discount_amt\", \"t23\".\"ws_ext_sales_price\", \"t23\".\"ws_ext_wholesale_cost\", \"t23\".\"ws_ext_list_price\", \"t23\".\"ws_ext_tax\", \"t23\".\"ws_coupon_amt\", \"t23\".\"ws_ext_ship_cost\", \"t23\".\"ws_net_paid\", \"t23\".\"ws_net_paid_inc_tax\", \"t23\".\"ws_net_paid_inc_ship\", \"t23\".\"ws_net_paid_inc_ship_tax\", \"t23\".\"ws_net_profit\"\r\n                    FROM (SELECT *\r\n                            FROM \"web_sales\"\r\n                            WHERE \"ws_wholesale_cost\" >= 23 AND \"ws_wholesale_cost\" <= 33) AS \"t23\"\r\n                        INNER JOIN (SELECT \"t29\".\"ss_sold_date_sk2\"\r\n                            FROM (SELECT \"t25\".\"i_item_sk0\" AS \"ss_sold_date_sk2\"\r\n                                    FROM \"store_sales\" AS \"store_sales2\" (\"ss_sold_date_sk2\", \"ss_sold_time_sk2\", \"ss_item_sk2\", \"ss_customer_sk2\", \"ss_cdemo_sk2\", \"ss_hdemo_sk2\", \"ss_addr_sk2\", \"ss_store_sk2\", \"ss_promo_sk2\", \"ss_ticket_number2\", \"ss_quantity2\", \"ss_wholesale_cost2\", \"ss_list_price2\", \"ss_sales_price2\", \"ss_ext_discount_amt2\", \"ss_ext_sales_price2\", \"ss_ext_wholesale_cost2\", \"ss_ext_list_price2\", \"ss_ext_tax2\", \"ss_coupon_amt2\", \"ss_net_paid2\", \"ss_net_paid_inc_tax2\", \"ss_net_profit2\")\r\n                                        INNER JOIN (SELECT *\r\n                                            FROM \"date_dim\" AS \"date_dim2\" (\"d_date_sk2\", \"d_date_id2\", \"d_date2\", \"d_month_seq2\", \"d_week_seq2\", \"d_quarter_seq2\", \"d_year2\", \"d_dow2\", \"d_moy2\", \"d_dom2\", \"d_qoy2\", \"d_fy_year2\", \"d_fy_quarter_seq2\", \"d_fy_week_seq2\", \"d_day_name2\", \"d_quarter_name2\", \"d_holiday2\", \"d_weekend2\", \"d_following_holiday2\", \"d_first_dom2\", \"d_last_dom2\", \"d_same_day_ly2\", \"d_same_day_lq2\", \"d_current_day2\", \"d_current_week2\", \"d_current_month2\", \"d_current_quarter2\", \"d_current_year2\")\r\n                                            WHERE \"d_year2\" = 1999) AS \"t24\" ON \"store_sales2\".\"ss_sold_date_sk2\" = \"t24\".\"d_date_sk2\"\r\n                                        INNER JOIN (SELECT *\r\n                                            FROM \"item\" AS \"item0\" (\"i_item_sk0\", \"i_item_id0\", \"i_rec_start_date0\", \"i_rec_end_date0\", \"i_item_desc0\", \"i_current_price0\", \"i_wholesale_cost0\", \"i_brand_id0\", \"i_brand0\", \"i_class_id0\", \"i_class0\", \"i_category_id0\", \"i_category0\", \"i_manufact_id0\", \"i_manufact0\", \"i_size0\", \"i_formulation0\", \"i_color0\", \"i_units0\", \"i_container0\", \"i_manager_id0\", \"i_product_name0\")\r\n                                            WHERE \"i_manager_id0\" >= 40 AND \"i_manager_id0\" <= 59 AND (\"i_category0\" = 'Books' OR \"i_category0\" = 'Children' OR \"i_category0\" = 'Home')) AS \"t25\" ON \"store_sales2\".\"ss_item_sk2\" = \"t25\".\"i_item_sk0\"\r\n                                    GROUP BY SUBSTRING(\"t25\".\"i_item_desc0\", 1, 30), \"t25\".\"i_item_sk0\", \"t24\".\"d_date2\"\r\n                                    HAVING COUNT(*) > 4) AS \"t29\"\r\n                            GROUP BY \"t29\".\"ss_sold_date_sk2\") AS \"t30\" ON \"t23\".\"ws_item_sk\" = \"t30\".\"ss_sold_date_sk2\"\r\n                        INNER JOIN (SELECT \"t34\".\"ss_sold_date_sk3\"\r\n                            FROM (SELECT \"t31\".\"c_customer_sk1\" AS \"ss_sold_date_sk3\", CASE WHEN COUNT(\"store_sales3\".\"ss_quantity3\" * \"store_sales3\".\"ss_sales_price3\") = 0 THEN NULL ELSE COALESCE(SUM(\"store_sales3\".\"ss_quantity3\" * \"store_sales3\".\"ss_sales_price3\"), 0) END AS \"ssales0\"\r\n                                    FROM \"store_sales\" AS \"store_sales3\" (\"ss_sold_date_sk3\", \"ss_sold_time_sk3\", \"ss_item_sk3\", \"ss_customer_sk3\", \"ss_cdemo_sk3\", \"ss_hdemo_sk3\", \"ss_addr_sk3\", \"ss_store_sk3\", \"ss_promo_sk3\", \"ss_ticket_number3\", \"ss_quantity3\", \"ss_wholesale_cost3\", \"ss_list_price3\", \"ss_sales_price3\", \"ss_ext_discount_amt3\", \"ss_ext_sales_price3\", \"ss_ext_wholesale_cost3\", \"ss_ext_list_price3\", \"ss_ext_tax3\", \"ss_coupon_amt3\", \"ss_net_paid3\", \"ss_net_paid_inc_tax3\", \"ss_net_profit3\")\r\n                                        INNER JOIN (SELECT *\r\n                                            FROM \"customer\" AS \"customer1\" (\"c_customer_sk1\", \"c_customer_id1\", \"c_current_cdemo_sk1\", \"c_current_hdemo_sk1\", \"c_current_addr_sk1\", \"c_first_shipto_date_sk1\", \"c_first_sales_date_sk1\", \"c_salutation1\", \"c_first_name1\", \"c_last_name1\", \"c_preferred_cust_flag1\", \"c_birth_day1\", \"c_birth_month1\", \"c_birth_year1\", \"c_birth_country1\", \"c_login1\", \"c_email_address1\", \"c_last_review_date_sk1\")\r\n                                            WHERE \"c_birth_year1\" >= 1980 AND \"c_birth_year1\" <= 1986) AS \"t31\" ON \"store_sales3\".\"ss_customer_sk3\" = \"t31\".\"c_customer_sk1\"\r\n                                    GROUP BY \"t31\".\"c_customer_sk1\") AS \"t34\"\r\n                                INNER JOIN (SELECT MAX(\"t40\".\"ss_sold_date_sk4\") AS \"tpcds_cmax\"\r\n                                    FROM (SELECT CASE WHEN COUNT(\"t35\".\"ss_quantity4\" * \"t35\".\"ss_sales_price4\") = 0 THEN NULL ELSE COALESCE(SUM(\"t35\".\"ss_quantity4\" * \"t35\".\"ss_sales_price4\"), 0) END AS \"ss_sold_date_sk4\"\r\n                                            FROM (SELECT *\r\n                                                    FROM \"store_sales\" AS \"store_sales4\" (\"ss_sold_date_sk4\", \"ss_sold_time_sk4\", \"ss_item_sk4\", \"ss_customer_sk4\", \"ss_cdemo_sk4\", \"ss_hdemo_sk4\", \"ss_addr_sk4\", \"ss_store_sk4\", \"ss_promo_sk4\", \"ss_ticket_number4\", \"ss_quantity4\", \"ss_wholesale_cost4\", \"ss_list_price4\", \"ss_sales_price4\", \"ss_ext_discount_amt4\", \"ss_ext_sales_price4\", \"ss_ext_wholesale_cost4\", \"ss_ext_list_price4\", \"ss_ext_tax4\", \"ss_coupon_amt4\", \"ss_net_paid4\", \"ss_net_paid_inc_tax4\", \"ss_net_profit4\")\r\n                                                    WHERE \"ss_wholesale_cost4\" >= 23 AND \"ss_wholesale_cost4\" <= 33) AS \"t35\"\r\n                                                INNER JOIN \"customer\" AS \"customer2\" (\"c_customer_sk2\", \"c_customer_id2\", \"c_current_cdemo_sk2\", \"c_current_hdemo_sk2\", \"c_current_addr_sk2\", \"c_first_shipto_date_sk2\", \"c_first_sales_date_sk2\", \"c_salutation2\", \"c_first_name2\", \"c_last_name2\", \"c_preferred_cust_flag2\", \"c_birth_day2\", \"c_birth_month2\", \"c_birth_year2\", \"c_birth_country2\", \"c_login2\", \"c_email_address2\", \"c_last_review_date_sk2\") ON \"t35\".\"ss_customer_sk4\" = \"customer2\".\"c_customer_sk2\"\r\n                                                INNER JOIN (SELECT *\r\n                                                    FROM \"date_dim\" AS \"date_dim3\" (\"d_date_sk3\", \"d_date_id3\", \"d_date3\", \"d_month_seq3\", \"d_week_seq3\", \"d_quarter_seq3\", \"d_year3\", \"d_dow3\", \"d_moy3\", \"d_dom3\", \"d_qoy3\", \"d_fy_year3\", \"d_fy_quarter_seq3\", \"d_fy_week_seq3\", \"d_day_name3\", \"d_quarter_name3\", \"d_holiday3\", \"d_weekend3\", \"d_following_holiday3\", \"d_first_dom3\", \"d_last_dom3\", \"d_same_day_ly3\", \"d_same_day_lq3\", \"d_current_day3\", \"d_current_week3\", \"d_current_month3\", \"d_current_quarter3\", \"d_current_year3\")\r\n                                                    WHERE \"d_year3\" = 1999) AS \"t36\" ON \"t35\".\"ss_sold_date_sk4\" = \"t36\".\"d_date_sk3\"\r\n                                            GROUP BY \"customer2\".\"c_customer_sk2\") AS \"t40\") AS \"t41\" ON \"t34\".\"ssales0\" > 0.95 * \"t41\".\"tpcds_cmax\") AS \"t42\" ON \"t23\".\"ws_bill_customer_sk\" = \"t42\".\"ss_sold_date_sk3\") AS \"t43\"\r\n                INNER JOIN (SELECT *\r\n                    FROM \"date_dim\" AS \"date_dim4\" (\"d_date_sk4\", \"d_date_id4\", \"d_date4\", \"d_month_seq4\", \"d_week_seq4\", \"d_quarter_seq4\", \"d_year4\", \"d_dow4\", \"d_moy4\", \"d_dom4\", \"d_qoy4\", \"d_fy_year4\", \"d_fy_quarter_seq4\", \"d_fy_week_seq4\", \"d_day_name4\", \"d_quarter_name4\", \"d_holiday4\", \"d_weekend4\", \"d_following_holiday4\", \"d_first_dom4\", \"d_last_dom4\", \"d_same_day_ly4\", \"d_same_day_lq4\", \"d_current_day4\", \"d_current_week4\", \"d_current_month4\", \"d_current_quarter4\", \"d_current_year4\")\r\n                    WHERE \"d_year4\" = 1999 AND \"d_moy4\" = 8) AS \"t44\" ON \"t43\".\"ws_sold_date_sk\" = \"t44\".\"d_date_sk4\") AS \"t47\"\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 175.34, "used_rules": ["FILTER_INTO_JOIN", "FILTER_SUB_QUERY_TO_CORRELATE", "FILTER_INTO_JOIN", "PROJECT_REMOVE", "PROJECT_TO_CALC", "CALC_MERGE", "JOIN_REDUCE_EXPRESSIONS", "AGGREGATE_REDUCE_FUNCTIONS", "AGGREGATE_UNION_TRANSPOSE"], "rewrite_time": 5248}
{"name": "query025_0", "input_sql": "select \n i_item_id\n ,i_item_desc\n ,s_store_id\n ,s_store_name\n ,stddev_samp(ss_net_profit) as store_sales_profit\n ,stddev_samp(sr_net_loss) as store_returns_loss\n ,stddev_samp(cs_net_profit) as catalog_sales_profit\n from\n store_sales\n ,store_returns\n ,catalog_sales\n ,date_dim d1\n ,date_dim d2\n ,date_dim d3\n ,store\n ,item\n where\n d1.d_moy = 7\n and d1.d_year = 1998\n and d1.d_date_sk = ss_sold_date_sk\n and i_item_sk = ss_item_sk\n and s_store_sk = ss_store_sk\n and ss_customer_sk = sr_customer_sk\n and ss_item_sk = sr_item_sk\n and ss_ticket_number = sr_ticket_number\n and sr_returned_date_sk = d2.d_date_sk\n and d2.d_moy               between 7 and  7 + 2\n and d2.d_year              = 1998\n and sr_customer_sk = cs_bill_customer_sk\n and sr_item_sk = cs_item_sk\n and cs_sold_date_sk = d3.d_date_sk\n and d3.d_moy               between 7 and  7 + 2\n and d3.d_year              = 1998\n group by\n i_item_id\n ,i_item_desc\n ,s_store_id\n ,s_store_name\n order by\n i_item_id\n ,i_item_desc\n ,s_store_id\n ,s_store_name\n limit 100;", "input_cost": 49.76, "output_sql": "SELECT \"item\".\"i_item_id\" AS \"ss_sold_date_sk\", \"item\".\"i_item_desc\" AS \"ss_sold_time_sk\", \"store\".\"s_store_id\" AS \"ss_item_sk\", \"store\".\"s_store_name\" AS \"ss_customer_sk\", POWER((CASE WHEN COUNT(\"store_sales\".\"ss_net_profit\" * \"store_sales\".\"ss_net_profit\") = 0 THEN NULL ELSE COALESCE(SUM(\"store_sales\".\"ss_net_profit\" * \"store_sales\".\"ss_net_profit\"), 0) END - CASE WHEN COUNT(\"store_sales\".\"ss_net_profit\") = 0 THEN NULL ELSE COALESCE(SUM(\"store_sales\".\"ss_net_profit\"), 0) END * CASE WHEN COUNT(\"store_sales\".\"ss_net_profit\") = 0 THEN NULL ELSE COALESCE(SUM(\"store_sales\".\"ss_net_profit\"), 0) END / COUNT(\"store_sales\".\"ss_net_profit\")) / CASE WHEN COUNT(\"store_sales\".\"ss_net_profit\") = 1 THEN NULL ELSE COUNT(\"store_sales\".\"ss_net_profit\") - 1 END, 0.5) AS \"$f4\", POWER((CASE WHEN COUNT(\"store_returns\".\"sr_net_loss\" * \"store_returns\".\"sr_net_loss\") = 0 THEN NULL ELSE COALESCE(SUM(\"store_returns\".\"sr_net_loss\" * \"store_returns\".\"sr_net_loss\"), 0) END - CASE WHEN COUNT(\"store_returns\".\"sr_net_loss\") = 0 THEN NULL ELSE COALESCE(SUM(\"store_returns\".\"sr_net_loss\"), 0) END * CASE WHEN COUNT(\"store_returns\".\"sr_net_loss\") = 0 THEN NULL ELSE COALESCE(SUM(\"store_returns\".\"sr_net_loss\"), 0) END / COUNT(\"store_returns\".\"sr_net_loss\")) / CASE WHEN COUNT(\"store_returns\".\"sr_net_loss\") = 1 THEN NULL ELSE COUNT(\"store_returns\".\"sr_net_loss\") - 1 END, 0.5) AS \"$f5\", POWER((CASE WHEN COUNT(\"catalog_sales\".\"cs_net_profit\" * \"catalog_sales\".\"cs_net_profit\") = 0 THEN NULL ELSE COALESCE(SUM(\"catalog_sales\".\"cs_net_profit\" * \"catalog_sales\".\"cs_net_profit\"), 0) END - CASE WHEN COUNT(\"catalog_sales\".\"cs_net_profit\") = 0 THEN NULL ELSE COALESCE(SUM(\"catalog_sales\".\"cs_net_profit\"), 0) END * CASE WHEN COUNT(\"catalog_sales\".\"cs_net_profit\") = 0 THEN NULL ELSE COALESCE(SUM(\"catalog_sales\".\"cs_net_profit\"), 0) END / COUNT(\"catalog_sales\".\"cs_net_profit\")) / CASE WHEN COUNT(\"catalog_sales\".\"cs_net_profit\") = 1 THEN NULL ELSE COUNT(\"catalog_sales\".\"cs_net_profit\") - 1 END, 0.5) AS \"$f6\"\r\nFROM \"store_sales\"\r\n    INNER JOIN \"store_returns\" ON \"store_sales\".\"ss_customer_sk\" = \"store_returns\".\"sr_customer_sk\" AND \"store_sales\".\"ss_item_sk\" = \"store_returns\".\"sr_item_sk\" AND \"store_sales\".\"ss_ticket_number\" = \"store_returns\".\"sr_ticket_number\"\r\n    INNER JOIN \"catalog_sales\" ON \"store_returns\".\"sr_customer_sk\" = \"catalog_sales\".\"cs_bill_customer_sk\" AND \"store_returns\".\"sr_item_sk\" = \"catalog_sales\".\"cs_item_sk\"\r\n    INNER JOIN (SELECT *\r\n        FROM \"date_dim\"\r\n        WHERE \"d_moy\" = 7 AND \"d_year\" = 1998) AS \"t\" ON \"store_sales\".\"ss_sold_date_sk\" = \"t\".\"d_date_sk\"\r\n    INNER JOIN (SELECT *\r\n        FROM \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\")\r\n        WHERE \"d_moy0\" >= 7 AND \"d_moy0\" <= 9 AND \"d_year0\" = 1998) AS \"t0\" ON \"store_returns\".\"sr_returned_date_sk\" = \"t0\".\"d_date_sk0\"\r\n    INNER JOIN (SELECT *\r\n        FROM \"date_dim\" AS \"date_dim1\" (\"d_date_sk1\", \"d_date_id1\", \"d_date1\", \"d_month_seq1\", \"d_week_seq1\", \"d_quarter_seq1\", \"d_year1\", \"d_dow1\", \"d_moy1\", \"d_dom1\", \"d_qoy1\", \"d_fy_year1\", \"d_fy_quarter_seq1\", \"d_fy_week_seq1\", \"d_day_name1\", \"d_quarter_name1\", \"d_holiday1\", \"d_weekend1\", \"d_following_holiday1\", \"d_first_dom1\", \"d_last_dom1\", \"d_same_day_ly1\", \"d_same_day_lq1\", \"d_current_day1\", \"d_current_week1\", \"d_current_month1\", \"d_current_quarter1\", \"d_current_year1\")\r\n        WHERE \"d_moy1\" >= 7 AND \"d_moy1\" <= 9 AND \"d_year1\" = 1998) AS \"t1\" ON \"catalog_sales\".\"cs_sold_date_sk\" = \"t1\".\"d_date_sk1\"\r\n    INNER JOIN \"store\" ON \"store_sales\".\"ss_store_sk\" = \"store\".\"s_store_sk\"\r\n    INNER JOIN \"item\" ON \"store_sales\".\"ss_item_sk\" = \"item\".\"i_item_sk\"\r\nGROUP BY \"item\".\"i_item_id\", \"item\".\"i_item_desc\", \"store\".\"s_store_id\", \"store\".\"s_store_name\"\r\nORDER BY \"item\".\"i_item_id\", \"item\".\"i_item_desc\", \"store\".\"s_store_id\", \"store\".\"s_store_name\"\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 49.9, "used_rules": ["FILTER_INTO_JOIN", "FILTER_REDUCE_EXPRESSIONS", "PROJECT_TO_CALC", "AGGREGATE_REDUCE_FUNCTIONS", "PROJECT_CALC_MERGE", "PROJECT_TO_CALC", "CALC_MERGE"], "rewrite_time": 3133}
{"name": "query025_1", "input_sql": "select \n i_item_id\n ,i_item_desc\n ,s_store_id\n ,s_store_name\n ,max(ss_net_profit) as store_sales_profit\n ,max(sr_net_loss) as store_returns_loss\n ,max(cs_net_profit) as catalog_sales_profit\n from\n store_sales\n ,store_returns\n ,catalog_sales\n ,date_dim d1\n ,date_dim d2\n ,date_dim d3\n ,store\n ,item\n where\n d1.d_moy = 4\n and d1.d_year = 2001\n and d1.d_date_sk = ss_sold_date_sk\n and i_item_sk = ss_item_sk\n and s_store_sk = ss_store_sk\n and ss_customer_sk = sr_customer_sk\n and ss_item_sk = sr_item_sk\n and ss_ticket_number = sr_ticket_number\n and sr_returned_date_sk = d2.d_date_sk\n and d2.d_moy               between 4 and  4 + 2\n and d2.d_year              = 2001\n and sr_customer_sk = cs_bill_customer_sk\n and sr_item_sk = cs_item_sk\n and cs_sold_date_sk = d3.d_date_sk\n and d3.d_moy               between 4 and  4 + 2\n and d3.d_year              = 2001\n group by\n i_item_id\n ,i_item_desc\n ,s_store_id\n ,s_store_name\n order by\n i_item_id\n ,i_item_desc\n ,s_store_id\n ,s_store_name\n limit 100;", "input_cost": 49.76, "output_sql": "SELECT \"item\".\"i_item_id\", \"item\".\"i_item_desc\", \"t8\".\"s_store_id\", \"t8\".\"s_store_name\", MAX(\"t8\".\"store_sales_profit\") AS \"store_sales_profit\", MAX(\"t8\".\"store_returns_loss\") AS \"store_returns_loss\", MAX(\"t8\".\"catalog_sales_profit\") AS \"catalog_sales_profit\"\r\nFROM (SELECT \"t7\".\"ss_item_sk\", \"store\".\"s_store_id\", \"store\".\"s_store_name\", MAX(\"t7\".\"store_sales_profit\") AS \"store_sales_profit\", MAX(\"t7\".\"store_returns_loss\") AS \"store_returns_loss\", MAX(\"t7\".\"catalog_sales_profit\") AS \"catalog_sales_profit\"\r\n        FROM (SELECT \"t5\".\"ss_item_sk\", \"t5\".\"ss_store_sk\", MAX(\"t5\".\"store_sales_profit\") AS \"store_sales_profit\", MAX(\"t5\".\"store_returns_loss\") AS \"store_returns_loss\", MAX(\"t5\".\"catalog_sales_profit\") AS \"catalog_sales_profit\"\r\n                FROM (SELECT \"t3\".\"ss_item_sk\", \"t3\".\"ss_store_sk\", \"t3\".\"cs_sold_date_sk\", MAX(\"t3\".\"store_sales_profit\") AS \"store_sales_profit\", MAX(\"t3\".\"store_returns_loss\") AS \"store_returns_loss\", MAX(\"t3\".\"catalog_sales_profit\") AS \"catalog_sales_profit\"\r\n                        FROM (SELECT \"t1\".\"ss_item_sk\", \"t1\".\"ss_store_sk\", \"t1\".\"sr_returned_date_sk\", \"t1\".\"cs_sold_date_sk\", MAX(\"t1\".\"store_sales_profit\") AS \"store_sales_profit\", MAX(\"t1\".\"store_returns_loss\") AS \"store_returns_loss\", MAX(\"t1\".\"catalog_sales_profit\") AS \"catalog_sales_profit\"\r\n                                FROM (SELECT \"t\".\"ss_sold_date_sk\", \"t\".\"ss_item_sk\", \"t\".\"ss_store_sk\", \"t\".\"sr_returned_date_sk\", \"t0\".\"cs_sold_date_sk\", MAX(\"t\".\"store_sales_profit\") AS \"store_sales_profit\", MAX(\"t\".\"store_returns_loss\") AS \"store_returns_loss\", MAX(\"t0\".\"catalog_sales_profit\") AS \"catalog_sales_profit\"\r\n                                        FROM (SELECT \"store_sales\".\"ss_sold_date_sk\", \"store_sales\".\"ss_item_sk\", \"store_sales\".\"ss_store_sk\", \"store_returns\".\"sr_returned_date_sk\", \"store_returns\".\"sr_item_sk\", \"store_returns\".\"sr_customer_sk\", MAX(\"store_sales\".\"ss_net_profit\") AS \"store_sales_profit\", MAX(\"store_returns\".\"sr_net_loss\") AS \"store_returns_loss\"\r\n                                                FROM \"store_sales\"\r\n                                                    INNER JOIN \"store_returns\" ON \"store_sales\".\"ss_customer_sk\" = \"store_returns\".\"sr_customer_sk\" AND \"store_sales\".\"ss_item_sk\" = \"store_returns\".\"sr_item_sk\" AND \"store_sales\".\"ss_ticket_number\" = \"store_returns\".\"sr_ticket_number\"\r\n                                                GROUP BY \"store_sales\".\"ss_sold_date_sk\", \"store_sales\".\"ss_item_sk\", \"store_sales\".\"ss_store_sk\", \"store_returns\".\"sr_returned_date_sk\", \"store_returns\".\"sr_item_sk\", \"store_returns\".\"sr_customer_sk\") AS \"t\"\r\n                                            INNER JOIN (SELECT \"cs_sold_date_sk\", \"cs_bill_customer_sk\", \"cs_item_sk\", MAX(\"cs_net_profit\") AS \"catalog_sales_profit\"\r\n                                                FROM \"catalog_sales\"\r\n                                                GROUP BY \"cs_sold_date_sk\", \"cs_bill_customer_sk\", \"cs_item_sk\") AS \"t0\" ON \"t\".\"sr_customer_sk\" = \"t0\".\"cs_bill_customer_sk\" AND \"t\".\"sr_item_sk\" = \"t0\".\"cs_item_sk\"\r\n                                        GROUP BY \"t\".\"ss_sold_date_sk\", \"t\".\"ss_item_sk\", \"t\".\"ss_store_sk\", \"t\".\"sr_returned_date_sk\", \"t0\".\"cs_sold_date_sk\") AS \"t1\"\r\n                                    INNER JOIN (SELECT *\r\n                                        FROM \"date_dim\"\r\n                                        WHERE \"d_moy\" = 4 AND \"d_year\" = 2001) AS \"t2\" ON \"t1\".\"ss_sold_date_sk\" = \"t2\".\"d_date_sk\"\r\n                                GROUP BY \"t1\".\"ss_item_sk\", \"t1\".\"ss_store_sk\", \"t1\".\"sr_returned_date_sk\", \"t1\".\"cs_sold_date_sk\") AS \"t3\"\r\n                            INNER JOIN (SELECT *\r\n                                FROM \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\")\r\n                                WHERE \"d_moy0\" >= 4 AND \"d_moy0\" <= 6 AND \"d_year0\" = 2001) AS \"t4\" ON \"t3\".\"sr_returned_date_sk\" = \"t4\".\"d_date_sk0\"\r\n                        GROUP BY \"t3\".\"ss_item_sk\", \"t3\".\"ss_store_sk\", \"t3\".\"cs_sold_date_sk\") AS \"t5\"\r\n                    INNER JOIN (SELECT *\r\n                        FROM \"date_dim\" AS \"date_dim1\" (\"d_date_sk1\", \"d_date_id1\", \"d_date1\", \"d_month_seq1\", \"d_week_seq1\", \"d_quarter_seq1\", \"d_year1\", \"d_dow1\", \"d_moy1\", \"d_dom1\", \"d_qoy1\", \"d_fy_year1\", \"d_fy_quarter_seq1\", \"d_fy_week_seq1\", \"d_day_name1\", \"d_quarter_name1\", \"d_holiday1\", \"d_weekend1\", \"d_following_holiday1\", \"d_first_dom1\", \"d_last_dom1\", \"d_same_day_ly1\", \"d_same_day_lq1\", \"d_current_day1\", \"d_current_week1\", \"d_current_month1\", \"d_current_quarter1\", \"d_current_year1\")\r\n                        WHERE \"d_moy1\" >= 4 AND \"d_moy1\" <= 6 AND \"d_year1\" = 2001) AS \"t6\" ON \"t5\".\"cs_sold_date_sk\" = \"t6\".\"d_date_sk1\"\r\n                GROUP BY \"t5\".\"ss_item_sk\", \"t5\".\"ss_store_sk\") AS \"t7\"\r\n            INNER JOIN \"store\" ON \"t7\".\"ss_store_sk\" = \"store\".\"s_store_sk\"\r\n        GROUP BY \"t7\".\"ss_item_sk\", \"store\".\"s_store_id\", \"store\".\"s_store_name\") AS \"t8\"\r\n    INNER JOIN \"item\" ON \"t8\".\"ss_item_sk\" = \"item\".\"i_item_sk\"\r\nGROUP BY \"t8\".\"s_store_id\", \"t8\".\"s_store_name\", \"item\".\"i_item_id\", \"item\".\"i_item_desc\"\r\nORDER BY \"item\".\"i_item_id\", \"item\".\"i_item_desc\", \"t8\".\"s_store_id\", \"t8\".\"s_store_name\"\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 99.11, "used_rules": ["FILTER_INTO_JOIN", "FILTER_REDUCE_EXPRESSIONS", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_JOIN_TRANSPOSE_EXTENDED", "JOIN_EXTRACT_FILTER", "JOIN_PROJECT_RIGHT_TRANSPOSE", "FILTER_INTO_JOIN", "FILTER_PROJECT_TRANSPOSE", "FILTER_INTO_JOIN", "AGGREGATE_PROJECT_MERGE"], "rewrite_time": 2459}
{"name": "query027_0", "input_sql": "select  i_item_id,\n        s_state, grouping(s_state) g_state,\n        avg(ss_quantity) agg1,\n        avg(ss_list_price) agg2,\n        avg(ss_coupon_amt) agg3,\n        avg(ss_sales_price) agg4\nfrom store_sales, customer_demographics, date_dim, store, item\nwhere ss_sold_date_sk = d_date_sk and\n      ss_item_sk = i_item_sk and\n      ss_store_sk = s_store_sk and\n      ss_cdemo_sk = cd_demo_sk and\n      cd_gender = 'F' and\n      cd_marital_status = 'S' and\n      cd_education_status = 'Unknown' and\n      d_year = 2001 and\n      s_state = 'MI' and\n     i_category  = 'Books'\n group by rollup (i_item_id, s_state)\n order by i_item_id\n         ,s_state\n limit 100;", "input_cost": 41.05, "output_sql": "SELECT \"t5\".\"i_item_id\", \"t4\".\"s_state\", GROUPING(\"t4\".\"s_state\") AS \"g_state\", CAST(CASE WHEN COUNT(\"t4\".\"ss_quantity\") = 0 THEN NULL ELSE COALESCE(SUM(\"t4\".\"ss_quantity\"), 0) END / COUNT(\"t4\".\"ss_quantity\") AS INTEGER) AS \"agg1\", CASE WHEN COUNT(\"t4\".\"ss_list_price\") = 0 THEN NULL ELSE COALESCE(SUM(\"t4\".\"ss_list_price\"), 0) END / COUNT(\"t4\".\"ss_list_price\") AS \"agg2\", CASE WHEN COUNT(\"t4\".\"ss_coupon_amt\") = 0 THEN NULL ELSE COALESCE(SUM(\"t4\".\"ss_coupon_amt\"), 0) END / COUNT(\"t4\".\"ss_coupon_amt\") AS \"agg3\", CASE WHEN COUNT(\"t4\".\"ss_sales_price\") = 0 THEN NULL ELSE COALESCE(SUM(\"t4\".\"ss_sales_price\"), 0) END / COUNT(\"t4\".\"ss_sales_price\") AS \"agg4\"\r\nFROM (SELECT *\r\n        FROM (SELECT *\r\n                FROM (SELECT *\r\n                        FROM \"store_sales\",\r\n                                (SELECT *\r\n                                FROM \"customer_demographics\"\r\n                                WHERE \"cd_gender\" = 'F' AND \"cd_marital_status\" = 'S' AND \"cd_education_status\" = 'Unknown') AS \"t\"\r\n                        WHERE \"store_sales\".\"ss_cdemo_sk\" = \"t\".\"cd_demo_sk\") AS \"t0\",\r\n                        (SELECT *\r\n                        FROM \"date_dim\"\r\n                        WHERE \"d_year\" = 2001) AS \"t1\"\r\n                WHERE \"t0\".\"ss_sold_date_sk\" = \"t1\".\"d_date_sk\") AS \"t2\",\r\n                (SELECT *\r\n                FROM \"store\"\r\n                WHERE \"s_state\" = 'MI') AS \"t3\"\r\n        WHERE \"t2\".\"ss_store_sk\" = \"t3\".\"s_store_sk\") AS \"t4\",\r\n        (SELECT *\r\n        FROM \"item\"\r\n        WHERE \"i_category\" = 'Books') AS \"t5\"\r\nWHERE \"t4\".\"ss_item_sk\" = \"t5\".\"i_item_sk\"\r\nGROUP BY ROLLUP(\"t5\".\"i_item_id\", \"t4\".\"s_state\")\r\nORDER BY \"t5\".\"i_item_id\", \"t4\".\"s_state\"\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 41.12, "used_rules": ["FILTER_INTO_JOIN", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_REDUCE_FUNCTIONS", "PROJECT_TO_CALC", "CALC_MERGE", "JOIN_EXTRACT_FILTER"], "rewrite_time": 1382}
{"name": "query027_1", "input_sql": "select  i_item_id,\n        s_state, grouping(s_state) g_state,\n        avg(ss_quantity) agg1,\n        avg(ss_list_price) agg2,\n        avg(ss_coupon_amt) agg3,\n        avg(ss_sales_price) agg4\nfrom store_sales, customer_demographics, date_dim, store, item\nwhere ss_sold_date_sk = d_date_sk and\n      ss_item_sk = i_item_sk and\n      ss_store_sk = s_store_sk and\n      ss_cdemo_sk = cd_demo_sk and\n      cd_gender = 'F' and\n      cd_marital_status = 'S' and\n      cd_education_status = '2 yr Degree' and\n      d_year = 1999 and\n      s_state = 'KS' and\n     i_category  = 'Shoes'\n group by rollup (i_item_id, s_state)\n order by i_item_id\n         ,s_state\n limit 100;", "input_cost": 41.05, "output_sql": "SELECT \"t2\".\"i_item_id\", \"t1\".\"s_state\", GROUPING(\"t1\".\"s_state\") AS \"g_state\", CAST(CASE WHEN COUNT(\"store_sales\".\"ss_quantity\") = 0 THEN NULL ELSE COALESCE(SUM(\"store_sales\".\"ss_quantity\"), 0) END / COUNT(\"store_sales\".\"ss_quantity\") AS INTEGER) AS \"agg1\", CASE WHEN COUNT(\"store_sales\".\"ss_list_price\") = 0 THEN NULL ELSE COALESCE(SUM(\"store_sales\".\"ss_list_price\"), 0) END / COUNT(\"store_sales\".\"ss_list_price\") AS \"agg2\", CASE WHEN COUNT(\"store_sales\".\"ss_coupon_amt\") = 0 THEN NULL ELSE COALESCE(SUM(\"store_sales\".\"ss_coupon_amt\"), 0) END / COUNT(\"store_sales\".\"ss_coupon_amt\") AS \"agg3\", CASE WHEN COUNT(\"store_sales\".\"ss_sales_price\") = 0 THEN NULL ELSE COALESCE(SUM(\"store_sales\".\"ss_sales_price\"), 0) END / COUNT(\"store_sales\".\"ss_sales_price\") AS \"agg4\"\r\nFROM \"store_sales\"\r\n    INNER JOIN (SELECT *\r\n        FROM \"customer_demographics\"\r\n        WHERE \"cd_gender\" = 'F' AND \"cd_marital_status\" = 'S' AND \"cd_education_status\" = '2 yr Degree') AS \"t\" ON \"store_sales\".\"ss_cdemo_sk\" = \"t\".\"cd_demo_sk\"\r\n    INNER JOIN (SELECT *\r\n        FROM \"date_dim\"\r\n        WHERE \"d_year\" = 1999) AS \"t0\" ON \"store_sales\".\"ss_sold_date_sk\" = \"t0\".\"d_date_sk\"\r\n    INNER JOIN (SELECT *\r\n        FROM \"store\"\r\n        WHERE \"s_state\" = 'KS') AS \"t1\" ON \"store_sales\".\"ss_store_sk\" = \"t1\".\"s_store_sk\"\r\n    INNER JOIN (SELECT *\r\n        FROM \"item\"\r\n        WHERE \"i_category\" = 'Shoes') AS \"t2\" ON \"store_sales\".\"ss_item_sk\" = \"t2\".\"i_item_sk\"\r\nGROUP BY ROLLUP(\"t2\".\"i_item_id\", \"t1\".\"s_state\")\r\nORDER BY \"t2\".\"i_item_id\", \"t1\".\"s_state\"\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 50.28, "used_rules": ["FILTER_INTO_JOIN", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_REDUCE_FUNCTIONS", "SORT_PROJECT_TRANSPOSE", "PROJECT_TO_CALC", "CALC_MERGE"], "rewrite_time": 1349}
{"name": "query030_0", "input_sql": "with customer_total_return as\n (select wr_returning_customer_sk as ctr_customer_sk\n ,ca_state as ctr_state\n,wr_reason_sk as ctr_reason_sk\n,sum(wr_return_amt) as ctr_total_return\n from web_returns\n     ,date_dim\n     ,customer_address\n     ,item\n where wr_returned_date_sk = d_date_sk\n   and d_year =2000\n   and wr_returning_addr_sk = ca_address_sk\n   and wr_item_sk = i_item_sk\n   and i_manager_id BETWEEN 91 and 100\n   and wr_return_amt / wr_return_quantity between 271 and 300\n group by wr_returning_customer_sk\n         ,ca_state, wr_reason_sk)\n  select  c_customer_id,c_salutation,c_first_name,c_last_name,c_preferred_cust_flag\n       ,c_birth_day,c_birth_month,c_birth_year,c_birth_country,c_login,c_email_address\n       ,c_last_review_date_sk,ctr_total_return\n from customer_total_return ctr1\n     ,customer_address\n     ,customer\n where ctr1.ctr_total_return > (select avg(ctr_total_return)*1.2\n \t\t\t  from customer_total_return ctr2\n                  \t  where ctr1.ctr_state = ctr2.ctr_state)\n       and ca_address_sk = c_current_addr_sk\n       and ca_state in ('MO', 'OH', 'OK', 'SD')\n       and ctr1.ctr_customer_sk = c_customer_sk\n       and ctr1.ctr_reason_sk in (15, 50)\n      and c_birth_year BETWEEN 1987 AND 1993\n order by c_customer_id,c_salutation,c_first_name,c_last_name,c_preferred_cust_flag\n                  ,c_birth_day,c_birth_month,c_birth_year,c_birth_country,c_login,c_email_address\n                  ,c_last_review_date_sk,ctr_total_return\nlimit 100;", "input_cost": 56.12, "output_sql": "None", "output_cost": -1, "used_rules": [], "rewrite_time": 2460}
{"name": "query030_1", "input_sql": "with customer_total_return as\n (select wr_returning_customer_sk as ctr_customer_sk\n ,ca_state as ctr_state\n,wr_reason_sk as ctr_reason_sk\n,sum(wr_return_amt) as ctr_total_return\n from web_returns\n     ,date_dim\n     ,customer_address\n     ,item\n where wr_returned_date_sk = d_date_sk\n   and d_year =2000\n   and wr_returning_addr_sk = ca_address_sk\n   and wr_item_sk = i_item_sk\n   and i_manager_id BETWEEN 47 and 56\n   and wr_return_amt / wr_return_quantity between 95 and 124\n group by wr_returning_customer_sk\n         ,ca_state, wr_reason_sk)\n  select  c_customer_id,c_salutation,c_first_name,c_last_name,c_preferred_cust_flag\n       ,c_birth_day,c_birth_month,c_birth_year,c_birth_country,c_login,c_email_address\n       ,c_last_review_date_sk,ctr_total_return\n from customer_total_return ctr1\n     ,customer_address\n     ,customer\n where ctr1.ctr_total_return > (select avg(ctr_total_return)*1.2\n \t\t\t  from customer_total_return ctr2\n                  \t  where ctr1.ctr_state = ctr2.ctr_state)\n       and ca_address_sk = c_current_addr_sk\n       and ca_state in ('IL', 'NE', 'PA', 'VT')\n       and ctr1.ctr_customer_sk = c_customer_sk\n       and ctr1.ctr_reason_sk in (23, 38)\n      and c_birth_year BETWEEN 1927 AND 1933\n order by c_customer_id,c_salutation,c_first_name,c_last_name,c_preferred_cust_flag\n                  ,c_birth_day,c_birth_month,c_birth_year,c_birth_country,c_login,c_email_address\n                  ,c_last_review_date_sk,ctr_total_return\nlimit 100;", "input_cost": 56.12, "output_sql": "None", "output_cost": -1, "used_rules": [], "rewrite_time": 2380}
{"name": "query031_0", "input_sql": "with ss as\n (select ca_county,d_qoy, d_year,sum(ss_ext_sales_price) as store_sales\n from store_sales,date_dim,customer_address, item\n where ss_sold_date_sk = d_date_sk\n  and ss_addr_sk=ca_address_sk\n  and ss_item_sk = i_item_sk\n  and i_color IN ('cornsilk', 'rosy')\n  and i_manager_id BETWEEN 80 and 99\n  and ss_list_price between 248 and 262\n  and ca_state in ('IL','MI')\n group by ca_county,d_qoy, d_year),\n ws as\n (select ca_county,d_qoy, d_year,sum(ws_ext_sales_price) as web_sales\n from web_sales,date_dim,customer_address, item\n where ws_sold_date_sk = d_date_sk\n  and ws_bill_addr_sk=ca_address_sk\n  and ws_item_sk = i_item_sk\n  and i_color IN ('cornsilk', 'rosy')\n  and i_manager_id BETWEEN 80 and 99\n  and ws_list_price between 248 and 262\n  and ca_state in ('IL','MI')\ngroup by ca_county,d_qoy, d_year)\n select\n        ss1.ca_county\n       ,ss1.d_year\n       ,ws2.web_sales/ws1.web_sales web_q1_q2_increase\n       ,ss2.store_sales/ss1.store_sales store_q1_q2_increase\n       ,ws3.web_sales/ws2.web_sales web_q2_q3_increase\n       ,ss3.store_sales/ss2.store_sales store_q2_q3_increase\n from\n        ss ss1\n       ,ss ss2\n       ,ss ss3\n       ,ws ws1\n       ,ws ws2\n       ,ws ws3\n where\n    ss1.d_qoy = 1\n    and ss1.d_year = 2002\n    and ss1.ca_county = ss2.ca_county\n    and ss2.d_qoy = 2\n    and ss2.d_year = 2002\n and ss2.ca_county = ss3.ca_county\n    and ss3.d_qoy = 3\n    and ss3.d_year = 2002\n    and ss1.ca_county = ws1.ca_county\n    and ws1.d_qoy = 1\n    and ws1.d_year = 2002\n    and ws1.ca_county = ws2.ca_county\n    and ws2.d_qoy = 2\n    and ws2.d_year = 2002\n    and ws1.ca_county = ws3.ca_county\n    and ws3.d_qoy = 3\n    and ws3.d_year =2002\n    and case when ws1.web_sales > 0 then ws2.web_sales/ws1.web_sales else null end\n       > case when ss1.store_sales > 0 then ss2.store_sales/ss1.store_sales else null end\n    and case when ws2.web_sales > 0 then ws3.web_sales/ws2.web_sales else null end\n       > case when ss2.store_sales > 0 then ss3.store_sales/ss2.store_sales else null end\n order by web_q1_q2_increase;", "input_cost": 71.14, "output_sql": "SELECT \"t11\".\"ca_county\", CAST(2002 AS INTEGER) AS \"d_year10\", \"t63\".\"web_sales0\" / \"t50\".\"web_sales\" AS \"web_q1_q2_increase\", \"t24\".\"store_sales\" / \"t11\".\"store_sales\" AS \"store_q1_q2_increase\", \"t76\".\"web_sales1\" / \"t63\".\"web_sales0\" AS \"web_q2_q3_increase\", \"t37\".\"store_sales0\" / \"t24\".\"store_sales\" AS \"store_q2_q3_increase\"\r\nFROM (SELECT \"t6\".\"ca_county\", CAST(1 AS INTEGER) AS \"d_qoy\", CAST(2002 AS INTEGER) AS \"d_year\", CASE WHEN COALESCE(SUM(\"t6\".\"$f3\"), 0) = 0 THEN NULL ELSE COALESCE(SUM(\"t6\".\"store_sales\"), 0) END AS \"store_sales\"\r\n        FROM (SELECT \"t3\".\"ss_item_sk\", \"t5\".\"ca_county\", COALESCE(SUM(\"t3\".\"store_sales\"), 0) AS \"store_sales\", COALESCE(SUM(\"t3\".\"$f3\"), 0) AS \"$f3\"\r\n                FROM (SELECT \"t0\".\"ss_item_sk\", \"t0\".\"ss_addr_sk\", COALESCE(SUM(\"t0\".\"store_sales\"), 0) AS \"store_sales\", COALESCE(SUM(\"t0\".\"$f4\"), 0) AS \"$f3\"\r\n                        FROM (SELECT \"ss_sold_date_sk\", \"ss_item_sk\", \"ss_addr_sk\", COALESCE(SUM(\"ss_ext_sales_price\"), 0) AS \"store_sales\", COUNT(\"ss_ext_sales_price\") AS \"$f4\"\r\n                                FROM \"store_sales\"\r\n                                WHERE \"ss_list_price\" >= 248 AND \"ss_list_price\" <= 262\r\n                                GROUP BY \"ss_sold_date_sk\", \"ss_item_sk\", \"ss_addr_sk\") AS \"t0\"\r\n                            INNER JOIN (SELECT \"d_date_sk\"\r\n                                FROM \"date_dim\"\r\n                                WHERE \"d_qoy\" = 1 AND \"d_year\" = 2002) AS \"t2\" ON \"t0\".\"ss_sold_date_sk\" = \"t2\".\"d_date_sk\"\r\n                        GROUP BY \"t0\".\"ss_item_sk\", \"t0\".\"ss_addr_sk\") AS \"t3\"\r\n                    INNER JOIN (SELECT \"ca_address_sk\", \"ca_county\"\r\n                        FROM \"customer_address\"\r\n                        WHERE CAST(\"ca_state\" AS CHAR(2)) IN ('IL', 'MI')) AS \"t5\" ON \"t3\".\"ss_addr_sk\" = \"t5\".\"ca_address_sk\"\r\n                GROUP BY \"t3\".\"ss_item_sk\", \"t5\".\"ca_county\") AS \"t6\"\r\n            INNER JOIN (SELECT \"i_item_sk\"\r\n                FROM \"item\"\r\n                WHERE (\"i_color\" = 'cornsilk' OR \"i_color\" = 'rosy') AND (\"i_manager_id\" >= 80 AND \"i_manager_id\" <= 99)) AS \"t8\" ON \"t6\".\"ss_item_sk\" = \"t8\".\"i_item_sk\"\r\n        GROUP BY \"t6\".\"ca_county\") AS \"t11\"\r\n    INNER JOIN (SELECT \"t19\".\"ca_county0\", CAST(2 AS INTEGER) AS \"d_qoy1\", CAST(2002 AS INTEGER) AS \"d_year1\", CASE WHEN COALESCE(SUM(\"t19\".\"$f3\"), 0) = 0 THEN NULL ELSE COALESCE(SUM(\"t19\".\"store_sales\"), 0) END AS \"store_sales\"\r\n        FROM (SELECT \"t16\".\"ss_item_sk0\", \"t18\".\"ca_county0\", COALESCE(SUM(\"t16\".\"store_sales\"), 0) AS \"store_sales\", COALESCE(SUM(\"t16\".\"$f3\"), 0) AS \"$f3\"\r\n                FROM (SELECT \"t13\".\"ss_item_sk0\", \"t13\".\"ss_addr_sk0\", COALESCE(SUM(\"t13\".\"store_sales\"), 0) AS \"store_sales\", COALESCE(SUM(\"t13\".\"$f4\"), 0) AS \"$f3\"\r\n                        FROM (SELECT \"ss_sold_date_sk0\", \"ss_item_sk0\", \"ss_addr_sk0\", COALESCE(SUM(\"ss_ext_sales_price0\"), 0) AS \"store_sales\", COUNT(\"ss_ext_sales_price0\") AS \"$f4\"\r\n                                FROM \"store_sales\" AS \"store_sales0\" (\"ss_sold_date_sk0\", \"ss_sold_time_sk0\", \"ss_item_sk0\", \"ss_customer_sk0\", \"ss_cdemo_sk0\", \"ss_hdemo_sk0\", \"ss_addr_sk0\", \"ss_store_sk0\", \"ss_promo_sk0\", \"ss_ticket_number0\", \"ss_quantity0\", \"ss_wholesale_cost0\", \"ss_list_price0\", \"ss_sales_price0\", \"ss_ext_discount_amt0\", \"ss_ext_sales_price0\", \"ss_ext_wholesale_cost0\", \"ss_ext_list_price0\", \"ss_ext_tax0\", \"ss_coupon_amt0\", \"ss_net_paid0\", \"ss_net_paid_inc_tax0\", \"ss_net_profit0\")\r\n                                WHERE \"ss_list_price0\" >= 248 AND \"ss_list_price0\" <= 262\r\n                                GROUP BY \"ss_sold_date_sk0\", \"ss_item_sk0\", \"ss_addr_sk0\") AS \"t13\"\r\n                            INNER JOIN (SELECT \"d_date_sk0\"\r\n                                FROM \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\")\r\n                                WHERE \"d_qoy0\" = 2 AND \"d_year0\" = 2002) AS \"t15\" ON \"t13\".\"ss_sold_date_sk0\" = \"t15\".\"d_date_sk0\"\r\n                        GROUP BY \"t13\".\"ss_item_sk0\", \"t13\".\"ss_addr_sk0\") AS \"t16\"\r\n                    INNER JOIN (SELECT \"ca_address_sk0\", \"ca_county0\"\r\n                        FROM \"customer_address\" AS \"customer_address0\" (\"ca_address_sk0\", \"ca_address_id0\", \"ca_street_number0\", \"ca_street_name0\", \"ca_street_type0\", \"ca_suite_number0\", \"ca_city0\", \"ca_county0\", \"ca_state0\", \"ca_zip0\", \"ca_country0\", \"ca_gmt_offset0\", \"ca_location_type0\")\r\n                        WHERE CAST(\"ca_state0\" AS CHAR(2)) IN ('IL', 'MI')) AS \"t18\" ON \"t16\".\"ss_addr_sk0\" = \"t18\".\"ca_address_sk0\"\r\n                GROUP BY \"t16\".\"ss_item_sk0\", \"t18\".\"ca_county0\") AS \"t19\"\r\n            INNER JOIN (SELECT \"i_item_sk0\"\r\n                FROM \"item\" AS \"item0\" (\"i_item_sk0\", \"i_item_id0\", \"i_rec_start_date0\", \"i_rec_end_date0\", \"i_item_desc0\", \"i_current_price0\", \"i_wholesale_cost0\", \"i_brand_id0\", \"i_brand0\", \"i_class_id0\", \"i_class0\", \"i_category_id0\", \"i_category0\", \"i_manufact_id0\", \"i_manufact0\", \"i_size0\", \"i_formulation0\", \"i_color0\", \"i_units0\", \"i_container0\", \"i_manager_id0\", \"i_product_name0\")\r\n                WHERE (\"i_color0\" = 'cornsilk' OR \"i_color0\" = 'rosy') AND (\"i_manager_id0\" >= 80 AND \"i_manager_id0\" <= 99)) AS \"t21\" ON \"t19\".\"ss_item_sk0\" = \"t21\".\"i_item_sk0\"\r\n        GROUP BY \"t19\".\"ca_county0\") AS \"t24\" ON \"t11\".\"ca_county\" = \"t24\".\"ca_county0\"\r\n    INNER JOIN (SELECT \"t32\".\"ca_county1\", CAST(3 AS INTEGER) AS \"d_qoy3\", CAST(2002 AS INTEGER) AS \"d_year3\", CASE WHEN COALESCE(SUM(\"t32\".\"$f3\"), 0) = 0 THEN NULL ELSE COALESCE(SUM(\"t32\".\"store_sales\"), 0) END AS \"store_sales0\"\r\n        FROM (SELECT \"t29\".\"ss_item_sk1\", \"t31\".\"ca_county1\", COALESCE(SUM(\"t29\".\"store_sales\"), 0) AS \"store_sales\", COALESCE(SUM(\"t29\".\"$f3\"), 0) AS \"$f3\"\r\n                FROM (SELECT \"t26\".\"ss_item_sk1\", \"t26\".\"ss_addr_sk1\", COALESCE(SUM(\"t26\".\"store_sales\"), 0) AS \"store_sales\", COALESCE(SUM(\"t26\".\"$f4\"), 0) AS \"$f3\"\r\n                        FROM (SELECT \"ss_sold_date_sk1\", \"ss_item_sk1\", \"ss_addr_sk1\", COALESCE(SUM(\"ss_ext_sales_price1\"), 0) AS \"store_sales\", COUNT(\"ss_ext_sales_price1\") AS \"$f4\"\r\n                                FROM \"store_sales\" AS \"store_sales1\" (\"ss_sold_date_sk1\", \"ss_sold_time_sk1\", \"ss_item_sk1\", \"ss_customer_sk1\", \"ss_cdemo_sk1\", \"ss_hdemo_sk1\", \"ss_addr_sk1\", \"ss_store_sk1\", \"ss_promo_sk1\", \"ss_ticket_number1\", \"ss_quantity1\", \"ss_wholesale_cost1\", \"ss_list_price1\", \"ss_sales_price1\", \"ss_ext_discount_amt1\", \"ss_ext_sales_price1\", \"ss_ext_wholesale_cost1\", \"ss_ext_list_price1\", \"ss_ext_tax1\", \"ss_coupon_amt1\", \"ss_net_paid1\", \"ss_net_paid_inc_tax1\", \"ss_net_profit1\")\r\n                                WHERE \"ss_list_price1\" >= 248 AND \"ss_list_price1\" <= 262\r\n                                GROUP BY \"ss_sold_date_sk1\", \"ss_item_sk1\", \"ss_addr_sk1\") AS \"t26\"\r\n                            INNER JOIN (SELECT \"d_date_sk1\"\r\n                                FROM \"date_dim\" AS \"date_dim1\" (\"d_date_sk1\", \"d_date_id1\", \"d_date1\", \"d_month_seq1\", \"d_week_seq1\", \"d_quarter_seq1\", \"d_year2\", \"d_dow1\", \"d_moy1\", \"d_dom1\", \"d_qoy2\", \"d_fy_year1\", \"d_fy_quarter_seq1\", \"d_fy_week_seq1\", \"d_day_name1\", \"d_quarter_name1\", \"d_holiday1\", \"d_weekend1\", \"d_following_holiday1\", \"d_first_dom1\", \"d_last_dom1\", \"d_same_day_ly1\", \"d_same_day_lq1\", \"d_current_day1\", \"d_current_week1\", \"d_current_month1\", \"d_current_quarter1\", \"d_current_year1\")\r\n                                WHERE \"d_qoy2\" = 3 AND \"d_year2\" = 2002) AS \"t28\" ON \"t26\".\"ss_sold_date_sk1\" = \"t28\".\"d_date_sk1\"\r\n                        GROUP BY \"t26\".\"ss_item_sk1\", \"t26\".\"ss_addr_sk1\") AS \"t29\"\r\n                    INNER JOIN (SELECT \"ca_address_sk1\", \"ca_county1\"\r\n                        FROM \"customer_address\" AS \"customer_address1\" (\"ca_address_sk1\", \"ca_address_id1\", \"ca_street_number1\", \"ca_street_name1\", \"ca_street_type1\", \"ca_suite_number1\", \"ca_city1\", \"ca_county1\", \"ca_state1\", \"ca_zip1\", \"ca_country1\", \"ca_gmt_offset1\", \"ca_location_type1\")\r\n                        WHERE CAST(\"ca_state1\" AS CHAR(2)) IN ('IL', 'MI')) AS \"t31\" ON \"t29\".\"ss_addr_sk1\" = \"t31\".\"ca_address_sk1\"\r\n                GROUP BY \"t29\".\"ss_item_sk1\", \"t31\".\"ca_county1\") AS \"t32\"\r\n            INNER JOIN (SELECT \"i_item_sk1\"\r\n                FROM \"item\" AS \"item1\" (\"i_item_sk1\", \"i_item_id1\", \"i_rec_start_date1\", \"i_rec_end_date1\", \"i_item_desc1\", \"i_current_price1\", \"i_wholesale_cost1\", \"i_brand_id1\", \"i_brand1\", \"i_class_id1\", \"i_class1\", \"i_category_id1\", \"i_category1\", \"i_manufact_id1\", \"i_manufact1\", \"i_size1\", \"i_formulation1\", \"i_color1\", \"i_units1\", \"i_container1\", \"i_manager_id1\", \"i_product_name1\")\r\n                WHERE (\"i_color1\" = 'cornsilk' OR \"i_color1\" = 'rosy') AND (\"i_manager_id1\" >= 80 AND \"i_manager_id1\" <= 99)) AS \"t34\" ON \"t32\".\"ss_item_sk1\" = \"t34\".\"i_item_sk1\"\r\n        GROUP BY \"t32\".\"ca_county1\") AS \"t37\" ON \"t24\".\"ca_county0\" = \"t37\".\"ca_county1\"\r\n    INNER JOIN (SELECT \"t45\".\"ca_county2\", CAST(1 AS INTEGER) AS \"d_qoy5\", CAST(2002 AS INTEGER) AS \"d_year5\", CASE WHEN COALESCE(SUM(\"t45\".\"$f3\"), 0) = 0 THEN NULL ELSE COALESCE(SUM(\"t45\".\"web_sales\"), 0) END AS \"web_sales\"\r\n        FROM (SELECT \"t42\".\"ws_item_sk\", \"t44\".\"ca_county2\", COALESCE(SUM(\"t42\".\"web_sales\"), 0) AS \"web_sales\", COALESCE(SUM(\"t42\".\"$f3\"), 0) AS \"$f3\"\r\n                FROM (SELECT \"t39\".\"ws_item_sk\", \"t39\".\"ws_bill_addr_sk\", COALESCE(SUM(\"t39\".\"web_sales\"), 0) AS \"web_sales\", COALESCE(SUM(\"t39\".\"$f4\"), 0) AS \"$f3\"\r\n                        FROM (SELECT \"ws_sold_date_sk\", \"ws_item_sk\", \"ws_bill_addr_sk\", COALESCE(SUM(\"ws_ext_sales_price\"), 0) AS \"web_sales\", COUNT(\"ws_ext_sales_price\") AS \"$f4\"\r\n                                FROM \"web_sales\"\r\n                                WHERE \"ws_list_price\" >= 248 AND \"ws_list_price\" <= 262\r\n                                GROUP BY \"ws_sold_date_sk\", \"ws_item_sk\", \"ws_bill_addr_sk\") AS \"t39\"\r\n                            INNER JOIN (SELECT \"d_date_sk2\"\r\n                                FROM \"date_dim\" AS \"date_dim2\" (\"d_date_sk2\", \"d_date_id2\", \"d_date2\", \"d_month_seq2\", \"d_week_seq2\", \"d_quarter_seq2\", \"d_year4\", \"d_dow2\", \"d_moy2\", \"d_dom2\", \"d_qoy4\", \"d_fy_year2\", \"d_fy_quarter_seq2\", \"d_fy_week_seq2\", \"d_day_name2\", \"d_quarter_name2\", \"d_holiday2\", \"d_weekend2\", \"d_following_holiday2\", \"d_first_dom2\", \"d_last_dom2\", \"d_same_day_ly2\", \"d_same_day_lq2\", \"d_current_day2\", \"d_current_week2\", \"d_current_month2\", \"d_current_quarter2\", \"d_current_year2\")\r\n                                WHERE \"d_qoy4\" = 1 AND \"d_year4\" = 2002) AS \"t41\" ON \"t39\".\"ws_sold_date_sk\" = \"t41\".\"d_date_sk2\"\r\n                        GROUP BY \"t39\".\"ws_item_sk\", \"t39\".\"ws_bill_addr_sk\") AS \"t42\"\r\n                    INNER JOIN (SELECT \"ca_address_sk2\", \"ca_county2\"\r\n                        FROM \"customer_address\" AS \"customer_address2\" (\"ca_address_sk2\", \"ca_address_id2\", \"ca_street_number2\", \"ca_street_name2\", \"ca_street_type2\", \"ca_suite_number2\", \"ca_city2\", \"ca_county2\", \"ca_state2\", \"ca_zip2\", \"ca_country2\", \"ca_gmt_offset2\", \"ca_location_type2\")\r\n                        WHERE CAST(\"ca_state2\" AS CHAR(2)) IN ('IL', 'MI')) AS \"t44\" ON \"t42\".\"ws_bill_addr_sk\" = \"t44\".\"ca_address_sk2\"\r\n                GROUP BY \"t42\".\"ws_item_sk\", \"t44\".\"ca_county2\") AS \"t45\"\r\n            INNER JOIN (SELECT \"i_item_sk2\"\r\n                FROM \"item\" AS \"item2\" (\"i_item_sk2\", \"i_item_id2\", \"i_rec_start_date2\", \"i_rec_end_date2\", \"i_item_desc2\", \"i_current_price2\", \"i_wholesale_cost2\", \"i_brand_id2\", \"i_brand2\", \"i_class_id2\", \"i_class2\", \"i_category_id2\", \"i_category2\", \"i_manufact_id2\", \"i_manufact2\", \"i_size2\", \"i_formulation2\", \"i_color2\", \"i_units2\", \"i_container2\", \"i_manager_id2\", \"i_product_name2\")\r\n                WHERE (\"i_color2\" = 'cornsilk' OR \"i_color2\" = 'rosy') AND (\"i_manager_id2\" >= 80 AND \"i_manager_id2\" <= 99)) AS \"t47\" ON \"t45\".\"ws_item_sk\" = \"t47\".\"i_item_sk2\"\r\n        GROUP BY \"t45\".\"ca_county2\") AS \"t50\" ON \"t11\".\"ca_county\" = \"t50\".\"ca_county2\"\r\n    INNER JOIN (SELECT \"t58\".\"ca_county3\", CAST(2 AS INTEGER) AS \"d_qoy7\", CAST(2002 AS INTEGER) AS \"d_year7\", CASE WHEN COALESCE(SUM(\"t58\".\"$f3\"), 0) = 0 THEN NULL ELSE COALESCE(SUM(\"t58\".\"web_sales\"), 0) END AS \"web_sales0\"\r\n        FROM (SELECT \"t55\".\"ws_item_sk0\", \"t57\".\"ca_county3\", COALESCE(SUM(\"t55\".\"web_sales\"), 0) AS \"web_sales\", COALESCE(SUM(\"t55\".\"$f3\"), 0) AS \"$f3\"\r\n                FROM (SELECT \"t52\".\"ws_item_sk0\", \"t52\".\"ws_bill_addr_sk0\", COALESCE(SUM(\"t52\".\"web_sales\"), 0) AS \"web_sales\", COALESCE(SUM(\"t52\".\"$f4\"), 0) AS \"$f3\"\r\n                        FROM (SELECT \"ws_sold_date_sk0\", \"ws_item_sk0\", \"ws_bill_addr_sk0\", COALESCE(SUM(\"ws_ext_sales_price0\"), 0) AS \"web_sales\", COUNT(\"ws_ext_sales_price0\") AS \"$f4\"\r\n                                FROM \"web_sales\" AS \"web_sales0\" (\"ws_sold_date_sk0\", \"ws_sold_time_sk0\", \"ws_ship_date_sk0\", \"ws_item_sk0\", \"ws_bill_customer_sk0\", \"ws_bill_cdemo_sk0\", \"ws_bill_hdemo_sk0\", \"ws_bill_addr_sk0\", \"ws_ship_customer_sk0\", \"ws_ship_cdemo_sk0\", \"ws_ship_hdemo_sk0\", \"ws_ship_addr_sk0\", \"ws_web_page_sk0\", \"ws_web_site_sk0\", \"ws_ship_mode_sk0\", \"ws_warehouse_sk0\", \"ws_promo_sk0\", \"ws_order_number0\", \"ws_quantity0\", \"ws_wholesale_cost0\", \"ws_list_price0\", \"ws_sales_price0\", \"ws_ext_discount_amt0\", \"ws_ext_sales_price0\", \"ws_ext_wholesale_cost0\", \"ws_ext_list_price0\", \"ws_ext_tax0\", \"ws_coupon_amt0\", \"ws_ext_ship_cost0\", \"ws_net_paid0\", \"ws_net_paid_inc_tax0\", \"ws_net_paid_inc_ship0\", \"ws_net_paid_inc_ship_tax0\", \"ws_net_profit0\")\r\n                                WHERE \"ws_list_price0\" >= 248 AND \"ws_list_price0\" <= 262\r\n                                GROUP BY \"ws_sold_date_sk0\", \"ws_item_sk0\", \"ws_bill_addr_sk0\") AS \"t52\"\r\n                            INNER JOIN (SELECT \"d_date_sk3\"\r\n                                FROM \"date_dim\" AS \"date_dim3\" (\"d_date_sk3\", \"d_date_id3\", \"d_date3\", \"d_month_seq3\", \"d_week_seq3\", \"d_quarter_seq3\", \"d_year6\", \"d_dow3\", \"d_moy3\", \"d_dom3\", \"d_qoy6\", \"d_fy_year3\", \"d_fy_quarter_seq3\", \"d_fy_week_seq3\", \"d_day_name3\", \"d_quarter_name3\", \"d_holiday3\", \"d_weekend3\", \"d_following_holiday3\", \"d_first_dom3\", \"d_last_dom3\", \"d_same_day_ly3\", \"d_same_day_lq3\", \"d_current_day3\", \"d_current_week3\", \"d_current_month3\", \"d_current_quarter3\", \"d_current_year3\")\r\n                                WHERE \"d_qoy6\" = 2 AND \"d_year6\" = 2002) AS \"t54\" ON \"t52\".\"ws_sold_date_sk0\" = \"t54\".\"d_date_sk3\"\r\n                        GROUP BY \"t52\".\"ws_item_sk0\", \"t52\".\"ws_bill_addr_sk0\") AS \"t55\"\r\n                    INNER JOIN (SELECT \"ca_address_sk3\", \"ca_county3\"\r\n                        FROM \"customer_address\" AS \"customer_address3\" (\"ca_address_sk3\", \"ca_address_id3\", \"ca_street_number3\", \"ca_street_name3\", \"ca_street_type3\", \"ca_suite_number3\", \"ca_city3\", \"ca_county3\", \"ca_state3\", \"ca_zip3\", \"ca_country3\", \"ca_gmt_offset3\", \"ca_location_type3\")\r\n                        WHERE CAST(\"ca_state3\" AS CHAR(2)) IN ('IL', 'MI')) AS \"t57\" ON \"t55\".\"ws_bill_addr_sk0\" = \"t57\".\"ca_address_sk3\"\r\n                GROUP BY \"t55\".\"ws_item_sk0\", \"t57\".\"ca_county3\") AS \"t58\"\r\n            INNER JOIN (SELECT \"i_item_sk3\"\r\n                FROM \"item\" AS \"item3\" (\"i_item_sk3\", \"i_item_id3\", \"i_rec_start_date3\", \"i_rec_end_date3\", \"i_item_desc3\", \"i_current_price3\", \"i_wholesale_cost3\", \"i_brand_id3\", \"i_brand3\", \"i_class_id3\", \"i_class3\", \"i_category_id3\", \"i_category3\", \"i_manufact_id3\", \"i_manufact3\", \"i_size3\", \"i_formulation3\", \"i_color3\", \"i_units3\", \"i_container3\", \"i_manager_id3\", \"i_product_name3\")\r\n                WHERE (\"i_color3\" = 'cornsilk' OR \"i_color3\" = 'rosy') AND (\"i_manager_id3\" >= 80 AND \"i_manager_id3\" <= 99)) AS \"t60\" ON \"t58\".\"ws_item_sk0\" = \"t60\".\"i_item_sk3\"\r\n        GROUP BY \"t58\".\"ca_county3\") AS \"t63\" ON \"t50\".\"ca_county2\" = \"t63\".\"ca_county3\" AND CASE WHEN \"t11\".\"store_sales\" > 0 THEN CASE WHEN \"t50\".\"web_sales\" > 0 THEN \"t63\".\"web_sales0\" / \"t50\".\"web_sales\" > \"t24\".\"store_sales\" / \"t11\".\"store_sales\" ELSE FALSE END ELSE FALSE END\r\n    INNER JOIN (SELECT \"t71\".\"ca_county4\", CAST(3 AS INTEGER) AS \"d_qoy9\", CAST(2002 AS INTEGER) AS \"d_year9\", CASE WHEN COALESCE(SUM(\"t71\".\"$f3\"), 0) = 0 THEN NULL ELSE COALESCE(SUM(\"t71\".\"web_sales\"), 0) END AS \"web_sales1\"\r\n        FROM (SELECT \"t68\".\"ws_item_sk1\", \"t70\".\"ca_county4\", COALESCE(SUM(\"t68\".\"web_sales\"), 0) AS \"web_sales\", COALESCE(SUM(\"t68\".\"$f3\"), 0) AS \"$f3\"\r\n                FROM (SELECT \"t65\".\"ws_item_sk1\", \"t65\".\"ws_bill_addr_sk1\", COALESCE(SUM(\"t65\".\"web_sales\"), 0) AS \"web_sales\", COALESCE(SUM(\"t65\".\"$f4\"), 0) AS \"$f3\"\r\n                        FROM (SELECT \"ws_sold_date_sk1\", \"ws_item_sk1\", \"ws_bill_addr_sk1\", COALESCE(SUM(\"ws_ext_sales_price1\"), 0) AS \"web_sales\", COUNT(\"ws_ext_sales_price1\") AS \"$f4\"\r\n                                FROM \"web_sales\" AS \"web_sales1\" (\"ws_sold_date_sk1\", \"ws_sold_time_sk1\", \"ws_ship_date_sk1\", \"ws_item_sk1\", \"ws_bill_customer_sk1\", \"ws_bill_cdemo_sk1\", \"ws_bill_hdemo_sk1\", \"ws_bill_addr_sk1\", \"ws_ship_customer_sk1\", \"ws_ship_cdemo_sk1\", \"ws_ship_hdemo_sk1\", \"ws_ship_addr_sk1\", \"ws_web_page_sk1\", \"ws_web_site_sk1\", \"ws_ship_mode_sk1\", \"ws_warehouse_sk1\", \"ws_promo_sk1\", \"ws_order_number1\", \"ws_quantity1\", \"ws_wholesale_cost1\", \"ws_list_price1\", \"ws_sales_price1\", \"ws_ext_discount_amt1\", \"ws_ext_sales_price1\", \"ws_ext_wholesale_cost1\", \"ws_ext_list_price1\", \"ws_ext_tax1\", \"ws_coupon_amt1\", \"ws_ext_ship_cost1\", \"ws_net_paid1\", \"ws_net_paid_inc_tax1\", \"ws_net_paid_inc_ship1\", \"ws_net_paid_inc_ship_tax1\", \"ws_net_profit1\")\r\n                                WHERE \"ws_list_price1\" >= 248 AND \"ws_list_price1\" <= 262\r\n                                GROUP BY \"ws_sold_date_sk1\", \"ws_item_sk1\", \"ws_bill_addr_sk1\") AS \"t65\"\r\n                            INNER JOIN (SELECT \"d_date_sk4\"\r\n                                FROM \"date_dim\" AS \"date_dim4\" (\"d_date_sk4\", \"d_date_id4\", \"d_date4\", \"d_month_seq4\", \"d_week_seq4\", \"d_quarter_seq4\", \"d_year8\", \"d_dow4\", \"d_moy4\", \"d_dom4\", \"d_qoy8\", \"d_fy_year4\", \"d_fy_quarter_seq4\", \"d_fy_week_seq4\", \"d_day_name4\", \"d_quarter_name4\", \"d_holiday4\", \"d_weekend4\", \"d_following_holiday4\", \"d_first_dom4\", \"d_last_dom4\", \"d_same_day_ly4\", \"d_same_day_lq4\", \"d_current_day4\", \"d_current_week4\", \"d_current_month4\", \"d_current_quarter4\", \"d_current_year4\")\r\n                                WHERE \"d_qoy8\" = 3 AND \"d_year8\" = 2002) AS \"t67\" ON \"t65\".\"ws_sold_date_sk1\" = \"t67\".\"d_date_sk4\"\r\n                        GROUP BY \"t65\".\"ws_item_sk1\", \"t65\".\"ws_bill_addr_sk1\") AS \"t68\"\r\n                    INNER JOIN (SELECT \"ca_address_sk4\", \"ca_county4\"\r\n                        FROM \"customer_address\" AS \"customer_address4\" (\"ca_address_sk4\", \"ca_address_id4\", \"ca_street_number4\", \"ca_street_name4\", \"ca_street_type4\", \"ca_suite_number4\", \"ca_city4\", \"ca_county4\", \"ca_state4\", \"ca_zip4\", \"ca_country4\", \"ca_gmt_offset4\", \"ca_location_type4\")\r\n                        WHERE CAST(\"ca_state4\" AS CHAR(2)) IN ('IL', 'MI')) AS \"t70\" ON \"t68\".\"ws_bill_addr_sk1\" = \"t70\".\"ca_address_sk4\"\r\n                GROUP BY \"t68\".\"ws_item_sk1\", \"t70\".\"ca_county4\") AS \"t71\"\r\n            INNER JOIN (SELECT \"i_item_sk4\"\r\n                FROM \"item\" AS \"item4\" (\"i_item_sk4\", \"i_item_id4\", \"i_rec_start_date4\", \"i_rec_end_date4\", \"i_item_desc4\", \"i_current_price4\", \"i_wholesale_cost4\", \"i_brand_id4\", \"i_brand4\", \"i_class_id4\", \"i_class4\", \"i_category_id4\", \"i_category4\", \"i_manufact_id4\", \"i_manufact4\", \"i_size4\", \"i_formulation4\", \"i_color4\", \"i_units4\", \"i_container4\", \"i_manager_id4\", \"i_product_name4\")\r\n                WHERE (\"i_color4\" = 'cornsilk' OR \"i_color4\" = 'rosy') AND (\"i_manager_id4\" >= 80 AND \"i_manager_id4\" <= 99)) AS \"t73\" ON \"t71\".\"ws_item_sk1\" = \"t73\".\"i_item_sk4\"\r\n        GROUP BY \"t71\".\"ca_county4\") AS \"t76\" ON \"t50\".\"ca_county2\" = \"t76\".\"ca_county4\" AND CASE WHEN \"t24\".\"store_sales\" > 0 THEN CASE WHEN \"t63\".\"web_sales0\" > 0 THEN \"t76\".\"web_sales1\" / \"t63\".\"web_sales0\" > \"t37\".\"store_sales0\" / \"t24\".\"store_sales\" ELSE FALSE END ELSE FALSE END\r\nORDER BY 3;", "output_cost": 260.03, "used_rules": ["FILTER_INTO_JOIN", "FILTER_AGGREGATE_TRANSPOSE", "FILTER_PROJECT_TRANSPOSE", "PROJECT_REDUCE_EXPRESSIONS", "FILTER_INTO_JOIN", "AGGREGATE_ANY_PULL_UP_CONSTANTS", "AGGREGATE_REDUCE_FUNCTIONS", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_JOIN_TRANSPOSE_EXTENDED", "JOIN_REDUCE_EXPRESSIONS"], "rewrite_time": 5595}
{"name": "query031_1", "input_sql": "with ss as\n (select ca_county,d_qoy, d_year,sum(ss_ext_sales_price) as store_sales\n from store_sales,date_dim,customer_address, item\n where ss_sold_date_sk = d_date_sk\n  and ss_addr_sk=ca_address_sk\n  and ss_item_sk = i_item_sk\n  and i_color IN ('mint', 'thistle')\n  and i_manager_id BETWEEN 13 and 32\n  and ss_list_price between 107 and 121\n  and ca_state in ('KS','ND')\n group by ca_county,d_qoy, d_year),\n ws as\n (select ca_county,d_qoy, d_year,sum(ws_ext_sales_price) as web_sales\n from web_sales,date_dim,customer_address, item\n where ws_sold_date_sk = d_date_sk\n  and ws_bill_addr_sk=ca_address_sk\n  and ws_item_sk = i_item_sk\n  and i_color IN ('mint', 'thistle')\n  and i_manager_id BETWEEN 13 and 32\n  and ws_list_price between 107 and 121\n  and ca_state in ('KS','ND')\ngroup by ca_county,d_qoy, d_year)\n select\n        ss1.ca_county\n       ,ss1.d_year\n       ,ws2.web_sales/ws1.web_sales web_q1_q2_increase\n       ,ss2.store_sales/ss1.store_sales store_q1_q2_increase\n       ,ws3.web_sales/ws2.web_sales web_q2_q3_increase\n       ,ss3.store_sales/ss2.store_sales store_q2_q3_increase\n from\n        ss ss1\n       ,ss ss2\n       ,ss ss3\n       ,ws ws1\n       ,ws ws2\n       ,ws ws3\n where\n    ss1.d_qoy = 1\n    and ss1.d_year = 1998\n    and ss1.ca_county = ss2.ca_county\n    and ss2.d_qoy = 2\n    and ss2.d_year = 1998\n and ss2.ca_county = ss3.ca_county\n    and ss3.d_qoy = 3\n    and ss3.d_year = 1998\n    and ss1.ca_county = ws1.ca_county\n    and ws1.d_qoy = 1\n    and ws1.d_year = 1998\n    and ws1.ca_county = ws2.ca_county\n    and ws2.d_qoy = 2\n    and ws2.d_year = 1998\n    and ws1.ca_county = ws3.ca_county\n    and ws3.d_qoy = 3\n    and ws3.d_year =1998\n    and case when ws1.web_sales > 0 then ws2.web_sales/ws1.web_sales else null end\n       > case when ss1.store_sales > 0 then ss2.store_sales/ss1.store_sales else null end\n    and case when ws2.web_sales > 0 then ws3.web_sales/ws2.web_sales else null end\n       > case when ss2.store_sales > 0 then ss3.store_sales/ss2.store_sales else null end\n order by web_q2_q3_increase;", "input_cost": 71.14, "output_sql": "SELECT \"t11\".\"ca_county\", CAST(1998 AS INTEGER) AS \"d_year10\", \"t63\".\"web_sales0\" / \"t50\".\"web_sales\" AS \"web_q1_q2_increase\", \"t24\".\"store_sales\" / \"t11\".\"store_sales\" AS \"store_q1_q2_increase\", \"t76\".\"web_sales1\" / \"t63\".\"web_sales0\" AS \"web_q2_q3_increase\", \"t37\".\"store_sales0\" / \"t24\".\"store_sales\" AS \"store_q2_q3_increase\"\r\nFROM (SELECT \"t6\".\"ca_county\", CAST(1 AS INTEGER) AS \"d_qoy\", CAST(1998 AS INTEGER) AS \"d_year\", CASE WHEN COALESCE(SUM(\"t6\".\"$f3\"), 0) = 0 THEN NULL ELSE COALESCE(SUM(\"t6\".\"store_sales\"), 0) END AS \"store_sales\"\r\n        FROM (SELECT \"t3\".\"ss_item_sk\", \"t5\".\"ca_county\", COALESCE(SUM(\"t3\".\"store_sales\"), 0) AS \"store_sales\", COALESCE(SUM(\"t3\".\"$f3\"), 0) AS \"$f3\"\r\n                FROM (SELECT \"t0\".\"ss_item_sk\", \"t0\".\"ss_addr_sk\", COALESCE(SUM(\"t0\".\"store_sales\"), 0) AS \"store_sales\", COALESCE(SUM(\"t0\".\"$f4\"), 0) AS \"$f3\"\r\n                        FROM (SELECT \"ss_sold_date_sk\", \"ss_item_sk\", \"ss_addr_sk\", COALESCE(SUM(\"ss_ext_sales_price\"), 0) AS \"store_sales\", COUNT(\"ss_ext_sales_price\") AS \"$f4\"\r\n                                FROM \"store_sales\"\r\n                                WHERE \"ss_list_price\" >= 107 AND \"ss_list_price\" <= 121\r\n                                GROUP BY \"ss_sold_date_sk\", \"ss_item_sk\", \"ss_addr_sk\") AS \"t0\"\r\n                            INNER JOIN (SELECT \"d_date_sk\"\r\n                                FROM \"date_dim\"\r\n                                WHERE \"d_qoy\" = 1 AND \"d_year\" = 1998) AS \"t2\" ON \"t0\".\"ss_sold_date_sk\" = \"t2\".\"d_date_sk\"\r\n                        GROUP BY \"t0\".\"ss_item_sk\", \"t0\".\"ss_addr_sk\") AS \"t3\"\r\n                    INNER JOIN (SELECT \"ca_address_sk\", \"ca_county\"\r\n                        FROM \"customer_address\"\r\n                        WHERE CAST(\"ca_state\" AS CHAR(2)) IN ('KS', 'ND')) AS \"t5\" ON \"t3\".\"ss_addr_sk\" = \"t5\".\"ca_address_sk\"\r\n                GROUP BY \"t3\".\"ss_item_sk\", \"t5\".\"ca_county\") AS \"t6\"\r\n            INNER JOIN (SELECT \"i_item_sk\"\r\n                FROM \"item\"\r\n                WHERE (\"i_color\" = 'mint' OR \"i_color\" = 'thistle') AND (\"i_manager_id\" >= 13 AND \"i_manager_id\" <= 32)) AS \"t8\" ON \"t6\".\"ss_item_sk\" = \"t8\".\"i_item_sk\"\r\n        GROUP BY \"t6\".\"ca_county\") AS \"t11\"\r\n    INNER JOIN (SELECT \"t19\".\"ca_county0\", CAST(2 AS INTEGER) AS \"d_qoy1\", CAST(1998 AS INTEGER) AS \"d_year1\", CASE WHEN COALESCE(SUM(\"t19\".\"$f3\"), 0) = 0 THEN NULL ELSE COALESCE(SUM(\"t19\".\"store_sales\"), 0) END AS \"store_sales\"\r\n        FROM (SELECT \"t16\".\"ss_item_sk0\", \"t18\".\"ca_county0\", COALESCE(SUM(\"t16\".\"store_sales\"), 0) AS \"store_sales\", COALESCE(SUM(\"t16\".\"$f3\"), 0) AS \"$f3\"\r\n                FROM (SELECT \"t13\".\"ss_item_sk0\", \"t13\".\"ss_addr_sk0\", COALESCE(SUM(\"t13\".\"store_sales\"), 0) AS \"store_sales\", COALESCE(SUM(\"t13\".\"$f4\"), 0) AS \"$f3\"\r\n                        FROM (SELECT \"ss_sold_date_sk0\", \"ss_item_sk0\", \"ss_addr_sk0\", COALESCE(SUM(\"ss_ext_sales_price0\"), 0) AS \"store_sales\", COUNT(\"ss_ext_sales_price0\") AS \"$f4\"\r\n                                FROM \"store_sales\" AS \"store_sales0\" (\"ss_sold_date_sk0\", \"ss_sold_time_sk0\", \"ss_item_sk0\", \"ss_customer_sk0\", \"ss_cdemo_sk0\", \"ss_hdemo_sk0\", \"ss_addr_sk0\", \"ss_store_sk0\", \"ss_promo_sk0\", \"ss_ticket_number0\", \"ss_quantity0\", \"ss_wholesale_cost0\", \"ss_list_price0\", \"ss_sales_price0\", \"ss_ext_discount_amt0\", \"ss_ext_sales_price0\", \"ss_ext_wholesale_cost0\", \"ss_ext_list_price0\", \"ss_ext_tax0\", \"ss_coupon_amt0\", \"ss_net_paid0\", \"ss_net_paid_inc_tax0\", \"ss_net_profit0\")\r\n                                WHERE \"ss_list_price0\" >= 107 AND \"ss_list_price0\" <= 121\r\n                                GROUP BY \"ss_sold_date_sk0\", \"ss_item_sk0\", \"ss_addr_sk0\") AS \"t13\"\r\n                            INNER JOIN (SELECT \"d_date_sk0\"\r\n                                FROM \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\")\r\n                                WHERE \"d_qoy0\" = 2 AND \"d_year0\" = 1998) AS \"t15\" ON \"t13\".\"ss_sold_date_sk0\" = \"t15\".\"d_date_sk0\"\r\n                        GROUP BY \"t13\".\"ss_item_sk0\", \"t13\".\"ss_addr_sk0\") AS \"t16\"\r\n                    INNER JOIN (SELECT \"ca_address_sk0\", \"ca_county0\"\r\n                        FROM \"customer_address\" AS \"customer_address0\" (\"ca_address_sk0\", \"ca_address_id0\", \"ca_street_number0\", \"ca_street_name0\", \"ca_street_type0\", \"ca_suite_number0\", \"ca_city0\", \"ca_county0\", \"ca_state0\", \"ca_zip0\", \"ca_country0\", \"ca_gmt_offset0\", \"ca_location_type0\")\r\n                        WHERE CAST(\"ca_state0\" AS CHAR(2)) IN ('KS', 'ND')) AS \"t18\" ON \"t16\".\"ss_addr_sk0\" = \"t18\".\"ca_address_sk0\"\r\n                GROUP BY \"t16\".\"ss_item_sk0\", \"t18\".\"ca_county0\") AS \"t19\"\r\n            INNER JOIN (SELECT \"i_item_sk0\"\r\n                FROM \"item\" AS \"item0\" (\"i_item_sk0\", \"i_item_id0\", \"i_rec_start_date0\", \"i_rec_end_date0\", \"i_item_desc0\", \"i_current_price0\", \"i_wholesale_cost0\", \"i_brand_id0\", \"i_brand0\", \"i_class_id0\", \"i_class0\", \"i_category_id0\", \"i_category0\", \"i_manufact_id0\", \"i_manufact0\", \"i_size0\", \"i_formulation0\", \"i_color0\", \"i_units0\", \"i_container0\", \"i_manager_id0\", \"i_product_name0\")\r\n                WHERE (\"i_color0\" = 'mint' OR \"i_color0\" = 'thistle') AND (\"i_manager_id0\" >= 13 AND \"i_manager_id0\" <= 32)) AS \"t21\" ON \"t19\".\"ss_item_sk0\" = \"t21\".\"i_item_sk0\"\r\n        GROUP BY \"t19\".\"ca_county0\") AS \"t24\" ON \"t11\".\"ca_county\" = \"t24\".\"ca_county0\"\r\n    INNER JOIN (SELECT \"t32\".\"ca_county1\", CAST(3 AS INTEGER) AS \"d_qoy3\", CAST(1998 AS INTEGER) AS \"d_year3\", CASE WHEN COALESCE(SUM(\"t32\".\"$f3\"), 0) = 0 THEN NULL ELSE COALESCE(SUM(\"t32\".\"store_sales\"), 0) END AS \"store_sales0\"\r\n        FROM (SELECT \"t29\".\"ss_item_sk1\", \"t31\".\"ca_county1\", COALESCE(SUM(\"t29\".\"store_sales\"), 0) AS \"store_sales\", COALESCE(SUM(\"t29\".\"$f3\"), 0) AS \"$f3\"\r\n                FROM (SELECT \"t26\".\"ss_item_sk1\", \"t26\".\"ss_addr_sk1\", COALESCE(SUM(\"t26\".\"store_sales\"), 0) AS \"store_sales\", COALESCE(SUM(\"t26\".\"$f4\"), 0) AS \"$f3\"\r\n                        FROM (SELECT \"ss_sold_date_sk1\", \"ss_item_sk1\", \"ss_addr_sk1\", COALESCE(SUM(\"ss_ext_sales_price1\"), 0) AS \"store_sales\", COUNT(\"ss_ext_sales_price1\") AS \"$f4\"\r\n                                FROM \"store_sales\" AS \"store_sales1\" (\"ss_sold_date_sk1\", \"ss_sold_time_sk1\", \"ss_item_sk1\", \"ss_customer_sk1\", \"ss_cdemo_sk1\", \"ss_hdemo_sk1\", \"ss_addr_sk1\", \"ss_store_sk1\", \"ss_promo_sk1\", \"ss_ticket_number1\", \"ss_quantity1\", \"ss_wholesale_cost1\", \"ss_list_price1\", \"ss_sales_price1\", \"ss_ext_discount_amt1\", \"ss_ext_sales_price1\", \"ss_ext_wholesale_cost1\", \"ss_ext_list_price1\", \"ss_ext_tax1\", \"ss_coupon_amt1\", \"ss_net_paid1\", \"ss_net_paid_inc_tax1\", \"ss_net_profit1\")\r\n                                WHERE \"ss_list_price1\" >= 107 AND \"ss_list_price1\" <= 121\r\n                                GROUP BY \"ss_sold_date_sk1\", \"ss_item_sk1\", \"ss_addr_sk1\") AS \"t26\"\r\n                            INNER JOIN (SELECT \"d_date_sk1\"\r\n                                FROM \"date_dim\" AS \"date_dim1\" (\"d_date_sk1\", \"d_date_id1\", \"d_date1\", \"d_month_seq1\", \"d_week_seq1\", \"d_quarter_seq1\", \"d_year2\", \"d_dow1\", \"d_moy1\", \"d_dom1\", \"d_qoy2\", \"d_fy_year1\", \"d_fy_quarter_seq1\", \"d_fy_week_seq1\", \"d_day_name1\", \"d_quarter_name1\", \"d_holiday1\", \"d_weekend1\", \"d_following_holiday1\", \"d_first_dom1\", \"d_last_dom1\", \"d_same_day_ly1\", \"d_same_day_lq1\", \"d_current_day1\", \"d_current_week1\", \"d_current_month1\", \"d_current_quarter1\", \"d_current_year1\")\r\n                                WHERE \"d_qoy2\" = 3 AND \"d_year2\" = 1998) AS \"t28\" ON \"t26\".\"ss_sold_date_sk1\" = \"t28\".\"d_date_sk1\"\r\n                        GROUP BY \"t26\".\"ss_item_sk1\", \"t26\".\"ss_addr_sk1\") AS \"t29\"\r\n                    INNER JOIN (SELECT \"ca_address_sk1\", \"ca_county1\"\r\n                        FROM \"customer_address\" AS \"customer_address1\" (\"ca_address_sk1\", \"ca_address_id1\", \"ca_street_number1\", \"ca_street_name1\", \"ca_street_type1\", \"ca_suite_number1\", \"ca_city1\", \"ca_county1\", \"ca_state1\", \"ca_zip1\", \"ca_country1\", \"ca_gmt_offset1\", \"ca_location_type1\")\r\n                        WHERE CAST(\"ca_state1\" AS CHAR(2)) IN ('KS', 'ND')) AS \"t31\" ON \"t29\".\"ss_addr_sk1\" = \"t31\".\"ca_address_sk1\"\r\n                GROUP BY \"t29\".\"ss_item_sk1\", \"t31\".\"ca_county1\") AS \"t32\"\r\n            INNER JOIN (SELECT \"i_item_sk1\"\r\n                FROM \"item\" AS \"item1\" (\"i_item_sk1\", \"i_item_id1\", \"i_rec_start_date1\", \"i_rec_end_date1\", \"i_item_desc1\", \"i_current_price1\", \"i_wholesale_cost1\", \"i_brand_id1\", \"i_brand1\", \"i_class_id1\", \"i_class1\", \"i_category_id1\", \"i_category1\", \"i_manufact_id1\", \"i_manufact1\", \"i_size1\", \"i_formulation1\", \"i_color1\", \"i_units1\", \"i_container1\", \"i_manager_id1\", \"i_product_name1\")\r\n                WHERE (\"i_color1\" = 'mint' OR \"i_color1\" = 'thistle') AND (\"i_manager_id1\" >= 13 AND \"i_manager_id1\" <= 32)) AS \"t34\" ON \"t32\".\"ss_item_sk1\" = \"t34\".\"i_item_sk1\"\r\n        GROUP BY \"t32\".\"ca_county1\") AS \"t37\" ON \"t24\".\"ca_county0\" = \"t37\".\"ca_county1\"\r\n    INNER JOIN (SELECT \"t45\".\"ca_county2\", CAST(1 AS INTEGER) AS \"d_qoy5\", CAST(1998 AS INTEGER) AS \"d_year5\", CASE WHEN COALESCE(SUM(\"t45\".\"$f3\"), 0) = 0 THEN NULL ELSE COALESCE(SUM(\"t45\".\"web_sales\"), 0) END AS \"web_sales\"\r\n        FROM (SELECT \"t42\".\"ws_item_sk\", \"t44\".\"ca_county2\", COALESCE(SUM(\"t42\".\"web_sales\"), 0) AS \"web_sales\", COALESCE(SUM(\"t42\".\"$f3\"), 0) AS \"$f3\"\r\n                FROM (SELECT \"t39\".\"ws_item_sk\", \"t39\".\"ws_bill_addr_sk\", COALESCE(SUM(\"t39\".\"web_sales\"), 0) AS \"web_sales\", COALESCE(SUM(\"t39\".\"$f4\"), 0) AS \"$f3\"\r\n                        FROM (SELECT \"ws_sold_date_sk\", \"ws_item_sk\", \"ws_bill_addr_sk\", COALESCE(SUM(\"ws_ext_sales_price\"), 0) AS \"web_sales\", COUNT(\"ws_ext_sales_price\") AS \"$f4\"\r\n                                FROM \"web_sales\"\r\n                                WHERE \"ws_list_price\" >= 107 AND \"ws_list_price\" <= 121\r\n                                GROUP BY \"ws_sold_date_sk\", \"ws_item_sk\", \"ws_bill_addr_sk\") AS \"t39\"\r\n                            INNER JOIN (SELECT \"d_date_sk2\"\r\n                                FROM \"date_dim\" AS \"date_dim2\" (\"d_date_sk2\", \"d_date_id2\", \"d_date2\", \"d_month_seq2\", \"d_week_seq2\", \"d_quarter_seq2\", \"d_year4\", \"d_dow2\", \"d_moy2\", \"d_dom2\", \"d_qoy4\", \"d_fy_year2\", \"d_fy_quarter_seq2\", \"d_fy_week_seq2\", \"d_day_name2\", \"d_quarter_name2\", \"d_holiday2\", \"d_weekend2\", \"d_following_holiday2\", \"d_first_dom2\", \"d_last_dom2\", \"d_same_day_ly2\", \"d_same_day_lq2\", \"d_current_day2\", \"d_current_week2\", \"d_current_month2\", \"d_current_quarter2\", \"d_current_year2\")\r\n                                WHERE \"d_qoy4\" = 1 AND \"d_year4\" = 1998) AS \"t41\" ON \"t39\".\"ws_sold_date_sk\" = \"t41\".\"d_date_sk2\"\r\n                        GROUP BY \"t39\".\"ws_item_sk\", \"t39\".\"ws_bill_addr_sk\") AS \"t42\"\r\n                    INNER JOIN (SELECT \"ca_address_sk2\", \"ca_county2\"\r\n                        FROM \"customer_address\" AS \"customer_address2\" (\"ca_address_sk2\", \"ca_address_id2\", \"ca_street_number2\", \"ca_street_name2\", \"ca_street_type2\", \"ca_suite_number2\", \"ca_city2\", \"ca_county2\", \"ca_state2\", \"ca_zip2\", \"ca_country2\", \"ca_gmt_offset2\", \"ca_location_type2\")\r\n                        WHERE CAST(\"ca_state2\" AS CHAR(2)) IN ('KS', 'ND')) AS \"t44\" ON \"t42\".\"ws_bill_addr_sk\" = \"t44\".\"ca_address_sk2\"\r\n                GROUP BY \"t42\".\"ws_item_sk\", \"t44\".\"ca_county2\") AS \"t45\"\r\n            INNER JOIN (SELECT \"i_item_sk2\"\r\n                FROM \"item\" AS \"item2\" (\"i_item_sk2\", \"i_item_id2\", \"i_rec_start_date2\", \"i_rec_end_date2\", \"i_item_desc2\", \"i_current_price2\", \"i_wholesale_cost2\", \"i_brand_id2\", \"i_brand2\", \"i_class_id2\", \"i_class2\", \"i_category_id2\", \"i_category2\", \"i_manufact_id2\", \"i_manufact2\", \"i_size2\", \"i_formulation2\", \"i_color2\", \"i_units2\", \"i_container2\", \"i_manager_id2\", \"i_product_name2\")\r\n                WHERE (\"i_color2\" = 'mint' OR \"i_color2\" = 'thistle') AND (\"i_manager_id2\" >= 13 AND \"i_manager_id2\" <= 32)) AS \"t47\" ON \"t45\".\"ws_item_sk\" = \"t47\".\"i_item_sk2\"\r\n        GROUP BY \"t45\".\"ca_county2\") AS \"t50\" ON \"t11\".\"ca_county\" = \"t50\".\"ca_county2\"\r\n    INNER JOIN (SELECT \"t58\".\"ca_county3\", CAST(2 AS INTEGER) AS \"d_qoy7\", CAST(1998 AS INTEGER) AS \"d_year7\", CASE WHEN COALESCE(SUM(\"t58\".\"$f3\"), 0) = 0 THEN NULL ELSE COALESCE(SUM(\"t58\".\"web_sales\"), 0) END AS \"web_sales0\"\r\n        FROM (SELECT \"t55\".\"ws_item_sk0\", \"t57\".\"ca_county3\", COALESCE(SUM(\"t55\".\"web_sales\"), 0) AS \"web_sales\", COALESCE(SUM(\"t55\".\"$f3\"), 0) AS \"$f3\"\r\n                FROM (SELECT \"t52\".\"ws_item_sk0\", \"t52\".\"ws_bill_addr_sk0\", COALESCE(SUM(\"t52\".\"web_sales\"), 0) AS \"web_sales\", COALESCE(SUM(\"t52\".\"$f4\"), 0) AS \"$f3\"\r\n                        FROM (SELECT \"ws_sold_date_sk0\", \"ws_item_sk0\", \"ws_bill_addr_sk0\", COALESCE(SUM(\"ws_ext_sales_price0\"), 0) AS \"web_sales\", COUNT(\"ws_ext_sales_price0\") AS \"$f4\"\r\n                                FROM \"web_sales\" AS \"web_sales0\" (\"ws_sold_date_sk0\", \"ws_sold_time_sk0\", \"ws_ship_date_sk0\", \"ws_item_sk0\", \"ws_bill_customer_sk0\", \"ws_bill_cdemo_sk0\", \"ws_bill_hdemo_sk0\", \"ws_bill_addr_sk0\", \"ws_ship_customer_sk0\", \"ws_ship_cdemo_sk0\", \"ws_ship_hdemo_sk0\", \"ws_ship_addr_sk0\", \"ws_web_page_sk0\", \"ws_web_site_sk0\", \"ws_ship_mode_sk0\", \"ws_warehouse_sk0\", \"ws_promo_sk0\", \"ws_order_number0\", \"ws_quantity0\", \"ws_wholesale_cost0\", \"ws_list_price0\", \"ws_sales_price0\", \"ws_ext_discount_amt0\", \"ws_ext_sales_price0\", \"ws_ext_wholesale_cost0\", \"ws_ext_list_price0\", \"ws_ext_tax0\", \"ws_coupon_amt0\", \"ws_ext_ship_cost0\", \"ws_net_paid0\", \"ws_net_paid_inc_tax0\", \"ws_net_paid_inc_ship0\", \"ws_net_paid_inc_ship_tax0\", \"ws_net_profit0\")\r\n                                WHERE \"ws_list_price0\" >= 107 AND \"ws_list_price0\" <= 121\r\n                                GROUP BY \"ws_sold_date_sk0\", \"ws_item_sk0\", \"ws_bill_addr_sk0\") AS \"t52\"\r\n                            INNER JOIN (SELECT \"d_date_sk3\"\r\n                                FROM \"date_dim\" AS \"date_dim3\" (\"d_date_sk3\", \"d_date_id3\", \"d_date3\", \"d_month_seq3\", \"d_week_seq3\", \"d_quarter_seq3\", \"d_year6\", \"d_dow3\", \"d_moy3\", \"d_dom3\", \"d_qoy6\", \"d_fy_year3\", \"d_fy_quarter_seq3\", \"d_fy_week_seq3\", \"d_day_name3\", \"d_quarter_name3\", \"d_holiday3\", \"d_weekend3\", \"d_following_holiday3\", \"d_first_dom3\", \"d_last_dom3\", \"d_same_day_ly3\", \"d_same_day_lq3\", \"d_current_day3\", \"d_current_week3\", \"d_current_month3\", \"d_current_quarter3\", \"d_current_year3\")\r\n                                WHERE \"d_qoy6\" = 2 AND \"d_year6\" = 1998) AS \"t54\" ON \"t52\".\"ws_sold_date_sk0\" = \"t54\".\"d_date_sk3\"\r\n                        GROUP BY \"t52\".\"ws_item_sk0\", \"t52\".\"ws_bill_addr_sk0\") AS \"t55\"\r\n                    INNER JOIN (SELECT \"ca_address_sk3\", \"ca_county3\"\r\n                        FROM \"customer_address\" AS \"customer_address3\" (\"ca_address_sk3\", \"ca_address_id3\", \"ca_street_number3\", \"ca_street_name3\", \"ca_street_type3\", \"ca_suite_number3\", \"ca_city3\", \"ca_county3\", \"ca_state3\", \"ca_zip3\", \"ca_country3\", \"ca_gmt_offset3\", \"ca_location_type3\")\r\n                        WHERE CAST(\"ca_state3\" AS CHAR(2)) IN ('KS', 'ND')) AS \"t57\" ON \"t55\".\"ws_bill_addr_sk0\" = \"t57\".\"ca_address_sk3\"\r\n                GROUP BY \"t55\".\"ws_item_sk0\", \"t57\".\"ca_county3\") AS \"t58\"\r\n            INNER JOIN (SELECT \"i_item_sk3\"\r\n                FROM \"item\" AS \"item3\" (\"i_item_sk3\", \"i_item_id3\", \"i_rec_start_date3\", \"i_rec_end_date3\", \"i_item_desc3\", \"i_current_price3\", \"i_wholesale_cost3\", \"i_brand_id3\", \"i_brand3\", \"i_class_id3\", \"i_class3\", \"i_category_id3\", \"i_category3\", \"i_manufact_id3\", \"i_manufact3\", \"i_size3\", \"i_formulation3\", \"i_color3\", \"i_units3\", \"i_container3\", \"i_manager_id3\", \"i_product_name3\")\r\n                WHERE (\"i_color3\" = 'mint' OR \"i_color3\" = 'thistle') AND (\"i_manager_id3\" >= 13 AND \"i_manager_id3\" <= 32)) AS \"t60\" ON \"t58\".\"ws_item_sk0\" = \"t60\".\"i_item_sk3\"\r\n        GROUP BY \"t58\".\"ca_county3\") AS \"t63\" ON \"t50\".\"ca_county2\" = \"t63\".\"ca_county3\" AND CASE WHEN \"t11\".\"store_sales\" > 0 THEN CASE WHEN \"t50\".\"web_sales\" > 0 THEN \"t63\".\"web_sales0\" / \"t50\".\"web_sales\" > \"t24\".\"store_sales\" / \"t11\".\"store_sales\" ELSE FALSE END ELSE FALSE END\r\n    INNER JOIN (SELECT \"t71\".\"ca_county4\", CAST(3 AS INTEGER) AS \"d_qoy9\", CAST(1998 AS INTEGER) AS \"d_year9\", CASE WHEN COALESCE(SUM(\"t71\".\"$f3\"), 0) = 0 THEN NULL ELSE COALESCE(SUM(\"t71\".\"web_sales\"), 0) END AS \"web_sales1\"\r\n        FROM (SELECT \"t68\".\"ws_item_sk1\", \"t70\".\"ca_county4\", COALESCE(SUM(\"t68\".\"web_sales\"), 0) AS \"web_sales\", COALESCE(SUM(\"t68\".\"$f3\"), 0) AS \"$f3\"\r\n                FROM (SELECT \"t65\".\"ws_item_sk1\", \"t65\".\"ws_bill_addr_sk1\", COALESCE(SUM(\"t65\".\"web_sales\"), 0) AS \"web_sales\", COALESCE(SUM(\"t65\".\"$f4\"), 0) AS \"$f3\"\r\n                        FROM (SELECT \"ws_sold_date_sk1\", \"ws_item_sk1\", \"ws_bill_addr_sk1\", COALESCE(SUM(\"ws_ext_sales_price1\"), 0) AS \"web_sales\", COUNT(\"ws_ext_sales_price1\") AS \"$f4\"\r\n                                FROM \"web_sales\" AS \"web_sales1\" (\"ws_sold_date_sk1\", \"ws_sold_time_sk1\", \"ws_ship_date_sk1\", \"ws_item_sk1\", \"ws_bill_customer_sk1\", \"ws_bill_cdemo_sk1\", \"ws_bill_hdemo_sk1\", \"ws_bill_addr_sk1\", \"ws_ship_customer_sk1\", \"ws_ship_cdemo_sk1\", \"ws_ship_hdemo_sk1\", \"ws_ship_addr_sk1\", \"ws_web_page_sk1\", \"ws_web_site_sk1\", \"ws_ship_mode_sk1\", \"ws_warehouse_sk1\", \"ws_promo_sk1\", \"ws_order_number1\", \"ws_quantity1\", \"ws_wholesale_cost1\", \"ws_list_price1\", \"ws_sales_price1\", \"ws_ext_discount_amt1\", \"ws_ext_sales_price1\", \"ws_ext_wholesale_cost1\", \"ws_ext_list_price1\", \"ws_ext_tax1\", \"ws_coupon_amt1\", \"ws_ext_ship_cost1\", \"ws_net_paid1\", \"ws_net_paid_inc_tax1\", \"ws_net_paid_inc_ship1\", \"ws_net_paid_inc_ship_tax1\", \"ws_net_profit1\")\r\n                                WHERE \"ws_list_price1\" >= 107 AND \"ws_list_price1\" <= 121\r\n                                GROUP BY \"ws_sold_date_sk1\", \"ws_item_sk1\", \"ws_bill_addr_sk1\") AS \"t65\"\r\n                            INNER JOIN (SELECT \"d_date_sk4\"\r\n                                FROM \"date_dim\" AS \"date_dim4\" (\"d_date_sk4\", \"d_date_id4\", \"d_date4\", \"d_month_seq4\", \"d_week_seq4\", \"d_quarter_seq4\", \"d_year8\", \"d_dow4\", \"d_moy4\", \"d_dom4\", \"d_qoy8\", \"d_fy_year4\", \"d_fy_quarter_seq4\", \"d_fy_week_seq4\", \"d_day_name4\", \"d_quarter_name4\", \"d_holiday4\", \"d_weekend4\", \"d_following_holiday4\", \"d_first_dom4\", \"d_last_dom4\", \"d_same_day_ly4\", \"d_same_day_lq4\", \"d_current_day4\", \"d_current_week4\", \"d_current_month4\", \"d_current_quarter4\", \"d_current_year4\")\r\n                                WHERE \"d_qoy8\" = 3 AND \"d_year8\" = 1998) AS \"t67\" ON \"t65\".\"ws_sold_date_sk1\" = \"t67\".\"d_date_sk4\"\r\n                        GROUP BY \"t65\".\"ws_item_sk1\", \"t65\".\"ws_bill_addr_sk1\") AS \"t68\"\r\n                    INNER JOIN (SELECT \"ca_address_sk4\", \"ca_county4\"\r\n                        FROM \"customer_address\" AS \"customer_address4\" (\"ca_address_sk4\", \"ca_address_id4\", \"ca_street_number4\", \"ca_street_name4\", \"ca_street_type4\", \"ca_suite_number4\", \"ca_city4\", \"ca_county4\", \"ca_state4\", \"ca_zip4\", \"ca_country4\", \"ca_gmt_offset4\", \"ca_location_type4\")\r\n                        WHERE CAST(\"ca_state4\" AS CHAR(2)) IN ('KS', 'ND')) AS \"t70\" ON \"t68\".\"ws_bill_addr_sk1\" = \"t70\".\"ca_address_sk4\"\r\n                GROUP BY \"t68\".\"ws_item_sk1\", \"t70\".\"ca_county4\") AS \"t71\"\r\n            INNER JOIN (SELECT \"i_item_sk4\"\r\n                FROM \"item\" AS \"item4\" (\"i_item_sk4\", \"i_item_id4\", \"i_rec_start_date4\", \"i_rec_end_date4\", \"i_item_desc4\", \"i_current_price4\", \"i_wholesale_cost4\", \"i_brand_id4\", \"i_brand4\", \"i_class_id4\", \"i_class4\", \"i_category_id4\", \"i_category4\", \"i_manufact_id4\", \"i_manufact4\", \"i_size4\", \"i_formulation4\", \"i_color4\", \"i_units4\", \"i_container4\", \"i_manager_id4\", \"i_product_name4\")\r\n                WHERE (\"i_color4\" = 'mint' OR \"i_color4\" = 'thistle') AND (\"i_manager_id4\" >= 13 AND \"i_manager_id4\" <= 32)) AS \"t73\" ON \"t71\".\"ws_item_sk1\" = \"t73\".\"i_item_sk4\"\r\n        GROUP BY \"t71\".\"ca_county4\") AS \"t76\" ON \"t50\".\"ca_county2\" = \"t76\".\"ca_county4\" AND CASE WHEN \"t24\".\"store_sales\" > 0 THEN CASE WHEN \"t63\".\"web_sales0\" > 0 THEN \"t76\".\"web_sales1\" / \"t63\".\"web_sales0\" > \"t37\".\"store_sales0\" / \"t24\".\"store_sales\" ELSE FALSE END ELSE FALSE END\r\nORDER BY 5;", "output_cost": 260.03, "used_rules": ["FILTER_INTO_JOIN", "FILTER_AGGREGATE_TRANSPOSE", "FILTER_PROJECT_TRANSPOSE", "PROJECT_REDUCE_EXPRESSIONS", "FILTER_INTO_JOIN", "AGGREGATE_ANY_PULL_UP_CONSTANTS", "AGGREGATE_REDUCE_FUNCTIONS", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_JOIN_TRANSPOSE_EXTENDED", "JOIN_REDUCE_EXPRESSIONS"], "rewrite_time": 5500}
{"name": "query032_0", "input_sql": "select  sum(cs_ext_discount_amt)  as \"excess discount amount\"\nfrom\n   catalog_sales\n   ,item\n   ,date_dim\nwhere\n(i_manufact_id in (214, 376, 518, 755, 996)\nor i_manager_id BETWEEN 71 and 100)\nand i_item_sk = cs_item_sk\nand d_date between '2000-03-06' and\n        cast('2000-03-06' as date) + interval '90' day\nand d_date_sk = cs_sold_date_sk\nand cs_ext_discount_amt\n     > (\n         select\n            1.3 * avg(cs_ext_discount_amt)\n         from\n            catalog_sales\n           ,date_dim\n         where\n              cs_item_sk = i_item_sk\n          and d_date between '2000-03-06' and\n                             cast('2000-03-06' as date) + interval '90' day\n          and d_date_sk = cs_sold_date_sk\n          and cs_list_price between 80 and 109\n          and cs_sales_price / cs_list_price BETWEEN 80 * 0.01 AND 100 * 0.01\n      )\norder by sum(cs_ext_discount_amt)\nlimit 100;", "input_cost": 29.99, "output_sql": "SELECT CASE WHEN COUNT(\"catalog_sales\".\"cs_ext_discount_amt\") = 0 THEN NULL ELSE COALESCE(SUM(\"catalog_sales\".\"cs_ext_discount_amt\"), 0) END AS \"excess discount amount\"\r\nFROM \"catalog_sales\"\r\n    INNER JOIN (SELECT *\r\n        FROM \"item\"\r\n        WHERE \"i_manufact_id\" IN (214, 376, 518, 755, 996) OR \"i_manager_id\" >= 71 AND \"i_manager_id\" <= 100) AS \"t\" ON \"catalog_sales\".\"cs_item_sk\" = \"t\".\"i_item_sk\"\r\n    INNER JOIN (SELECT *\r\n        FROM \"date_dim\"\r\n        WHERE \"d_date\" >= DATE '2000-03-06' AND \"d_date\" <= DATE '2000-06-04') AS \"t0\" ON \"catalog_sales\".\"cs_sold_date_sk\" = \"t0\".\"d_date_sk\"\r\n    INNER JOIN (SELECT \"cs_item_sk0\", CASE WHEN COUNT(\"cs_ext_discount_amt0\") = 0 THEN NULL ELSE COALESCE(SUM(\"cs_ext_discount_amt0\"), 0) END / COUNT(\"cs_ext_discount_amt0\") AS \"$f10\"\r\n        FROM (SELECT *\r\n                FROM \"catalog_sales\" AS \"catalog_sales0\" (\"cs_sold_date_sk0\", \"cs_sold_time_sk0\", \"cs_ship_date_sk0\", \"cs_bill_customer_sk0\", \"cs_bill_cdemo_sk0\", \"cs_bill_hdemo_sk0\", \"cs_bill_addr_sk0\", \"cs_ship_customer_sk0\", \"cs_ship_cdemo_sk0\", \"cs_ship_hdemo_sk0\", \"cs_ship_addr_sk0\", \"cs_call_center_sk0\", \"cs_catalog_page_sk0\", \"cs_ship_mode_sk0\", \"cs_warehouse_sk0\", \"cs_item_sk0\", \"cs_promo_sk0\", \"cs_order_number0\", \"cs_quantity0\", \"cs_wholesale_cost0\", \"cs_list_price0\", \"cs_sales_price0\", \"cs_ext_discount_amt0\", \"cs_ext_sales_price0\", \"cs_ext_wholesale_cost0\", \"cs_ext_list_price0\", \"cs_ext_tax0\", \"cs_coupon_amt0\", \"cs_ext_ship_cost0\", \"cs_net_paid0\", \"cs_net_paid_inc_tax0\", \"cs_net_paid_inc_ship0\", \"cs_net_paid_inc_ship_tax0\", \"cs_net_profit0\")\r\n                WHERE \"cs_list_price0\" >= 80 AND \"cs_list_price0\" <= 109 AND \"cs_sales_price0\" / \"cs_list_price0\" >= 0.80 AND \"cs_sales_price0\" / \"cs_list_price0\" <= 1.00 AND EXISTS (SELECT 1\r\n                        FROM (SELECT *\r\n                                FROM \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\")\r\n                                WHERE \"d_date0\" >= DATE '2000-03-06' AND \"d_date0\" <= DATE '2000-06-04') AS \"t2\"\r\n                        WHERE \"cs_sold_date_sk0\" = \"t2\".\"d_date_sk0\")) AS \"t1\"\r\n        GROUP BY \"cs_item_sk0\") AS \"t5\" ON \"t\".\"i_item_sk\" = \"t5\".\"cs_item_sk0\" AND \"catalog_sales\".\"cs_ext_discount_amt\" > 1.3 * \"t5\".\"$f10\"\r\nORDER BY 1\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 41.05, "used_rules": ["FILTER_SUB_QUERY_TO_CORRELATE", "JOIN_ON_UNIQUE_TO_SEMI_JOIN", "JOIN_EXTRACT_FILTER", "FILTER_INTO_JOIN", "FILTER_REDUCE_EXPRESSIONS", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_REDUCE_FUNCTIONS"], "rewrite_time": 2329}
{"name": "query032_1", "input_sql": "select  sum(cs_ext_discount_amt)  as \"excess discount amount\"\nfrom\n   catalog_sales\n   ,item\n   ,date_dim\nwhere\n(i_manufact_id in (15, 261, 343, 512, 683)\nor i_manager_id BETWEEN 25 and 54)\nand i_item_sk = cs_item_sk\nand d_date between '2001-02-05' and\n        cast('2001-02-05' as date) + interval '90' day\nand d_date_sk = cs_sold_date_sk\nand cs_ext_discount_amt\n     > (\n         select\n            1.3 * avg(cs_ext_discount_amt)\n         from\n            catalog_sales\n           ,date_dim\n         where\n              cs_item_sk = i_item_sk\n          and d_date between '2001-02-05' and\n                             cast('2001-02-05' as date) + interval '90' day\n          and d_date_sk = cs_sold_date_sk\n          and cs_list_price between 259 and 288\n          and cs_sales_price / cs_list_price BETWEEN 17 * 0.01 AND 37 * 0.01\n      )\norder by sum(cs_ext_discount_amt)\nlimit 100;", "input_cost": 29.99, "output_sql": "SELECT CASE WHEN COUNT(\"catalog_sales\".\"cs_ext_discount_amt\") = 0 THEN NULL ELSE COALESCE(SUM(\"catalog_sales\".\"cs_ext_discount_amt\"), 0) END AS \"excess discount amount\"\r\nFROM \"catalog_sales\"\r\n    INNER JOIN (SELECT *\r\n        FROM \"item\"\r\n        WHERE \"i_manufact_id\" IN (15, 261, 343, 512, 683) OR \"i_manager_id\" >= 25 AND \"i_manager_id\" <= 54) AS \"t\" ON \"catalog_sales\".\"cs_item_sk\" = \"t\".\"i_item_sk\"\r\n    INNER JOIN (SELECT *\r\n        FROM \"date_dim\"\r\n        WHERE \"d_date\" >= DATE '2001-02-05' AND \"d_date\" <= DATE '2001-05-06') AS \"t0\" ON \"catalog_sales\".\"cs_sold_date_sk\" = \"t0\".\"d_date_sk\"\r\n    INNER JOIN (SELECT \"cs_item_sk0\", CASE WHEN COUNT(\"cs_ext_discount_amt0\") = 0 THEN NULL ELSE COALESCE(SUM(\"cs_ext_discount_amt0\"), 0) END / COUNT(\"cs_ext_discount_amt0\") AS \"$f10\"\r\n        FROM (SELECT *\r\n                FROM \"catalog_sales\" AS \"catalog_sales0\" (\"cs_sold_date_sk0\", \"cs_sold_time_sk0\", \"cs_ship_date_sk0\", \"cs_bill_customer_sk0\", \"cs_bill_cdemo_sk0\", \"cs_bill_hdemo_sk0\", \"cs_bill_addr_sk0\", \"cs_ship_customer_sk0\", \"cs_ship_cdemo_sk0\", \"cs_ship_hdemo_sk0\", \"cs_ship_addr_sk0\", \"cs_call_center_sk0\", \"cs_catalog_page_sk0\", \"cs_ship_mode_sk0\", \"cs_warehouse_sk0\", \"cs_item_sk0\", \"cs_promo_sk0\", \"cs_order_number0\", \"cs_quantity0\", \"cs_wholesale_cost0\", \"cs_list_price0\", \"cs_sales_price0\", \"cs_ext_discount_amt0\", \"cs_ext_sales_price0\", \"cs_ext_wholesale_cost0\", \"cs_ext_list_price0\", \"cs_ext_tax0\", \"cs_coupon_amt0\", \"cs_ext_ship_cost0\", \"cs_net_paid0\", \"cs_net_paid_inc_tax0\", \"cs_net_paid_inc_ship0\", \"cs_net_paid_inc_ship_tax0\", \"cs_net_profit0\")\r\n                WHERE \"cs_list_price0\" >= 259 AND \"cs_list_price0\" <= 288 AND \"cs_sales_price0\" / \"cs_list_price0\" >= 0.17 AND \"cs_sales_price0\" / \"cs_list_price0\" <= 0.37 AND EXISTS (SELECT 1\r\n                        FROM (SELECT *\r\n                                FROM \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\")\r\n                                WHERE \"d_date0\" >= DATE '2001-02-05' AND \"d_date0\" <= DATE '2001-05-06') AS \"t2\"\r\n                        WHERE \"cs_sold_date_sk0\" = \"t2\".\"d_date_sk0\")) AS \"t1\"\r\n        GROUP BY \"cs_item_sk0\") AS \"t5\" ON \"t\".\"i_item_sk\" = \"t5\".\"cs_item_sk0\" AND \"catalog_sales\".\"cs_ext_discount_amt\" > 1.3 * \"t5\".\"$f10\"\r\nORDER BY 1\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 41.05, "used_rules": ["FILTER_SUB_QUERY_TO_CORRELATE", "JOIN_ON_UNIQUE_TO_SEMI_JOIN", "JOIN_EXTRACT_FILTER", "FILTER_INTO_JOIN", "FILTER_REDUCE_EXPRESSIONS", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_REDUCE_FUNCTIONS"], "rewrite_time": 2157}
{"name": "query038_0", "input_sql": "select  count(*) from (\n    select distinct c_last_name, c_first_name, d_date\n    from store_sales, date_dim, customer\n          where store_sales.ss_sold_date_sk = date_dim.d_date_sk\n      and store_sales.ss_customer_sk = customer.c_customer_sk\n      and d_month_seq between 1221 and 1221 + 11\n      and c_birth_month in (2, 8, 10, 11)\n      and ss_list_price between 241 and 300\n      and ss_wholesale_cost BETWEEN 73 AND 93\n  intersect\n    select distinct c_last_name, c_first_name, d_date\n    from catalog_sales, date_dim, customer\n          where catalog_sales.cs_sold_date_sk = date_dim.d_date_sk\n      and catalog_sales.cs_bill_customer_sk = customer.c_customer_sk\n      and d_month_seq between 1221 and 1221 + 11\n      and c_birth_month in (2, 8, 10, 11)\n      and cs_list_price between 241 and 300\n      and cs_wholesale_cost BETWEEN 73 AND 93\n  intersect\n    select distinct c_last_name, c_first_name, d_date\n    from web_sales, date_dim, customer\n          where web_sales.ws_sold_date_sk = date_dim.d_date_sk\n      and web_sales.ws_bill_customer_sk = customer.c_customer_sk\n      and d_month_seq between 1221 and 1221 + 11\n      and c_birth_month in (2, 8, 10, 11)\n      and ws_list_price between 241 and 300\n      and ws_wholesale_cost BETWEEN 73 AND 93\n) hot_cust\nlimit 100;", "input_cost": 79.88, "output_sql": "SELECT COUNT(*)\r\nFROM (SELECT *\r\n            FROM (SELECT \"t3\".\"c_last_name\", \"t3\".\"c_first_name\", \"t2\".\"d_date\"\r\n                        FROM (SELECT \"t0\".\"ss_customer_sk\", \"t1\".\"d_date\"\r\n                                FROM (SELECT \"ss_sold_date_sk\", \"ss_customer_sk\"\r\n                                        FROM \"store_sales\"\r\n                                        WHERE \"ss_list_price\" >= 241 AND \"ss_list_price\" <= 300 AND (\"ss_wholesale_cost\" >= 73 AND \"ss_wholesale_cost\" <= 93)\r\n                                        GROUP BY \"ss_sold_date_sk\", \"ss_customer_sk\") AS \"t0\"\r\n                                    INNER JOIN (SELECT *\r\n                                        FROM \"date_dim\"\r\n                                        WHERE \"d_month_seq\" >= 1221 AND \"d_month_seq\" <= 1232) AS \"t1\" ON \"t0\".\"ss_sold_date_sk\" = \"t1\".\"d_date_sk\"\r\n                                GROUP BY \"t0\".\"ss_customer_sk\", \"t1\".\"d_date\") AS \"t2\"\r\n                            INNER JOIN (SELECT *\r\n                                FROM \"customer\"\r\n                                WHERE \"c_birth_month\" IN (2, 8, 10, 11)) AS \"t3\" ON \"t2\".\"ss_customer_sk\" = \"t3\".\"c_customer_sk\"\r\n                        GROUP BY \"t2\".\"d_date\", \"t3\".\"c_first_name\", \"t3\".\"c_last_name\"\r\n                        INTERSECT\r\n                        SELECT \"t10\".\"c_last_name0\", \"t10\".\"c_first_name0\", \"t9\".\"d_date0\"\r\n                        FROM (SELECT \"t7\".\"cs_bill_customer_sk\", \"t8\".\"d_date0\"\r\n                                FROM (SELECT \"cs_sold_date_sk\", \"cs_bill_customer_sk\"\r\n                                        FROM \"catalog_sales\"\r\n                                        WHERE \"cs_list_price\" >= 241 AND \"cs_list_price\" <= 300 AND (\"cs_wholesale_cost\" >= 73 AND \"cs_wholesale_cost\" <= 93)\r\n                                        GROUP BY \"cs_sold_date_sk\", \"cs_bill_customer_sk\") AS \"t7\"\r\n                                    INNER JOIN (SELECT *\r\n                                        FROM \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\")\r\n                                        WHERE \"d_month_seq0\" >= 1221 AND \"d_month_seq0\" <= 1232) AS \"t8\" ON \"t7\".\"cs_sold_date_sk\" = \"t8\".\"d_date_sk0\"\r\n                                GROUP BY \"t7\".\"cs_bill_customer_sk\", \"t8\".\"d_date0\") AS \"t9\"\r\n                            INNER JOIN (SELECT *\r\n                                FROM \"customer\" AS \"customer0\" (\"c_customer_sk0\", \"c_customer_id0\", \"c_current_cdemo_sk0\", \"c_current_hdemo_sk0\", \"c_current_addr_sk0\", \"c_first_shipto_date_sk0\", \"c_first_sales_date_sk0\", \"c_salutation0\", \"c_first_name0\", \"c_last_name0\", \"c_preferred_cust_flag0\", \"c_birth_day0\", \"c_birth_month0\", \"c_birth_year0\", \"c_birth_country0\", \"c_login0\", \"c_email_address0\", \"c_last_review_date_sk0\")\r\n                                WHERE \"c_birth_month0\" IN (2, 8, 10, 11)) AS \"t10\" ON \"t9\".\"cs_bill_customer_sk\" = \"t10\".\"c_customer_sk0\"\r\n                        GROUP BY \"t9\".\"d_date0\", \"t10\".\"c_first_name0\", \"t10\".\"c_last_name0\") AS \"t\"\r\n            INTERSECT\r\n            SELECT \"t18\".\"c_last_name1\", \"t18\".\"c_first_name1\", \"t17\".\"d_date1\"\r\n            FROM (SELECT \"t15\".\"ws_bill_customer_sk\", \"t16\".\"d_date1\"\r\n                    FROM (SELECT \"ws_sold_date_sk\", \"ws_bill_customer_sk\"\r\n                            FROM \"web_sales\"\r\n                            WHERE \"ws_list_price\" >= 241 AND \"ws_list_price\" <= 300 AND (\"ws_wholesale_cost\" >= 73 AND \"ws_wholesale_cost\" <= 93)\r\n                            GROUP BY \"ws_sold_date_sk\", \"ws_bill_customer_sk\") AS \"t15\"\r\n                        INNER JOIN (SELECT *\r\n                            FROM \"date_dim\" AS \"date_dim1\" (\"d_date_sk1\", \"d_date_id1\", \"d_date1\", \"d_month_seq1\", \"d_week_seq1\", \"d_quarter_seq1\", \"d_year1\", \"d_dow1\", \"d_moy1\", \"d_dom1\", \"d_qoy1\", \"d_fy_year1\", \"d_fy_quarter_seq1\", \"d_fy_week_seq1\", \"d_day_name1\", \"d_quarter_name1\", \"d_holiday1\", \"d_weekend1\", \"d_following_holiday1\", \"d_first_dom1\", \"d_last_dom1\", \"d_same_day_ly1\", \"d_same_day_lq1\", \"d_current_day1\", \"d_current_week1\", \"d_current_month1\", \"d_current_quarter1\", \"d_current_year1\")\r\n                            WHERE \"d_month_seq1\" >= 1221 AND \"d_month_seq1\" <= 1232) AS \"t16\" ON \"t15\".\"ws_sold_date_sk\" = \"t16\".\"d_date_sk1\"\r\n                    GROUP BY \"t15\".\"ws_bill_customer_sk\", \"t16\".\"d_date1\") AS \"t17\"\r\n                INNER JOIN (SELECT *\r\n                    FROM \"customer\" AS \"customer1\" (\"c_customer_sk1\", \"c_customer_id1\", \"c_current_cdemo_sk1\", \"c_current_hdemo_sk1\", \"c_current_addr_sk1\", \"c_first_shipto_date_sk1\", \"c_first_sales_date_sk1\", \"c_salutation1\", \"c_first_name1\", \"c_last_name1\", \"c_preferred_cust_flag1\", \"c_birth_day1\", \"c_birth_month1\", \"c_birth_year1\", \"c_birth_country1\", \"c_login1\", \"c_email_address1\", \"c_last_review_date_sk1\")\r\n                    WHERE \"c_birth_month1\" IN (2, 8, 10, 11)) AS \"t18\" ON \"t17\".\"ws_bill_customer_sk\" = \"t18\".\"c_customer_sk1\"\r\n            GROUP BY \"t17\".\"d_date1\", \"t18\".\"c_first_name1\", \"t18\".\"c_last_name1\") AS \"t21\"\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 101.43, "used_rules": ["FILTER_INTO_JOIN", "FILTER_REDUCE_EXPRESSIONS", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_JOIN_TRANSPOSE_EXTENDED", "JOIN_EXTRACT_FILTER", "JOIN_PROJECT_RIGHT_TRANSPOSE", "FILTER_PROJECT_TRANSPOSE", "FILTER_INTO_JOIN", "AGGREGATE_PROJECT_MERGE"], "rewrite_time": 2775}
{"name": "query038_1", "input_sql": "select  count(*) from (\n    select distinct c_last_name, c_first_name, d_date\n    from store_sales, date_dim, customer\n          where store_sales.ss_sold_date_sk = date_dim.d_date_sk\n      and store_sales.ss_customer_sk = customer.c_customer_sk\n      and d_month_seq between 1190 and 1190 + 11\n      and c_birth_month in (1, 5, 9, 11)\n      and ss_list_price between 77 and 136\n      and ss_wholesale_cost BETWEEN 80 AND 100\n  intersect\n    select distinct c_last_name, c_first_name, d_date\n    from catalog_sales, date_dim, customer\n          where catalog_sales.cs_sold_date_sk = date_dim.d_date_sk\n      and catalog_sales.cs_bill_customer_sk = customer.c_customer_sk\n      and d_month_seq between 1190 and 1190 + 11\n      and c_birth_month in (1, 5, 9, 11)\n      and cs_list_price between 77 and 136\n      and cs_wholesale_cost BETWEEN 80 AND 100\n  intersect\n    select distinct c_last_name, c_first_name, d_date\n    from web_sales, date_dim, customer\n          where web_sales.ws_sold_date_sk = date_dim.d_date_sk\n      and web_sales.ws_bill_customer_sk = customer.c_customer_sk\n      and d_month_seq between 1190 and 1190 + 11\n      and c_birth_month in (1, 5, 9, 11)\n      and ws_list_price between 77 and 136\n      and ws_wholesale_cost BETWEEN 80 AND 100\n) hot_cust\nlimit 100;", "input_cost": 79.88, "output_sql": "SELECT COUNT(*)\r\nFROM (SELECT *\r\n            FROM (SELECT \"t3\".\"c_last_name\", \"t3\".\"c_first_name\", \"t2\".\"d_date\"\r\n                        FROM (SELECT \"t0\".\"ss_customer_sk\", \"t1\".\"d_date\"\r\n                                FROM (SELECT \"ss_sold_date_sk\", \"ss_customer_sk\"\r\n                                        FROM \"store_sales\"\r\n                                        WHERE \"ss_list_price\" >= 77 AND \"ss_list_price\" <= 136 AND (\"ss_wholesale_cost\" >= 80 AND \"ss_wholesale_cost\" <= 100)\r\n                                        GROUP BY \"ss_sold_date_sk\", \"ss_customer_sk\") AS \"t0\"\r\n                                    INNER JOIN (SELECT *\r\n                                        FROM \"date_dim\"\r\n                                        WHERE \"d_month_seq\" >= 1190 AND \"d_month_seq\" <= 1201) AS \"t1\" ON \"t0\".\"ss_sold_date_sk\" = \"t1\".\"d_date_sk\"\r\n                                GROUP BY \"t0\".\"ss_customer_sk\", \"t1\".\"d_date\") AS \"t2\"\r\n                            INNER JOIN (SELECT *\r\n                                FROM \"customer\"\r\n                                WHERE \"c_birth_month\" IN (1, 5, 9, 11)) AS \"t3\" ON \"t2\".\"ss_customer_sk\" = \"t3\".\"c_customer_sk\"\r\n                        GROUP BY \"t2\".\"d_date\", \"t3\".\"c_first_name\", \"t3\".\"c_last_name\"\r\n                        INTERSECT\r\n                        SELECT \"t10\".\"c_last_name0\", \"t10\".\"c_first_name0\", \"t9\".\"d_date0\"\r\n                        FROM (SELECT \"t7\".\"cs_bill_customer_sk\", \"t8\".\"d_date0\"\r\n                                FROM (SELECT \"cs_sold_date_sk\", \"cs_bill_customer_sk\"\r\n                                        FROM \"catalog_sales\"\r\n                                        WHERE \"cs_list_price\" >= 77 AND \"cs_list_price\" <= 136 AND (\"cs_wholesale_cost\" >= 80 AND \"cs_wholesale_cost\" <= 100)\r\n                                        GROUP BY \"cs_sold_date_sk\", \"cs_bill_customer_sk\") AS \"t7\"\r\n                                    INNER JOIN (SELECT *\r\n                                        FROM \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\")\r\n                                        WHERE \"d_month_seq0\" >= 1190 AND \"d_month_seq0\" <= 1201) AS \"t8\" ON \"t7\".\"cs_sold_date_sk\" = \"t8\".\"d_date_sk0\"\r\n                                GROUP BY \"t7\".\"cs_bill_customer_sk\", \"t8\".\"d_date0\") AS \"t9\"\r\n                            INNER JOIN (SELECT *\r\n                                FROM \"customer\" AS \"customer0\" (\"c_customer_sk0\", \"c_customer_id0\", \"c_current_cdemo_sk0\", \"c_current_hdemo_sk0\", \"c_current_addr_sk0\", \"c_first_shipto_date_sk0\", \"c_first_sales_date_sk0\", \"c_salutation0\", \"c_first_name0\", \"c_last_name0\", \"c_preferred_cust_flag0\", \"c_birth_day0\", \"c_birth_month0\", \"c_birth_year0\", \"c_birth_country0\", \"c_login0\", \"c_email_address0\", \"c_last_review_date_sk0\")\r\n                                WHERE \"c_birth_month0\" IN (1, 5, 9, 11)) AS \"t10\" ON \"t9\".\"cs_bill_customer_sk\" = \"t10\".\"c_customer_sk0\"\r\n                        GROUP BY \"t9\".\"d_date0\", \"t10\".\"c_first_name0\", \"t10\".\"c_last_name0\") AS \"t\"\r\n            INTERSECT\r\n            SELECT \"t18\".\"c_last_name1\", \"t18\".\"c_first_name1\", \"t17\".\"d_date1\"\r\n            FROM (SELECT \"t15\".\"ws_bill_customer_sk\", \"t16\".\"d_date1\"\r\n                    FROM (SELECT \"ws_sold_date_sk\", \"ws_bill_customer_sk\"\r\n                            FROM \"web_sales\"\r\n                            WHERE \"ws_list_price\" >= 77 AND \"ws_list_price\" <= 136 AND (\"ws_wholesale_cost\" >= 80 AND \"ws_wholesale_cost\" <= 100)\r\n                            GROUP BY \"ws_sold_date_sk\", \"ws_bill_customer_sk\") AS \"t15\"\r\n                        INNER JOIN (SELECT *\r\n                            FROM \"date_dim\" AS \"date_dim1\" (\"d_date_sk1\", \"d_date_id1\", \"d_date1\", \"d_month_seq1\", \"d_week_seq1\", \"d_quarter_seq1\", \"d_year1\", \"d_dow1\", \"d_moy1\", \"d_dom1\", \"d_qoy1\", \"d_fy_year1\", \"d_fy_quarter_seq1\", \"d_fy_week_seq1\", \"d_day_name1\", \"d_quarter_name1\", \"d_holiday1\", \"d_weekend1\", \"d_following_holiday1\", \"d_first_dom1\", \"d_last_dom1\", \"d_same_day_ly1\", \"d_same_day_lq1\", \"d_current_day1\", \"d_current_week1\", \"d_current_month1\", \"d_current_quarter1\", \"d_current_year1\")\r\n                            WHERE \"d_month_seq1\" >= 1190 AND \"d_month_seq1\" <= 1201) AS \"t16\" ON \"t15\".\"ws_sold_date_sk\" = \"t16\".\"d_date_sk1\"\r\n                    GROUP BY \"t15\".\"ws_bill_customer_sk\", \"t16\".\"d_date1\") AS \"t17\"\r\n                INNER JOIN (SELECT *\r\n                    FROM \"customer\" AS \"customer1\" (\"c_customer_sk1\", \"c_customer_id1\", \"c_current_cdemo_sk1\", \"c_current_hdemo_sk1\", \"c_current_addr_sk1\", \"c_first_shipto_date_sk1\", \"c_first_sales_date_sk1\", \"c_salutation1\", \"c_first_name1\", \"c_last_name1\", \"c_preferred_cust_flag1\", \"c_birth_day1\", \"c_birth_month1\", \"c_birth_year1\", \"c_birth_country1\", \"c_login1\", \"c_email_address1\", \"c_last_review_date_sk1\")\r\n                    WHERE \"c_birth_month1\" IN (1, 5, 9, 11)) AS \"t18\" ON \"t17\".\"ws_bill_customer_sk\" = \"t18\".\"c_customer_sk1\"\r\n            GROUP BY \"t17\".\"d_date1\", \"t18\".\"c_first_name1\", \"t18\".\"c_last_name1\") AS \"t21\"\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 101.43, "used_rules": ["FILTER_INTO_JOIN", "FILTER_REDUCE_EXPRESSIONS", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_JOIN_TRANSPOSE_EXTENDED", "JOIN_EXTRACT_FILTER", "JOIN_PROJECT_RIGHT_TRANSPOSE", "FILTER_PROJECT_TRANSPOSE", "FILTER_INTO_JOIN", "AGGREGATE_PROJECT_MERGE"], "rewrite_time": 2734}
{"name": "query039_0_0", "input_sql": "with inv as\n(select w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy\n       ,stdev,mean, case mean when 0 then null else stdev/mean end cov\n from(select w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy\n            ,stddev_samp(inv_quantity_on_hand) stdev,avg(inv_quantity_on_hand) mean\n      from inventory\n          ,item\n          ,warehouse\n          ,date_dim\n      where inv_item_sk = i_item_sk\n        and inv_warehouse_sk = w_warehouse_sk\n        and inv_date_sk = d_date_sk\n        and d_year =1999\n        and i_category IN ('Books', 'Shoes')\n        and i_manager_id BETWEEN 81 and 100\n        and inv_quantity_on_hand between 800 and 1000\n      group by w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy) foo\n where case mean when 0 then 0 else stdev/mean end > 1)\nselect inv1.w_warehouse_sk,inv1.i_item_sk,inv1.d_moy,inv1.mean, inv1.cov\n        ,inv2.w_warehouse_sk,inv2.i_item_sk,inv2.d_moy,inv2.mean, inv2.cov\nfrom inv inv1,inv inv2\nwhere inv1.i_item_sk = inv2.i_item_sk\n  and inv1.w_warehouse_sk =  inv2.w_warehouse_sk\n  and inv1.d_moy=7\n  and inv2.d_moy=7+1\norder by inv1.w_warehouse_sk,inv1.i_item_sk,inv1.d_moy,inv1.mean,inv1.cov\n        ,inv2.d_moy,inv2.mean, inv2.cov;", "input_cost": 30.69, "output_sql": "SELECT \"t8\".\"w_warehouse_sk\" AS \"w_warehouse_name\", \"t8\".\"i_item_sk\" AS \"w_warehouse_sk\", CAST(7 AS INTEGER) AS \"i_item_sk\", \"t8\".\"mean\" AS \"d_moy\", \"t8\".\"cov\" AS \"stdev\", \"t18\".\"inv_item_sk0\" AS \"mean\", \"t18\".\"inv_warehouse_sk0\" AS \"cov\", CAST(8 AS INTEGER) AS \"inv_date_sk0\", \"t18\".\"$f5\" AS \"inv_item_sk0\", \"t18\".\"$f6\" AS \"inv_warehouse_sk0\"\r\nFROM (SELECT \"t2\".\"w_warehouse_name\", \"t2\".\"w_warehouse_sk\", \"t2\".\"i_item_sk\", CAST(7 AS INTEGER) AS \"d_moy\", CAST(POWER((CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\" * \"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\" * \"t2\".\"inv_quantity_on_hand\"), 0) END - CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END * CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END / COUNT(\"t2\".\"inv_quantity_on_hand\")) / CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 1 THEN NULL ELSE COUNT(\"t2\".\"inv_quantity_on_hand\") - 1 END, 0.5) AS INTEGER) AS \"stdev\", CAST(CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END / COUNT(\"t2\".\"inv_quantity_on_hand\") AS INTEGER) AS \"mean\", CASE WHEN CAST(CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END / COUNT(\"t2\".\"inv_quantity_on_hand\") AS INTEGER) = 0 THEN NULL ELSE CAST(POWER((CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\" * \"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\" * \"t2\".\"inv_quantity_on_hand\"), 0) END - CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END * CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END / COUNT(\"t2\".\"inv_quantity_on_hand\")) / CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 1 THEN NULL ELSE COUNT(\"t2\".\"inv_quantity_on_hand\") - 1 END, 0.5) AS INTEGER) / CAST(CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END / COUNT(\"t2\".\"inv_quantity_on_hand\") AS INTEGER) END AS \"cov\"\r\n        FROM (SELECT *\r\n                FROM (SELECT *\r\n                        FROM (SELECT *\r\n                                FROM \"inventory\"\r\n                                WHERE \"inv_quantity_on_hand\" >= 800 AND \"inv_quantity_on_hand\" <= 1000) AS \"t\",\r\n                                (SELECT *\r\n                                FROM \"item\"\r\n                                WHERE CAST(\"i_category\" AS CHAR(5)) IN ('Books', 'Shoes') AND (\"i_manager_id\" >= 81 AND \"i_manager_id\" <= 100)) AS \"t0\"\r\n                        WHERE \"t\".\"inv_item_sk\" = \"t0\".\"i_item_sk\") AS \"t1\",\r\n                    \"warehouse\"\r\n                WHERE \"t1\".\"inv_warehouse_sk\" = \"warehouse\".\"w_warehouse_sk\") AS \"t2\",\r\n                (SELECT *\r\n                FROM \"date_dim\"\r\n                WHERE \"d_year\" = 1999 AND \"d_moy\" = 7) AS \"t3\"\r\n        WHERE \"t2\".\"inv_date_sk\" = \"t3\".\"d_date_sk\"\r\n        GROUP BY \"t2\".\"w_warehouse_name\", \"t2\".\"w_warehouse_sk\", \"t2\".\"i_item_sk\"\r\n        HAVING CASE WHEN CAST(CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END / COUNT(\"t2\".\"inv_quantity_on_hand\") AS INTEGER) = 0 THEN FALSE ELSE CAST(POWER((CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\" * \"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\" * \"t2\".\"inv_quantity_on_hand\"), 0) END - CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END * CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END / COUNT(\"t2\".\"inv_quantity_on_hand\")) / CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 1 THEN NULL ELSE COUNT(\"t2\".\"inv_quantity_on_hand\") - 1 END, 0.5) AS INTEGER) / CAST(CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END / COUNT(\"t2\".\"inv_quantity_on_hand\") AS INTEGER) > 1 END) AS \"t8\",\r\n        (SELECT \"t12\".\"w_warehouse_name0\" AS \"inv_date_sk0\", \"t12\".\"w_warehouse_sk0\" AS \"inv_item_sk0\", \"t12\".\"i_item_sk0\" AS \"inv_warehouse_sk0\", CAST(8 AS INTEGER) AS \"$f3\", CAST(POWER((CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\" * \"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\" * \"t12\".\"inv_quantity_on_hand0\"), 0) END - CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END * CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END / COUNT(\"t12\".\"inv_quantity_on_hand0\")) / CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 1 THEN NULL ELSE COUNT(\"t12\".\"inv_quantity_on_hand0\") - 1 END, 0.5) AS INTEGER) AS \"$f4\", CAST(CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END / COUNT(\"t12\".\"inv_quantity_on_hand0\") AS INTEGER) AS \"$f5\", CASE WHEN CAST(CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END / COUNT(\"t12\".\"inv_quantity_on_hand0\") AS INTEGER) = 0 THEN NULL ELSE CAST(POWER((CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\" * \"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\" * \"t12\".\"inv_quantity_on_hand0\"), 0) END - CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END * CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END / COUNT(\"t12\".\"inv_quantity_on_hand0\")) / CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 1 THEN NULL ELSE COUNT(\"t12\".\"inv_quantity_on_hand0\") - 1 END, 0.5) AS INTEGER) / CAST(CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END / COUNT(\"t12\".\"inv_quantity_on_hand0\") AS INTEGER) END AS \"$f6\"\r\n        FROM (SELECT *\r\n                FROM (SELECT *\r\n                        FROM (SELECT *\r\n                                FROM \"inventory\" AS \"inventory0\" (\"inv_date_sk0\", \"inv_item_sk0\", \"inv_warehouse_sk0\", \"inv_quantity_on_hand0\")\r\n                                WHERE \"inv_quantity_on_hand0\" >= 800 AND \"inv_quantity_on_hand0\" <= 1000) AS \"t9\",\r\n                                (SELECT *\r\n                                FROM \"item\" AS \"item0\" (\"i_item_sk0\", \"i_item_id0\", \"i_rec_start_date0\", \"i_rec_end_date0\", \"i_item_desc0\", \"i_current_price0\", \"i_wholesale_cost0\", \"i_brand_id0\", \"i_brand0\", \"i_class_id0\", \"i_class0\", \"i_category_id0\", \"i_category0\", \"i_manufact_id0\", \"i_manufact0\", \"i_size0\", \"i_formulation0\", \"i_color0\", \"i_units0\", \"i_container0\", \"i_manager_id0\", \"i_product_name0\")\r\n                                WHERE CAST(\"i_category0\" AS CHAR(5)) IN ('Books', 'Shoes') AND (\"i_manager_id0\" >= 81 AND \"i_manager_id0\" <= 100)) AS \"t10\"\r\n                        WHERE \"t9\".\"inv_item_sk0\" = \"t10\".\"i_item_sk0\") AS \"t11\",\r\n                    \"warehouse\" AS \"warehouse0\" (\"w_warehouse_sk0\", \"w_warehouse_id0\", \"w_warehouse_name0\", \"w_warehouse_sq_ft0\", \"w_street_number0\", \"w_street_name0\", \"w_street_type0\", \"w_suite_number0\", \"w_city0\", \"w_county0\", \"w_state0\", \"w_zip0\", \"w_country0\", \"w_gmt_offset0\")\r\n                WHERE \"t11\".\"inv_warehouse_sk0\" = \"warehouse0\".\"w_warehouse_sk0\") AS \"t12\",\r\n                (SELECT *\r\n                FROM \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\")\r\n                WHERE \"d_year0\" = 1999 AND \"d_moy0\" = 8) AS \"t13\"\r\n        WHERE \"t12\".\"inv_date_sk0\" = \"t13\".\"d_date_sk0\"\r\n        GROUP BY \"t12\".\"w_warehouse_name0\", \"t12\".\"w_warehouse_sk0\", \"t12\".\"i_item_sk0\"\r\n        HAVING CASE WHEN CAST(CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END / COUNT(\"t12\".\"inv_quantity_on_hand0\") AS INTEGER) = 0 THEN FALSE ELSE CAST(POWER((CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\" * \"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\" * \"t12\".\"inv_quantity_on_hand0\"), 0) END - CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END * CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END / COUNT(\"t12\".\"inv_quantity_on_hand0\")) / CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 1 THEN NULL ELSE COUNT(\"t12\".\"inv_quantity_on_hand0\") - 1 END, 0.5) AS INTEGER) / CAST(CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END / COUNT(\"t12\".\"inv_quantity_on_hand0\") AS INTEGER) > 1 END) AS \"t18\"\r\nWHERE \"t8\".\"i_item_sk\" = \"t18\".\"inv_warehouse_sk0\" AND \"t8\".\"w_warehouse_sk\" = \"t18\".\"inv_item_sk0\"\r\nORDER BY \"t8\".\"w_warehouse_sk\", \"t8\".\"i_item_sk\", 3, \"t8\".\"mean\", \"t8\".\"cov\", 8, \"t18\".\"$f5\", \"t18\".\"$f6\";", "output_cost": 64.12, "used_rules": ["FILTER_INTO_JOIN", "FILTER_PROJECT_TRANSPOSE", "FILTER_MERGE", "FILTER_REDUCE_EXPRESSIONS", "PROJECT_REDUCE_EXPRESSIONS", "FILTER_AGGREGATE_TRANSPOSE", "FILTER_PROJECT_TRANSPOSE", "PROJECT_REDUCE_EXPRESSIONS", "FILTER_INTO_JOIN", "FILTER_MERGE", "AGGREGATE_ANY_PULL_UP_CONSTANTS", "AGGREGATE_REDUCE_FUNCTIONS", "FILTER_PROJECT_TRANSPOSE", "PROJECT_TO_CALC", "CALC_MERGE", "JOIN_EXTRACT_FILTER"], "rewrite_time": 3151}
{"name": "query039_0_1", "input_sql": "with inv as\n(select w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy\n       ,stdev,mean, case mean when 0 then null else stdev/mean end cov\n from(select w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy\n            ,stddev_samp(inv_quantity_on_hand) stdev,avg(inv_quantity_on_hand) mean\n      from inventory\n          ,item\n          ,warehouse\n          ,date_dim\n      where inv_item_sk = i_item_sk\n        and inv_warehouse_sk = w_warehouse_sk\n        and inv_date_sk = d_date_sk\n        and d_year =1999\n        and i_category IN ('Books', 'Shoes')\n        and i_manager_id BETWEEN 81 and 100\n        and inv_quantity_on_hand between 800 and 1000\n      group by w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy) foo\n where case mean when 0 then 0 else stdev/mean end > 1)\nselect inv1.w_warehouse_sk,inv1.i_item_sk,inv1.d_moy,inv1.mean, inv1.cov\n        ,inv2.w_warehouse_sk,inv2.i_item_sk,inv2.d_moy,inv2.mean, inv2.cov\nfrom inv inv1,inv inv2\nwhere inv1.i_item_sk = inv2.i_item_sk\n  and inv1.w_warehouse_sk =  inv2.w_warehouse_sk\n  and inv1.d_moy=7\n  and inv2.d_moy=7+1\n  and inv1.cov > 1.5\norder by inv1.w_warehouse_sk,inv1.i_item_sk,inv1.d_moy,inv1.mean,inv1.cov\n        ,inv2.d_moy,inv2.mean, inv2.cov;", "input_cost": 30.7, "output_sql": "SELECT \"t8\".\"w_warehouse_sk\" AS \"w_warehouse_name\", \"t8\".\"i_item_sk\" AS \"w_warehouse_sk\", CAST(7 AS INTEGER) AS \"i_item_sk\", \"t8\".\"mean\" AS \"d_moy\", \"t8\".\"cov\" AS \"stdev\", \"t18\".\"inv_item_sk0\" AS \"mean\", \"t18\".\"inv_warehouse_sk0\" AS \"cov\", CAST(8 AS INTEGER) AS \"inv_date_sk0\", \"t18\".\"$f5\" AS \"inv_item_sk0\", \"t18\".\"$f6\" AS \"inv_warehouse_sk0\"\r\nFROM (SELECT \"t2\".\"w_warehouse_name\", \"t2\".\"w_warehouse_sk\", \"t2\".\"i_item_sk\", CAST(7 AS INTEGER) AS \"d_moy\", CAST(POWER((CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\" * \"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\" * \"t2\".\"inv_quantity_on_hand\"), 0) END - CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END * CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END / COUNT(\"t2\".\"inv_quantity_on_hand\")) / CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 1 THEN NULL ELSE COUNT(\"t2\".\"inv_quantity_on_hand\") - 1 END, 0.5) AS INTEGER) AS \"stdev\", CAST(CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END / COUNT(\"t2\".\"inv_quantity_on_hand\") AS INTEGER) AS \"mean\", CASE WHEN CAST(CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END / COUNT(\"t2\".\"inv_quantity_on_hand\") AS INTEGER) = 0 THEN NULL ELSE CAST(POWER((CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\" * \"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\" * \"t2\".\"inv_quantity_on_hand\"), 0) END - CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END * CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END / COUNT(\"t2\".\"inv_quantity_on_hand\")) / CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 1 THEN NULL ELSE COUNT(\"t2\".\"inv_quantity_on_hand\") - 1 END, 0.5) AS INTEGER) / CAST(CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END / COUNT(\"t2\".\"inv_quantity_on_hand\") AS INTEGER) END AS \"cov\"\r\n        FROM (SELECT *\r\n                FROM (SELECT *\r\n                        FROM (SELECT *\r\n                                FROM \"inventory\"\r\n                                WHERE \"inv_quantity_on_hand\" >= 800 AND \"inv_quantity_on_hand\" <= 1000) AS \"t\",\r\n                                (SELECT *\r\n                                FROM \"item\"\r\n                                WHERE CAST(\"i_category\" AS CHAR(5)) IN ('Books', 'Shoes') AND (\"i_manager_id\" >= 81 AND \"i_manager_id\" <= 100)) AS \"t0\"\r\n                        WHERE \"t\".\"inv_item_sk\" = \"t0\".\"i_item_sk\") AS \"t1\",\r\n                    \"warehouse\"\r\n                WHERE \"t1\".\"inv_warehouse_sk\" = \"warehouse\".\"w_warehouse_sk\") AS \"t2\",\r\n                (SELECT *\r\n                FROM \"date_dim\"\r\n                WHERE \"d_year\" = 1999 AND \"d_moy\" = 7) AS \"t3\"\r\n        WHERE \"t2\".\"inv_date_sk\" = \"t3\".\"d_date_sk\"\r\n        GROUP BY \"t2\".\"w_warehouse_name\", \"t2\".\"w_warehouse_sk\", \"t2\".\"i_item_sk\"\r\n        HAVING CASE WHEN CAST(CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END / COUNT(\"t2\".\"inv_quantity_on_hand\") AS INTEGER) = 0 THEN FALSE ELSE CAST(POWER((CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\" * \"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\" * \"t2\".\"inv_quantity_on_hand\"), 0) END - CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END * CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END / COUNT(\"t2\".\"inv_quantity_on_hand\")) / CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 1 THEN NULL ELSE COUNT(\"t2\".\"inv_quantity_on_hand\") - 1 END, 0.5) AS INTEGER) / CAST(CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END / COUNT(\"t2\".\"inv_quantity_on_hand\") AS INTEGER) > 1 END AND CASE WHEN CAST(CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END / COUNT(\"t2\".\"inv_quantity_on_hand\") AS INTEGER) = 0 THEN FALSE ELSE CAST(POWER((CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\" * \"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\" * \"t2\".\"inv_quantity_on_hand\"), 0) END - CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END * CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END / COUNT(\"t2\".\"inv_quantity_on_hand\")) / CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 1 THEN NULL ELSE COUNT(\"t2\".\"inv_quantity_on_hand\") - 1 END, 0.5) AS INTEGER) / CAST(CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END / COUNT(\"t2\".\"inv_quantity_on_hand\") AS INTEGER) > 1.5 END) AS \"t8\",\r\n        (SELECT \"t12\".\"w_warehouse_name0\" AS \"inv_date_sk0\", \"t12\".\"w_warehouse_sk0\" AS \"inv_item_sk0\", \"t12\".\"i_item_sk0\" AS \"inv_warehouse_sk0\", CAST(8 AS INTEGER) AS \"$f3\", CAST(POWER((CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\" * \"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\" * \"t12\".\"inv_quantity_on_hand0\"), 0) END - CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END * CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END / COUNT(\"t12\".\"inv_quantity_on_hand0\")) / CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 1 THEN NULL ELSE COUNT(\"t12\".\"inv_quantity_on_hand0\") - 1 END, 0.5) AS INTEGER) AS \"$f4\", CAST(CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END / COUNT(\"t12\".\"inv_quantity_on_hand0\") AS INTEGER) AS \"$f5\", CASE WHEN CAST(CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END / COUNT(\"t12\".\"inv_quantity_on_hand0\") AS INTEGER) = 0 THEN NULL ELSE CAST(POWER((CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\" * \"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\" * \"t12\".\"inv_quantity_on_hand0\"), 0) END - CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END * CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END / COUNT(\"t12\".\"inv_quantity_on_hand0\")) / CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 1 THEN NULL ELSE COUNT(\"t12\".\"inv_quantity_on_hand0\") - 1 END, 0.5) AS INTEGER) / CAST(CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END / COUNT(\"t12\".\"inv_quantity_on_hand0\") AS INTEGER) END AS \"$f6\"\r\n        FROM (SELECT *\r\n                FROM (SELECT *\r\n                        FROM (SELECT *\r\n                                FROM \"inventory\" AS \"inventory0\" (\"inv_date_sk0\", \"inv_item_sk0\", \"inv_warehouse_sk0\", \"inv_quantity_on_hand0\")\r\n                                WHERE \"inv_quantity_on_hand0\" >= 800 AND \"inv_quantity_on_hand0\" <= 1000) AS \"t9\",\r\n                                (SELECT *\r\n                                FROM \"item\" AS \"item0\" (\"i_item_sk0\", \"i_item_id0\", \"i_rec_start_date0\", \"i_rec_end_date0\", \"i_item_desc0\", \"i_current_price0\", \"i_wholesale_cost0\", \"i_brand_id0\", \"i_brand0\", \"i_class_id0\", \"i_class0\", \"i_category_id0\", \"i_category0\", \"i_manufact_id0\", \"i_manufact0\", \"i_size0\", \"i_formulation0\", \"i_color0\", \"i_units0\", \"i_container0\", \"i_manager_id0\", \"i_product_name0\")\r\n                                WHERE CAST(\"i_category0\" AS CHAR(5)) IN ('Books', 'Shoes') AND (\"i_manager_id0\" >= 81 AND \"i_manager_id0\" <= 100)) AS \"t10\"\r\n                        WHERE \"t9\".\"inv_item_sk0\" = \"t10\".\"i_item_sk0\") AS \"t11\",\r\n                    \"warehouse\" AS \"warehouse0\" (\"w_warehouse_sk0\", \"w_warehouse_id0\", \"w_warehouse_name0\", \"w_warehouse_sq_ft0\", \"w_street_number0\", \"w_street_name0\", \"w_street_type0\", \"w_suite_number0\", \"w_city0\", \"w_county0\", \"w_state0\", \"w_zip0\", \"w_country0\", \"w_gmt_offset0\")\r\n                WHERE \"t11\".\"inv_warehouse_sk0\" = \"warehouse0\".\"w_warehouse_sk0\") AS \"t12\",\r\n                (SELECT *\r\n                FROM \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\")\r\n                WHERE \"d_year0\" = 1999 AND \"d_moy0\" = 8) AS \"t13\"\r\n        WHERE \"t12\".\"inv_date_sk0\" = \"t13\".\"d_date_sk0\"\r\n        GROUP BY \"t12\".\"w_warehouse_name0\", \"t12\".\"w_warehouse_sk0\", \"t12\".\"i_item_sk0\"\r\n        HAVING CASE WHEN CAST(CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END / COUNT(\"t12\".\"inv_quantity_on_hand0\") AS INTEGER) = 0 THEN FALSE ELSE CAST(POWER((CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\" * \"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\" * \"t12\".\"inv_quantity_on_hand0\"), 0) END - CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END * CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END / COUNT(\"t12\".\"inv_quantity_on_hand0\")) / CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 1 THEN NULL ELSE COUNT(\"t12\".\"inv_quantity_on_hand0\") - 1 END, 0.5) AS INTEGER) / CAST(CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END / COUNT(\"t12\".\"inv_quantity_on_hand0\") AS INTEGER) > 1 END) AS \"t18\"\r\nWHERE \"t8\".\"i_item_sk\" = \"t18\".\"inv_warehouse_sk0\" AND \"t8\".\"w_warehouse_sk\" = \"t18\".\"inv_item_sk0\"\r\nORDER BY \"t8\".\"w_warehouse_sk\", \"t8\".\"i_item_sk\", \"t8\".\"mean\", \"t8\".\"cov\", \"t18\".\"$f5\", \"t18\".\"$f6\";", "output_cost": 64.17, "used_rules": ["FILTER_INTO_JOIN", "FILTER_PROJECT_TRANSPOSE", "FILTER_MERGE", "FILTER_REDUCE_EXPRESSIONS", "PROJECT_REDUCE_EXPRESSIONS", "FILTER_AGGREGATE_TRANSPOSE", "FILTER_PROJECT_TRANSPOSE", "PROJECT_REDUCE_EXPRESSIONS", "FILTER_INTO_JOIN", "FILTER_MERGE", "SORT_REMOVE_CONSTANT_KEYS", "SORT_PROJECT_TRANSPOSE", "AGGREGATE_ANY_PULL_UP_CONSTANTS", "AGGREGATE_REDUCE_FUNCTIONS", "FILTER_PROJECT_TRANSPOSE", "PROJECT_TO_CALC", "CALC_MERGE", "JOIN_EXTRACT_FILTER"], "rewrite_time": 3219}
{"name": "query039_1_0", "input_sql": "with inv as\n(select w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy\n       ,stdev,mean, case mean when 0 then null else stdev/mean end cov\n from(select w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy\n            ,stddev_samp(inv_quantity_on_hand) stdev,avg(inv_quantity_on_hand) mean\n      from inventory\n          ,item\n          ,warehouse\n          ,date_dim\n      where inv_item_sk = i_item_sk\n        and inv_warehouse_sk = w_warehouse_sk\n        and inv_date_sk = d_date_sk\n        and d_year =2001\n        and i_category IN ('Books', 'Electronics')\n        and i_manager_id BETWEEN 17 and 36\n        and inv_quantity_on_hand between 607 and 807\n      group by w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy) foo\n where case mean when 0 then 0 else stdev/mean end > 1)\nselect inv1.w_warehouse_sk,inv1.i_item_sk,inv1.d_moy,inv1.mean, inv1.cov\n        ,inv2.w_warehouse_sk,inv2.i_item_sk,inv2.d_moy,inv2.mean, inv2.cov\nfrom inv inv1,inv inv2\nwhere inv1.i_item_sk = inv2.i_item_sk\n  and inv1.w_warehouse_sk =  inv2.w_warehouse_sk\n  and inv1.d_moy=2\n  and inv2.d_moy=2+1\norder by inv1.w_warehouse_sk,inv1.i_item_sk,inv1.d_moy,inv1.mean,inv1.cov\n        ,inv2.d_moy,inv2.mean, inv2.cov;", "input_cost": 30.69, "output_sql": "SELECT \"t8\".\"w_warehouse_sk\" AS \"w_warehouse_name\", \"t8\".\"i_item_sk\" AS \"w_warehouse_sk\", CAST(2 AS INTEGER) AS \"i_item_sk\", \"t8\".\"mean\" AS \"d_moy\", \"t8\".\"cov\" AS \"stdev\", \"t18\".\"inv_item_sk0\" AS \"mean\", \"t18\".\"inv_warehouse_sk0\" AS \"cov\", CAST(3 AS INTEGER) AS \"inv_date_sk0\", \"t18\".\"$f5\" AS \"inv_item_sk0\", \"t18\".\"$f6\" AS \"inv_warehouse_sk0\"\r\nFROM (SELECT \"t2\".\"w_warehouse_name\", \"t2\".\"w_warehouse_sk\", \"t2\".\"i_item_sk\", CAST(2 AS INTEGER) AS \"d_moy\", CAST(POWER((CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\" * \"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\" * \"t2\".\"inv_quantity_on_hand\"), 0) END - CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END * CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END / COUNT(\"t2\".\"inv_quantity_on_hand\")) / CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 1 THEN NULL ELSE COUNT(\"t2\".\"inv_quantity_on_hand\") - 1 END, 0.5) AS INTEGER) AS \"stdev\", CAST(CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END / COUNT(\"t2\".\"inv_quantity_on_hand\") AS INTEGER) AS \"mean\", CASE WHEN CAST(CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END / COUNT(\"t2\".\"inv_quantity_on_hand\") AS INTEGER) = 0 THEN NULL ELSE CAST(POWER((CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\" * \"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\" * \"t2\".\"inv_quantity_on_hand\"), 0) END - CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END * CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END / COUNT(\"t2\".\"inv_quantity_on_hand\")) / CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 1 THEN NULL ELSE COUNT(\"t2\".\"inv_quantity_on_hand\") - 1 END, 0.5) AS INTEGER) / CAST(CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END / COUNT(\"t2\".\"inv_quantity_on_hand\") AS INTEGER) END AS \"cov\"\r\n        FROM (SELECT *\r\n                FROM (SELECT *\r\n                        FROM (SELECT *\r\n                                FROM \"inventory\"\r\n                                WHERE \"inv_quantity_on_hand\" >= 607 AND \"inv_quantity_on_hand\" <= 807) AS \"t\",\r\n                                (SELECT *\r\n                                FROM \"item\"\r\n                                WHERE (\"i_category\" = 'Books' OR \"i_category\" = 'Electronics') AND (\"i_manager_id\" >= 17 AND \"i_manager_id\" <= 36)) AS \"t0\"\r\n                        WHERE \"t\".\"inv_item_sk\" = \"t0\".\"i_item_sk\") AS \"t1\",\r\n                    \"warehouse\"\r\n                WHERE \"t1\".\"inv_warehouse_sk\" = \"warehouse\".\"w_warehouse_sk\") AS \"t2\",\r\n                (SELECT *\r\n                FROM \"date_dim\"\r\n                WHERE \"d_year\" = 2001 AND \"d_moy\" = 2) AS \"t3\"\r\n        WHERE \"t2\".\"inv_date_sk\" = \"t3\".\"d_date_sk\"\r\n        GROUP BY \"t2\".\"w_warehouse_name\", \"t2\".\"w_warehouse_sk\", \"t2\".\"i_item_sk\"\r\n        HAVING CASE WHEN CAST(CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END / COUNT(\"t2\".\"inv_quantity_on_hand\") AS INTEGER) = 0 THEN FALSE ELSE CAST(POWER((CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\" * \"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\" * \"t2\".\"inv_quantity_on_hand\"), 0) END - CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END * CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END / COUNT(\"t2\".\"inv_quantity_on_hand\")) / CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 1 THEN NULL ELSE COUNT(\"t2\".\"inv_quantity_on_hand\") - 1 END, 0.5) AS INTEGER) / CAST(CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END / COUNT(\"t2\".\"inv_quantity_on_hand\") AS INTEGER) > 1 END) AS \"t8\",\r\n        (SELECT \"t12\".\"w_warehouse_name0\" AS \"inv_date_sk0\", \"t12\".\"w_warehouse_sk0\" AS \"inv_item_sk0\", \"t12\".\"i_item_sk0\" AS \"inv_warehouse_sk0\", CAST(3 AS INTEGER) AS \"$f3\", CAST(POWER((CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\" * \"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\" * \"t12\".\"inv_quantity_on_hand0\"), 0) END - CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END * CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END / COUNT(\"t12\".\"inv_quantity_on_hand0\")) / CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 1 THEN NULL ELSE COUNT(\"t12\".\"inv_quantity_on_hand0\") - 1 END, 0.5) AS INTEGER) AS \"$f4\", CAST(CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END / COUNT(\"t12\".\"inv_quantity_on_hand0\") AS INTEGER) AS \"$f5\", CASE WHEN CAST(CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END / COUNT(\"t12\".\"inv_quantity_on_hand0\") AS INTEGER) = 0 THEN NULL ELSE CAST(POWER((CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\" * \"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\" * \"t12\".\"inv_quantity_on_hand0\"), 0) END - CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END * CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END / COUNT(\"t12\".\"inv_quantity_on_hand0\")) / CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 1 THEN NULL ELSE COUNT(\"t12\".\"inv_quantity_on_hand0\") - 1 END, 0.5) AS INTEGER) / CAST(CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END / COUNT(\"t12\".\"inv_quantity_on_hand0\") AS INTEGER) END AS \"$f6\"\r\n        FROM (SELECT *\r\n                FROM (SELECT *\r\n                        FROM (SELECT *\r\n                                FROM \"inventory\" AS \"inventory0\" (\"inv_date_sk0\", \"inv_item_sk0\", \"inv_warehouse_sk0\", \"inv_quantity_on_hand0\")\r\n                                WHERE \"inv_quantity_on_hand0\" >= 607 AND \"inv_quantity_on_hand0\" <= 807) AS \"t9\",\r\n                                (SELECT *\r\n                                FROM \"item\" AS \"item0\" (\"i_item_sk0\", \"i_item_id0\", \"i_rec_start_date0\", \"i_rec_end_date0\", \"i_item_desc0\", \"i_current_price0\", \"i_wholesale_cost0\", \"i_brand_id0\", \"i_brand0\", \"i_class_id0\", \"i_class0\", \"i_category_id0\", \"i_category0\", \"i_manufact_id0\", \"i_manufact0\", \"i_size0\", \"i_formulation0\", \"i_color0\", \"i_units0\", \"i_container0\", \"i_manager_id0\", \"i_product_name0\")\r\n                                WHERE (\"i_category0\" = 'Books' OR \"i_category0\" = 'Electronics') AND (\"i_manager_id0\" >= 17 AND \"i_manager_id0\" <= 36)) AS \"t10\"\r\n                        WHERE \"t9\".\"inv_item_sk0\" = \"t10\".\"i_item_sk0\") AS \"t11\",\r\n                    \"warehouse\" AS \"warehouse0\" (\"w_warehouse_sk0\", \"w_warehouse_id0\", \"w_warehouse_name0\", \"w_warehouse_sq_ft0\", \"w_street_number0\", \"w_street_name0\", \"w_street_type0\", \"w_suite_number0\", \"w_city0\", \"w_county0\", \"w_state0\", \"w_zip0\", \"w_country0\", \"w_gmt_offset0\")\r\n                WHERE \"t11\".\"inv_warehouse_sk0\" = \"warehouse0\".\"w_warehouse_sk0\") AS \"t12\",\r\n                (SELECT *\r\n                FROM \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\")\r\n                WHERE \"d_year0\" = 2001 AND \"d_moy0\" = 3) AS \"t13\"\r\n        WHERE \"t12\".\"inv_date_sk0\" = \"t13\".\"d_date_sk0\"\r\n        GROUP BY \"t12\".\"w_warehouse_name0\", \"t12\".\"w_warehouse_sk0\", \"t12\".\"i_item_sk0\"\r\n        HAVING CASE WHEN CAST(CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END / COUNT(\"t12\".\"inv_quantity_on_hand0\") AS INTEGER) = 0 THEN FALSE ELSE CAST(POWER((CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\" * \"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\" * \"t12\".\"inv_quantity_on_hand0\"), 0) END - CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END * CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END / COUNT(\"t12\".\"inv_quantity_on_hand0\")) / CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 1 THEN NULL ELSE COUNT(\"t12\".\"inv_quantity_on_hand0\") - 1 END, 0.5) AS INTEGER) / CAST(CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END / COUNT(\"t12\".\"inv_quantity_on_hand0\") AS INTEGER) > 1 END) AS \"t18\"\r\nWHERE \"t8\".\"i_item_sk\" = \"t18\".\"inv_warehouse_sk0\" AND \"t8\".\"w_warehouse_sk\" = \"t18\".\"inv_item_sk0\"\r\nORDER BY \"t8\".\"w_warehouse_sk\", \"t8\".\"i_item_sk\", \"t8\".\"mean\", \"t8\".\"cov\", \"t18\".\"$f5\", \"t18\".\"$f6\";", "output_cost": 61.54, "used_rules": ["FILTER_INTO_JOIN", "FILTER_PROJECT_TRANSPOSE", "FILTER_MERGE", "FILTER_REDUCE_EXPRESSIONS", "PROJECT_REDUCE_EXPRESSIONS", "FILTER_AGGREGATE_TRANSPOSE", "FILTER_PROJECT_TRANSPOSE", "PROJECT_REDUCE_EXPRESSIONS", "FILTER_INTO_JOIN", "FILTER_MERGE", "SORT_REMOVE_CONSTANT_KEYS", "SORT_PROJECT_TRANSPOSE", "AGGREGATE_ANY_PULL_UP_CONSTANTS", "AGGREGATE_REDUCE_FUNCTIONS", "FILTER_PROJECT_TRANSPOSE", "PROJECT_TO_CALC", "CALC_MERGE", "JOIN_EXTRACT_FILTER"], "rewrite_time": 3187}
{"name": "query039_1_1", "input_sql": "with inv as\n(select w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy\n       ,stdev,mean, case mean when 0 then null else stdev/mean end cov\n from(select w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy\n            ,stddev_samp(inv_quantity_on_hand) stdev,avg(inv_quantity_on_hand) mean\n      from inventory\n          ,item\n          ,warehouse\n          ,date_dim\n      where inv_item_sk = i_item_sk\n        and inv_warehouse_sk = w_warehouse_sk\n        and inv_date_sk = d_date_sk\n        and d_year =2001\n        and i_category IN ('Books', 'Electronics')\n        and i_manager_id BETWEEN 17 and 36\n        and inv_quantity_on_hand between 607 and 807\n      group by w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy) foo\n where case mean when 0 then 0 else stdev/mean end > 1)\nselect inv1.w_warehouse_sk,inv1.i_item_sk,inv1.d_moy,inv1.mean, inv1.cov\n        ,inv2.w_warehouse_sk,inv2.i_item_sk,inv2.d_moy,inv2.mean, inv2.cov\nfrom inv inv1,inv inv2\nwhere inv1.i_item_sk = inv2.i_item_sk\n  and inv1.w_warehouse_sk =  inv2.w_warehouse_sk\n  and inv1.d_moy=2\n  and inv2.d_moy=2+1\n  and inv1.cov > 1.5\norder by inv1.w_warehouse_sk,inv1.i_item_sk,inv1.d_moy,inv1.mean,inv1.cov\n        ,inv2.d_moy,inv2.mean, inv2.cov;", "input_cost": 30.7, "output_sql": "SELECT \"t8\".\"w_warehouse_sk\" AS \"w_warehouse_name\", \"t8\".\"i_item_sk\" AS \"w_warehouse_sk\", CAST(2 AS INTEGER) AS \"i_item_sk\", \"t8\".\"mean\" AS \"d_moy\", \"t8\".\"cov\" AS \"stdev\", \"t18\".\"inv_item_sk0\" AS \"mean\", \"t18\".\"inv_warehouse_sk0\" AS \"cov\", CAST(3 AS INTEGER) AS \"inv_date_sk0\", \"t18\".\"$f5\" AS \"inv_item_sk0\", \"t18\".\"$f6\" AS \"inv_warehouse_sk0\"\r\nFROM (SELECT \"t2\".\"w_warehouse_name\", \"t2\".\"w_warehouse_sk\", \"t2\".\"i_item_sk\", CAST(2 AS INTEGER) AS \"d_moy\", CAST(POWER((CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\" * \"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\" * \"t2\".\"inv_quantity_on_hand\"), 0) END - CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END * CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END / COUNT(\"t2\".\"inv_quantity_on_hand\")) / CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 1 THEN NULL ELSE COUNT(\"t2\".\"inv_quantity_on_hand\") - 1 END, 0.5) AS INTEGER) AS \"stdev\", CAST(CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END / COUNT(\"t2\".\"inv_quantity_on_hand\") AS INTEGER) AS \"mean\", CASE WHEN CAST(CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END / COUNT(\"t2\".\"inv_quantity_on_hand\") AS INTEGER) = 0 THEN NULL ELSE CAST(POWER((CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\" * \"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\" * \"t2\".\"inv_quantity_on_hand\"), 0) END - CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END * CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END / COUNT(\"t2\".\"inv_quantity_on_hand\")) / CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 1 THEN NULL ELSE COUNT(\"t2\".\"inv_quantity_on_hand\") - 1 END, 0.5) AS INTEGER) / CAST(CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END / COUNT(\"t2\".\"inv_quantity_on_hand\") AS INTEGER) END AS \"cov\"\r\n        FROM (SELECT *\r\n                FROM (SELECT *\r\n                        FROM (SELECT *\r\n                                FROM \"inventory\"\r\n                                WHERE \"inv_quantity_on_hand\" >= 607 AND \"inv_quantity_on_hand\" <= 807) AS \"t\",\r\n                                (SELECT *\r\n                                FROM \"item\"\r\n                                WHERE (\"i_category\" = 'Books' OR \"i_category\" = 'Electronics') AND (\"i_manager_id\" >= 17 AND \"i_manager_id\" <= 36)) AS \"t0\"\r\n                        WHERE \"t\".\"inv_item_sk\" = \"t0\".\"i_item_sk\") AS \"t1\",\r\n                    \"warehouse\"\r\n                WHERE \"t1\".\"inv_warehouse_sk\" = \"warehouse\".\"w_warehouse_sk\") AS \"t2\",\r\n                (SELECT *\r\n                FROM \"date_dim\"\r\n                WHERE \"d_year\" = 2001 AND \"d_moy\" = 2) AS \"t3\"\r\n        WHERE \"t2\".\"inv_date_sk\" = \"t3\".\"d_date_sk\"\r\n        GROUP BY \"t2\".\"w_warehouse_name\", \"t2\".\"w_warehouse_sk\", \"t2\".\"i_item_sk\"\r\n        HAVING CASE WHEN CAST(CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END / COUNT(\"t2\".\"inv_quantity_on_hand\") AS INTEGER) = 0 THEN FALSE ELSE CAST(POWER((CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\" * \"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\" * \"t2\".\"inv_quantity_on_hand\"), 0) END - CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END * CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END / COUNT(\"t2\".\"inv_quantity_on_hand\")) / CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 1 THEN NULL ELSE COUNT(\"t2\".\"inv_quantity_on_hand\") - 1 END, 0.5) AS INTEGER) / CAST(CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END / COUNT(\"t2\".\"inv_quantity_on_hand\") AS INTEGER) > 1 END AND CASE WHEN CAST(CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END / COUNT(\"t2\".\"inv_quantity_on_hand\") AS INTEGER) = 0 THEN FALSE ELSE CAST(POWER((CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\" * \"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\" * \"t2\".\"inv_quantity_on_hand\"), 0) END - CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END * CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END / COUNT(\"t2\".\"inv_quantity_on_hand\")) / CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 1 THEN NULL ELSE COUNT(\"t2\".\"inv_quantity_on_hand\") - 1 END, 0.5) AS INTEGER) / CAST(CASE WHEN COUNT(\"t2\".\"inv_quantity_on_hand\") = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"inv_quantity_on_hand\"), 0) END / COUNT(\"t2\".\"inv_quantity_on_hand\") AS INTEGER) > 1.5 END) AS \"t8\",\r\n        (SELECT \"t12\".\"w_warehouse_name0\" AS \"inv_date_sk0\", \"t12\".\"w_warehouse_sk0\" AS \"inv_item_sk0\", \"t12\".\"i_item_sk0\" AS \"inv_warehouse_sk0\", CAST(3 AS INTEGER) AS \"$f3\", CAST(POWER((CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\" * \"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\" * \"t12\".\"inv_quantity_on_hand0\"), 0) END - CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END * CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END / COUNT(\"t12\".\"inv_quantity_on_hand0\")) / CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 1 THEN NULL ELSE COUNT(\"t12\".\"inv_quantity_on_hand0\") - 1 END, 0.5) AS INTEGER) AS \"$f4\", CAST(CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END / COUNT(\"t12\".\"inv_quantity_on_hand0\") AS INTEGER) AS \"$f5\", CASE WHEN CAST(CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END / COUNT(\"t12\".\"inv_quantity_on_hand0\") AS INTEGER) = 0 THEN NULL ELSE CAST(POWER((CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\" * \"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\" * \"t12\".\"inv_quantity_on_hand0\"), 0) END - CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END * CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END / COUNT(\"t12\".\"inv_quantity_on_hand0\")) / CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 1 THEN NULL ELSE COUNT(\"t12\".\"inv_quantity_on_hand0\") - 1 END, 0.5) AS INTEGER) / CAST(CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END / COUNT(\"t12\".\"inv_quantity_on_hand0\") AS INTEGER) END AS \"$f6\"\r\n        FROM (SELECT *\r\n                FROM (SELECT *\r\n                        FROM (SELECT *\r\n                                FROM \"inventory\" AS \"inventory0\" (\"inv_date_sk0\", \"inv_item_sk0\", \"inv_warehouse_sk0\", \"inv_quantity_on_hand0\")\r\n                                WHERE \"inv_quantity_on_hand0\" >= 607 AND \"inv_quantity_on_hand0\" <= 807) AS \"t9\",\r\n                                (SELECT *\r\n                                FROM \"item\" AS \"item0\" (\"i_item_sk0\", \"i_item_id0\", \"i_rec_start_date0\", \"i_rec_end_date0\", \"i_item_desc0\", \"i_current_price0\", \"i_wholesale_cost0\", \"i_brand_id0\", \"i_brand0\", \"i_class_id0\", \"i_class0\", \"i_category_id0\", \"i_category0\", \"i_manufact_id0\", \"i_manufact0\", \"i_size0\", \"i_formulation0\", \"i_color0\", \"i_units0\", \"i_container0\", \"i_manager_id0\", \"i_product_name0\")\r\n                                WHERE (\"i_category0\" = 'Books' OR \"i_category0\" = 'Electronics') AND (\"i_manager_id0\" >= 17 AND \"i_manager_id0\" <= 36)) AS \"t10\"\r\n                        WHERE \"t9\".\"inv_item_sk0\" = \"t10\".\"i_item_sk0\") AS \"t11\",\r\n                    \"warehouse\" AS \"warehouse0\" (\"w_warehouse_sk0\", \"w_warehouse_id0\", \"w_warehouse_name0\", \"w_warehouse_sq_ft0\", \"w_street_number0\", \"w_street_name0\", \"w_street_type0\", \"w_suite_number0\", \"w_city0\", \"w_county0\", \"w_state0\", \"w_zip0\", \"w_country0\", \"w_gmt_offset0\")\r\n                WHERE \"t11\".\"inv_warehouse_sk0\" = \"warehouse0\".\"w_warehouse_sk0\") AS \"t12\",\r\n                (SELECT *\r\n                FROM \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\")\r\n                WHERE \"d_year0\" = 2001 AND \"d_moy0\" = 3) AS \"t13\"\r\n        WHERE \"t12\".\"inv_date_sk0\" = \"t13\".\"d_date_sk0\"\r\n        GROUP BY \"t12\".\"w_warehouse_name0\", \"t12\".\"w_warehouse_sk0\", \"t12\".\"i_item_sk0\"\r\n        HAVING CASE WHEN CAST(CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END / COUNT(\"t12\".\"inv_quantity_on_hand0\") AS INTEGER) = 0 THEN FALSE ELSE CAST(POWER((CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\" * \"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\" * \"t12\".\"inv_quantity_on_hand0\"), 0) END - CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END * CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END / COUNT(\"t12\".\"inv_quantity_on_hand0\")) / CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 1 THEN NULL ELSE COUNT(\"t12\".\"inv_quantity_on_hand0\") - 1 END, 0.5) AS INTEGER) / CAST(CASE WHEN COUNT(\"t12\".\"inv_quantity_on_hand0\") = 0 THEN NULL ELSE COALESCE(SUM(\"t12\".\"inv_quantity_on_hand0\"), 0) END / COUNT(\"t12\".\"inv_quantity_on_hand0\") AS INTEGER) > 1 END) AS \"t18\"\r\nWHERE \"t8\".\"i_item_sk\" = \"t18\".\"inv_warehouse_sk0\" AND \"t8\".\"w_warehouse_sk\" = \"t18\".\"inv_item_sk0\"\r\nORDER BY \"t8\".\"w_warehouse_sk\", \"t8\".\"i_item_sk\", 3, \"t8\".\"mean\", \"t8\".\"cov\", 8, \"t18\".\"$f5\", \"t18\".\"$f6\";", "output_cost": 61.6, "used_rules": ["FILTER_INTO_JOIN", "FILTER_PROJECT_TRANSPOSE", "FILTER_MERGE", "FILTER_REDUCE_EXPRESSIONS", "PROJECT_REDUCE_EXPRESSIONS", "FILTER_AGGREGATE_TRANSPOSE", "FILTER_PROJECT_TRANSPOSE", "PROJECT_REDUCE_EXPRESSIONS", "FILTER_INTO_JOIN", "FILTER_MERGE", "AGGREGATE_ANY_PULL_UP_CONSTANTS", "AGGREGATE_REDUCE_FUNCTIONS", "FILTER_PROJECT_TRANSPOSE", "PROJECT_TO_CALC", "CALC_MERGE", "JOIN_EXTRACT_FILTER"], "rewrite_time": 3230}
{"name": "query040_0", "input_sql": "select \n   w_state\n  ,i_item_id\n  ,sum(case when (cast(d_date as date) < cast ('2001-05-21' as date))\n \t\tthen cs_sales_price - coalesce(cr_refunded_cash,0) else 0 end) as sales_before\n  ,sum(case when (cast(d_date as date) >= cast ('2001-05-21' as date))\n \t\tthen cs_sales_price - coalesce(cr_refunded_cash,0) else 0 end) as sales_after\n from\n   catalog_sales left outer join catalog_returns on\n       (cs_order_number = cr_order_number\n        and cs_item_sk = cr_item_sk)\n  ,warehouse\n  ,item\n  ,date_dim\n where\n i_item_sk          = cs_item_sk\n and cs_warehouse_sk    = w_warehouse_sk\n and cs_sold_date_sk    = d_date_sk\n and d_date between  (cast ('2001-05-21' as date) - interval '30' day)\n                and (cast ('2001-05-21' as date) + interval '30' day) \n and i_category  = 'Books'\n and i_manager_id between 61 and 100\n and cs_wholesale_cost between 81 and 100\n and cr_reason_sk = 5\n group by\n    w_state,i_item_id\n order by w_state,i_item_id\nlimit 100;", "input_cost": 43.04, "output_sql": "SELECT \"warehouse\".\"w_state\", \"t1\".\"i_item_id\", SUM(CASE WHEN \"t2\".\"d_date\" < DATE '2001-05-21' THEN \"t\".\"cs_sales_price\" - CASE WHEN \"t0\".\"cr_refunded_cash\" IS NOT NULL THEN CAST(\"t0\".\"cr_refunded_cash\" AS DECIMAL(12, 2)) ELSE 0 END ELSE 0 END) AS \"sales_before\", SUM(CASE WHEN \"t2\".\"d_date\" >= DATE '2001-05-21' THEN \"t\".\"cs_sales_price\" - CASE WHEN \"t0\".\"cr_refunded_cash\" IS NOT NULL THEN CAST(\"t0\".\"cr_refunded_cash\" AS DECIMAL(12, 2)) ELSE 0 END ELSE 0 END) AS \"sales_after\"\r\nFROM (SELECT *\r\n        FROM \"catalog_sales\"\r\n        WHERE \"cs_wholesale_cost\" >= 81 AND \"cs_wholesale_cost\" <= 100) AS \"t\"\r\n    INNER JOIN (SELECT *\r\n        FROM \"catalog_returns\"\r\n        WHERE \"cr_reason_sk\" = 5) AS \"t0\" ON \"t\".\"cs_order_number\" = \"t0\".\"cr_order_number\" AND \"t\".\"cs_item_sk\" = \"t0\".\"cr_item_sk\"\r\n    INNER JOIN \"warehouse\" ON \"t\".\"cs_warehouse_sk\" = \"warehouse\".\"w_warehouse_sk\"\r\n    INNER JOIN (SELECT *\r\n        FROM \"item\"\r\n        WHERE \"i_category\" = 'Books' AND (\"i_manager_id\" >= 61 AND \"i_manager_id\" <= 100)) AS \"t1\" ON \"t\".\"cs_item_sk\" = \"t1\".\"i_item_sk\"\r\n    INNER JOIN (SELECT *\r\n        FROM \"date_dim\"\r\n        WHERE \"d_date\" >= DATE '2001-04-21' AND \"d_date\" <= DATE '2001-06-20') AS \"t2\" ON \"t\".\"cs_sold_date_sk\" = \"t2\".\"d_date_sk\"\r\nGROUP BY \"warehouse\".\"w_state\", \"t1\".\"i_item_id\"\r\nORDER BY \"warehouse\".\"w_state\", \"t1\".\"i_item_id\"\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 43.04, "used_rules": ["FILTER_INTO_JOIN", "FILTER_REDUCE_EXPRESSIONS", "PROJECT_REDUCE_EXPRESSIONS", "JOIN_PROJECT_LEFT_TRANSPOSE", "JOIN_EXTRACT_FILTER", "FILTER_INTO_JOIN", "PROJECT_TO_CALC", "CALC_MERGE"], "rewrite_time": 2185}
{"name": "query040_1", "input_sql": "select \n   w_state\n  ,i_item_id\n  ,sum(case when (cast(d_date as date) < cast ('1999-04-19' as date))\n \t\tthen cs_sales_price - coalesce(cr_refunded_cash,0) else 0 end) as sales_before\n  ,sum(case when (cast(d_date as date) >= cast ('1999-04-19' as date))\n \t\tthen cs_sales_price - coalesce(cr_refunded_cash,0) else 0 end) as sales_after\n from\n   catalog_sales left outer join catalog_returns on\n       (cs_order_number = cr_order_number\n        and cs_item_sk = cr_item_sk)\n  ,warehouse\n  ,item\n  ,date_dim\n where\n i_item_sk          = cs_item_sk\n and cs_warehouse_sk    = w_warehouse_sk\n and cs_sold_date_sk    = d_date_sk\n and d_date between  (cast ('1999-04-19' as date) - interval '30' day)\n                and (cast ('1999-04-19' as date) + interval '30' day) \n and i_category  = 'Sports'\n and i_manager_id between 61 and 100\n and cs_wholesale_cost between 13 and 32\n and cr_reason_sk = 57\n group by\n    w_state,i_item_id\n order by w_state,i_item_id\nlimit 100;", "input_cost": 43.04, "output_sql": "SELECT \"warehouse\".\"w_state\", \"t1\".\"i_item_id\", SUM(CASE WHEN \"t2\".\"d_date\" < DATE '1999-04-19' THEN \"t\".\"cs_sales_price\" - CASE WHEN \"t0\".\"cr_refunded_cash\" IS NOT NULL THEN CAST(\"t0\".\"cr_refunded_cash\" AS DECIMAL(12, 2)) ELSE 0 END ELSE 0 END) AS \"sales_before\", SUM(CASE WHEN \"t2\".\"d_date\" >= DATE '1999-04-19' THEN \"t\".\"cs_sales_price\" - CASE WHEN \"t0\".\"cr_refunded_cash\" IS NOT NULL THEN CAST(\"t0\".\"cr_refunded_cash\" AS DECIMAL(12, 2)) ELSE 0 END ELSE 0 END) AS \"sales_after\"\r\nFROM (SELECT *\r\n        FROM \"catalog_sales\"\r\n        WHERE \"cs_wholesale_cost\" >= 13 AND \"cs_wholesale_cost\" <= 32) AS \"t\"\r\n    INNER JOIN (SELECT *\r\n        FROM \"catalog_returns\"\r\n        WHERE \"cr_reason_sk\" = 57) AS \"t0\" ON \"t\".\"cs_order_number\" = \"t0\".\"cr_order_number\" AND \"t\".\"cs_item_sk\" = \"t0\".\"cr_item_sk\"\r\n    INNER JOIN \"warehouse\" ON \"t\".\"cs_warehouse_sk\" = \"warehouse\".\"w_warehouse_sk\"\r\n    INNER JOIN (SELECT *\r\n        FROM \"item\"\r\n        WHERE \"i_category\" = 'Sports' AND (\"i_manager_id\" >= 61 AND \"i_manager_id\" <= 100)) AS \"t1\" ON \"t\".\"cs_item_sk\" = \"t1\".\"i_item_sk\"\r\n    INNER JOIN (SELECT *\r\n        FROM \"date_dim\"\r\n        WHERE \"d_date\" >= DATE '1999-03-20' AND \"d_date\" <= DATE '1999-05-19') AS \"t2\" ON \"t\".\"cs_sold_date_sk\" = \"t2\".\"d_date_sk\"\r\nGROUP BY \"warehouse\".\"w_state\", \"t1\".\"i_item_id\"\r\nORDER BY \"warehouse\".\"w_state\", \"t1\".\"i_item_id\"\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 43.04, "used_rules": ["FILTER_INTO_JOIN", "FILTER_REDUCE_EXPRESSIONS", "PROJECT_REDUCE_EXPRESSIONS", "JOIN_PROJECT_LEFT_TRANSPOSE", "JOIN_EXTRACT_FILTER", "FILTER_INTO_JOIN", "PROJECT_TO_CALC", "CALC_MERGE"], "rewrite_time": 2067}
{"name": "query050_0", "input_sql": "select \n   s_store_name\n  ,s_company_id\n  ,s_street_number\n  ,s_street_name\n  ,s_street_type\n  ,s_suite_number\n  ,s_city\n  ,s_county\n  ,s_state\n  ,s_zip\n  ,sum(case when (sr_returned_date_sk - ss_sold_date_sk <= 30 ) then 1 else 0 end)  as \"30 days\"\n  ,sum(case when (sr_returned_date_sk - ss_sold_date_sk > 30) and\n                 (sr_returned_date_sk - ss_sold_date_sk <= 60) then 1 else 0 end )  as \"31-60 days\"\n  ,sum(case when (sr_returned_date_sk - ss_sold_date_sk > 60) and\n                 (sr_returned_date_sk - ss_sold_date_sk <= 90) then 1 else 0 end)  as \"61-90 days\"\n  ,sum(case when (sr_returned_date_sk - ss_sold_date_sk > 90) and\n                 (sr_returned_date_sk - ss_sold_date_sk <= 120) then 1 else 0 end)  as \"91-120 days\"\n  ,sum(case when (sr_returned_date_sk - ss_sold_date_sk  > 120) then 1 else 0 end)  as \">120 days\"\nfrom\n   store_sales\n  ,store_returns\n  ,store\n  ,date_dim d1\n  ,date_dim d2\nwhere\n    d2.d_year = 1999\nand d2.d_moy  = 4\nand ss_ticket_number = sr_ticket_number\nand ss_item_sk = sr_item_sk\nand ss_sold_date_sk   = d1.d_date_sk\nand sr_returned_date_sk   = d2.d_date_sk\nand ss_customer_sk = sr_customer_sk\nand ss_store_sk = s_store_sk\nand d1.d_date between (d2.d_date - interval '120' day)\n               and d2.d_date\ngroup by\n   s_store_name\n  ,s_company_id\n  ,s_street_number\n  ,s_street_name\n  ,s_street_type\n  ,s_suite_number\n  ,s_city\n  ,s_county\n  ,s_state\n  ,s_zip\norder by s_store_name\n        ,s_company_id\n        ,s_street_number\n        ,s_street_name\n        ,s_street_type\n        ,s_suite_number\n        ,s_city\n        ,s_county\n        ,s_state\n        ,s_zip\nlimit 100;", "input_cost": 34.75, "output_sql": "SELECT \"t1\".\"s_store_name\" AS \"ss_sold_date_sk\", \"t1\".\"s_company_id\" AS \"ss_sold_time_sk\", \"t1\".\"s_street_number\" AS \"ss_item_sk\", \"t1\".\"s_street_name\" AS \"ss_customer_sk\", \"t1\".\"s_street_type\" AS \"ss_cdemo_sk\", \"t1\".\"s_suite_number\" AS \"ss_hdemo_sk\", \"t1\".\"s_city\" AS \"ss_addr_sk\", \"t1\".\"s_county\" AS \"ss_store_sk\", \"t1\".\"s_state\" AS \"ss_promo_sk\", \"t1\".\"s_zip\" AS \"ss_ticket_number\", COALESCE(SUM(CASE WHEN \"t1\".\"sr_returned_date_sk\" - \"t1\".\"ss_sold_date_sk\" <= 30 THEN 1 ELSE 0 END), 0) AS \"30 days\", COALESCE(SUM(CASE WHEN \"t1\".\"sr_returned_date_sk\" - \"t1\".\"ss_sold_date_sk\" > 30 AND \"t1\".\"sr_returned_date_sk\" - \"t1\".\"ss_sold_date_sk\" <= 60 THEN 1 ELSE 0 END), 0) AS \"31-60 days\", COALESCE(SUM(CASE WHEN \"t1\".\"sr_returned_date_sk\" - \"t1\".\"ss_sold_date_sk\" > 60 AND \"t1\".\"sr_returned_date_sk\" - \"t1\".\"ss_sold_date_sk\" <= 90 THEN 1 ELSE 0 END), 0) AS \"61-90 days\", COALESCE(SUM(CASE WHEN \"t1\".\"sr_returned_date_sk\" - \"t1\".\"ss_sold_date_sk\" > 90 AND \"t1\".\"sr_returned_date_sk\" - \"t1\".\"ss_sold_date_sk\" <= 120 THEN 1 ELSE 0 END), 0) AS \"91-120 days\", COALESCE(SUM(CASE WHEN \"t1\".\"sr_returned_date_sk\" - \"t1\".\"ss_sold_date_sk\" > 120 THEN 1 ELSE 0 END), 0) AS \">120 days\"\r\nFROM (SELECT *\r\n        FROM (SELECT *\r\n                FROM (SELECT *\r\n                        FROM \"store_sales\",\r\n                            \"store_returns\"\r\n                        WHERE \"store_sales\".\"ss_ticket_number\" = \"store_returns\".\"sr_ticket_number\" AND \"store_sales\".\"ss_item_sk\" = \"store_returns\".\"sr_item_sk\" AND \"store_sales\".\"ss_customer_sk\" = \"store_returns\".\"sr_customer_sk\") AS \"t\",\r\n                    \"store\"\r\n                WHERE \"t\".\"ss_store_sk\" = \"store\".\"s_store_sk\") AS \"t0\",\r\n            \"date_dim\"\r\n        WHERE \"t0\".\"ss_sold_date_sk\" = \"date_dim\".\"d_date_sk\") AS \"t1\",\r\n        (SELECT *\r\n        FROM \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\")\r\n        WHERE \"d_year0\" = 1999 AND \"d_moy0\" = 4) AS \"t2\"\r\nWHERE \"t1\".\"sr_returned_date_sk\" = \"t2\".\"d_date_sk0\" AND \"t1\".\"d_date\" >= (\"t2\".\"d_date0\" - INTERVAL '120' DAY) AND \"t1\".\"d_date\" <= \"t2\".\"d_date0\"\r\nGROUP BY \"t1\".\"s_store_name\", \"t1\".\"s_company_id\", \"t1\".\"s_street_number\", \"t1\".\"s_street_name\", \"t1\".\"s_street_type\", \"t1\".\"s_suite_number\", \"t1\".\"s_city\", \"t1\".\"s_county\", \"t1\".\"s_state\", \"t1\".\"s_zip\"\r\nORDER BY \"t1\".\"s_store_name\", \"t1\".\"s_company_id\", \"t1\".\"s_street_number\", \"t1\".\"s_street_name\", \"t1\".\"s_street_type\", \"t1\".\"s_suite_number\", \"t1\".\"s_city\", \"t1\".\"s_county\", \"t1\".\"s_state\", \"t1\".\"s_zip\"\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 34.75, "used_rules": ["FILTER_INTO_JOIN", "PROJECT_TO_CALC", "AGGREGATE_REDUCE_FUNCTIONS", "JOIN_EXTRACT_FILTER"], "rewrite_time": 1540}
{"name": "query050_1", "input_sql": "select \n   s_store_name\n  ,s_company_id\n  ,s_street_number\n  ,s_street_name\n  ,s_street_type\n  ,s_suite_number\n  ,s_city\n  ,s_county\n  ,s_state\n  ,s_zip\n  ,sum(case when (sr_returned_date_sk - ss_sold_date_sk <= 30 ) then 1 else 0 end)  as \"30 days\"\n  ,sum(case when (sr_returned_date_sk - ss_sold_date_sk > 30) and\n                 (sr_returned_date_sk - ss_sold_date_sk <= 60) then 1 else 0 end )  as \"31-60 days\"\n  ,sum(case when (sr_returned_date_sk - ss_sold_date_sk > 60) and\n                 (sr_returned_date_sk - ss_sold_date_sk <= 90) then 1 else 0 end)  as \"61-90 days\"\n  ,sum(case when (sr_returned_date_sk - ss_sold_date_sk > 90) and\n                 (sr_returned_date_sk - ss_sold_date_sk <= 120) then 1 else 0 end)  as \"91-120 days\"\n  ,sum(case when (sr_returned_date_sk - ss_sold_date_sk  > 120) then 1 else 0 end)  as \">120 days\"\nfrom\n   store_sales\n  ,store_returns\n  ,store\n  ,date_dim d1\n  ,date_dim d2\nwhere\n    d2.d_year = 2000\nand d2.d_moy  = 7\nand ss_ticket_number = sr_ticket_number\nand ss_item_sk = sr_item_sk\nand ss_sold_date_sk   = d1.d_date_sk\nand sr_returned_date_sk   = d2.d_date_sk\nand ss_customer_sk = sr_customer_sk\nand ss_store_sk = s_store_sk\nand d1.d_date between (d2.d_date - interval '120' day)\n               and d2.d_date\ngroup by\n   s_store_name\n  ,s_company_id\n  ,s_street_number\n  ,s_street_name\n  ,s_street_type\n  ,s_suite_number\n  ,s_city\n  ,s_county\n  ,s_state\n  ,s_zip\norder by s_store_name\n        ,s_company_id\n        ,s_street_number\n        ,s_street_name\n        ,s_street_type\n        ,s_suite_number\n        ,s_city\n        ,s_county\n        ,s_state\n        ,s_zip\nlimit 100;", "input_cost": 34.75, "output_sql": "SELECT \"t1\".\"s_store_name\" AS \"ss_sold_date_sk\", \"t1\".\"s_company_id\" AS \"ss_sold_time_sk\", \"t1\".\"s_street_number\" AS \"ss_item_sk\", \"t1\".\"s_street_name\" AS \"ss_customer_sk\", \"t1\".\"s_street_type\" AS \"ss_cdemo_sk\", \"t1\".\"s_suite_number\" AS \"ss_hdemo_sk\", \"t1\".\"s_city\" AS \"ss_addr_sk\", \"t1\".\"s_county\" AS \"ss_store_sk\", \"t1\".\"s_state\" AS \"ss_promo_sk\", \"t1\".\"s_zip\" AS \"ss_ticket_number\", COALESCE(SUM(CASE WHEN \"t1\".\"sr_returned_date_sk\" - \"t1\".\"ss_sold_date_sk\" <= 30 THEN 1 ELSE 0 END), 0) AS \"30 days\", COALESCE(SUM(CASE WHEN \"t1\".\"sr_returned_date_sk\" - \"t1\".\"ss_sold_date_sk\" > 30 AND \"t1\".\"sr_returned_date_sk\" - \"t1\".\"ss_sold_date_sk\" <= 60 THEN 1 ELSE 0 END), 0) AS \"31-60 days\", COALESCE(SUM(CASE WHEN \"t1\".\"sr_returned_date_sk\" - \"t1\".\"ss_sold_date_sk\" > 60 AND \"t1\".\"sr_returned_date_sk\" - \"t1\".\"ss_sold_date_sk\" <= 90 THEN 1 ELSE 0 END), 0) AS \"61-90 days\", COALESCE(SUM(CASE WHEN \"t1\".\"sr_returned_date_sk\" - \"t1\".\"ss_sold_date_sk\" > 90 AND \"t1\".\"sr_returned_date_sk\" - \"t1\".\"ss_sold_date_sk\" <= 120 THEN 1 ELSE 0 END), 0) AS \"91-120 days\", COALESCE(SUM(CASE WHEN \"t1\".\"sr_returned_date_sk\" - \"t1\".\"ss_sold_date_sk\" > 120 THEN 1 ELSE 0 END), 0) AS \">120 days\"\r\nFROM (SELECT *\r\n        FROM (SELECT *\r\n                FROM (SELECT *\r\n                        FROM \"store_sales\",\r\n                            \"store_returns\"\r\n                        WHERE \"store_sales\".\"ss_ticket_number\" = \"store_returns\".\"sr_ticket_number\" AND \"store_sales\".\"ss_item_sk\" = \"store_returns\".\"sr_item_sk\" AND \"store_sales\".\"ss_customer_sk\" = \"store_returns\".\"sr_customer_sk\") AS \"t\",\r\n                    \"store\"\r\n                WHERE \"t\".\"ss_store_sk\" = \"store\".\"s_store_sk\") AS \"t0\",\r\n            \"date_dim\"\r\n        WHERE \"t0\".\"ss_sold_date_sk\" = \"date_dim\".\"d_date_sk\") AS \"t1\",\r\n        (SELECT *\r\n        FROM \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\")\r\n        WHERE \"d_year0\" = 2000 AND \"d_moy0\" = 7) AS \"t2\"\r\nWHERE \"t1\".\"sr_returned_date_sk\" = \"t2\".\"d_date_sk0\" AND \"t1\".\"d_date\" >= (\"t2\".\"d_date0\" - INTERVAL '120' DAY) AND \"t1\".\"d_date\" <= \"t2\".\"d_date0\"\r\nGROUP BY \"t1\".\"s_store_name\", \"t1\".\"s_company_id\", \"t1\".\"s_street_number\", \"t1\".\"s_street_name\", \"t1\".\"s_street_type\", \"t1\".\"s_suite_number\", \"t1\".\"s_city\", \"t1\".\"s_county\", \"t1\".\"s_state\", \"t1\".\"s_zip\"\r\nORDER BY \"t1\".\"s_store_name\", \"t1\".\"s_company_id\", \"t1\".\"s_street_number\", \"t1\".\"s_street_name\", \"t1\".\"s_street_type\", \"t1\".\"s_suite_number\", \"t1\".\"s_city\", \"t1\".\"s_county\", \"t1\".\"s_state\", \"t1\".\"s_zip\"\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 34.75, "used_rules": ["FILTER_INTO_JOIN", "PROJECT_TO_CALC", "AGGREGATE_REDUCE_FUNCTIONS", "JOIN_EXTRACT_FILTER"], "rewrite_time": 1539}
{"name": "query054_0", "input_sql": "with my_customers as (\n select distinct c_customer_sk\n        , c_current_addr_sk\n from\n        ( select cs_sold_date_sk sold_date_sk,\n                 cs_bill_customer_sk customer_sk,\n                 cs_item_sk item_sk,\n                 cs_wholesale_cost wholesale_cost\n          from   catalog_sales\n          union all\n          select ws_sold_date_sk sold_date_sk,\n                 ws_bill_customer_sk customer_sk,\n                 ws_item_sk item_sk,\n                 ws_wholesale_cost wholesale_cost\n          from   web_sales\n         ) cs_or_ws_sales,\n         item,\n         date_dim,\n         customer\n where   sold_date_sk = d_date_sk\n         and item_sk = i_item_sk\n         and i_category = 'Home'\n         and i_class = 'furniture'\n         and c_customer_sk = cs_or_ws_sales.customer_sk\n         and d_moy = 12\n         and d_year = 1999\n         and wholesale_cost BETWEEN 70 AND 100\n         and c_birth_year BETWEEN 1980 AND 1993\n )\n , my_revenue as (\n select c_customer_sk,\n        sum(ss_ext_sales_price) as revenue\n from   my_customers,\n        store_sales,\n        customer_address,\n        store,\n        date_dim\n where  c_current_addr_sk = ca_address_sk\n        and ca_county = s_county\n        and ca_state = s_state\n        and ss_sold_date_sk = d_date_sk\n        and c_customer_sk = ss_customer_sk\n        and ss_wholesale_cost BETWEEN 70 AND 100\n        and s_state in ('GA','IA','IL'\n                    ,'KS','LA','ME'\n                    ,'MI','NC','ND'\n                    ,'OK')\n        and d_month_seq between (select distinct d_month_seq+1\n                                 from   date_dim where d_year = 1999 and d_moy = 12)\n                           and  (select distinct d_month_seq+3\n                                 from   date_dim where d_year = 1999 and d_moy = 12)\n group by c_customer_sk\n )\n , segments as\n (select cast((revenue/50) as int) as segment\n  from   my_revenue\n )\n  select  segment, count(*) as num_customers, segment*50 as segment_base\n from segments\n group by segment\n order by segment, num_customers\n limit 100;", "input_cost": 88.3, "output_sql": "SELECT \"segment\", \"num_customers\", \"segment\" * 50 AS \"segment_base\"\r\nFROM (SELECT \"t34\".\"segment\", COUNT(*) AS \"num_customers\"\r\n        FROM (SELECT CAST(CASE WHEN COALESCE(SUM(\"t23\".\"$f3\"), 0) = 0 THEN NULL ELSE COALESCE(SUM(\"t23\".\"revenue\"), 0) END / 50 AS INTEGER) AS \"segment\"\r\n                FROM (SELECT \"t19\".\"c_customer_sk\", \"t19\".\"ss_sold_date_sk\", COALESCE(SUM(\"t19\".\"revenue\" * \"t21\".\"$f2\"), 0) AS \"revenue\", COALESCE(SUM(\"t19\".\"$f5\" * \"t21\".\"$f2\"), 0) AS \"$f3\"\r\n                        FROM (SELECT \"t17\".\"c_customer_sk\", \"t17\".\"ss_sold_date_sk\", \"t18\".\"ca_county\", \"t18\".\"ca_state\", COALESCE(SUM(\"t17\".\"revenue\"), 0) AS \"revenue\", COALESCE(SUM(\"t17\".\"$f4\"), 0) AS \"$f5\"\r\n                                FROM (SELECT \"t14\".\"c_customer_sk\", \"t14\".\"c_current_addr_sk\", \"t16\".\"ss_sold_date_sk\", COALESCE(SUM(\"t16\".\"revenue\"), 0) AS \"revenue\", COALESCE(SUM(\"t16\".\"$f3\"), 0) AS \"$f4\"\r\n                                        FROM (SELECT \"t12\".\"customer_sk\", \"t13\".\"c_customer_sk\", \"t13\".\"c_current_addr_sk\"\r\n                                                FROM (SELECT \"t10\".\"customer_sk\"\r\n                                                        FROM (SELECT \"t8\".\"sold_date_sk\", \"t8\".\"customer_sk\"\r\n                                                                FROM (SELECT \"sold_date_sk\", \"customer_sk\", \"item_sk\"\r\n                                                                        FROM (SELECT \"cs_sold_date_sk\" AS \"sold_date_sk\", \"cs_bill_customer_sk\" AS \"customer_sk\", \"cs_item_sk\" AS \"item_sk\"\r\n                                                                                    FROM \"catalog_sales\"\r\n                                                                                    WHERE \"cs_wholesale_cost\" >= 70 AND \"cs_wholesale_cost\" <= 100\r\n                                                                                    GROUP BY \"cs_sold_date_sk\", \"cs_bill_customer_sk\", \"cs_item_sk\"\r\n                                                                                    UNION ALL\r\n                                                                                    SELECT \"ws_sold_date_sk\" AS \"sold_date_sk\", \"ws_bill_customer_sk\" AS \"customer_sk\", \"ws_item_sk\" AS \"item_sk\"\r\n                                                                                    FROM \"web_sales\"\r\n                                                                                    WHERE \"ws_wholesale_cost\" >= 70 AND \"ws_wholesale_cost\" <= 100\r\n                                                                                    GROUP BY \"ws_sold_date_sk\", \"ws_bill_customer_sk\", \"ws_item_sk\") AS \"t7\"\r\n                                                                        GROUP BY \"sold_date_sk\", \"customer_sk\", \"item_sk\") AS \"t8\"\r\n                                                                    INNER JOIN (SELECT *\r\n                                                                        FROM \"item\"\r\n                                                                        WHERE \"i_category\" = 'Home' AND \"i_class\" = 'furniture') AS \"t9\" ON \"t8\".\"item_sk\" = \"t9\".\"i_item_sk\"\r\n                                                                GROUP BY \"t8\".\"sold_date_sk\", \"t8\".\"customer_sk\") AS \"t10\"\r\n                                                            INNER JOIN (SELECT *\r\n                                                                FROM \"date_dim\"\r\n                                                                WHERE \"d_moy\" = 12 AND \"d_year\" = 1999) AS \"t11\" ON \"t10\".\"sold_date_sk\" = \"t11\".\"d_date_sk\"\r\n                                                        GROUP BY \"t10\".\"customer_sk\") AS \"t12\"\r\n                                                    INNER JOIN (SELECT *\r\n                                                        FROM \"customer\"\r\n                                                        WHERE \"c_birth_year\" >= 1980 AND \"c_birth_year\" <= 1993) AS \"t13\" ON \"t12\".\"customer_sk\" = \"t13\".\"c_customer_sk\") AS \"t14\"\r\n                                            INNER JOIN (SELECT \"ss_sold_date_sk\", \"ss_customer_sk\", COALESCE(SUM(\"ss_ext_sales_price\"), 0) AS \"revenue\", COUNT(\"ss_ext_sales_price\") AS \"$f3\"\r\n                                                FROM \"store_sales\"\r\n                                                WHERE \"ss_wholesale_cost\" >= 70 AND \"ss_wholesale_cost\" <= 100\r\n                                                GROUP BY \"ss_sold_date_sk\", \"ss_customer_sk\") AS \"t16\" ON \"t14\".\"c_customer_sk\" = \"t16\".\"ss_customer_sk\"\r\n                                        GROUP BY \"t14\".\"c_customer_sk\", \"t14\".\"c_current_addr_sk\", \"t16\".\"ss_sold_date_sk\") AS \"t17\"\r\n                                    INNER JOIN (SELECT *\r\n                                        FROM \"customer_address\"\r\n                                        WHERE CAST(\"ca_state\" AS CHAR(2)) IN ('GA', 'IA', 'IL', 'KS', 'LA', 'ME', 'MI', 'NC', 'ND', 'OK')) AS \"t18\" ON \"t17\".\"c_current_addr_sk\" = \"t18\".\"ca_address_sk\"\r\n                                GROUP BY \"t17\".\"c_customer_sk\", \"t17\".\"ss_sold_date_sk\", \"t18\".\"ca_county\", \"t18\".\"ca_state\") AS \"t19\"\r\n                            INNER JOIN (SELECT \"s_county\", \"s_state\", COUNT(*) AS \"$f2\"\r\n                                FROM \"store\"\r\n                                WHERE CAST(\"s_state\" AS CHAR(2)) IN ('GA', 'IA', 'IL', 'KS', 'LA', 'ME', 'MI', 'NC', 'ND', 'OK')\r\n                                GROUP BY \"s_county\", \"s_state\") AS \"t21\" ON \"t19\".\"ca_county\" = \"t21\".\"s_county\" AND \"t19\".\"ca_state\" = \"t21\".\"s_state\"\r\n                        GROUP BY \"t19\".\"c_customer_sk\", \"t19\".\"ss_sold_date_sk\") AS \"t23\"\r\n                    INNER JOIN (\"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\") INNER JOIN (SELECT CASE COUNT(*) WHEN 0 THEN NULL WHEN 1 THEN MIN(\"EXPR$0\") ELSE (SELECT CAST(NULL AS INTEGER)\r\n                                            UNION ALL\r\n                                            SELECT CAST(NULL AS INTEGER)) END AS \"$f0\"\r\n                            FROM (SELECT \"d_month_seq1\" + 1 AS \"EXPR$0\"\r\n                                    FROM \"date_dim\" AS \"date_dim1\" (\"d_date_sk1\", \"d_date_id1\", \"d_date1\", \"d_month_seq1\", \"d_week_seq1\", \"d_quarter_seq1\", \"d_year1\", \"d_dow1\", \"d_moy1\", \"d_dom1\", \"d_qoy1\", \"d_fy_year1\", \"d_fy_quarter_seq1\", \"d_fy_week_seq1\", \"d_day_name1\", \"d_quarter_name1\", \"d_holiday1\", \"d_weekend1\", \"d_following_holiday1\", \"d_first_dom1\", \"d_last_dom1\", \"d_same_day_ly1\", \"d_same_day_lq1\", \"d_current_day1\", \"d_current_week1\", \"d_current_month1\", \"d_current_quarter1\", \"d_current_year1\")\r\n                                    WHERE \"d_moy1\" = 12 AND \"d_year1\" = 1999\r\n                                    GROUP BY \"d_month_seq1\" + 1) AS \"t26\") AS \"t27\" ON \"date_dim0\".\"d_month_seq0\" >= \"t27\".\"$f0\" INNER JOIN (SELECT CASE COUNT(*) WHEN 0 THEN NULL WHEN 1 THEN MIN(\"EXPR$00\") ELSE (SELECT CAST(NULL AS INTEGER)\r\n                                            UNION ALL\r\n                                            SELECT CAST(NULL AS INTEGER)) END AS \"$f0\"\r\n                            FROM (SELECT \"d_month_seq2\" + 3 AS \"EXPR$00\"\r\n                                    FROM \"date_dim\" AS \"date_dim2\" (\"d_date_sk2\", \"d_date_id2\", \"d_date2\", \"d_month_seq2\", \"d_week_seq2\", \"d_quarter_seq2\", \"d_year2\", \"d_dow2\", \"d_moy2\", \"d_dom2\", \"d_qoy2\", \"d_fy_year2\", \"d_fy_quarter_seq2\", \"d_fy_week_seq2\", \"d_day_name2\", \"d_quarter_name2\", \"d_holiday2\", \"d_weekend2\", \"d_following_holiday2\", \"d_first_dom2\", \"d_last_dom2\", \"d_same_day_ly2\", \"d_same_day_lq2\", \"d_current_day2\", \"d_current_week2\", \"d_current_month2\", \"d_current_quarter2\", \"d_current_year2\")\r\n                                    WHERE \"d_moy2\" = 12 AND \"d_year2\" = 1999\r\n                                    GROUP BY \"d_month_seq2\" + 3) AS \"t30\") AS \"t31\" ON \"date_dim0\".\"d_month_seq0\" <= \"t31\".\"$f0\") ON \"t23\".\"ss_sold_date_sk\" = \"date_dim0\".\"d_date_sk0\"\r\n                GROUP BY \"t23\".\"c_customer_sk\") AS \"t34\"\r\n        GROUP BY \"t34\".\"segment\"\r\n        ORDER BY \"t34\".\"segment\", 2\r\n        FETCH NEXT 100 ROWS ONLY) AS \"t36\";", "output_cost": 110.64, "used_rules": ["FILTER_INTO_JOIN", "FILTER_SET_OP_TRANSPOSE", "FILTER_SUB_QUERY_TO_CORRELATE", "FILTER_INTO_JOIN", "FILTER_PROJECT_TRANSPOSE", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_REDUCE_FUNCTIONS", "AGGREGATE_JOIN_TRANSPOSE_EXTENDED", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_UNION_TRANSPOSE", "AGGREGATE_UNION_AGGREGATE", "AGGREGATE_UNION_TRANSPOSE", "AGGREGATE_UNION_AGGREGATE", "AGGREGATE_UNION_TRANSPOSE", "AGGREGATE_UNION_AGGREGATE", "AGGREGATE_UNION_TRANSPOSE", "JOIN_PUSH_TRANSITIVE_PREDICATES", "JOIN_PROJECT_LEFT_TRANSPOSE", "JOIN_EXTRACT_FILTER", "JOIN_PROJECT_RIGHT_TRANSPOSE", "FILTER_INTO_JOIN", "FILTER_AGGREGATE_TRANSPOSE", "FILTER_PROJECT_TRANSPOSE", "FILTER_MERGE", "FILTER_INTO_JOIN", "AGGREGATE_UNION_AGGREGATE", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_UNION_TRANSPOSE", "AGGREGATE_UNION_AGGREGATE", "AGGREGATE_UNION_TRANSPOSE", "AGGREGATE_UNION_AGGREGATE", "AGGREGATE_UNION_TRANSPOSE", "AGGREGATE_UNION_AGGREGATE", "AGGREGATE_UNION_TRANSPOSE", "AGGREGATE_UNION_AGGREGATE", "AGGREGATE_UNION_TRANSPOSE", "SORT_PROJECT_TRANSPOSE"], "rewrite_time": 4201}
{"name": "query054_1", "input_sql": "with my_customers as (\n select distinct c_customer_sk\n        , c_current_addr_sk\n from\n        ( select cs_sold_date_sk sold_date_sk,\n                 cs_bill_customer_sk customer_sk,\n                 cs_item_sk item_sk,\n                 cs_wholesale_cost wholesale_cost\n          from   catalog_sales\n          union all\n          select ws_sold_date_sk sold_date_sk,\n                 ws_bill_customer_sk customer_sk,\n                 ws_item_sk item_sk,\n                 ws_wholesale_cost wholesale_cost\n          from   web_sales\n         ) cs_or_ws_sales,\n         item,\n         date_dim,\n         customer\n where   sold_date_sk = d_date_sk\n         and item_sk = i_item_sk\n         and i_category = 'Women'\n         and i_class = 'fragrances'\n         and c_customer_sk = cs_or_ws_sales.customer_sk\n         and d_moy = 6\n         and d_year = 1998\n         and wholesale_cost BETWEEN 48 AND 78\n         and c_birth_year BETWEEN 1980 AND 1993\n )\n , my_revenue as (\n select c_customer_sk,\n        sum(ss_ext_sales_price) as revenue\n from   my_customers,\n        store_sales,\n        customer_address,\n        store,\n        date_dim\n where  c_current_addr_sk = ca_address_sk\n        and ca_county = s_county\n        and ca_state = s_state\n        and ss_sold_date_sk = d_date_sk\n        and c_customer_sk = ss_customer_sk\n        and ss_wholesale_cost BETWEEN 48 AND 78\n        and s_state in ('GA','IN','KS'\n                    ,'KY','MD','MN'\n                    ,'NC','TN','VA'\n                    ,'WI')\n        and d_month_seq between (select distinct d_month_seq+1\n                                 from   date_dim where d_year = 1998 and d_moy = 6)\n                           and  (select distinct d_month_seq+3\n                                 from   date_dim where d_year = 1998 and d_moy = 6)\n group by c_customer_sk\n )\n , segments as\n (select cast((revenue/50) as int) as segment\n  from   my_revenue\n )\n  select  segment, count(*) as num_customers, segment*50 as segment_base\n from segments\n group by segment\n order by segment, num_customers\n limit 100;", "input_cost": 88.3, "output_sql": "SELECT \"segment\", \"num_customers\", \"segment\" * 50 AS \"segment_base\"\r\nFROM (SELECT \"t34\".\"segment\", COUNT(*) AS \"num_customers\"\r\n        FROM (SELECT CAST(CASE WHEN COALESCE(SUM(\"t23\".\"$f3\"), 0) = 0 THEN NULL ELSE COALESCE(SUM(\"t23\".\"revenue\"), 0) END / 50 AS INTEGER) AS \"segment\"\r\n                FROM (SELECT \"t19\".\"c_customer_sk\", \"t19\".\"ss_sold_date_sk\", COALESCE(SUM(\"t19\".\"revenue\" * \"t21\".\"$f2\"), 0) AS \"revenue\", COALESCE(SUM(\"t19\".\"$f5\" * \"t21\".\"$f2\"), 0) AS \"$f3\"\r\n                        FROM (SELECT \"t17\".\"c_customer_sk\", \"t17\".\"ss_sold_date_sk\", \"t18\".\"ca_county\", \"t18\".\"ca_state\", COALESCE(SUM(\"t17\".\"revenue\"), 0) AS \"revenue\", COALESCE(SUM(\"t17\".\"$f4\"), 0) AS \"$f5\"\r\n                                FROM (SELECT \"t14\".\"c_customer_sk\", \"t14\".\"c_current_addr_sk\", \"t16\".\"ss_sold_date_sk\", COALESCE(SUM(\"t16\".\"revenue\"), 0) AS \"revenue\", COALESCE(SUM(\"t16\".\"$f3\"), 0) AS \"$f4\"\r\n                                        FROM (SELECT \"t12\".\"customer_sk\", \"t13\".\"c_customer_sk\", \"t13\".\"c_current_addr_sk\"\r\n                                                FROM (SELECT \"t10\".\"customer_sk\"\r\n                                                        FROM (SELECT \"t8\".\"sold_date_sk\", \"t8\".\"customer_sk\"\r\n                                                                FROM (SELECT \"sold_date_sk\", \"customer_sk\", \"item_sk\"\r\n                                                                        FROM (SELECT \"cs_sold_date_sk\" AS \"sold_date_sk\", \"cs_bill_customer_sk\" AS \"customer_sk\", \"cs_item_sk\" AS \"item_sk\"\r\n                                                                                    FROM \"catalog_sales\"\r\n                                                                                    WHERE \"cs_wholesale_cost\" >= 48 AND \"cs_wholesale_cost\" <= 78\r\n                                                                                    GROUP BY \"cs_sold_date_sk\", \"cs_bill_customer_sk\", \"cs_item_sk\"\r\n                                                                                    UNION ALL\r\n                                                                                    SELECT \"ws_sold_date_sk\" AS \"sold_date_sk\", \"ws_bill_customer_sk\" AS \"customer_sk\", \"ws_item_sk\" AS \"item_sk\"\r\n                                                                                    FROM \"web_sales\"\r\n                                                                                    WHERE \"ws_wholesale_cost\" >= 48 AND \"ws_wholesale_cost\" <= 78\r\n                                                                                    GROUP BY \"ws_sold_date_sk\", \"ws_bill_customer_sk\", \"ws_item_sk\") AS \"t7\"\r\n                                                                        GROUP BY \"sold_date_sk\", \"customer_sk\", \"item_sk\") AS \"t8\"\r\n                                                                    INNER JOIN (SELECT *\r\n                                                                        FROM \"item\"\r\n                                                                        WHERE \"i_category\" = 'Women' AND \"i_class\" = 'fragrances') AS \"t9\" ON \"t8\".\"item_sk\" = \"t9\".\"i_item_sk\"\r\n                                                                GROUP BY \"t8\".\"sold_date_sk\", \"t8\".\"customer_sk\") AS \"t10\"\r\n                                                            INNER JOIN (SELECT *\r\n                                                                FROM \"date_dim\"\r\n                                                                WHERE \"d_moy\" = 6 AND \"d_year\" = 1998) AS \"t11\" ON \"t10\".\"sold_date_sk\" = \"t11\".\"d_date_sk\"\r\n                                                        GROUP BY \"t10\".\"customer_sk\") AS \"t12\"\r\n                                                    INNER JOIN (SELECT *\r\n                                                        FROM \"customer\"\r\n                                                        WHERE \"c_birth_year\" >= 1980 AND \"c_birth_year\" <= 1993) AS \"t13\" ON \"t12\".\"customer_sk\" = \"t13\".\"c_customer_sk\") AS \"t14\"\r\n                                            INNER JOIN (SELECT \"ss_sold_date_sk\", \"ss_customer_sk\", COALESCE(SUM(\"ss_ext_sales_price\"), 0) AS \"revenue\", COUNT(\"ss_ext_sales_price\") AS \"$f3\"\r\n                                                FROM \"store_sales\"\r\n                                                WHERE \"ss_wholesale_cost\" >= 48 AND \"ss_wholesale_cost\" <= 78\r\n                                                GROUP BY \"ss_sold_date_sk\", \"ss_customer_sk\") AS \"t16\" ON \"t14\".\"c_customer_sk\" = \"t16\".\"ss_customer_sk\"\r\n                                        GROUP BY \"t14\".\"c_customer_sk\", \"t14\".\"c_current_addr_sk\", \"t16\".\"ss_sold_date_sk\") AS \"t17\"\r\n                                    INNER JOIN (SELECT *\r\n                                        FROM \"customer_address\"\r\n                                        WHERE CAST(\"ca_state\" AS CHAR(2)) IN ('GA', 'IN', 'KS', 'KY', 'MD', 'MN', 'NC', 'TN', 'VA', 'WI')) AS \"t18\" ON \"t17\".\"c_current_addr_sk\" = \"t18\".\"ca_address_sk\"\r\n                                GROUP BY \"t17\".\"c_customer_sk\", \"t17\".\"ss_sold_date_sk\", \"t18\".\"ca_county\", \"t18\".\"ca_state\") AS \"t19\"\r\n                            INNER JOIN (SELECT \"s_county\", \"s_state\", COUNT(*) AS \"$f2\"\r\n                                FROM \"store\"\r\n                                WHERE CAST(\"s_state\" AS CHAR(2)) IN ('GA', 'IN', 'KS', 'KY', 'MD', 'MN', 'NC', 'TN', 'VA', 'WI')\r\n                                GROUP BY \"s_county\", \"s_state\") AS \"t21\" ON \"t19\".\"ca_county\" = \"t21\".\"s_county\" AND \"t19\".\"ca_state\" = \"t21\".\"s_state\"\r\n                        GROUP BY \"t19\".\"c_customer_sk\", \"t19\".\"ss_sold_date_sk\") AS \"t23\"\r\n                    INNER JOIN (\"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\") INNER JOIN (SELECT CASE COUNT(*) WHEN 0 THEN NULL WHEN 1 THEN MIN(\"EXPR$0\") ELSE (SELECT CAST(NULL AS INTEGER)\r\n                                            UNION ALL\r\n                                            SELECT CAST(NULL AS INTEGER)) END AS \"$f0\"\r\n                            FROM (SELECT \"d_month_seq1\" + 1 AS \"EXPR$0\"\r\n                                    FROM \"date_dim\" AS \"date_dim1\" (\"d_date_sk1\", \"d_date_id1\", \"d_date1\", \"d_month_seq1\", \"d_week_seq1\", \"d_quarter_seq1\", \"d_year1\", \"d_dow1\", \"d_moy1\", \"d_dom1\", \"d_qoy1\", \"d_fy_year1\", \"d_fy_quarter_seq1\", \"d_fy_week_seq1\", \"d_day_name1\", \"d_quarter_name1\", \"d_holiday1\", \"d_weekend1\", \"d_following_holiday1\", \"d_first_dom1\", \"d_last_dom1\", \"d_same_day_ly1\", \"d_same_day_lq1\", \"d_current_day1\", \"d_current_week1\", \"d_current_month1\", \"d_current_quarter1\", \"d_current_year1\")\r\n                                    WHERE \"d_moy1\" = 6 AND \"d_year1\" = 1998\r\n                                    GROUP BY \"d_month_seq1\" + 1) AS \"t26\") AS \"t27\" ON \"date_dim0\".\"d_month_seq0\" >= \"t27\".\"$f0\" INNER JOIN (SELECT CASE COUNT(*) WHEN 0 THEN NULL WHEN 1 THEN MIN(\"EXPR$00\") ELSE (SELECT CAST(NULL AS INTEGER)\r\n                                            UNION ALL\r\n                                            SELECT CAST(NULL AS INTEGER)) END AS \"$f0\"\r\n                            FROM (SELECT \"d_month_seq2\" + 3 AS \"EXPR$00\"\r\n                                    FROM \"date_dim\" AS \"date_dim2\" (\"d_date_sk2\", \"d_date_id2\", \"d_date2\", \"d_month_seq2\", \"d_week_seq2\", \"d_quarter_seq2\", \"d_year2\", \"d_dow2\", \"d_moy2\", \"d_dom2\", \"d_qoy2\", \"d_fy_year2\", \"d_fy_quarter_seq2\", \"d_fy_week_seq2\", \"d_day_name2\", \"d_quarter_name2\", \"d_holiday2\", \"d_weekend2\", \"d_following_holiday2\", \"d_first_dom2\", \"d_last_dom2\", \"d_same_day_ly2\", \"d_same_day_lq2\", \"d_current_day2\", \"d_current_week2\", \"d_current_month2\", \"d_current_quarter2\", \"d_current_year2\")\r\n                                    WHERE \"d_moy2\" = 6 AND \"d_year2\" = 1998\r\n                                    GROUP BY \"d_month_seq2\" + 3) AS \"t30\") AS \"t31\" ON \"date_dim0\".\"d_month_seq0\" <= \"t31\".\"$f0\") ON \"t23\".\"ss_sold_date_sk\" = \"date_dim0\".\"d_date_sk0\"\r\n                GROUP BY \"t23\".\"c_customer_sk\") AS \"t34\"\r\n        GROUP BY \"t34\".\"segment\"\r\n        ORDER BY \"t34\".\"segment\", 2\r\n        FETCH NEXT 100 ROWS ONLY) AS \"t36\";", "output_cost": 110.64, "used_rules": ["FILTER_INTO_JOIN", "FILTER_SET_OP_TRANSPOSE", "FILTER_SUB_QUERY_TO_CORRELATE", "FILTER_INTO_JOIN", "FILTER_PROJECT_TRANSPOSE", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_REDUCE_FUNCTIONS", "AGGREGATE_JOIN_TRANSPOSE_EXTENDED", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_UNION_TRANSPOSE", "AGGREGATE_UNION_AGGREGATE", "AGGREGATE_UNION_TRANSPOSE", "AGGREGATE_UNION_AGGREGATE", "AGGREGATE_UNION_TRANSPOSE", "AGGREGATE_UNION_AGGREGATE", "AGGREGATE_UNION_TRANSPOSE", "JOIN_PUSH_TRANSITIVE_PREDICATES", "JOIN_PROJECT_LEFT_TRANSPOSE", "JOIN_EXTRACT_FILTER", "JOIN_PROJECT_RIGHT_TRANSPOSE", "FILTER_INTO_JOIN", "FILTER_AGGREGATE_TRANSPOSE", "FILTER_PROJECT_TRANSPOSE", "FILTER_MERGE", "FILTER_INTO_JOIN", "AGGREGATE_UNION_AGGREGATE", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_UNION_TRANSPOSE", "AGGREGATE_UNION_AGGREGATE", "AGGREGATE_UNION_TRANSPOSE", "AGGREGATE_UNION_AGGREGATE", "AGGREGATE_UNION_TRANSPOSE", "AGGREGATE_UNION_AGGREGATE", "AGGREGATE_UNION_TRANSPOSE", "AGGREGATE_UNION_AGGREGATE", "AGGREGATE_UNION_TRANSPOSE", "SORT_PROJECT_TRANSPOSE"], "rewrite_time": 4412}
{"name": "query058_0", "input_sql": "with ss_items as\n (select i_item_id item_id\n       ,c_birth_year birth_year\n        ,sum(ss_ext_sales_price) ss_item_rev\n from store_sales\n     ,item\n     ,date_dim\n     ,customer\n where ss_item_sk = i_item_sk\n   and d_date in (select d_date\n                  from date_dim\n                  where d_month_seq = (select d_month_seq\n                                      from date_dim\n                                      where d_date = '2000-07-16'))\n   and ss_sold_date_sk   = d_date_sk\n   and ss_list_price between 271 and 300\n   and i_manager_id BETWEEN 71 and 100\n   and ss_customer_sk = c_customer_sk\n   and c_birth_year BETWEEN 1987 AND 1993\ngroup by i_item_id, c_birth_year),\n cs_items as\n (select i_item_id item_id\n        ,c_birth_year birth_year\n        ,sum(cs_ext_sales_price) cs_item_rev\n  from catalog_sales\n      ,item\n      ,date_dim\n      ,customer\n where cs_item_sk = i_item_sk\n  and  d_date in (select d_date\n                  from date_dim\n                  where d_month_seq = (select d_month_seq\n                                      from date_dim\n                                      where d_date = '2000-07-16'))\n  and  cs_sold_date_sk = d_date_sk\n  and  cs_list_price between 271 and 300\n  and i_manager_id BETWEEN 71 and 100\n  and cs_bill_customer_sk = c_customer_sk\n  and c_birth_year BETWEEN 1987 AND 1993\ngroup by i_item_id, c_birth_year),\n ws_items as\n (select i_item_id item_id\n      ,c_birth_year birth_year\n        ,sum(ws_ext_sales_price) ws_item_rev\n  from web_sales\n      ,item\n      ,date_dim\n      ,customer\n where ws_item_sk = i_item_sk\n  and  d_date in (select d_date\n                  from date_dim\n                  where d_month_seq = (select d_month_seq\n                                     from date_dim\n                                     where d_date = '2000-07-16'))\n  and ws_sold_date_sk   = d_date_sk\n  and ws_list_price between 271 and 300\n  and i_manager_id BETWEEN 71 and 100\n  and ws_bill_customer_sk = c_customer_sk\n  and c_birth_year BETWEEN 1987 AND 1993\ngroup by i_item_id, c_birth_year)\n  select  ss_items.item_id, ss_items.birth_year\n       ,ss_item_rev\n       ,ss_item_rev/((ss_item_rev+cs_item_rev+ws_item_rev)/3) * 100 ss_dev\n       ,cs_item_rev\n       ,cs_item_rev/((ss_item_rev+cs_item_rev+ws_item_rev)/3) * 100 cs_dev\n       ,ws_item_rev\n       ,ws_item_rev/((ss_item_rev+cs_item_rev+ws_item_rev)/3) * 100 ws_dev\n       ,(ss_item_rev+cs_item_rev+ws_item_rev)/3 average\n from ss_items,cs_items,ws_items\n where ss_items.item_id=cs_items.item_id\n   and ss_items.item_id=ws_items.item_id\n   and ss_items.birth_year = cs_items.birth_year\n   and ss_items.birth_year = ws_items.birth_year\n   and ss_item_rev between 0.9 * cs_item_rev and 1.1 * cs_item_rev\n   and ss_item_rev between 0.9 * ws_item_rev and 1.1 * ws_item_rev\n   and cs_item_rev between 0.9 * ss_item_rev and 1.1 * ss_item_rev\n   and cs_item_rev between 0.9 * ws_item_rev and 1.1 * ws_item_rev\n   and ws_item_rev between 0.9 * ss_item_rev and 1.1 * ss_item_rev\n   and ws_item_rev between 0.9 * cs_item_rev and 1.1 * cs_item_rev\n order by item_id, birth_year\n         ,ss_item_rev\n limit 100;", "input_cost": 163.53, "output_sql": "None", "output_cost": -1, "used_rules": [], "rewrite_time": 2838}
{"name": "query058_1", "input_sql": "with ss_items as\n (select i_item_id item_id\n       ,c_birth_year birth_year\n        ,sum(ss_ext_sales_price) ss_item_rev\n from store_sales\n     ,item\n     ,date_dim\n     ,customer\n where ss_item_sk = i_item_sk\n   and d_date in (select d_date\n                  from date_dim\n                  where d_month_seq = (select d_month_seq\n                                      from date_dim\n                                      where d_date = '2000-01-02'))\n   and ss_sold_date_sk   = d_date_sk\n   and ss_list_price between 95 and 124\n   and i_manager_id BETWEEN 7 and 36\n   and ss_customer_sk = c_customer_sk\n   and c_birth_year BETWEEN 1934 AND 1940\ngroup by i_item_id, c_birth_year),\n cs_items as\n (select i_item_id item_id\n        ,c_birth_year birth_year\n        ,sum(cs_ext_sales_price) cs_item_rev\n  from catalog_sales\n      ,item\n      ,date_dim\n      ,customer\n where cs_item_sk = i_item_sk\n  and  d_date in (select d_date\n                  from date_dim\n                  where d_month_seq = (select d_month_seq\n                                      from date_dim\n                                      where d_date = '2000-01-02'))\n  and  cs_sold_date_sk = d_date_sk\n  and  cs_list_price between 95 and 124\n  and i_manager_id BETWEEN 7 and 36\n  and cs_bill_customer_sk = c_customer_sk\n  and c_birth_year BETWEEN 1934 AND 1940\ngroup by i_item_id, c_birth_year),\n ws_items as\n (select i_item_id item_id\n      ,c_birth_year birth_year\n        ,sum(ws_ext_sales_price) ws_item_rev\n  from web_sales\n      ,item\n      ,date_dim\n      ,customer\n where ws_item_sk = i_item_sk\n  and  d_date in (select d_date\n                  from date_dim\n                  where d_month_seq = (select d_month_seq\n                                     from date_dim\n                                     where d_date = '2000-01-02'))\n  and ws_sold_date_sk   = d_date_sk\n  and ws_list_price between 95 and 124\n  and i_manager_id BETWEEN 7 and 36\n  and ws_bill_customer_sk = c_customer_sk\n  and c_birth_year BETWEEN 1934 AND 1940\ngroup by i_item_id, c_birth_year)\n  select  ss_items.item_id, ss_items.birth_year\n       ,ss_item_rev\n       ,ss_item_rev/((ss_item_rev+cs_item_rev+ws_item_rev)/3) * 100 ss_dev\n       ,cs_item_rev\n       ,cs_item_rev/((ss_item_rev+cs_item_rev+ws_item_rev)/3) * 100 cs_dev\n       ,ws_item_rev\n       ,ws_item_rev/((ss_item_rev+cs_item_rev+ws_item_rev)/3) * 100 ws_dev\n       ,(ss_item_rev+cs_item_rev+ws_item_rev)/3 average\n from ss_items,cs_items,ws_items\n where ss_items.item_id=cs_items.item_id\n   and ss_items.item_id=ws_items.item_id\n   and ss_items.birth_year = cs_items.birth_year\n   and ss_items.birth_year = ws_items.birth_year\n   and ss_item_rev between 0.9 * cs_item_rev and 1.1 * cs_item_rev\n   and ss_item_rev between 0.9 * ws_item_rev and 1.1 * ws_item_rev\n   and cs_item_rev between 0.9 * ss_item_rev and 1.1 * ss_item_rev\n   and cs_item_rev between 0.9 * ws_item_rev and 1.1 * ws_item_rev\n   and ws_item_rev between 0.9 * ss_item_rev and 1.1 * ss_item_rev\n   and ws_item_rev between 0.9 * cs_item_rev and 1.1 * cs_item_rev\n order by item_id, birth_year\n         ,ss_item_rev\n limit 100;", "input_cost": 163.53, "output_sql": "None", "output_cost": -1, "used_rules": [], "rewrite_time": 2887}
{"name": "query059_0", "input_sql": "with wss as\n (select d_week_seq,\n        ss_store_sk,\n        sum(case when (d_day_name='Sunday') then ss_sales_price else null end) sun_sales,\n        sum(case when (d_day_name='Monday') then ss_sales_price else null end) mon_sales,\n        sum(case when (d_day_name='Tuesday') then ss_sales_price else  null end) tue_sales,\n        sum(case when (d_day_name='Wednesday') then ss_sales_price else null end) wed_sales,\n        sum(case when (d_day_name='Thursday') then ss_sales_price else null end) thu_sales,\n        sum(case when (d_day_name='Friday') then ss_sales_price else null end) fri_sales,\n        sum(case when (d_day_name='Saturday') then ss_sales_price else null end) sat_sales\n from store_sales,date_dim\n where d_date_sk = ss_sold_date_sk\n and ss_sales_price / ss_list_price BETWEEN 77 * 0.01 AND 97 * 0.01\n group by d_week_seq,ss_store_sk\n )\n  select  s_store_name1,s_store_id1,d_week_seq1\n       ,sun_sales1/sun_sales2,mon_sales1/mon_sales2\n       ,tue_sales1/tue_sales2,wed_sales1/wed_sales2,thu_sales1/thu_sales2\n       ,fri_sales1/fri_sales2,sat_sales1/sat_sales2\n from\n (select s_store_name s_store_name1,wss.d_week_seq d_week_seq1\n        ,s_store_id s_store_id1,sun_sales sun_sales1\n        ,mon_sales mon_sales1,tue_sales tue_sales1\n        ,wed_sales wed_sales1,thu_sales thu_sales1\n        ,fri_sales fri_sales1,sat_sales sat_sales1\n  from wss,store,date_dim d\n  where d.d_week_seq = wss.d_week_seq and\n        ss_store_sk = s_store_sk and\n        d_month_seq between 1212 and 1212 + 11\n        and s_state in ('GA','IA','IL'\n                    ,'KS','LA','ME','MI','NC')\n        ) y,\n (select s_store_name s_store_name2,wss.d_week_seq d_week_seq2\n        ,s_store_id s_store_id2,sun_sales sun_sales2\n        ,mon_sales mon_sales2,tue_sales tue_sales2\n        ,wed_sales wed_sales2,thu_sales thu_sales2\n        ,fri_sales fri_sales2,sat_sales sat_sales2\n  from wss,store,date_dim d\n  where d.d_week_seq = wss.d_week_seq and\n        ss_store_sk = s_store_sk and\n        d_month_seq between 1212+ 12 and 1212 + 23\n        and s_state in ('GA','IA','IL'\n                    ,'KS','LA','ME','MI','NC')) x\n where s_store_id1=s_store_id2\n   and d_week_seq1=d_week_seq2-52\n order by s_store_name1,s_store_id1,d_week_seq1\nlimit 100;", "input_cost": 59.09, "output_sql": "None", "output_cost": -1, "used_rules": [], "rewrite_time": 776}
{"name": "query059_1", "input_sql": "with wss as\n (select d_week_seq,\n        ss_store_sk,\n        sum(case when (d_day_name='Sunday') then ss_sales_price else null end) sun_sales,\n        sum(case when (d_day_name='Monday') then ss_sales_price else null end) mon_sales,\n        sum(case when (d_day_name='Tuesday') then ss_sales_price else  null end) tue_sales,\n        sum(case when (d_day_name='Wednesday') then ss_sales_price else null end) wed_sales,\n        sum(case when (d_day_name='Thursday') then ss_sales_price else null end) thu_sales,\n        sum(case when (d_day_name='Friday') then ss_sales_price else null end) fri_sales,\n        sum(case when (d_day_name='Saturday') then ss_sales_price else null end) sat_sales\n from store_sales,date_dim\n where d_date_sk = ss_sold_date_sk\n and ss_sales_price / ss_list_price BETWEEN 54 * 0.01 AND 74 * 0.01\n group by d_week_seq,ss_store_sk\n )\n  select  s_store_name1,s_store_id1,d_week_seq1\n       ,sun_sales1/sun_sales2,mon_sales1/mon_sales2\n       ,tue_sales1/tue_sales2,wed_sales1/wed_sales2,thu_sales1/thu_sales2\n       ,fri_sales1/fri_sales2,sat_sales1/sat_sales2\n from\n (select s_store_name s_store_name1,wss.d_week_seq d_week_seq1\n        ,s_store_id s_store_id1,sun_sales sun_sales1\n        ,mon_sales mon_sales1,tue_sales tue_sales1\n        ,wed_sales wed_sales1,thu_sales thu_sales1\n        ,fri_sales fri_sales1,sat_sales sat_sales1\n  from wss,store,date_dim d\n  where d.d_week_seq = wss.d_week_seq and\n        ss_store_sk = s_store_sk and\n        d_month_seq between 1192 and 1192 + 11\n        and s_state in ('CO','GA','MN'\n                    ,'ND','NE','PA','TN','WI')\n        ) y,\n (select s_store_name s_store_name2,wss.d_week_seq d_week_seq2\n        ,s_store_id s_store_id2,sun_sales sun_sales2\n        ,mon_sales mon_sales2,tue_sales tue_sales2\n        ,wed_sales wed_sales2,thu_sales thu_sales2\n        ,fri_sales fri_sales2,sat_sales sat_sales2\n  from wss,store,date_dim d\n  where d.d_week_seq = wss.d_week_seq and\n        ss_store_sk = s_store_sk and\n        d_month_seq between 1192+ 12 and 1192 + 23\n        and s_state in ('CO','GA','MN'\n                    ,'ND','NE','PA','TN','WI')) x\n where s_store_id1=s_store_id2\n   and d_week_seq1=d_week_seq2-52\n order by s_store_name1,s_store_id1,d_week_seq1\nlimit 100;", "input_cost": 59.09, "output_sql": "None", "output_cost": -1, "used_rules": [], "rewrite_time": 730}
{"name": "query064_0", "input_sql": "with cs_ui as\n (select cs_item_sk\n        ,sum(cs_ext_list_price) as sale,sum(cr_refunded_cash+cr_reversed_charge+cr_store_credit) as refund\n  from catalog_sales\n      ,catalog_returns\n  where cs_item_sk = cr_item_sk\n    and cs_order_number = cr_order_number\n    and cs_wholesale_cost BETWEEN 73 AND 93\n   group by cs_item_sk\n  having sum(cs_ext_list_price)>2*sum(cr_refunded_cash+cr_reversed_charge+cr_store_credit)),\ncross_sales as\n (select i_product_name product_name\n     ,i_item_sk item_sk\n     ,s_store_name store_name\n     ,s_zip store_zip\n     ,ad1.ca_street_number b_street_number\n     ,ad1.ca_street_name b_street_name\n     ,ad1.ca_city b_city\n     ,ad1.ca_zip b_zip\n     ,ad2.ca_street_number c_street_number\n     ,ad2.ca_street_name c_street_name\n     ,ad2.ca_city c_city\n     ,ad2.ca_zip c_zip\n     ,d1.d_year as syear\n     ,d2.d_year as fsyear\n     ,d3.d_year s2year\n     ,count(*) cnt\n     ,sum(ss_wholesale_cost) s1\n     ,sum(ss_list_price) s2\n     ,sum(ss_coupon_amt) s3\n  FROM   store_sales\n        ,store_returns\n        ,cs_ui\n        ,date_dim d1\n        ,date_dim d2\n        ,date_dim d3\n        ,store\n        ,customer\n        ,customer_demographics cd1\n        ,customer_demographics cd2\n        ,promotion\n        ,household_demographics hd1\n        ,household_demographics hd2\n        ,customer_address ad1\n        ,customer_address ad2\n        ,income_band ib1\n        ,income_band ib2\n        ,item\n  WHERE  ss_store_sk = s_store_sk AND\n         ss_sold_date_sk = d1.d_date_sk AND\n         ss_customer_sk = c_customer_sk AND\n         ss_cdemo_sk= cd1.cd_demo_sk AND\n         ss_hdemo_sk = hd1.hd_demo_sk AND\n         ss_addr_sk = ad1.ca_address_sk and\n         ss_item_sk = i_item_sk and\n         ss_item_sk = sr_item_sk and\n         ss_ticket_number = sr_ticket_number and\n         ss_item_sk = cs_ui.cs_item_sk and\n         c_current_cdemo_sk = cd2.cd_demo_sk AND\n         c_current_hdemo_sk = hd2.hd_demo_sk AND\n         c_current_addr_sk = ad2.ca_address_sk and\n         c_first_sales_date_sk = d2.d_date_sk and\n         c_first_shipto_date_sk = d3.d_date_sk and\n         ss_promo_sk = p_promo_sk and\n         hd1.hd_income_band_sk = ib1.ib_income_band_sk and\n         hd2.hd_income_band_sk = ib2.ib_income_band_sk and\n         cd1.cd_marital_status <> cd2.cd_marital_status and\n         i_current_price between 80 and 80 + 10\n         and p_channel_email = 'Y'\n         and p_channel_tv = 'Y'\n         and p_channel_radio = 'Y'\n         and ad2.ca_state in ('IL','ME','MI')\n         and ss_wholesale_cost BETWEEN 73 AND 93\n         and cd1.cd_marital_status in ('M', 'M', 'S')\n         and cd1.cd_education_status in ('Unknown', '2 yr Degree', '2 yr Degree')\n         and cd2.cd_marital_status in ('M', 'M', 'S')\n         and cd2.cd_education_status in ('Unknown', '2 yr Degree', '2 yr Degree')\ngroup by i_product_name\n       ,i_item_sk\n       ,s_store_name\n       ,s_zip\n       ,ad1.ca_street_number\n       ,ad1.ca_street_name\n       ,ad1.ca_city\n       ,ad1.ca_zip\n       ,ad2.ca_street_number\n       ,ad2.ca_street_name\n       ,ad2.ca_city\n       ,ad2.ca_zip\n       ,d1.d_year\n       ,d2.d_year\n       ,d3.d_year\n)\nselect cs1.product_name\n     ,cs1.store_name\n     ,cs1.store_zip\n     ,cs1.b_street_number\n     ,cs1.b_street_name\n     ,cs1.b_city\n     ,cs1.b_zip\n     ,cs1.c_street_number\n     ,cs1.c_street_name\n     ,cs1.c_city\n     ,cs1.c_zip\n     ,cs1.syear\n     ,cs1.cnt\n     ,cs1.s1 as s11\n     ,cs1.s2 as s21\n     ,cs1.s3 as s31\n     ,cs2.s1 as s12\n     ,cs2.s2 as s22\n     ,cs2.s3 as s32\n     ,cs2.syear\n     ,cs2.cnt\nfrom cross_sales cs1,cross_sales cs2\nwhere cs1.item_sk=cs2.item_sk and\n     cs1.syear = 1998 and\n     cs2.syear = 1998 + 1 and\n     cs2.cnt <= cs1.cnt and\n     cs1.store_name = cs2.store_name and\n     cs1.store_zip = cs2.store_zip\norder by cs1.product_name\n       ,cs1.store_name\n       ,cs2.cnt\n       ,cs1.s1\n       ,cs2.s1;", "input_cost": 125.42, "output_sql": "None", "output_cost": -1, "used_rules": [], "rewrite_time": 4461}
{"name": "query064_1", "input_sql": "with cs_ui as\n (select cs_item_sk\n        ,sum(cs_ext_list_price) as sale,sum(cr_refunded_cash+cr_reversed_charge+cr_store_credit) as refund\n  from catalog_sales\n      ,catalog_returns\n  where cs_item_sk = cr_item_sk\n    and cs_order_number = cr_order_number\n    and cs_wholesale_cost BETWEEN 80 AND 100\n   group by cs_item_sk\n  having sum(cs_ext_list_price)>2*sum(cr_refunded_cash+cr_reversed_charge+cr_store_credit)),\ncross_sales as\n (select i_product_name product_name\n     ,i_item_sk item_sk\n     ,s_store_name store_name\n     ,s_zip store_zip\n     ,ad1.ca_street_number b_street_number\n     ,ad1.ca_street_name b_street_name\n     ,ad1.ca_city b_city\n     ,ad1.ca_zip b_zip\n     ,ad2.ca_street_number c_street_number\n     ,ad2.ca_street_name c_street_name\n     ,ad2.ca_city c_city\n     ,ad2.ca_zip c_zip\n     ,d1.d_year as syear\n     ,d2.d_year as fsyear\n     ,d3.d_year s2year\n     ,count(*) cnt\n     ,sum(ss_wholesale_cost) s1\n     ,sum(ss_list_price) s2\n     ,sum(ss_coupon_amt) s3\n  FROM   store_sales\n        ,store_returns\n        ,cs_ui\n        ,date_dim d1\n        ,date_dim d2\n        ,date_dim d3\n        ,store\n        ,customer\n        ,customer_demographics cd1\n        ,customer_demographics cd2\n        ,promotion\n        ,household_demographics hd1\n        ,household_demographics hd2\n        ,customer_address ad1\n        ,customer_address ad2\n        ,income_band ib1\n        ,income_band ib2\n        ,item\n  WHERE  ss_store_sk = s_store_sk AND\n         ss_sold_date_sk = d1.d_date_sk AND\n         ss_customer_sk = c_customer_sk AND\n         ss_cdemo_sk= cd1.cd_demo_sk AND\n         ss_hdemo_sk = hd1.hd_demo_sk AND\n         ss_addr_sk = ad1.ca_address_sk and\n         ss_item_sk = i_item_sk and\n         ss_item_sk = sr_item_sk and\n         ss_ticket_number = sr_ticket_number and\n         ss_item_sk = cs_ui.cs_item_sk and\n         c_current_cdemo_sk = cd2.cd_demo_sk AND\n         c_current_hdemo_sk = hd2.hd_demo_sk AND\n         c_current_addr_sk = ad2.ca_address_sk and\n         c_first_sales_date_sk = d2.d_date_sk and\n         c_first_shipto_date_sk = d3.d_date_sk and\n         ss_promo_sk = p_promo_sk and\n         hd1.hd_income_band_sk = ib1.ib_income_band_sk and\n         hd2.hd_income_band_sk = ib2.ib_income_band_sk and\n         cd1.cd_marital_status <> cd2.cd_marital_status and\n         i_current_price between 22 and 22 + 10\n         and p_channel_email = 'N'\n         and p_channel_tv = 'Y'\n         and p_channel_radio = 'Y'\n         and ad2.ca_state in ('PA','TN','WI')\n         and ss_wholesale_cost BETWEEN 80 AND 100\n         and cd1.cd_marital_status in ('M', 'S', 'S')\n         and cd1.cd_education_status in ('Secondary', '4 yr Degree', 'Unknown')\n         and cd2.cd_marital_status in ('M', 'S', 'S')\n         and cd2.cd_education_status in ('Secondary', '4 yr Degree', 'Unknown')\ngroup by i_product_name\n       ,i_item_sk\n       ,s_store_name\n       ,s_zip\n       ,ad1.ca_street_number\n       ,ad1.ca_street_name\n       ,ad1.ca_city\n       ,ad1.ca_zip\n       ,ad2.ca_street_number\n       ,ad2.ca_street_name\n       ,ad2.ca_city\n       ,ad2.ca_zip\n       ,d1.d_year\n       ,d2.d_year\n       ,d3.d_year\n)\nselect cs1.product_name\n     ,cs1.store_name\n     ,cs1.store_zip\n     ,cs1.b_street_number\n     ,cs1.b_street_name\n     ,cs1.b_city\n     ,cs1.b_zip\n     ,cs1.c_street_number\n     ,cs1.c_street_name\n     ,cs1.c_city\n     ,cs1.c_zip\n     ,cs1.syear\n     ,cs1.cnt\n     ,cs1.s1 as s11\n     ,cs1.s2 as s21\n     ,cs1.s3 as s31\n     ,cs2.s1 as s12\n     ,cs2.s2 as s22\n     ,cs2.s3 as s32\n     ,cs2.syear\n     ,cs2.cnt\nfrom cross_sales cs1,cross_sales cs2\nwhere cs1.item_sk=cs2.item_sk and\n     cs1.syear = 2000 and\n     cs2.syear = 2000 + 1 and\n     cs2.cnt <= cs1.cnt and\n     cs1.store_name = cs2.store_name and\n     cs1.store_zip = cs2.store_zip\norder by cs1.product_name\n       ,cs1.store_name\n       ,cs2.cnt\n       ,cs1.s1\n       ,cs2.s1;", "input_cost": 125.42, "output_sql": "None", "output_cost": -1, "used_rules": [], "rewrite_time": 6993}
{"name": "query065_0", "input_sql": "select \n\ts_store_name,\n\ti_item_desc,\n\tsc.revenue,\n\ti_current_price,\n\ti_wholesale_cost,\n\ti_brand\n from store, item,\n     (select ss_store_sk, avg(revenue) as ave\n \tfrom\n \t    (select  ss_store_sk, ss_item_sk,\n \t\t     sum(ss_sales_price) as revenue\n \t\tfrom store_sales, date_dim\n \t\twhere ss_sold_date_sk = d_date_sk and d_month_seq between 1207 and 1207+11\n    and ss_sales_price / ss_list_price BETWEEN 41 * 0.01 AND 51 * 0.01\n \t\tgroup by ss_store_sk, ss_item_sk) sa\n \tgroup by ss_store_sk) sb,\n     (select  ss_store_sk, ss_item_sk, sum(ss_sales_price) as revenue\n \tfrom store_sales, date_dim\n \twhere ss_sold_date_sk = d_date_sk and d_month_seq between 1207 and 1207+11\n  and ss_sales_price / ss_list_price BETWEEN 41 * 0.01 AND 51 * 0.01\n \tgroup by ss_store_sk, ss_item_sk) sc\n where sb.ss_store_sk = sc.ss_store_sk and\n       sc.revenue <= 0.1 * sb.ave and\n       s_store_sk = sc.ss_store_sk and\n       i_item_sk = sc.ss_item_sk\n       and i_manager_id BETWEEN 54 and 58\n       and s_state in ('IA','IL','MI')\n order by s_store_name, i_item_desc\nlimit 100;", "input_cost": 54.34, "output_sql": "SELECT \"t\".\"s_store_name\" AS \"s_store_sk\", \"t0\".\"i_item_desc\" AS \"s_store_id\", \"t11\".\"revenue\" AS \"s_rec_start_date\", \"t0\".\"i_current_price\" AS \"s_rec_end_date\", \"t0\".\"i_wholesale_cost\" AS \"s_closed_date_sk\", \"t0\".\"i_brand\" AS \"s_store_name\"\r\nFROM (SELECT *\r\n        FROM \"store\"\r\n        WHERE CAST(\"s_state\" AS CHAR(2)) IN ('IA', 'IL', 'MI')) AS \"t\"\r\n    CROSS JOIN (SELECT *\r\n        FROM \"item\"\r\n        WHERE \"i_manager_id\" >= 54 AND \"i_manager_id\" <= 58) AS \"t0\"\r\n    INNER JOIN (SELECT \"ss_store_sk\", AVG(\"revenue\") AS \"ave\"\r\n        FROM (SELECT \"ss_store_sk\", SUM(\"ss_sales_price\") AS \"revenue\"\r\n                FROM (SELECT *\r\n                        FROM \"store_sales\"\r\n                        WHERE \"ss_sales_price\" / \"ss_list_price\" >= 0.41 AND \"ss_sales_price\" / \"ss_list_price\" <= 0.51 AND EXISTS (SELECT 1\r\n                                FROM (SELECT *\r\n                                        FROM \"date_dim\"\r\n                                        WHERE \"d_month_seq\" >= 1207 AND \"d_month_seq\" <= 1218) AS \"t2\"\r\n                                WHERE \"ss_sold_date_sk\" = \"t2\".\"d_date_sk\")) AS \"t1\"\r\n                GROUP BY \"ss_store_sk\", \"ss_item_sk\") AS \"t5\"\r\n        GROUP BY \"ss_store_sk\") AS \"t6\" ON \"t\".\"s_store_sk\" = \"t6\".\"ss_store_sk\"\r\n    INNER JOIN (SELECT \"ss_store_sk0\" AS \"ss_sold_date_sk0\", \"ss_item_sk0\" AS \"ss_sold_time_sk0\", SUM(\"ss_sales_price0\") AS \"revenue\"\r\n        FROM (SELECT *\r\n                FROM \"store_sales\" AS \"store_sales0\" (\"ss_sold_date_sk0\", \"ss_sold_time_sk0\", \"ss_item_sk0\", \"ss_customer_sk0\", \"ss_cdemo_sk0\", \"ss_hdemo_sk0\", \"ss_addr_sk0\", \"ss_store_sk0\", \"ss_promo_sk0\", \"ss_ticket_number0\", \"ss_quantity0\", \"ss_wholesale_cost0\", \"ss_list_price0\", \"ss_sales_price0\", \"ss_ext_discount_amt0\", \"ss_ext_sales_price0\", \"ss_ext_wholesale_cost0\", \"ss_ext_list_price0\", \"ss_ext_tax0\", \"ss_coupon_amt0\", \"ss_net_paid0\", \"ss_net_paid_inc_tax0\", \"ss_net_profit0\")\r\n                WHERE \"ss_sales_price0\" / \"ss_list_price0\" >= 0.41 AND \"ss_sales_price0\" / \"ss_list_price0\" <= 0.51 AND EXISTS (SELECT 1\r\n                        FROM (SELECT *\r\n                                FROM \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\")\r\n                                WHERE \"d_month_seq0\" >= 1207 AND \"d_month_seq0\" <= 1218) AS \"t8\"\r\n                        WHERE \"ss_sold_date_sk0\" = \"t8\".\"d_date_sk0\")) AS \"t7\"\r\n        GROUP BY \"ss_store_sk0\", \"ss_item_sk0\") AS \"t11\" ON \"t11\".\"revenue\" <= 0.1 * \"t6\".\"ave\" AND \"t6\".\"ss_store_sk\" = \"t11\".\"ss_sold_date_sk0\" AND \"t0\".\"i_item_sk\" = \"t11\".\"ss_sold_time_sk0\"\r\nORDER BY \"t\".\"s_store_name\", \"t0\".\"i_item_desc\"\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 54.34, "used_rules": ["FILTER_INTO_JOIN", "FILTER_REDUCE_EXPRESSIONS", "JOIN_ON_UNIQUE_TO_SEMI_JOIN", "JOIN_EXTRACT_FILTER", "FILTER_INTO_JOIN", "PROJECT_TO_CALC"], "rewrite_time": 1777}
{"name": "query065_1", "input_sql": "select \n\ts_store_name,\n\ti_item_desc,\n\tsc.revenue,\n\ti_current_price,\n\ti_wholesale_cost,\n\ti_brand\n from store, item,\n     (select ss_store_sk, avg(revenue) as ave\n \tfrom\n \t    (select  ss_store_sk, ss_item_sk,\n \t\t     sum(ss_sales_price) as revenue\n \t\tfrom store_sales, date_dim\n \t\twhere ss_sold_date_sk = d_date_sk and d_month_seq between 1197 and 1197+11\n    and ss_sales_price / ss_list_price BETWEEN 90 * 0.01 AND 100 * 0.01\n \t\tgroup by ss_store_sk, ss_item_sk) sa\n \tgroup by ss_store_sk) sb,\n     (select  ss_store_sk, ss_item_sk, sum(ss_sales_price) as revenue\n \tfrom store_sales, date_dim\n \twhere ss_sold_date_sk = d_date_sk and d_month_seq between 1197 and 1197+11\n  and ss_sales_price / ss_list_price BETWEEN 90 * 0.01 AND 100 * 0.01\n \tgroup by ss_store_sk, ss_item_sk) sc\n where sb.ss_store_sk = sc.ss_store_sk and\n       sc.revenue <= 0.1 * sb.ave and\n       s_store_sk = sc.ss_store_sk and\n       i_item_sk = sc.ss_item_sk\n       and i_manager_id BETWEEN 27 and 31\n       and s_state in ('KS','LA','OK')\n order by s_store_name, i_item_desc\nlimit 100;", "input_cost": 54.34, "output_sql": "SELECT \"t\".\"s_store_name\" AS \"s_store_sk\", \"t0\".\"i_item_desc\" AS \"s_store_id\", \"t11\".\"revenue\" AS \"s_rec_start_date\", \"t0\".\"i_current_price\" AS \"s_rec_end_date\", \"t0\".\"i_wholesale_cost\" AS \"s_closed_date_sk\", \"t0\".\"i_brand\" AS \"s_store_name\"\r\nFROM (SELECT *\r\n        FROM \"store\"\r\n        WHERE CAST(\"s_state\" AS CHAR(2)) IN ('KS', 'LA', 'OK')) AS \"t\"\r\n    CROSS JOIN (SELECT *\r\n        FROM \"item\"\r\n        WHERE \"i_manager_id\" >= 27 AND \"i_manager_id\" <= 31) AS \"t0\"\r\n    INNER JOIN (SELECT \"ss_store_sk\", AVG(\"revenue\") AS \"ave\"\r\n        FROM (SELECT \"ss_store_sk\", SUM(\"ss_sales_price\") AS \"revenue\"\r\n                FROM (SELECT *\r\n                        FROM \"store_sales\"\r\n                        WHERE \"ss_sales_price\" / \"ss_list_price\" >= 0.90 AND \"ss_sales_price\" / \"ss_list_price\" <= 1.00 AND EXISTS (SELECT 1\r\n                                FROM (SELECT *\r\n                                        FROM \"date_dim\"\r\n                                        WHERE \"d_month_seq\" >= 1197 AND \"d_month_seq\" <= 1208) AS \"t2\"\r\n                                WHERE \"ss_sold_date_sk\" = \"t2\".\"d_date_sk\")) AS \"t1\"\r\n                GROUP BY \"ss_store_sk\", \"ss_item_sk\") AS \"t5\"\r\n        GROUP BY \"ss_store_sk\") AS \"t6\" ON \"t\".\"s_store_sk\" = \"t6\".\"ss_store_sk\"\r\n    INNER JOIN (SELECT \"ss_store_sk0\" AS \"ss_sold_date_sk0\", \"ss_item_sk0\" AS \"ss_sold_time_sk0\", SUM(\"ss_sales_price0\") AS \"revenue\"\r\n        FROM (SELECT *\r\n                FROM \"store_sales\" AS \"store_sales0\" (\"ss_sold_date_sk0\", \"ss_sold_time_sk0\", \"ss_item_sk0\", \"ss_customer_sk0\", \"ss_cdemo_sk0\", \"ss_hdemo_sk0\", \"ss_addr_sk0\", \"ss_store_sk0\", \"ss_promo_sk0\", \"ss_ticket_number0\", \"ss_quantity0\", \"ss_wholesale_cost0\", \"ss_list_price0\", \"ss_sales_price0\", \"ss_ext_discount_amt0\", \"ss_ext_sales_price0\", \"ss_ext_wholesale_cost0\", \"ss_ext_list_price0\", \"ss_ext_tax0\", \"ss_coupon_amt0\", \"ss_net_paid0\", \"ss_net_paid_inc_tax0\", \"ss_net_profit0\")\r\n                WHERE \"ss_sales_price0\" / \"ss_list_price0\" >= 0.90 AND \"ss_sales_price0\" / \"ss_list_price0\" <= 1.00 AND EXISTS (SELECT 1\r\n                        FROM (SELECT *\r\n                                FROM \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\")\r\n                                WHERE \"d_month_seq0\" >= 1197 AND \"d_month_seq0\" <= 1208) AS \"t8\"\r\n                        WHERE \"ss_sold_date_sk0\" = \"t8\".\"d_date_sk0\")) AS \"t7\"\r\n        GROUP BY \"ss_store_sk0\", \"ss_item_sk0\") AS \"t11\" ON \"t11\".\"revenue\" <= 0.1 * \"t6\".\"ave\" AND \"t6\".\"ss_store_sk\" = \"t11\".\"ss_sold_date_sk0\" AND \"t0\".\"i_item_sk\" = \"t11\".\"ss_sold_time_sk0\"\r\nORDER BY \"t\".\"s_store_name\", \"t0\".\"i_item_desc\"\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 54.34, "used_rules": ["FILTER_INTO_JOIN", "FILTER_REDUCE_EXPRESSIONS", "JOIN_ON_UNIQUE_TO_SEMI_JOIN", "JOIN_EXTRACT_FILTER", "FILTER_INTO_JOIN", "PROJECT_TO_CALC"], "rewrite_time": 1791}
{"name": "query069_0", "input_sql": "select \n  cd_gender,\n  cd_marital_status,\n  cd_education_status,\n  count(*) cnt1,\n  cd_purchase_estimate,\n  count(*) cnt2,\n  cd_credit_rating,\n  count(*) cnt3\n from\n  customer c,customer_address ca,customer_demographics\n where\n  c.c_current_addr_sk = ca.ca_address_sk and\n  ca_state in ('KS','LA','OK') and\n  cd_demo_sk = c.c_current_cdemo_sk\n  and cd_marital_status in ('W', 'S', 'S')\n  and cd_education_status in ('Unknown', '4 yr Degree') and\n  exists (select *\n          from store_sales,date_dim\n          where c.c_customer_sk = ss_customer_sk and\n                ss_sold_date_sk = d_date_sk and\n                d_year = 1999 and\n                d_moy between 7 and 7+2\n                and ss_list_price between 139 and 228\n          ) and\n   (not exists (select *\n            from web_sales,date_dim\n            where c.c_customer_sk = ws_bill_customer_sk and\n                  ws_sold_date_sk = d_date_sk and\n                  d_year = 1999 and\n                  d_moy between 7 and 7+2\n                  and ws_list_price between 139 and 228\n            ) and\n    not exists (select *\n            from catalog_sales,date_dim\n            where c.c_customer_sk = cs_ship_customer_sk and\n                  cs_sold_date_sk = d_date_sk and\n                  d_year = 1999 and\n                  d_moy between 7 and 7+2\n                  and cs_list_price between 139 and 228)\n            )\n group by cd_gender,\n          cd_marital_status,\n          cd_education_status,\n          cd_purchase_estimate,\n          cd_credit_rating\n order by cd_gender,\n          cd_marital_status,\n          cd_education_status,\n          cd_purchase_estimate,\n          cd_credit_rating\n limit 100;", "input_cost": 69.14, "output_sql": "SELECT \"t19\".\"cd_gender\", \"t19\".\"cd_marital_status\", \"t19\".\"cd_education_status\", COUNT(*) AS \"cnt3\", \"t19\".\"cd_purchase_estimate\", COUNT(*) AS \"cnt30\", \"t19\".\"cd_credit_rating\", COUNT(*) AS \"cnt31\"\r\nFROM (SELECT *\r\n        FROM (SELECT *\r\n                FROM (SELECT \"t3\".\"c_customer_sk\", \"t3\".\"c_customer_id\", \"t3\".\"c_current_cdemo_sk\", \"t3\".\"c_current_hdemo_sk\", \"t3\".\"c_current_addr_sk\", \"t3\".\"c_first_shipto_date_sk\", \"t3\".\"c_first_sales_date_sk\", \"t3\".\"c_salutation\", \"t3\".\"c_first_name\", \"t3\".\"c_last_name\", \"t3\".\"c_preferred_cust_flag\", \"t3\".\"c_birth_day\", \"t3\".\"c_birth_month\", \"t3\".\"c_birth_year\", \"t3\".\"c_birth_country\", \"t3\".\"c_login\", \"t3\".\"c_email_address\", \"t3\".\"c_last_review_date_sk\", \"t3\".\"ca_address_sk\", \"t3\".\"ca_address_id\", \"t3\".\"ca_street_number\", \"t3\".\"ca_street_name\", \"t3\".\"ca_street_type\", \"t3\".\"ca_suite_number\", \"t3\".\"ca_city\", \"t3\".\"ca_county\", \"t3\".\"ca_state\", \"t3\".\"ca_zip\", \"t3\".\"ca_country\", \"t3\".\"ca_gmt_offset\", \"t3\".\"ca_location_type\", \"t3\".\"cd_demo_sk\", \"t3\".\"cd_gender\", \"t3\".\"cd_marital_status\", \"t3\".\"cd_education_status\", \"t3\".\"cd_purchase_estimate\", \"t3\".\"cd_credit_rating\", \"t3\".\"cd_dep_count\", \"t3\".\"cd_dep_employed_count\", \"t3\".\"cd_dep_college_count\", \"t9\".\"ss_customer_sk\", TRUE AS \"$f1\"\r\n                        FROM (SELECT *\r\n                                FROM (SELECT *\r\n                                        FROM (SELECT *\r\n                                                FROM \"customer\",\r\n                                                        (SELECT *\r\n                                                        FROM \"customer_address\"\r\n                                                        WHERE CAST(\"ca_state\" AS CHAR(2)) IN ('KS', 'LA', 'OK')) AS \"t\"\r\n                                                WHERE \"customer\".\"c_current_addr_sk\" = \"t\".\"ca_address_sk\") AS \"t0\",\r\n                                                (SELECT *\r\n                                                FROM \"customer_demographics\"\r\n                                                WHERE CAST(\"cd_marital_status\" AS CHAR(1)) IN ('S', 'W') AND (\"cd_education_status\" = 'Unknown' OR \"cd_education_status\" = '4 yr Degree')) AS \"t1\"\r\n                                        WHERE \"t1\".\"cd_demo_sk\" = \"t0\".\"c_current_cdemo_sk\") AS \"t2\"\r\n                                WHERE \"t2\".\"c_customer_sk\" IS NOT NULL) AS \"t3\",\r\n                                (SELECT \"ss_customer_sk\"\r\n                                FROM (SELECT \"t5\".\"ss_sold_date_sk\", \"t5\".\"ss_customer_sk\", \"t6\".\"d_date_sk\"\r\n                                        FROM (SELECT \"ss_sold_date_sk\", \"ss_customer_sk\"\r\n                                                FROM \"store_sales\"\r\n                                                WHERE \"ss_list_price\" >= 139 AND \"ss_list_price\" <= 228 AND \"ss_customer_sk\" IS NOT NULL\r\n                                                GROUP BY \"ss_sold_date_sk\", \"ss_customer_sk\") AS \"t5\",\r\n                                                (SELECT *\r\n                                                FROM \"date_dim\"\r\n                                                WHERE \"d_year\" = 1999 AND (\"d_moy\" >= 7 AND \"d_moy\" <= 9)) AS \"t6\") AS \"t7\"\r\n                                WHERE \"t7\".\"ss_sold_date_sk\" = \"t7\".\"d_date_sk\"\r\n                                GROUP BY \"ss_customer_sk\") AS \"t9\") AS \"t10\"\r\n                WHERE \"t10\".\"c_customer_sk\" = \"t10\".\"ss_customer_sk\") AS \"t11\"\r\n            LEFT JOIN (SELECT \"ws_bill_customer_sk\", TRUE AS \"$f1\"\r\n                FROM (SELECT \"t13\".\"ws_sold_date_sk\", \"t13\".\"ws_bill_customer_sk\", \"t14\".\"d_date_sk0\"\r\n                        FROM (SELECT \"ws_sold_date_sk\", \"ws_bill_customer_sk\"\r\n                                FROM \"web_sales\"\r\n                                WHERE \"ws_list_price\" >= 139 AND \"ws_list_price\" <= 228 AND \"ws_bill_customer_sk\" IS NOT NULL\r\n                                GROUP BY \"ws_sold_date_sk\", \"ws_bill_customer_sk\") AS \"t13\",\r\n                                (SELECT *\r\n                                FROM \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\")\r\n                                WHERE \"d_year0\" = 1999 AND (\"d_moy0\" >= 7 AND \"d_moy0\" <= 9)) AS \"t14\") AS \"t15\"\r\n                WHERE \"t15\".\"ws_sold_date_sk\" = \"t15\".\"d_date_sk0\"\r\n                GROUP BY \"ws_bill_customer_sk\") AS \"t18\" ON \"t11\".\"c_customer_sk\" = \"t18\".\"ws_bill_customer_sk\"\r\n        WHERE \"t18\".\"$f1\" IS NULL) AS \"t19\"\r\n    LEFT JOIN (SELECT \"cs_ship_customer_sk\", TRUE AS \"$f10\"\r\n        FROM (SELECT \"t21\".\"cs_sold_date_sk\", \"t21\".\"cs_ship_customer_sk\", \"t22\".\"d_date_sk1\"\r\n                FROM (SELECT \"cs_sold_date_sk\", \"cs_ship_customer_sk\"\r\n                        FROM \"catalog_sales\"\r\n                        WHERE \"cs_list_price\" >= 139 AND \"cs_list_price\" <= 228 AND \"cs_ship_customer_sk\" IS NOT NULL\r\n                        GROUP BY \"cs_sold_date_sk\", \"cs_ship_customer_sk\") AS \"t21\",\r\n                        (SELECT *\r\n                        FROM \"date_dim\" AS \"date_dim1\" (\"d_date_sk1\", \"d_date_id1\", \"d_date1\", \"d_month_seq1\", \"d_week_seq1\", \"d_quarter_seq1\", \"d_year1\", \"d_dow1\", \"d_moy1\", \"d_dom1\", \"d_qoy1\", \"d_fy_year1\", \"d_fy_quarter_seq1\", \"d_fy_week_seq1\", \"d_day_name1\", \"d_quarter_name1\", \"d_holiday1\", \"d_weekend1\", \"d_following_holiday1\", \"d_first_dom1\", \"d_last_dom1\", \"d_same_day_ly1\", \"d_same_day_lq1\", \"d_current_day1\", \"d_current_week1\", \"d_current_month1\", \"d_current_quarter1\", \"d_current_year1\")\r\n                        WHERE \"d_year1\" = 1999 AND (\"d_moy1\" >= 7 AND \"d_moy1\" <= 9)) AS \"t22\") AS \"t23\"\r\n        WHERE \"t23\".\"cs_sold_date_sk\" = \"t23\".\"d_date_sk1\"\r\n        GROUP BY \"cs_ship_customer_sk\") AS \"t26\" ON \"t19\".\"c_customer_sk\" = \"t26\".\"cs_ship_customer_sk\"\r\nWHERE \"t26\".\"$f10\" IS NULL\r\nGROUP BY \"t19\".\"cd_gender\", \"t19\".\"cd_marital_status\", \"t19\".\"cd_education_status\", \"t19\".\"cd_purchase_estimate\", \"t19\".\"cd_credit_rating\"\r\nORDER BY \"t19\".\"cd_gender\", \"t19\".\"cd_marital_status\", \"t19\".\"cd_education_status\", \"t19\".\"cd_purchase_estimate\", \"t19\".\"cd_credit_rating\"\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 90.39, "used_rules": ["FILTER_SUB_QUERY_TO_CORRELATE", "FILTER_REDUCE_EXPRESSIONS", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_JOIN_TRANSPOSE_EXTENDED", "SORT_PROJECT_TRANSPOSE", "JOIN_PUSH_TRANSITIVE_PREDICATES", "JOIN_EXTRACT_FILTER", "JOIN_PROJECT_RIGHT_TRANSPOSE"], "rewrite_time": 2815}
{"name": "query069_1", "input_sql": "select \n  cd_gender,\n  cd_marital_status,\n  cd_education_status,\n  count(*) cnt1,\n  cd_purchase_estimate,\n  count(*) cnt2,\n  cd_credit_rating,\n  count(*) cnt3\n from\n  customer c,customer_address ca,customer_demographics\n where\n  c.c_current_addr_sk = ca.ca_address_sk and\n  ca_state in ('IN','TN','WI') and\n  cd_demo_sk = c.c_current_cdemo_sk\n  and cd_marital_status in ('D', 'W', 'S')\n  and cd_education_status in ('Unknown', 'Advanced Degree') and\n  exists (select *\n          from store_sales,date_dim\n          where c.c_customer_sk = ss_customer_sk and\n                ss_sold_date_sk = d_date_sk and\n                d_year = 2002 and\n                d_moy between 6 and 6+2\n                and ss_list_price between 77 and 166\n          ) and\n   (not exists (select *\n            from web_sales,date_dim\n            where c.c_customer_sk = ws_bill_customer_sk and\n                  ws_sold_date_sk = d_date_sk and\n                  d_year = 2002 and\n                  d_moy between 6 and 6+2\n                  and ws_list_price between 77 and 166\n            ) and\n    not exists (select *\n            from catalog_sales,date_dim\n            where c.c_customer_sk = cs_ship_customer_sk and\n                  cs_sold_date_sk = d_date_sk and\n                  d_year = 2002 and\n                  d_moy between 6 and 6+2\n                  and cs_list_price between 77 and 166)\n            )\n group by cd_gender,\n          cd_marital_status,\n          cd_education_status,\n          cd_purchase_estimate,\n          cd_credit_rating\n order by cd_gender,\n          cd_marital_status,\n          cd_education_status,\n          cd_purchase_estimate,\n          cd_credit_rating\n limit 100;", "input_cost": 69.14, "output_sql": "SELECT \"t19\".\"cd_gender\", \"t19\".\"cd_marital_status\", \"t19\".\"cd_education_status\", COUNT(*) AS \"cnt3\", \"t19\".\"cd_purchase_estimate\", COUNT(*) AS \"cnt30\", \"t19\".\"cd_credit_rating\", COUNT(*) AS \"cnt31\"\r\nFROM (SELECT *\r\n        FROM (SELECT *\r\n                FROM (SELECT \"t3\".\"c_customer_sk\", \"t3\".\"c_customer_id\", \"t3\".\"c_current_cdemo_sk\", \"t3\".\"c_current_hdemo_sk\", \"t3\".\"c_current_addr_sk\", \"t3\".\"c_first_shipto_date_sk\", \"t3\".\"c_first_sales_date_sk\", \"t3\".\"c_salutation\", \"t3\".\"c_first_name\", \"t3\".\"c_last_name\", \"t3\".\"c_preferred_cust_flag\", \"t3\".\"c_birth_day\", \"t3\".\"c_birth_month\", \"t3\".\"c_birth_year\", \"t3\".\"c_birth_country\", \"t3\".\"c_login\", \"t3\".\"c_email_address\", \"t3\".\"c_last_review_date_sk\", \"t3\".\"ca_address_sk\", \"t3\".\"ca_address_id\", \"t3\".\"ca_street_number\", \"t3\".\"ca_street_name\", \"t3\".\"ca_street_type\", \"t3\".\"ca_suite_number\", \"t3\".\"ca_city\", \"t3\".\"ca_county\", \"t3\".\"ca_state\", \"t3\".\"ca_zip\", \"t3\".\"ca_country\", \"t3\".\"ca_gmt_offset\", \"t3\".\"ca_location_type\", \"t3\".\"cd_demo_sk\", \"t3\".\"cd_gender\", \"t3\".\"cd_marital_status\", \"t3\".\"cd_education_status\", \"t3\".\"cd_purchase_estimate\", \"t3\".\"cd_credit_rating\", \"t3\".\"cd_dep_count\", \"t3\".\"cd_dep_employed_count\", \"t3\".\"cd_dep_college_count\", \"t9\".\"ss_customer_sk\", TRUE AS \"$f1\"\r\n                        FROM (SELECT *\r\n                                FROM (SELECT *\r\n                                        FROM (SELECT *\r\n                                                FROM \"customer\",\r\n                                                        (SELECT *\r\n                                                        FROM \"customer_address\"\r\n                                                        WHERE CAST(\"ca_state\" AS CHAR(2)) IN ('IN', 'TN', 'WI')) AS \"t\"\r\n                                                WHERE \"customer\".\"c_current_addr_sk\" = \"t\".\"ca_address_sk\") AS \"t0\",\r\n                                                (SELECT *\r\n                                                FROM \"customer_demographics\"\r\n                                                WHERE CAST(\"cd_marital_status\" AS CHAR(1)) IN ('D', 'S', 'W') AND (\"cd_education_status\" = 'Unknown' OR \"cd_education_status\" = 'Advanced Degree')) AS \"t1\"\r\n                                        WHERE \"t1\".\"cd_demo_sk\" = \"t0\".\"c_current_cdemo_sk\") AS \"t2\"\r\n                                WHERE \"t2\".\"c_customer_sk\" IS NOT NULL) AS \"t3\",\r\n                                (SELECT \"ss_customer_sk\"\r\n                                FROM (SELECT \"t5\".\"ss_sold_date_sk\", \"t5\".\"ss_customer_sk\", \"t6\".\"d_date_sk\"\r\n                                        FROM (SELECT \"ss_sold_date_sk\", \"ss_customer_sk\"\r\n                                                FROM \"store_sales\"\r\n                                                WHERE \"ss_list_price\" >= 77 AND \"ss_list_price\" <= 166 AND \"ss_customer_sk\" IS NOT NULL\r\n                                                GROUP BY \"ss_sold_date_sk\", \"ss_customer_sk\") AS \"t5\",\r\n                                                (SELECT *\r\n                                                FROM \"date_dim\"\r\n                                                WHERE \"d_year\" = 2002 AND (\"d_moy\" >= 6 AND \"d_moy\" <= 8)) AS \"t6\") AS \"t7\"\r\n                                WHERE \"t7\".\"ss_sold_date_sk\" = \"t7\".\"d_date_sk\"\r\n                                GROUP BY \"ss_customer_sk\") AS \"t9\") AS \"t10\"\r\n                WHERE \"t10\".\"c_customer_sk\" = \"t10\".\"ss_customer_sk\") AS \"t11\"\r\n            LEFT JOIN (SELECT \"ws_bill_customer_sk\", TRUE AS \"$f1\"\r\n                FROM (SELECT \"t13\".\"ws_sold_date_sk\", \"t13\".\"ws_bill_customer_sk\", \"t14\".\"d_date_sk0\"\r\n                        FROM (SELECT \"ws_sold_date_sk\", \"ws_bill_customer_sk\"\r\n                                FROM \"web_sales\"\r\n                                WHERE \"ws_list_price\" >= 77 AND \"ws_list_price\" <= 166 AND \"ws_bill_customer_sk\" IS NOT NULL\r\n                                GROUP BY \"ws_sold_date_sk\", \"ws_bill_customer_sk\") AS \"t13\",\r\n                                (SELECT *\r\n                                FROM \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\")\r\n                                WHERE \"d_year0\" = 2002 AND (\"d_moy0\" >= 6 AND \"d_moy0\" <= 8)) AS \"t14\") AS \"t15\"\r\n                WHERE \"t15\".\"ws_sold_date_sk\" = \"t15\".\"d_date_sk0\"\r\n                GROUP BY \"ws_bill_customer_sk\") AS \"t18\" ON \"t11\".\"c_customer_sk\" = \"t18\".\"ws_bill_customer_sk\"\r\n        WHERE \"t18\".\"$f1\" IS NULL) AS \"t19\"\r\n    LEFT JOIN (SELECT \"cs_ship_customer_sk\", TRUE AS \"$f10\"\r\n        FROM (SELECT \"t21\".\"cs_sold_date_sk\", \"t21\".\"cs_ship_customer_sk\", \"t22\".\"d_date_sk1\"\r\n                FROM (SELECT \"cs_sold_date_sk\", \"cs_ship_customer_sk\"\r\n                        FROM \"catalog_sales\"\r\n                        WHERE \"cs_list_price\" >= 77 AND \"cs_list_price\" <= 166 AND \"cs_ship_customer_sk\" IS NOT NULL\r\n                        GROUP BY \"cs_sold_date_sk\", \"cs_ship_customer_sk\") AS \"t21\",\r\n                        (SELECT *\r\n                        FROM \"date_dim\" AS \"date_dim1\" (\"d_date_sk1\", \"d_date_id1\", \"d_date1\", \"d_month_seq1\", \"d_week_seq1\", \"d_quarter_seq1\", \"d_year1\", \"d_dow1\", \"d_moy1\", \"d_dom1\", \"d_qoy1\", \"d_fy_year1\", \"d_fy_quarter_seq1\", \"d_fy_week_seq1\", \"d_day_name1\", \"d_quarter_name1\", \"d_holiday1\", \"d_weekend1\", \"d_following_holiday1\", \"d_first_dom1\", \"d_last_dom1\", \"d_same_day_ly1\", \"d_same_day_lq1\", \"d_current_day1\", \"d_current_week1\", \"d_current_month1\", \"d_current_quarter1\", \"d_current_year1\")\r\n                        WHERE \"d_year1\" = 2002 AND (\"d_moy1\" >= 6 AND \"d_moy1\" <= 8)) AS \"t22\") AS \"t23\"\r\n        WHERE \"t23\".\"cs_sold_date_sk\" = \"t23\".\"d_date_sk1\"\r\n        GROUP BY \"cs_ship_customer_sk\") AS \"t26\" ON \"t19\".\"c_customer_sk\" = \"t26\".\"cs_ship_customer_sk\"\r\nWHERE \"t26\".\"$f10\" IS NULL\r\nGROUP BY \"t19\".\"cd_gender\", \"t19\".\"cd_marital_status\", \"t19\".\"cd_education_status\", \"t19\".\"cd_purchase_estimate\", \"t19\".\"cd_credit_rating\"\r\nORDER BY \"t19\".\"cd_gender\", \"t19\".\"cd_marital_status\", \"t19\".\"cd_education_status\", \"t19\".\"cd_purchase_estimate\", \"t19\".\"cd_credit_rating\"\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 90.39, "used_rules": ["FILTER_SUB_QUERY_TO_CORRELATE", "FILTER_REDUCE_EXPRESSIONS", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_JOIN_TRANSPOSE_EXTENDED", "SORT_PROJECT_TRANSPOSE", "JOIN_PUSH_TRANSITIVE_PREDICATES", "JOIN_EXTRACT_FILTER", "JOIN_PROJECT_RIGHT_TRANSPOSE"], "rewrite_time": 2824}
{"name": "query072_0", "input_sql": "select  i_item_desc\n      ,w_warehouse_name\n      ,d1.d_week_seq\n      ,sum(case when p_promo_sk is null then 1 else 0 end) no_promo\n      ,sum(case when p_promo_sk is not null then 1 else 0 end) promo\n      ,count(*) total_cnt\nfrom catalog_sales\njoin inventory on (cs_item_sk = inv_item_sk)\njoin warehouse on (w_warehouse_sk=inv_warehouse_sk)\njoin item on (i_item_sk = cs_item_sk)\njoin customer_demographics on (cs_bill_cdemo_sk = cd_demo_sk)\njoin household_demographics on (cs_bill_hdemo_sk = hd_demo_sk)\njoin date_dim d1 on (cs_sold_date_sk = d1.d_date_sk)\njoin date_dim d2 on (inv_date_sk = d2.d_date_sk)\njoin date_dim d3 on (cs_ship_date_sk = d3.d_date_sk)\nleft outer join promotion on (cs_promo_sk=p_promo_sk)\nleft outer join catalog_returns on (cr_item_sk = cs_item_sk and cr_order_number = cs_order_number)\nwhere d1.d_week_seq = d2.d_week_seq\n  and inv_quantity_on_hand < cs_quantity\n  and d3.d_date > d1.d_date + interval '3' day\n  and hd_buy_potential = '1001-5000'\n  and d1.d_year = 1999\n  and cd_marital_status = 'M'\n  and cd_dep_count between 6 and 8\n  and i_category IN ('Books', 'Jewelry', 'Shoes')\n  and cs_wholesale_cost BETWEEN 73 AND 93\ngroup by i_item_desc,w_warehouse_name,d1.d_week_seq\norder by total_cnt desc, i_item_desc, w_warehouse_name, d_week_seq\nlimit 100;", "input_cost": 81.44, "output_sql": "SELECT \"t0\".\"i_item_desc\" AS \"cs_sold_date_sk\", \"warehouse\".\"w_warehouse_name\" AS \"cs_sold_time_sk\", \"t3\".\"d_week_seq\" AS \"cs_ship_date_sk\", COALESCE(SUM(CASE WHEN \"promotion\".\"p_promo_sk\" IS NULL THEN 1 ELSE 0 END), 0) AS \"no_promo\", COALESCE(SUM(CASE WHEN \"promotion\".\"p_promo_sk\" IS NOT NULL THEN 1 ELSE 0 END), 0) AS \"promo\", COUNT(*) AS \"total_cnt\"\r\nFROM (SELECT *\r\n        FROM \"catalog_sales\"\r\n        WHERE \"cs_wholesale_cost\" >= 73 AND \"cs_wholesale_cost\" <= 93) AS \"t\"\r\n    INNER JOIN \"inventory\" ON \"t\".\"cs_item_sk\" = \"inventory\".\"inv_item_sk\" AND \"t\".\"cs_quantity\" > \"inventory\".\"inv_quantity_on_hand\"\r\n    INNER JOIN \"warehouse\" ON \"inventory\".\"inv_warehouse_sk\" = \"warehouse\".\"w_warehouse_sk\"\r\n    INNER JOIN (SELECT *\r\n        FROM \"item\"\r\n        WHERE CAST(\"i_category\" AS CHAR(5)) IN ('Books', 'Shoes') OR \"i_category\" = 'Jewelry') AS \"t0\" ON \"t\".\"cs_item_sk\" = \"t0\".\"i_item_sk\"\r\n    INNER JOIN (SELECT *\r\n        FROM \"customer_demographics\"\r\n        WHERE \"cd_marital_status\" = 'M' AND (\"cd_dep_count\" >= 6 AND \"cd_dep_count\" <= 8)) AS \"t1\" ON \"t\".\"cs_bill_cdemo_sk\" = \"t1\".\"cd_demo_sk\"\r\n    INNER JOIN (SELECT *\r\n        FROM \"household_demographics\"\r\n        WHERE \"hd_buy_potential\" = '1001-5000') AS \"t2\" ON \"t\".\"cs_bill_hdemo_sk\" = \"t2\".\"hd_demo_sk\"\r\n    INNER JOIN (SELECT *\r\n        FROM \"date_dim\"\r\n        WHERE \"d_year\" = 1999) AS \"t3\" ON \"t\".\"cs_sold_date_sk\" = \"t3\".\"d_date_sk\"\r\n    INNER JOIN \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\") ON \"inventory\".\"inv_date_sk\" = \"date_dim0\".\"d_date_sk0\" AND \"t3\".\"d_week_seq\" = \"date_dim0\".\"d_week_seq0\"\r\n    INNER JOIN \"date_dim\" AS \"date_dim1\" (\"d_date_sk1\", \"d_date_id1\", \"d_date1\", \"d_month_seq1\", \"d_week_seq1\", \"d_quarter_seq1\", \"d_year1\", \"d_dow1\", \"d_moy1\", \"d_dom1\", \"d_qoy1\", \"d_fy_year1\", \"d_fy_quarter_seq1\", \"d_fy_week_seq1\", \"d_day_name1\", \"d_quarter_name1\", \"d_holiday1\", \"d_weekend1\", \"d_following_holiday1\", \"d_first_dom1\", \"d_last_dom1\", \"d_same_day_ly1\", \"d_same_day_lq1\", \"d_current_day1\", \"d_current_week1\", \"d_current_month1\", \"d_current_quarter1\", \"d_current_year1\") ON \"t\".\"cs_ship_date_sk\" = \"date_dim1\".\"d_date_sk1\" AND \"date_dim1\".\"d_date1\" > (\"t3\".\"d_date\" + INTERVAL '3' DAY)\r\n    LEFT JOIN \"promotion\" ON \"t\".\"cs_promo_sk\" = \"promotion\".\"p_promo_sk\"\r\nGROUP BY \"t0\".\"i_item_desc\", \"warehouse\".\"w_warehouse_name\", \"t3\".\"d_week_seq\"\r\nORDER BY 6 DESC, \"t0\".\"i_item_desc\", \"warehouse\".\"w_warehouse_name\", \"t3\".\"d_week_seq\"\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 81.44, "used_rules": ["FILTER_INTO_JOIN", "PROJECT_JOIN_REMOVE", "JOIN_EXTRACT_FILTER", "FILTER_INTO_JOIN", "PROJECT_TO_CALC", "AGGREGATE_REDUCE_FUNCTIONS"], "rewrite_time": 2381}
{"name": "query072_1", "input_sql": "select  i_item_desc\n      ,w_warehouse_name\n      ,d1.d_week_seq\n      ,sum(case when p_promo_sk is null then 1 else 0 end) no_promo\n      ,sum(case when p_promo_sk is not null then 1 else 0 end) promo\n      ,count(*) total_cnt\nfrom catalog_sales\njoin inventory on (cs_item_sk = inv_item_sk)\njoin warehouse on (w_warehouse_sk=inv_warehouse_sk)\njoin item on (i_item_sk = cs_item_sk)\njoin customer_demographics on (cs_bill_cdemo_sk = cd_demo_sk)\njoin household_demographics on (cs_bill_hdemo_sk = hd_demo_sk)\njoin date_dim d1 on (cs_sold_date_sk = d1.d_date_sk)\njoin date_dim d2 on (inv_date_sk = d2.d_date_sk)\njoin date_dim d3 on (cs_ship_date_sk = d3.d_date_sk)\nleft outer join promotion on (cs_promo_sk=p_promo_sk)\nleft outer join catalog_returns on (cr_item_sk = cs_item_sk and cr_order_number = cs_order_number)\nwhere d1.d_week_seq = d2.d_week_seq\n  and inv_quantity_on_hand < cs_quantity\n  and d3.d_date > d1.d_date + interval '3' day\n  and hd_buy_potential = '>10000'\n  and d1.d_year = 1998\n  and cd_marital_status = 'D'\n  and cd_dep_count between 9 and 11\n  and i_category IN ('Books', 'Children', 'Home')\n  and cs_wholesale_cost BETWEEN 43 AND 63\ngroup by i_item_desc,w_warehouse_name,d1.d_week_seq\norder by total_cnt desc, i_item_desc, w_warehouse_name, d_week_seq\nlimit 100;", "input_cost": 81.44, "output_sql": "SELECT \"t0\".\"i_item_desc\" AS \"cs_sold_date_sk\", \"warehouse\".\"w_warehouse_name\" AS \"cs_sold_time_sk\", \"t3\".\"d_week_seq\" AS \"cs_ship_date_sk\", COALESCE(SUM(CASE WHEN \"promotion\".\"p_promo_sk\" IS NULL THEN 1 ELSE 0 END), 0) AS \"no_promo\", COALESCE(SUM(CASE WHEN \"promotion\".\"p_promo_sk\" IS NOT NULL THEN 1 ELSE 0 END), 0) AS \"promo\", COUNT(*) AS \"total_cnt\"\r\nFROM (SELECT *\r\n        FROM \"catalog_sales\"\r\n        WHERE \"cs_wholesale_cost\" >= 43 AND \"cs_wholesale_cost\" <= 63) AS \"t\"\r\n    INNER JOIN \"inventory\" ON \"t\".\"cs_item_sk\" = \"inventory\".\"inv_item_sk\" AND \"t\".\"cs_quantity\" > \"inventory\".\"inv_quantity_on_hand\"\r\n    INNER JOIN \"warehouse\" ON \"inventory\".\"inv_warehouse_sk\" = \"warehouse\".\"w_warehouse_sk\"\r\n    INNER JOIN (SELECT *\r\n        FROM \"item\"\r\n        WHERE \"i_category\" = 'Books' OR \"i_category\" = 'Children' OR \"i_category\" = 'Home') AS \"t0\" ON \"t\".\"cs_item_sk\" = \"t0\".\"i_item_sk\"\r\n    INNER JOIN (SELECT *\r\n        FROM \"customer_demographics\"\r\n        WHERE \"cd_marital_status\" = 'D' AND (\"cd_dep_count\" >= 9 AND \"cd_dep_count\" <= 11)) AS \"t1\" ON \"t\".\"cs_bill_cdemo_sk\" = \"t1\".\"cd_demo_sk\"\r\n    INNER JOIN (SELECT *\r\n        FROM \"household_demographics\"\r\n        WHERE \"hd_buy_potential\" = '>10000') AS \"t2\" ON \"t\".\"cs_bill_hdemo_sk\" = \"t2\".\"hd_demo_sk\"\r\n    INNER JOIN (SELECT *\r\n        FROM \"date_dim\"\r\n        WHERE \"d_year\" = 1998) AS \"t3\" ON \"t\".\"cs_sold_date_sk\" = \"t3\".\"d_date_sk\"\r\n    INNER JOIN \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\") ON \"inventory\".\"inv_date_sk\" = \"date_dim0\".\"d_date_sk0\" AND \"t3\".\"d_week_seq\" = \"date_dim0\".\"d_week_seq0\"\r\n    INNER JOIN \"date_dim\" AS \"date_dim1\" (\"d_date_sk1\", \"d_date_id1\", \"d_date1\", \"d_month_seq1\", \"d_week_seq1\", \"d_quarter_seq1\", \"d_year1\", \"d_dow1\", \"d_moy1\", \"d_dom1\", \"d_qoy1\", \"d_fy_year1\", \"d_fy_quarter_seq1\", \"d_fy_week_seq1\", \"d_day_name1\", \"d_quarter_name1\", \"d_holiday1\", \"d_weekend1\", \"d_following_holiday1\", \"d_first_dom1\", \"d_last_dom1\", \"d_same_day_ly1\", \"d_same_day_lq1\", \"d_current_day1\", \"d_current_week1\", \"d_current_month1\", \"d_current_quarter1\", \"d_current_year1\") ON \"t\".\"cs_ship_date_sk\" = \"date_dim1\".\"d_date_sk1\" AND \"date_dim1\".\"d_date1\" > (\"t3\".\"d_date\" + INTERVAL '3' DAY)\r\n    LEFT JOIN \"promotion\" ON \"t\".\"cs_promo_sk\" = \"promotion\".\"p_promo_sk\"\r\nGROUP BY \"t0\".\"i_item_desc\", \"warehouse\".\"w_warehouse_name\", \"t3\".\"d_week_seq\"\r\nORDER BY 6 DESC, \"t0\".\"i_item_desc\", \"warehouse\".\"w_warehouse_name\", \"t3\".\"d_week_seq\"\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 81.44, "used_rules": ["FILTER_INTO_JOIN", "PROJECT_JOIN_REMOVE", "JOIN_EXTRACT_FILTER", "FILTER_INTO_JOIN", "PROJECT_TO_CALC", "AGGREGATE_REDUCE_FUNCTIONS"], "rewrite_time": 2482}
{"name": "query075_0", "input_sql": "WITH all_sales AS (\n SELECT d_year\n       ,i_brand_id\n       ,i_class_id\n       ,i_category_id\n       ,i_manufact_id\n       ,SUM(sales_cnt) AS sales_cnt\n       ,SUM(sales_amt) AS sales_amt\n FROM (SELECT d_year\n             ,i_brand_id\n             ,i_class_id\n             ,i_category_id\n             ,i_manufact_id\n             ,cs_quantity - COALESCE(cr_return_quantity,0) AS sales_cnt\n             ,cs_ext_sales_price - COALESCE(cr_return_amount,0.0) AS sales_amt\n       FROM catalog_sales JOIN item ON i_item_sk=cs_item_sk\n                          JOIN date_dim ON d_date_sk=cs_sold_date_sk\n                          LEFT JOIN catalog_returns ON (cs_order_number=cr_order_number\n                                                    AND cs_item_sk=cr_item_sk)\n       WHERE i_category='Electronics'\n       and cs_sales_price / cs_list_price BETWEEN 80 * 0.01 AND 100 * 0.01\n       and cr_reason_sk in (3, 6, 18, 30, 40)\n       UNION\n       SELECT d_year\n             ,i_brand_id\n             ,i_class_id\n             ,i_category_id\n             ,i_manufact_id\n             ,ss_quantity - COALESCE(sr_return_quantity,0) AS sales_cnt\n             ,ss_ext_sales_price - COALESCE(sr_return_amt,0.0) AS sales_amt\n       FROM store_sales JOIN item ON i_item_sk=ss_item_sk\n                        JOIN date_dim ON d_date_sk=ss_sold_date_sk\n                        LEFT JOIN store_returns ON (ss_ticket_number=sr_ticket_number\n                                                AND ss_item_sk=sr_item_sk)\n       WHERE i_category='Electronics'\n       and ss_sales_price / ss_list_price BETWEEN 80 * 0.01 AND 100 * 0.01\n       and sr_reason_sk in (3, 6, 18, 30, 40)\n       UNION\n       SELECT d_year\n             ,i_brand_id\n             ,i_class_id\n             ,i_category_id\n             ,i_manufact_id\n             ,ws_quantity - COALESCE(wr_return_quantity,0) AS sales_cnt\n             ,ws_ext_sales_price - COALESCE(wr_return_amt,0.0) AS sales_amt\n       FROM web_sales JOIN item ON i_item_sk=ws_item_sk\n                      JOIN date_dim ON d_date_sk=ws_sold_date_sk\n                      LEFT JOIN web_returns ON (ws_order_number=wr_order_number\n                                            AND ws_item_sk=wr_item_sk)\n       WHERE i_category='Electronics'\n       and ws_sales_price / ws_list_price BETWEEN 80 * 0.01 AND 100 * 0.01\n       and wr_reason_sk in (3, 6, 18, 30, 40)) sales_detail\nGROUP BY d_year, i_brand_id, i_class_id, i_category_id, i_manufact_id)\n SELECT  prev_yr.d_year AS prev_year\n                          ,curr_yr.d_year AS \"year\"\n                          ,curr_yr.i_brand_id\n                          ,curr_yr.i_class_id\n                          ,curr_yr.i_category_id\n                          ,curr_yr.i_manufact_id\n                          ,prev_yr.sales_cnt AS prev_yr_cnt\n                          ,curr_yr.sales_cnt AS curr_yr_cnt\n                          ,curr_yr.sales_cnt-prev_yr.sales_cnt AS sales_cnt_diff\n                          ,curr_yr.sales_amt-prev_yr.sales_amt AS sales_amt_diff\n FROM all_sales curr_yr, all_sales prev_yr\n WHERE curr_yr.i_brand_id=prev_yr.i_brand_id\n   AND curr_yr.i_class_id=prev_yr.i_class_id\n   AND curr_yr.i_category_id=prev_yr.i_category_id\n   AND curr_yr.i_manufact_id=prev_yr.i_manufact_id\n   AND curr_yr.d_year=2000\n   AND prev_yr.d_year=2000-1\n   AND prev_yr.sales_cnt > 0\n   AND CAST(curr_yr.sales_cnt AS DECIMAL(17,2))/CAST(prev_yr.sales_cnt AS DECIMAL(17,2))<0.9\n ORDER BY sales_cnt_diff,sales_amt_diff\n limit 100;", "input_cost": 89.88, "output_sql": "SELECT CAST(1999 AS INTEGER) AS \"prev_year\", CAST(2000 AS INTEGER) AS \"year\", \"t27\".\"i_brand_id\", \"t27\".\"i_class_id\", \"t27\".\"i_category_id\", \"t27\".\"i_manufact_id\", \"t59\".\"sales_cnt4\", CASE WHEN \"t27\".\"$f5\" = 0 THEN NULL ELSE \"t27\".\"sales_cnt\" END AS \"sales_cnt5\", CASE WHEN \"t27\".\"$f5\" = 0 THEN NULL ELSE \"t27\".\"sales_cnt\" END - \"t59\".\"sales_cnt4\" AS \"sales_cnt_diff\", CASE WHEN \"t27\".\"$f7\" = 0 THEN NULL ELSE \"t27\".\"sales_amt\" END - \"t59\".\"sales_amt4\" AS \"sales_amt_diff\"\r\nFROM (SELECT \"i_brand_id\", \"i_class_id\", \"i_category_id\", \"i_manufact_id\", COALESCE(SUM(\"sales_cnt\"), 0) AS \"sales_cnt\", COUNT(\"sales_cnt\") AS \"$f5\", COALESCE(SUM(\"sales_amt\"), 0) AS \"sales_amt\", COUNT(\"sales_amt\") AS \"$f7\"\r\n        FROM (SELECT CAST(2000 AS INTEGER) AS \"d_year7\", \"i_brand_id\", \"i_class_id\", \"i_category_id\", \"i_manufact_id\", \"sales_cnt\", \"sales_amt\"\r\n                FROM (SELECT \"i_brand_id\", \"i_class_id\", \"i_category_id\", \"i_manufact_id\", \"sales_cnt\", \"sales_amt\"\r\n                            FROM (SELECT \"t0\".\"i_brand_id\", \"t0\".\"i_class_id\", \"t0\".\"i_category_id\", \"t0\".\"i_manufact_id\", \"t\".\"cs_quantity\" - CASE WHEN \"t2\".\"cr_return_quantity\" IS NOT NULL THEN CAST(\"t2\".\"cr_return_quantity\" AS INTEGER) ELSE 0 END AS \"sales_cnt\", \"t\".\"cs_ext_sales_price\" - CASE WHEN \"t2\".\"cr_return_amount\" IS NOT NULL THEN \"t2\".\"cr_return_amount\" ELSE 0.0 END AS \"sales_amt\"\r\n                                        FROM (SELECT *\r\n                                                FROM \"catalog_sales\"\r\n                                                WHERE \"cs_sales_price\" / \"cs_list_price\" >= 0.80 AND \"cs_sales_price\" / \"cs_list_price\" <= 1.00) AS \"t\"\r\n                                            INNER JOIN (SELECT *\r\n                                                FROM \"item\"\r\n                                                WHERE \"i_category\" = 'Electronics') AS \"t0\" ON \"t\".\"cs_item_sk\" = \"t0\".\"i_item_sk\"\r\n                                            INNER JOIN (SELECT *\r\n                                                FROM \"date_dim\"\r\n                                                WHERE \"d_year\" = 2000) AS \"t1\" ON \"t\".\"cs_sold_date_sk\" = \"t1\".\"d_date_sk\"\r\n                                            INNER JOIN (SELECT *\r\n                                                FROM \"catalog_returns\"\r\n                                                WHERE \"cr_reason_sk\" IN (3, 6, 18, 30, 40)) AS \"t2\" ON \"t\".\"cs_order_number\" = \"t2\".\"cr_order_number\" AND \"t\".\"cs_item_sk\" = \"t2\".\"cr_item_sk\"\r\n                                        UNION ALL\r\n                                        SELECT \"t7\".\"i_brand_id0\", \"t7\".\"i_class_id0\", \"t7\".\"i_category_id0\", \"t7\".\"i_manufact_id0\", \"t6\".\"ss_quantity\" - CASE WHEN \"t9\".\"sr_return_quantity\" IS NOT NULL THEN CAST(\"t9\".\"sr_return_quantity\" AS INTEGER) ELSE 0 END AS \"sales_cnt\", \"t6\".\"ss_ext_sales_price\" - CASE WHEN \"t9\".\"sr_return_amt\" IS NOT NULL THEN \"t9\".\"sr_return_amt\" ELSE 0.0 END AS \"sales_amt\"\r\n                                        FROM (SELECT *\r\n                                                FROM \"store_sales\"\r\n                                                WHERE \"ss_sales_price\" / \"ss_list_price\" >= 0.80 AND \"ss_sales_price\" / \"ss_list_price\" <= 1.00) AS \"t6\"\r\n                                            INNER JOIN (SELECT *\r\n                                                FROM \"item\" AS \"item0\" (\"i_item_sk0\", \"i_item_id0\", \"i_rec_start_date0\", \"i_rec_end_date0\", \"i_item_desc0\", \"i_current_price0\", \"i_wholesale_cost0\", \"i_brand_id0\", \"i_brand0\", \"i_class_id0\", \"i_class0\", \"i_category_id0\", \"i_category0\", \"i_manufact_id0\", \"i_manufact0\", \"i_size0\", \"i_formulation0\", \"i_color0\", \"i_units0\", \"i_container0\", \"i_manager_id0\", \"i_product_name0\")\r\n                                                WHERE \"i_category0\" = 'Electronics') AS \"t7\" ON \"t6\".\"ss_item_sk\" = \"t7\".\"i_item_sk0\"\r\n                                            INNER JOIN (SELECT *\r\n                                                FROM \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\")\r\n                                                WHERE \"d_year0\" = 2000) AS \"t8\" ON \"t6\".\"ss_sold_date_sk\" = \"t8\".\"d_date_sk0\"\r\n                                            INNER JOIN (SELECT *\r\n                                                FROM \"store_returns\"\r\n                                                WHERE \"sr_reason_sk\" IN (3, 6, 18, 30, 40)) AS \"t9\" ON \"t6\".\"ss_ticket_number\" = \"t9\".\"sr_ticket_number\" AND \"t6\".\"ss_item_sk\" = \"t9\".\"sr_item_sk\") AS \"t13\"\r\n                            GROUP BY \"i_brand_id\", \"i_class_id\", \"i_category_id\", \"i_manufact_id\", \"sales_cnt\", \"sales_amt\"\r\n                            UNION ALL\r\n                            SELECT \"t18\".\"i_brand_id1\", \"t18\".\"i_class_id1\", \"t18\".\"i_category_id1\", \"t18\".\"i_manufact_id1\", \"t17\".\"ws_quantity\" - CASE WHEN \"t20\".\"wr_return_quantity\" IS NOT NULL THEN CAST(\"t20\".\"wr_return_quantity\" AS INTEGER) ELSE 0 END AS \"sales_cnt0\", \"t17\".\"ws_ext_sales_price\" - CASE WHEN \"t20\".\"wr_return_amt\" IS NOT NULL THEN \"t20\".\"wr_return_amt\" ELSE 0.0 END AS \"sales_amt0\"\r\n                            FROM (SELECT *\r\n                                    FROM \"web_sales\"\r\n                                    WHERE \"ws_sales_price\" / \"ws_list_price\" >= 0.80 AND \"ws_sales_price\" / \"ws_list_price\" <= 1.00) AS \"t17\"\r\n                                INNER JOIN (SELECT *\r\n                                    FROM \"item\" AS \"item1\" (\"i_item_sk1\", \"i_item_id1\", \"i_rec_start_date1\", \"i_rec_end_date1\", \"i_item_desc1\", \"i_current_price1\", \"i_wholesale_cost1\", \"i_brand_id1\", \"i_brand1\", \"i_class_id1\", \"i_class1\", \"i_category_id1\", \"i_category1\", \"i_manufact_id1\", \"i_manufact1\", \"i_size1\", \"i_formulation1\", \"i_color1\", \"i_units1\", \"i_container1\", \"i_manager_id1\", \"i_product_name1\")\r\n                                    WHERE \"i_category1\" = 'Electronics') AS \"t18\" ON \"t17\".\"ws_item_sk\" = \"t18\".\"i_item_sk1\"\r\n                                INNER JOIN (SELECT *\r\n                                    FROM \"date_dim\" AS \"date_dim1\" (\"d_date_sk1\", \"d_date_id1\", \"d_date1\", \"d_month_seq1\", \"d_week_seq1\", \"d_quarter_seq1\", \"d_year4\", \"d_dow1\", \"d_moy1\", \"d_dom1\", \"d_qoy1\", \"d_fy_year1\", \"d_fy_quarter_seq1\", \"d_fy_week_seq1\", \"d_day_name1\", \"d_quarter_name1\", \"d_holiday1\", \"d_weekend1\", \"d_following_holiday1\", \"d_first_dom1\", \"d_last_dom1\", \"d_same_day_ly1\", \"d_same_day_lq1\", \"d_current_day1\", \"d_current_week1\", \"d_current_month1\", \"d_current_quarter1\", \"d_current_year1\")\r\n                                    WHERE \"d_year4\" = 2000) AS \"t19\" ON \"t17\".\"ws_sold_date_sk\" = \"t19\".\"d_date_sk1\"\r\n                                INNER JOIN (SELECT *\r\n                                    FROM \"web_returns\"\r\n                                    WHERE \"wr_reason_sk\" IN (3, 6, 18, 30, 40)) AS \"t20\" ON \"t17\".\"ws_order_number\" = \"t20\".\"wr_order_number\" AND \"t17\".\"ws_item_sk\" = \"t20\".\"wr_item_sk\") AS \"t24\"\r\n                GROUP BY \"i_brand_id\", \"i_class_id\", \"i_category_id\", \"i_manufact_id\", \"sales_cnt\", \"sales_amt\") AS \"t26\"\r\n        GROUP BY \"i_brand_id\", \"i_class_id\", \"i_category_id\", \"i_manufact_id\") AS \"t27\"\r\n    INNER JOIN (SELECT CAST(1999 AS INTEGER) AS \"d_year19\", \"i_brand_id2\", \"i_class_id2\", \"i_category_id2\", \"i_manufact_id2\", CASE WHEN COUNT(\"sales_cnt1\") = 0 THEN NULL ELSE COALESCE(SUM(\"sales_cnt1\"), 0) END AS \"sales_cnt4\", CASE WHEN COUNT(\"sales_amt1\") = 0 THEN NULL ELSE COALESCE(SUM(\"sales_amt1\"), 0) END AS \"sales_amt4\"\r\n        FROM (SELECT CAST(1999 AS INTEGER) AS \"d_year18\", \"i_brand_id2\", \"i_class_id2\", \"i_category_id2\", \"i_manufact_id2\", \"sales_cnt1\", \"sales_amt1\"\r\n                FROM (SELECT \"i_brand_id2\", \"i_class_id2\", \"i_category_id2\", \"i_manufact_id2\", \"sales_cnt1\", \"sales_amt1\"\r\n                            FROM (SELECT \"t29\".\"i_brand_id2\", \"t29\".\"i_class_id2\", \"t29\".\"i_category_id2\", \"t29\".\"i_manufact_id2\", \"t28\".\"cs_quantity0\" - CASE WHEN \"t31\".\"cr_return_quantity0\" IS NOT NULL THEN CAST(\"t31\".\"cr_return_quantity0\" AS INTEGER) ELSE 0 END AS \"sales_cnt1\", \"t28\".\"cs_ext_sales_price0\" - CASE WHEN \"t31\".\"cr_return_amount0\" IS NOT NULL THEN \"t31\".\"cr_return_amount0\" ELSE 0.0 END AS \"sales_amt1\"\r\n                                        FROM (SELECT *\r\n                                                FROM \"catalog_sales\" AS \"catalog_sales0\" (\"cs_sold_date_sk0\", \"cs_sold_time_sk0\", \"cs_ship_date_sk0\", \"cs_bill_customer_sk0\", \"cs_bill_cdemo_sk0\", \"cs_bill_hdemo_sk0\", \"cs_bill_addr_sk0\", \"cs_ship_customer_sk0\", \"cs_ship_cdemo_sk0\", \"cs_ship_hdemo_sk0\", \"cs_ship_addr_sk0\", \"cs_call_center_sk0\", \"cs_catalog_page_sk0\", \"cs_ship_mode_sk0\", \"cs_warehouse_sk0\", \"cs_item_sk0\", \"cs_promo_sk0\", \"cs_order_number0\", \"cs_quantity0\", \"cs_wholesale_cost0\", \"cs_list_price0\", \"cs_sales_price0\", \"cs_ext_discount_amt0\", \"cs_ext_sales_price0\", \"cs_ext_wholesale_cost0\", \"cs_ext_list_price0\", \"cs_ext_tax0\", \"cs_coupon_amt0\", \"cs_ext_ship_cost0\", \"cs_net_paid0\", \"cs_net_paid_inc_tax0\", \"cs_net_paid_inc_ship0\", \"cs_net_paid_inc_ship_tax0\", \"cs_net_profit0\")\r\n                                                WHERE \"cs_sales_price0\" / \"cs_list_price0\" >= 0.80 AND \"cs_sales_price0\" / \"cs_list_price0\" <= 1.00) AS \"t28\"\r\n                                            INNER JOIN (SELECT *\r\n                                                FROM \"item\" AS \"item2\" (\"i_item_sk2\", \"i_item_id2\", \"i_rec_start_date2\", \"i_rec_end_date2\", \"i_item_desc2\", \"i_current_price2\", \"i_wholesale_cost2\", \"i_brand_id2\", \"i_brand2\", \"i_class_id2\", \"i_class2\", \"i_category_id2\", \"i_category2\", \"i_manufact_id2\", \"i_manufact2\", \"i_size2\", \"i_formulation2\", \"i_color2\", \"i_units2\", \"i_container2\", \"i_manager_id2\", \"i_product_name2\")\r\n                                                WHERE \"i_category2\" = 'Electronics') AS \"t29\" ON \"t28\".\"cs_item_sk0\" = \"t29\".\"i_item_sk2\"\r\n                                            INNER JOIN (SELECT *\r\n                                                FROM \"date_dim\" AS \"date_dim2\" (\"d_date_sk2\", \"d_date_id2\", \"d_date2\", \"d_month_seq2\", \"d_week_seq2\", \"d_quarter_seq2\", \"d_year8\", \"d_dow2\", \"d_moy2\", \"d_dom2\", \"d_qoy2\", \"d_fy_year2\", \"d_fy_quarter_seq2\", \"d_fy_week_seq2\", \"d_day_name2\", \"d_quarter_name2\", \"d_holiday2\", \"d_weekend2\", \"d_following_holiday2\", \"d_first_dom2\", \"d_last_dom2\", \"d_same_day_ly2\", \"d_same_day_lq2\", \"d_current_day2\", \"d_current_week2\", \"d_current_month2\", \"d_current_quarter2\", \"d_current_year2\")\r\n                                                WHERE \"d_year8\" = 1999) AS \"t30\" ON \"t28\".\"cs_sold_date_sk0\" = \"t30\".\"d_date_sk2\"\r\n                                            INNER JOIN (SELECT *\r\n                                                FROM \"catalog_returns\" AS \"catalog_returns0\" (\"cr_returned_date_sk0\", \"cr_returned_time_sk0\", \"cr_item_sk0\", \"cr_refunded_customer_sk0\", \"cr_refunded_cdemo_sk0\", \"cr_refunded_hdemo_sk0\", \"cr_refunded_addr_sk0\", \"cr_returning_customer_sk0\", \"cr_returning_cdemo_sk0\", \"cr_returning_hdemo_sk0\", \"cr_returning_addr_sk0\", \"cr_call_center_sk0\", \"cr_catalog_page_sk0\", \"cr_ship_mode_sk0\", \"cr_warehouse_sk0\", \"cr_reason_sk0\", \"cr_order_number0\", \"cr_return_quantity0\", \"cr_return_amount0\", \"cr_return_tax0\", \"cr_return_amt_inc_tax0\", \"cr_fee0\", \"cr_return_ship_cost0\", \"cr_refunded_cash0\", \"cr_reversed_charge0\", \"cr_store_credit0\", \"cr_net_loss0\")\r\n                                                WHERE \"cr_reason_sk0\" IN (3, 6, 18, 30, 40)) AS \"t31\" ON \"t28\".\"cs_order_number0\" = \"t31\".\"cr_order_number0\" AND \"t28\".\"cs_item_sk0\" = \"t31\".\"cr_item_sk0\"\r\n                                        UNION ALL\r\n                                        SELECT \"t36\".\"i_brand_id3\", \"t36\".\"i_class_id3\", \"t36\".\"i_category_id3\", \"t36\".\"i_manufact_id3\", \"t35\".\"ss_quantity0\" - CASE WHEN \"t38\".\"sr_return_quantity0\" IS NOT NULL THEN CAST(\"t38\".\"sr_return_quantity0\" AS INTEGER) ELSE 0 END AS \"sales_cnt2\", \"t35\".\"ss_ext_sales_price0\" - CASE WHEN \"t38\".\"sr_return_amt0\" IS NOT NULL THEN \"t38\".\"sr_return_amt0\" ELSE 0.0 END AS \"sales_amt2\"\r\n                                        FROM (SELECT *\r\n                                                FROM \"store_sales\" AS \"store_sales0\" (\"ss_sold_date_sk0\", \"ss_sold_time_sk0\", \"ss_item_sk0\", \"ss_customer_sk0\", \"ss_cdemo_sk0\", \"ss_hdemo_sk0\", \"ss_addr_sk0\", \"ss_store_sk0\", \"ss_promo_sk0\", \"ss_ticket_number0\", \"ss_quantity0\", \"ss_wholesale_cost0\", \"ss_list_price0\", \"ss_sales_price0\", \"ss_ext_discount_amt0\", \"ss_ext_sales_price0\", \"ss_ext_wholesale_cost0\", \"ss_ext_list_price0\", \"ss_ext_tax0\", \"ss_coupon_amt0\", \"ss_net_paid0\", \"ss_net_paid_inc_tax0\", \"ss_net_profit0\")\r\n                                                WHERE \"ss_sales_price0\" / \"ss_list_price0\" >= 0.80 AND \"ss_sales_price0\" / \"ss_list_price0\" <= 1.00) AS \"t35\"\r\n                                            INNER JOIN (SELECT *\r\n                                                FROM \"item\" AS \"item3\" (\"i_item_sk3\", \"i_item_id3\", \"i_rec_start_date3\", \"i_rec_end_date3\", \"i_item_desc3\", \"i_current_price3\", \"i_wholesale_cost3\", \"i_brand_id3\", \"i_brand3\", \"i_class_id3\", \"i_class3\", \"i_category_id3\", \"i_category3\", \"i_manufact_id3\", \"i_manufact3\", \"i_size3\", \"i_formulation3\", \"i_color3\", \"i_units3\", \"i_container3\", \"i_manager_id3\", \"i_product_name3\")\r\n                                                WHERE \"i_category3\" = 'Electronics') AS \"t36\" ON \"t35\".\"ss_item_sk0\" = \"t36\".\"i_item_sk3\"\r\n                                            INNER JOIN (SELECT *\r\n                                                FROM \"date_dim\" AS \"date_dim3\" (\"d_date_sk3\", \"d_date_id3\", \"d_date3\", \"d_month_seq3\", \"d_week_seq3\", \"d_quarter_seq3\", \"d_year11\", \"d_dow3\", \"d_moy3\", \"d_dom3\", \"d_qoy3\", \"d_fy_year3\", \"d_fy_quarter_seq3\", \"d_fy_week_seq3\", \"d_day_name3\", \"d_quarter_name3\", \"d_holiday3\", \"d_weekend3\", \"d_following_holiday3\", \"d_first_dom3\", \"d_last_dom3\", \"d_same_day_ly3\", \"d_same_day_lq3\", \"d_current_day3\", \"d_current_week3\", \"d_current_month3\", \"d_current_quarter3\", \"d_current_year3\")\r\n                                                WHERE \"d_year11\" = 1999) AS \"t37\" ON \"t35\".\"ss_sold_date_sk0\" = \"t37\".\"d_date_sk3\"\r\n                                            INNER JOIN (SELECT *\r\n                                                FROM \"store_returns\" AS \"store_returns0\" (\"sr_returned_date_sk0\", \"sr_return_time_sk0\", \"sr_item_sk1\", \"sr_customer_sk0\", \"sr_cdemo_sk0\", \"sr_hdemo_sk0\", \"sr_addr_sk0\", \"sr_store_sk0\", \"sr_reason_sk0\", \"sr_ticket_number1\", \"sr_return_quantity0\", \"sr_return_amt0\", \"sr_return_tax0\", \"sr_return_amt_inc_tax0\", \"sr_fee0\", \"sr_return_ship_cost0\", \"sr_refunded_cash0\", \"sr_reversed_charge0\", \"sr_store_credit0\", \"sr_net_loss0\")\r\n                                                WHERE \"sr_reason_sk0\" IN (3, 6, 18, 30, 40)) AS \"t38\" ON \"t35\".\"ss_ticket_number0\" = \"t38\".\"sr_ticket_number1\" AND \"t35\".\"ss_item_sk0\" = \"t38\".\"sr_item_sk1\") AS \"t42\"\r\n                            GROUP BY \"i_brand_id2\", \"i_class_id2\", \"i_category_id2\", \"i_manufact_id2\", \"sales_cnt1\", \"sales_amt1\"\r\n                            UNION ALL\r\n                            SELECT \"t47\".\"i_brand_id4\", \"t47\".\"i_class_id4\", \"t47\".\"i_category_id4\", \"t47\".\"i_manufact_id4\", \"t46\".\"ws_quantity0\" - CASE WHEN \"t49\".\"wr_return_quantity0\" IS NOT NULL THEN CAST(\"t49\".\"wr_return_quantity0\" AS INTEGER) ELSE 0 END AS \"sales_cnt3\", \"t46\".\"ws_ext_sales_price0\" - CASE WHEN \"t49\".\"wr_return_amt0\" IS NOT NULL THEN \"t49\".\"wr_return_amt0\" ELSE 0.0 END AS \"sales_amt3\"\r\n                            FROM (SELECT *\r\n                                    FROM \"web_sales\" AS \"web_sales0\" (\"ws_sold_date_sk0\", \"ws_sold_time_sk0\", \"ws_ship_date_sk0\", \"ws_item_sk0\", \"ws_bill_customer_sk0\", \"ws_bill_cdemo_sk0\", \"ws_bill_hdemo_sk0\", \"ws_bill_addr_sk0\", \"ws_ship_customer_sk0\", \"ws_ship_cdemo_sk0\", \"ws_ship_hdemo_sk0\", \"ws_ship_addr_sk0\", \"ws_web_page_sk0\", \"ws_web_site_sk0\", \"ws_ship_mode_sk0\", \"ws_warehouse_sk0\", \"ws_promo_sk0\", \"ws_order_number0\", \"ws_quantity0\", \"ws_wholesale_cost0\", \"ws_list_price0\", \"ws_sales_price0\", \"ws_ext_discount_amt0\", \"ws_ext_sales_price0\", \"ws_ext_wholesale_cost0\", \"ws_ext_list_price0\", \"ws_ext_tax0\", \"ws_coupon_amt0\", \"ws_ext_ship_cost0\", \"ws_net_paid0\", \"ws_net_paid_inc_tax0\", \"ws_net_paid_inc_ship0\", \"ws_net_paid_inc_ship_tax0\", \"ws_net_profit0\")\r\n                                    WHERE \"ws_sales_price0\" / \"ws_list_price0\" >= 0.80 AND \"ws_sales_price0\" / \"ws_list_price0\" <= 1.00) AS \"t46\"\r\n                                INNER JOIN (SELECT *\r\n                                    FROM \"item\" AS \"item4\" (\"i_item_sk4\", \"i_item_id4\", \"i_rec_start_date4\", \"i_rec_end_date4\", \"i_item_desc4\", \"i_current_price4\", \"i_wholesale_cost4\", \"i_brand_id4\", \"i_brand4\", \"i_class_id4\", \"i_class4\", \"i_category_id4\", \"i_category4\", \"i_manufact_id4\", \"i_manufact4\", \"i_size4\", \"i_formulation4\", \"i_color4\", \"i_units4\", \"i_container4\", \"i_manager_id4\", \"i_product_name4\")\r\n                                    WHERE \"i_category4\" = 'Electronics') AS \"t47\" ON \"t46\".\"ws_item_sk0\" = \"t47\".\"i_item_sk4\"\r\n                                INNER JOIN (SELECT *\r\n                                    FROM \"date_dim\" AS \"date_dim4\" (\"d_date_sk4\", \"d_date_id4\", \"d_date4\", \"d_month_seq4\", \"d_week_seq4\", \"d_quarter_seq4\", \"d_year15\", \"d_dow4\", \"d_moy4\", \"d_dom4\", \"d_qoy4\", \"d_fy_year4\", \"d_fy_quarter_seq4\", \"d_fy_week_seq4\", \"d_day_name4\", \"d_quarter_name4\", \"d_holiday4\", \"d_weekend4\", \"d_following_holiday4\", \"d_first_dom4\", \"d_last_dom4\", \"d_same_day_ly4\", \"d_same_day_lq4\", \"d_current_day4\", \"d_current_week4\", \"d_current_month4\", \"d_current_quarter4\", \"d_current_year4\")\r\n                                    WHERE \"d_year15\" = 1999) AS \"t48\" ON \"t46\".\"ws_sold_date_sk0\" = \"t48\".\"d_date_sk4\"\r\n                                INNER JOIN (SELECT *\r\n                                    FROM \"web_returns\" AS \"web_returns0\" (\"wr_returned_date_sk0\", \"wr_returned_time_sk0\", \"wr_item_sk1\", \"wr_refunded_customer_sk0\", \"wr_refunded_cdemo_sk0\", \"wr_refunded_hdemo_sk0\", \"wr_refunded_addr_sk0\", \"wr_returning_customer_sk0\", \"wr_returning_cdemo_sk0\", \"wr_returning_hdemo_sk0\", \"wr_returning_addr_sk0\", \"wr_web_page_sk0\", \"wr_reason_sk0\", \"wr_order_number1\", \"wr_return_quantity0\", \"wr_return_amt0\", \"wr_return_tax0\", \"wr_return_amt_inc_tax0\", \"wr_fee0\", \"wr_return_ship_cost0\", \"wr_refunded_cash0\", \"wr_reversed_charge0\", \"wr_account_credit0\", \"wr_net_loss0\")\r\n                                    WHERE \"wr_reason_sk0\" IN (3, 6, 18, 30, 40)) AS \"t49\" ON \"t46\".\"ws_order_number0\" = \"t49\".\"wr_order_number1\" AND \"t46\".\"ws_item_sk0\" = \"t49\".\"wr_item_sk1\") AS \"t53\"\r\n                GROUP BY \"i_brand_id2\", \"i_class_id2\", \"i_category_id2\", \"i_manufact_id2\", \"sales_cnt1\", \"sales_amt1\") AS \"t55\"\r\n        GROUP BY \"i_brand_id2\", \"i_class_id2\", \"i_category_id2\", \"i_manufact_id2\"\r\n        HAVING COALESCE(SUM(\"sales_cnt1\"), 0) > 0 AND COUNT(\"sales_cnt1\") <> 0) AS \"t59\" ON \"t27\".\"i_brand_id\" = \"t59\".\"i_brand_id2\" AND \"t27\".\"i_class_id\" = \"t59\".\"i_class_id2\" AND \"t27\".\"i_category_id\" = \"t59\".\"i_category_id2\" AND \"t27\".\"i_manufact_id\" = \"t59\".\"i_manufact_id2\" AND CAST(CASE WHEN \"t27\".\"$f5\" = 0 THEN NULL ELSE \"t27\".\"sales_cnt\" END AS DECIMAL(17, 2)) / CAST(\"t59\".\"sales_cnt4\" AS DECIMAL(17, 2)) < 0.9\r\nORDER BY 9, 10\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 178.71, "used_rules": ["FILTER_INTO_JOIN", "FILTER_AGGREGATE_TRANSPOSE", "FILTER_SET_OP_TRANSPOSE", "FILTER_REDUCE_EXPRESSIONS", "PROJECT_REDUCE_EXPRESSIONS", "FILTER_PROJECT_TRANSPOSE", "PROJECT_REDUCE_EXPRESSIONS", "FILTER_INTO_JOIN", "JOIN_EXTRACT_FILTER", "AGGREGATE_ANY_PULL_UP_CONSTANTS", "AGGREGATE_REDUCE_FUNCTIONS", "JOIN_PROJECT_LEFT_TRANSPOSE", "FILTER_INTO_JOIN", "FILTER_PROJECT_TRANSPOSE", "FILTER_REDUCE_EXPRESSIONS", "PROJECT_REDUCE_EXPRESSIONS", "FILTER_INTO_JOIN", "UNION_PULL_UP_CONSTANTS", "UNION_TO_DISTINCT"], "rewrite_time": 20862}
{"name": "query075_1", "input_sql": "WITH all_sales AS (\n SELECT d_year\n       ,i_brand_id\n       ,i_class_id\n       ,i_category_id\n       ,i_manufact_id\n       ,SUM(sales_cnt) AS sales_cnt\n       ,SUM(sales_amt) AS sales_amt\n FROM (SELECT d_year\n             ,i_brand_id\n             ,i_class_id\n             ,i_category_id\n             ,i_manufact_id\n             ,cs_quantity - COALESCE(cr_return_quantity,0) AS sales_cnt\n             ,cs_ext_sales_price - COALESCE(cr_return_amount,0.0) AS sales_amt\n       FROM catalog_sales JOIN item ON i_item_sk=cs_item_sk\n                          JOIN date_dim ON d_date_sk=cs_sold_date_sk\n                          LEFT JOIN catalog_returns ON (cs_order_number=cr_order_number\n                                                    AND cs_item_sk=cr_item_sk)\n       WHERE i_category='Children'\n       and cs_sales_price / cs_list_price BETWEEN 80 * 0.01 AND 100 * 0.01\n       and cr_reason_sk in (18, 40, 48, 55, 68)\n       UNION\n       SELECT d_year\n             ,i_brand_id\n             ,i_class_id\n             ,i_category_id\n             ,i_manufact_id\n             ,ss_quantity - COALESCE(sr_return_quantity,0) AS sales_cnt\n             ,ss_ext_sales_price - COALESCE(sr_return_amt,0.0) AS sales_amt\n       FROM store_sales JOIN item ON i_item_sk=ss_item_sk\n                        JOIN date_dim ON d_date_sk=ss_sold_date_sk\n                        LEFT JOIN store_returns ON (ss_ticket_number=sr_ticket_number\n                                                AND ss_item_sk=sr_item_sk)\n       WHERE i_category='Children'\n       and ss_sales_price / ss_list_price BETWEEN 80 * 0.01 AND 100 * 0.01\n       and sr_reason_sk in (18, 40, 48, 55, 68)\n       UNION\n       SELECT d_year\n             ,i_brand_id\n             ,i_class_id\n             ,i_category_id\n             ,i_manufact_id\n             ,ws_quantity - COALESCE(wr_return_quantity,0) AS sales_cnt\n             ,ws_ext_sales_price - COALESCE(wr_return_amt,0.0) AS sales_amt\n       FROM web_sales JOIN item ON i_item_sk=ws_item_sk\n                      JOIN date_dim ON d_date_sk=ws_sold_date_sk\n                      LEFT JOIN web_returns ON (ws_order_number=wr_order_number\n                                            AND ws_item_sk=wr_item_sk)\n       WHERE i_category='Children'\n       and ws_sales_price / ws_list_price BETWEEN 80 * 0.01 AND 100 * 0.01\n       and wr_reason_sk in (18, 40, 48, 55, 68)) sales_detail\nGROUP BY d_year, i_brand_id, i_class_id, i_category_id, i_manufact_id)\n SELECT  prev_yr.d_year AS prev_year\n                          ,curr_yr.d_year AS \"year\"\n                          ,curr_yr.i_brand_id\n                          ,curr_yr.i_class_id\n                          ,curr_yr.i_category_id\n                          ,curr_yr.i_manufact_id\n                          ,prev_yr.sales_cnt AS prev_yr_cnt\n                          ,curr_yr.sales_cnt AS curr_yr_cnt\n                          ,curr_yr.sales_cnt-prev_yr.sales_cnt AS sales_cnt_diff\n                          ,curr_yr.sales_amt-prev_yr.sales_amt AS sales_amt_diff\n FROM all_sales curr_yr, all_sales prev_yr\n WHERE curr_yr.i_brand_id=prev_yr.i_brand_id\n   AND curr_yr.i_class_id=prev_yr.i_class_id\n   AND curr_yr.i_category_id=prev_yr.i_category_id\n   AND curr_yr.i_manufact_id=prev_yr.i_manufact_id\n   AND curr_yr.d_year=1999\n   AND prev_yr.d_year=1999-1\n   AND prev_yr.sales_cnt > 0\n   AND CAST(curr_yr.sales_cnt AS DECIMAL(17,2))/CAST(prev_yr.sales_cnt AS DECIMAL(17,2))<0.9\n ORDER BY sales_cnt_diff,sales_amt_diff\n limit 100;", "input_cost": 89.88, "output_sql": "SELECT CAST(1998 AS INTEGER) AS \"prev_year\", CAST(1999 AS INTEGER) AS \"year\", \"t27\".\"i_brand_id\", \"t27\".\"i_class_id\", \"t27\".\"i_category_id\", \"t27\".\"i_manufact_id\", \"t59\".\"sales_cnt4\", CASE WHEN \"t27\".\"$f5\" = 0 THEN NULL ELSE \"t27\".\"sales_cnt\" END AS \"sales_cnt5\", CASE WHEN \"t27\".\"$f5\" = 0 THEN NULL ELSE \"t27\".\"sales_cnt\" END - \"t59\".\"sales_cnt4\" AS \"sales_cnt_diff\", CASE WHEN \"t27\".\"$f7\" = 0 THEN NULL ELSE \"t27\".\"sales_amt\" END - \"t59\".\"sales_amt4\" AS \"sales_amt_diff\"\r\nFROM (SELECT \"i_brand_id\", \"i_class_id\", \"i_category_id\", \"i_manufact_id\", COALESCE(SUM(\"sales_cnt\"), 0) AS \"sales_cnt\", COUNT(\"sales_cnt\") AS \"$f5\", COALESCE(SUM(\"sales_amt\"), 0) AS \"sales_amt\", COUNT(\"sales_amt\") AS \"$f7\"\r\n        FROM (SELECT CAST(1999 AS INTEGER) AS \"d_year7\", \"i_brand_id\", \"i_class_id\", \"i_category_id\", \"i_manufact_id\", \"sales_cnt\", \"sales_amt\"\r\n                FROM (SELECT \"i_brand_id\", \"i_class_id\", \"i_category_id\", \"i_manufact_id\", \"sales_cnt\", \"sales_amt\"\r\n                            FROM (SELECT \"t0\".\"i_brand_id\", \"t0\".\"i_class_id\", \"t0\".\"i_category_id\", \"t0\".\"i_manufact_id\", \"t\".\"cs_quantity\" - CASE WHEN \"t2\".\"cr_return_quantity\" IS NOT NULL THEN CAST(\"t2\".\"cr_return_quantity\" AS INTEGER) ELSE 0 END AS \"sales_cnt\", \"t\".\"cs_ext_sales_price\" - CASE WHEN \"t2\".\"cr_return_amount\" IS NOT NULL THEN \"t2\".\"cr_return_amount\" ELSE 0.0 END AS \"sales_amt\"\r\n                                        FROM (SELECT *\r\n                                                FROM \"catalog_sales\"\r\n                                                WHERE \"cs_sales_price\" / \"cs_list_price\" >= 0.80 AND \"cs_sales_price\" / \"cs_list_price\" <= 1.00) AS \"t\"\r\n                                            INNER JOIN (SELECT *\r\n                                                FROM \"item\"\r\n                                                WHERE \"i_category\" = 'Children') AS \"t0\" ON \"t\".\"cs_item_sk\" = \"t0\".\"i_item_sk\"\r\n                                            INNER JOIN (SELECT *\r\n                                                FROM \"date_dim\"\r\n                                                WHERE \"d_year\" = 1999) AS \"t1\" ON \"t\".\"cs_sold_date_sk\" = \"t1\".\"d_date_sk\"\r\n                                            INNER JOIN (SELECT *\r\n                                                FROM \"catalog_returns\"\r\n                                                WHERE \"cr_reason_sk\" IN (18, 40, 48, 55, 68)) AS \"t2\" ON \"t\".\"cs_order_number\" = \"t2\".\"cr_order_number\" AND \"t\".\"cs_item_sk\" = \"t2\".\"cr_item_sk\"\r\n                                        UNION ALL\r\n                                        SELECT \"t7\".\"i_brand_id0\", \"t7\".\"i_class_id0\", \"t7\".\"i_category_id0\", \"t7\".\"i_manufact_id0\", \"t6\".\"ss_quantity\" - CASE WHEN \"t9\".\"sr_return_quantity\" IS NOT NULL THEN CAST(\"t9\".\"sr_return_quantity\" AS INTEGER) ELSE 0 END AS \"sales_cnt\", \"t6\".\"ss_ext_sales_price\" - CASE WHEN \"t9\".\"sr_return_amt\" IS NOT NULL THEN \"t9\".\"sr_return_amt\" ELSE 0.0 END AS \"sales_amt\"\r\n                                        FROM (SELECT *\r\n                                                FROM \"store_sales\"\r\n                                                WHERE \"ss_sales_price\" / \"ss_list_price\" >= 0.80 AND \"ss_sales_price\" / \"ss_list_price\" <= 1.00) AS \"t6\"\r\n                                            INNER JOIN (SELECT *\r\n                                                FROM \"item\" AS \"item0\" (\"i_item_sk0\", \"i_item_id0\", \"i_rec_start_date0\", \"i_rec_end_date0\", \"i_item_desc0\", \"i_current_price0\", \"i_wholesale_cost0\", \"i_brand_id0\", \"i_brand0\", \"i_class_id0\", \"i_class0\", \"i_category_id0\", \"i_category0\", \"i_manufact_id0\", \"i_manufact0\", \"i_size0\", \"i_formulation0\", \"i_color0\", \"i_units0\", \"i_container0\", \"i_manager_id0\", \"i_product_name0\")\r\n                                                WHERE \"i_category0\" = 'Children') AS \"t7\" ON \"t6\".\"ss_item_sk\" = \"t7\".\"i_item_sk0\"\r\n                                            INNER JOIN (SELECT *\r\n                                                FROM \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\")\r\n                                                WHERE \"d_year0\" = 1999) AS \"t8\" ON \"t6\".\"ss_sold_date_sk\" = \"t8\".\"d_date_sk0\"\r\n                                            INNER JOIN (SELECT *\r\n                                                FROM \"store_returns\"\r\n                                                WHERE \"sr_reason_sk\" IN (18, 40, 48, 55, 68)) AS \"t9\" ON \"t6\".\"ss_ticket_number\" = \"t9\".\"sr_ticket_number\" AND \"t6\".\"ss_item_sk\" = \"t9\".\"sr_item_sk\") AS \"t13\"\r\n                            GROUP BY \"i_brand_id\", \"i_class_id\", \"i_category_id\", \"i_manufact_id\", \"sales_cnt\", \"sales_amt\"\r\n                            UNION ALL\r\n                            SELECT \"t18\".\"i_brand_id1\", \"t18\".\"i_class_id1\", \"t18\".\"i_category_id1\", \"t18\".\"i_manufact_id1\", \"t17\".\"ws_quantity\" - CASE WHEN \"t20\".\"wr_return_quantity\" IS NOT NULL THEN CAST(\"t20\".\"wr_return_quantity\" AS INTEGER) ELSE 0 END AS \"sales_cnt0\", \"t17\".\"ws_ext_sales_price\" - CASE WHEN \"t20\".\"wr_return_amt\" IS NOT NULL THEN \"t20\".\"wr_return_amt\" ELSE 0.0 END AS \"sales_amt0\"\r\n                            FROM (SELECT *\r\n                                    FROM \"web_sales\"\r\n                                    WHERE \"ws_sales_price\" / \"ws_list_price\" >= 0.80 AND \"ws_sales_price\" / \"ws_list_price\" <= 1.00) AS \"t17\"\r\n                                INNER JOIN (SELECT *\r\n                                    FROM \"item\" AS \"item1\" (\"i_item_sk1\", \"i_item_id1\", \"i_rec_start_date1\", \"i_rec_end_date1\", \"i_item_desc1\", \"i_current_price1\", \"i_wholesale_cost1\", \"i_brand_id1\", \"i_brand1\", \"i_class_id1\", \"i_class1\", \"i_category_id1\", \"i_category1\", \"i_manufact_id1\", \"i_manufact1\", \"i_size1\", \"i_formulation1\", \"i_color1\", \"i_units1\", \"i_container1\", \"i_manager_id1\", \"i_product_name1\")\r\n                                    WHERE \"i_category1\" = 'Children') AS \"t18\" ON \"t17\".\"ws_item_sk\" = \"t18\".\"i_item_sk1\"\r\n                                INNER JOIN (SELECT *\r\n                                    FROM \"date_dim\" AS \"date_dim1\" (\"d_date_sk1\", \"d_date_id1\", \"d_date1\", \"d_month_seq1\", \"d_week_seq1\", \"d_quarter_seq1\", \"d_year4\", \"d_dow1\", \"d_moy1\", \"d_dom1\", \"d_qoy1\", \"d_fy_year1\", \"d_fy_quarter_seq1\", \"d_fy_week_seq1\", \"d_day_name1\", \"d_quarter_name1\", \"d_holiday1\", \"d_weekend1\", \"d_following_holiday1\", \"d_first_dom1\", \"d_last_dom1\", \"d_same_day_ly1\", \"d_same_day_lq1\", \"d_current_day1\", \"d_current_week1\", \"d_current_month1\", \"d_current_quarter1\", \"d_current_year1\")\r\n                                    WHERE \"d_year4\" = 1999) AS \"t19\" ON \"t17\".\"ws_sold_date_sk\" = \"t19\".\"d_date_sk1\"\r\n                                INNER JOIN (SELECT *\r\n                                    FROM \"web_returns\"\r\n                                    WHERE \"wr_reason_sk\" IN (18, 40, 48, 55, 68)) AS \"t20\" ON \"t17\".\"ws_order_number\" = \"t20\".\"wr_order_number\" AND \"t17\".\"ws_item_sk\" = \"t20\".\"wr_item_sk\") AS \"t24\"\r\n                GROUP BY \"i_brand_id\", \"i_class_id\", \"i_category_id\", \"i_manufact_id\", \"sales_cnt\", \"sales_amt\") AS \"t26\"\r\n        GROUP BY \"i_brand_id\", \"i_class_id\", \"i_category_id\", \"i_manufact_id\") AS \"t27\"\r\n    INNER JOIN (SELECT CAST(1998 AS INTEGER) AS \"d_year19\", \"i_brand_id2\", \"i_class_id2\", \"i_category_id2\", \"i_manufact_id2\", CASE WHEN COUNT(\"sales_cnt1\") = 0 THEN NULL ELSE COALESCE(SUM(\"sales_cnt1\"), 0) END AS \"sales_cnt4\", CASE WHEN COUNT(\"sales_amt1\") = 0 THEN NULL ELSE COALESCE(SUM(\"sales_amt1\"), 0) END AS \"sales_amt4\"\r\n        FROM (SELECT CAST(1998 AS INTEGER) AS \"d_year18\", \"i_brand_id2\", \"i_class_id2\", \"i_category_id2\", \"i_manufact_id2\", \"sales_cnt1\", \"sales_amt1\"\r\n                FROM (SELECT \"i_brand_id2\", \"i_class_id2\", \"i_category_id2\", \"i_manufact_id2\", \"sales_cnt1\", \"sales_amt1\"\r\n                            FROM (SELECT \"t29\".\"i_brand_id2\", \"t29\".\"i_class_id2\", \"t29\".\"i_category_id2\", \"t29\".\"i_manufact_id2\", \"t28\".\"cs_quantity0\" - CASE WHEN \"t31\".\"cr_return_quantity0\" IS NOT NULL THEN CAST(\"t31\".\"cr_return_quantity0\" AS INTEGER) ELSE 0 END AS \"sales_cnt1\", \"t28\".\"cs_ext_sales_price0\" - CASE WHEN \"t31\".\"cr_return_amount0\" IS NOT NULL THEN \"t31\".\"cr_return_amount0\" ELSE 0.0 END AS \"sales_amt1\"\r\n                                        FROM (SELECT *\r\n                                                FROM \"catalog_sales\" AS \"catalog_sales0\" (\"cs_sold_date_sk0\", \"cs_sold_time_sk0\", \"cs_ship_date_sk0\", \"cs_bill_customer_sk0\", \"cs_bill_cdemo_sk0\", \"cs_bill_hdemo_sk0\", \"cs_bill_addr_sk0\", \"cs_ship_customer_sk0\", \"cs_ship_cdemo_sk0\", \"cs_ship_hdemo_sk0\", \"cs_ship_addr_sk0\", \"cs_call_center_sk0\", \"cs_catalog_page_sk0\", \"cs_ship_mode_sk0\", \"cs_warehouse_sk0\", \"cs_item_sk0\", \"cs_promo_sk0\", \"cs_order_number0\", \"cs_quantity0\", \"cs_wholesale_cost0\", \"cs_list_price0\", \"cs_sales_price0\", \"cs_ext_discount_amt0\", \"cs_ext_sales_price0\", \"cs_ext_wholesale_cost0\", \"cs_ext_list_price0\", \"cs_ext_tax0\", \"cs_coupon_amt0\", \"cs_ext_ship_cost0\", \"cs_net_paid0\", \"cs_net_paid_inc_tax0\", \"cs_net_paid_inc_ship0\", \"cs_net_paid_inc_ship_tax0\", \"cs_net_profit0\")\r\n                                                WHERE \"cs_sales_price0\" / \"cs_list_price0\" >= 0.80 AND \"cs_sales_price0\" / \"cs_list_price0\" <= 1.00) AS \"t28\"\r\n                                            INNER JOIN (SELECT *\r\n                                                FROM \"item\" AS \"item2\" (\"i_item_sk2\", \"i_item_id2\", \"i_rec_start_date2\", \"i_rec_end_date2\", \"i_item_desc2\", \"i_current_price2\", \"i_wholesale_cost2\", \"i_brand_id2\", \"i_brand2\", \"i_class_id2\", \"i_class2\", \"i_category_id2\", \"i_category2\", \"i_manufact_id2\", \"i_manufact2\", \"i_size2\", \"i_formulation2\", \"i_color2\", \"i_units2\", \"i_container2\", \"i_manager_id2\", \"i_product_name2\")\r\n                                                WHERE \"i_category2\" = 'Children') AS \"t29\" ON \"t28\".\"cs_item_sk0\" = \"t29\".\"i_item_sk2\"\r\n                                            INNER JOIN (SELECT *\r\n                                                FROM \"date_dim\" AS \"date_dim2\" (\"d_date_sk2\", \"d_date_id2\", \"d_date2\", \"d_month_seq2\", \"d_week_seq2\", \"d_quarter_seq2\", \"d_year8\", \"d_dow2\", \"d_moy2\", \"d_dom2\", \"d_qoy2\", \"d_fy_year2\", \"d_fy_quarter_seq2\", \"d_fy_week_seq2\", \"d_day_name2\", \"d_quarter_name2\", \"d_holiday2\", \"d_weekend2\", \"d_following_holiday2\", \"d_first_dom2\", \"d_last_dom2\", \"d_same_day_ly2\", \"d_same_day_lq2\", \"d_current_day2\", \"d_current_week2\", \"d_current_month2\", \"d_current_quarter2\", \"d_current_year2\")\r\n                                                WHERE \"d_year8\" = 1998) AS \"t30\" ON \"t28\".\"cs_sold_date_sk0\" = \"t30\".\"d_date_sk2\"\r\n                                            INNER JOIN (SELECT *\r\n                                                FROM \"catalog_returns\" AS \"catalog_returns0\" (\"cr_returned_date_sk0\", \"cr_returned_time_sk0\", \"cr_item_sk0\", \"cr_refunded_customer_sk0\", \"cr_refunded_cdemo_sk0\", \"cr_refunded_hdemo_sk0\", \"cr_refunded_addr_sk0\", \"cr_returning_customer_sk0\", \"cr_returning_cdemo_sk0\", \"cr_returning_hdemo_sk0\", \"cr_returning_addr_sk0\", \"cr_call_center_sk0\", \"cr_catalog_page_sk0\", \"cr_ship_mode_sk0\", \"cr_warehouse_sk0\", \"cr_reason_sk0\", \"cr_order_number0\", \"cr_return_quantity0\", \"cr_return_amount0\", \"cr_return_tax0\", \"cr_return_amt_inc_tax0\", \"cr_fee0\", \"cr_return_ship_cost0\", \"cr_refunded_cash0\", \"cr_reversed_charge0\", \"cr_store_credit0\", \"cr_net_loss0\")\r\n                                                WHERE \"cr_reason_sk0\" IN (18, 40, 48, 55, 68)) AS \"t31\" ON \"t28\".\"cs_order_number0\" = \"t31\".\"cr_order_number0\" AND \"t28\".\"cs_item_sk0\" = \"t31\".\"cr_item_sk0\"\r\n                                        UNION ALL\r\n                                        SELECT \"t36\".\"i_brand_id3\", \"t36\".\"i_class_id3\", \"t36\".\"i_category_id3\", \"t36\".\"i_manufact_id3\", \"t35\".\"ss_quantity0\" - CASE WHEN \"t38\".\"sr_return_quantity0\" IS NOT NULL THEN CAST(\"t38\".\"sr_return_quantity0\" AS INTEGER) ELSE 0 END AS \"sales_cnt2\", \"t35\".\"ss_ext_sales_price0\" - CASE WHEN \"t38\".\"sr_return_amt0\" IS NOT NULL THEN \"t38\".\"sr_return_amt0\" ELSE 0.0 END AS \"sales_amt2\"\r\n                                        FROM (SELECT *\r\n                                                FROM \"store_sales\" AS \"store_sales0\" (\"ss_sold_date_sk0\", \"ss_sold_time_sk0\", \"ss_item_sk0\", \"ss_customer_sk0\", \"ss_cdemo_sk0\", \"ss_hdemo_sk0\", \"ss_addr_sk0\", \"ss_store_sk0\", \"ss_promo_sk0\", \"ss_ticket_number0\", \"ss_quantity0\", \"ss_wholesale_cost0\", \"ss_list_price0\", \"ss_sales_price0\", \"ss_ext_discount_amt0\", \"ss_ext_sales_price0\", \"ss_ext_wholesale_cost0\", \"ss_ext_list_price0\", \"ss_ext_tax0\", \"ss_coupon_amt0\", \"ss_net_paid0\", \"ss_net_paid_inc_tax0\", \"ss_net_profit0\")\r\n                                                WHERE \"ss_sales_price0\" / \"ss_list_price0\" >= 0.80 AND \"ss_sales_price0\" / \"ss_list_price0\" <= 1.00) AS \"t35\"\r\n                                            INNER JOIN (SELECT *\r\n                                                FROM \"item\" AS \"item3\" (\"i_item_sk3\", \"i_item_id3\", \"i_rec_start_date3\", \"i_rec_end_date3\", \"i_item_desc3\", \"i_current_price3\", \"i_wholesale_cost3\", \"i_brand_id3\", \"i_brand3\", \"i_class_id3\", \"i_class3\", \"i_category_id3\", \"i_category3\", \"i_manufact_id3\", \"i_manufact3\", \"i_size3\", \"i_formulation3\", \"i_color3\", \"i_units3\", \"i_container3\", \"i_manager_id3\", \"i_product_name3\")\r\n                                                WHERE \"i_category3\" = 'Children') AS \"t36\" ON \"t35\".\"ss_item_sk0\" = \"t36\".\"i_item_sk3\"\r\n                                            INNER JOIN (SELECT *\r\n                                                FROM \"date_dim\" AS \"date_dim3\" (\"d_date_sk3\", \"d_date_id3\", \"d_date3\", \"d_month_seq3\", \"d_week_seq3\", \"d_quarter_seq3\", \"d_year11\", \"d_dow3\", \"d_moy3\", \"d_dom3\", \"d_qoy3\", \"d_fy_year3\", \"d_fy_quarter_seq3\", \"d_fy_week_seq3\", \"d_day_name3\", \"d_quarter_name3\", \"d_holiday3\", \"d_weekend3\", \"d_following_holiday3\", \"d_first_dom3\", \"d_last_dom3\", \"d_same_day_ly3\", \"d_same_day_lq3\", \"d_current_day3\", \"d_current_week3\", \"d_current_month3\", \"d_current_quarter3\", \"d_current_year3\")\r\n                                                WHERE \"d_year11\" = 1998) AS \"t37\" ON \"t35\".\"ss_sold_date_sk0\" = \"t37\".\"d_date_sk3\"\r\n                                            INNER JOIN (SELECT *\r\n                                                FROM \"store_returns\" AS \"store_returns0\" (\"sr_returned_date_sk0\", \"sr_return_time_sk0\", \"sr_item_sk1\", \"sr_customer_sk0\", \"sr_cdemo_sk0\", \"sr_hdemo_sk0\", \"sr_addr_sk0\", \"sr_store_sk0\", \"sr_reason_sk0\", \"sr_ticket_number1\", \"sr_return_quantity0\", \"sr_return_amt0\", \"sr_return_tax0\", \"sr_return_amt_inc_tax0\", \"sr_fee0\", \"sr_return_ship_cost0\", \"sr_refunded_cash0\", \"sr_reversed_charge0\", \"sr_store_credit0\", \"sr_net_loss0\")\r\n                                                WHERE \"sr_reason_sk0\" IN (18, 40, 48, 55, 68)) AS \"t38\" ON \"t35\".\"ss_ticket_number0\" = \"t38\".\"sr_ticket_number1\" AND \"t35\".\"ss_item_sk0\" = \"t38\".\"sr_item_sk1\") AS \"t42\"\r\n                            GROUP BY \"i_brand_id2\", \"i_class_id2\", \"i_category_id2\", \"i_manufact_id2\", \"sales_cnt1\", \"sales_amt1\"\r\n                            UNION ALL\r\n                            SELECT \"t47\".\"i_brand_id4\", \"t47\".\"i_class_id4\", \"t47\".\"i_category_id4\", \"t47\".\"i_manufact_id4\", \"t46\".\"ws_quantity0\" - CASE WHEN \"t49\".\"wr_return_quantity0\" IS NOT NULL THEN CAST(\"t49\".\"wr_return_quantity0\" AS INTEGER) ELSE 0 END AS \"sales_cnt3\", \"t46\".\"ws_ext_sales_price0\" - CASE WHEN \"t49\".\"wr_return_amt0\" IS NOT NULL THEN \"t49\".\"wr_return_amt0\" ELSE 0.0 END AS \"sales_amt3\"\r\n                            FROM (SELECT *\r\n                                    FROM \"web_sales\" AS \"web_sales0\" (\"ws_sold_date_sk0\", \"ws_sold_time_sk0\", \"ws_ship_date_sk0\", \"ws_item_sk0\", \"ws_bill_customer_sk0\", \"ws_bill_cdemo_sk0\", \"ws_bill_hdemo_sk0\", \"ws_bill_addr_sk0\", \"ws_ship_customer_sk0\", \"ws_ship_cdemo_sk0\", \"ws_ship_hdemo_sk0\", \"ws_ship_addr_sk0\", \"ws_web_page_sk0\", \"ws_web_site_sk0\", \"ws_ship_mode_sk0\", \"ws_warehouse_sk0\", \"ws_promo_sk0\", \"ws_order_number0\", \"ws_quantity0\", \"ws_wholesale_cost0\", \"ws_list_price0\", \"ws_sales_price0\", \"ws_ext_discount_amt0\", \"ws_ext_sales_price0\", \"ws_ext_wholesale_cost0\", \"ws_ext_list_price0\", \"ws_ext_tax0\", \"ws_coupon_amt0\", \"ws_ext_ship_cost0\", \"ws_net_paid0\", \"ws_net_paid_inc_tax0\", \"ws_net_paid_inc_ship0\", \"ws_net_paid_inc_ship_tax0\", \"ws_net_profit0\")\r\n                                    WHERE \"ws_sales_price0\" / \"ws_list_price0\" >= 0.80 AND \"ws_sales_price0\" / \"ws_list_price0\" <= 1.00) AS \"t46\"\r\n                                INNER JOIN (SELECT *\r\n                                    FROM \"item\" AS \"item4\" (\"i_item_sk4\", \"i_item_id4\", \"i_rec_start_date4\", \"i_rec_end_date4\", \"i_item_desc4\", \"i_current_price4\", \"i_wholesale_cost4\", \"i_brand_id4\", \"i_brand4\", \"i_class_id4\", \"i_class4\", \"i_category_id4\", \"i_category4\", \"i_manufact_id4\", \"i_manufact4\", \"i_size4\", \"i_formulation4\", \"i_color4\", \"i_units4\", \"i_container4\", \"i_manager_id4\", \"i_product_name4\")\r\n                                    WHERE \"i_category4\" = 'Children') AS \"t47\" ON \"t46\".\"ws_item_sk0\" = \"t47\".\"i_item_sk4\"\r\n                                INNER JOIN (SELECT *\r\n                                    FROM \"date_dim\" AS \"date_dim4\" (\"d_date_sk4\", \"d_date_id4\", \"d_date4\", \"d_month_seq4\", \"d_week_seq4\", \"d_quarter_seq4\", \"d_year15\", \"d_dow4\", \"d_moy4\", \"d_dom4\", \"d_qoy4\", \"d_fy_year4\", \"d_fy_quarter_seq4\", \"d_fy_week_seq4\", \"d_day_name4\", \"d_quarter_name4\", \"d_holiday4\", \"d_weekend4\", \"d_following_holiday4\", \"d_first_dom4\", \"d_last_dom4\", \"d_same_day_ly4\", \"d_same_day_lq4\", \"d_current_day4\", \"d_current_week4\", \"d_current_month4\", \"d_current_quarter4\", \"d_current_year4\")\r\n                                    WHERE \"d_year15\" = 1998) AS \"t48\" ON \"t46\".\"ws_sold_date_sk0\" = \"t48\".\"d_date_sk4\"\r\n                                INNER JOIN (SELECT *\r\n                                    FROM \"web_returns\" AS \"web_returns0\" (\"wr_returned_date_sk0\", \"wr_returned_time_sk0\", \"wr_item_sk1\", \"wr_refunded_customer_sk0\", \"wr_refunded_cdemo_sk0\", \"wr_refunded_hdemo_sk0\", \"wr_refunded_addr_sk0\", \"wr_returning_customer_sk0\", \"wr_returning_cdemo_sk0\", \"wr_returning_hdemo_sk0\", \"wr_returning_addr_sk0\", \"wr_web_page_sk0\", \"wr_reason_sk0\", \"wr_order_number1\", \"wr_return_quantity0\", \"wr_return_amt0\", \"wr_return_tax0\", \"wr_return_amt_inc_tax0\", \"wr_fee0\", \"wr_return_ship_cost0\", \"wr_refunded_cash0\", \"wr_reversed_charge0\", \"wr_account_credit0\", \"wr_net_loss0\")\r\n                                    WHERE \"wr_reason_sk0\" IN (18, 40, 48, 55, 68)) AS \"t49\" ON \"t46\".\"ws_order_number0\" = \"t49\".\"wr_order_number1\" AND \"t46\".\"ws_item_sk0\" = \"t49\".\"wr_item_sk1\") AS \"t53\"\r\n                GROUP BY \"i_brand_id2\", \"i_class_id2\", \"i_category_id2\", \"i_manufact_id2\", \"sales_cnt1\", \"sales_amt1\") AS \"t55\"\r\n        GROUP BY \"i_brand_id2\", \"i_class_id2\", \"i_category_id2\", \"i_manufact_id2\"\r\n        HAVING COALESCE(SUM(\"sales_cnt1\"), 0) > 0 AND COUNT(\"sales_cnt1\") <> 0) AS \"t59\" ON \"t27\".\"i_brand_id\" = \"t59\".\"i_brand_id2\" AND \"t27\".\"i_class_id\" = \"t59\".\"i_class_id2\" AND \"t27\".\"i_category_id\" = \"t59\".\"i_category_id2\" AND \"t27\".\"i_manufact_id\" = \"t59\".\"i_manufact_id2\" AND CAST(CASE WHEN \"t27\".\"$f5\" = 0 THEN NULL ELSE \"t27\".\"sales_cnt\" END AS DECIMAL(17, 2)) / CAST(\"t59\".\"sales_cnt4\" AS DECIMAL(17, 2)) < 0.9\r\nORDER BY 9, 10\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 178.71, "used_rules": ["FILTER_INTO_JOIN", "FILTER_AGGREGATE_TRANSPOSE", "FILTER_SET_OP_TRANSPOSE", "FILTER_REDUCE_EXPRESSIONS", "PROJECT_REDUCE_EXPRESSIONS", "FILTER_PROJECT_TRANSPOSE", "PROJECT_REDUCE_EXPRESSIONS", "FILTER_INTO_JOIN", "JOIN_EXTRACT_FILTER", "AGGREGATE_ANY_PULL_UP_CONSTANTS", "AGGREGATE_REDUCE_FUNCTIONS", "JOIN_PROJECT_LEFT_TRANSPOSE", "FILTER_INTO_JOIN", "FILTER_PROJECT_TRANSPOSE", "FILTER_REDUCE_EXPRESSIONS", "PROJECT_REDUCE_EXPRESSIONS", "FILTER_INTO_JOIN", "UNION_PULL_UP_CONSTANTS", "UNION_TO_DISTINCT"], "rewrite_time": 20948}
{"name": "query080_0", "input_sql": "with ssr as\n (select  s_store_id as store_id,\n          sum(ss_ext_sales_price) as sales,\n          sum(coalesce(sr_return_amt, 0)) as \"returns\",\n          sum(ss_net_profit - coalesce(sr_net_loss, 0)) as profit\n  from store_sales left outer join store_returns on\n         (ss_item_sk = sr_item_sk and ss_ticket_number = sr_ticket_number),\n     date_dim,\n     store,\n     item,\n     promotion\n where ss_sold_date_sk = d_date_sk\n       and d_date between cast('2000-06-06' as date)\n                  and cast('2000-06-06' as date) + interval '30' day\n       and ss_store_sk = s_store_sk\n       and ss_item_sk = i_item_sk\n       and i_current_price > 50\n       and ss_promo_sk = p_promo_sk\n       and p_channel_email = 'Y'\n       and p_channel_tv = 'Y'\n       and p_channel_radio = 'Y'\n       and p_channel_press = 'N'\n       and p_channel_event = 'N'\n       and ss_wholesale_cost BETWEEN 85 AND 100\n       and i_category IN ('Books', 'Jewelry')\n group by s_store_id)\n ,\n csr as\n (select  cp_catalog_page_id as catalog_page_id,\n          sum(cs_ext_sales_price) as sales,\n          sum(coalesce(cr_return_amount, 0)) as \"returns\",\n          sum(cs_net_profit - coalesce(cr_net_loss, 0)) as profit\n  from catalog_sales left outer join catalog_returns on\n         (cs_item_sk = cr_item_sk and cs_order_number = cr_order_number),\n     date_dim,\n     catalog_page,\n     item,\n     promotion\n where cs_sold_date_sk = d_date_sk\n       and d_date between cast('2000-06-06' as date)\n                  and cast('2000-06-06' as date) + interval '30' day\n        and cs_catalog_page_sk = cp_catalog_page_sk\n       and cs_item_sk = i_item_sk\n       and i_current_price > 50\n       and cs_promo_sk = p_promo_sk\n       and p_channel_email = 'Y'\n       and p_channel_tv = 'Y'\n       and p_channel_radio = 'Y'\n       and p_channel_press = 'N'\n       and p_channel_event = 'N'\n       and cs_wholesale_cost BETWEEN 85 AND 100\n       and i_category IN ('Books', 'Jewelry')\ngroup by cp_catalog_page_id)\n ,\n wsr as\n (select  web_site_id,\n          sum(ws_ext_sales_price) as sales,\n          sum(coalesce(wr_return_amt, 0)) as \"returns\",\n          sum(ws_net_profit - coalesce(wr_net_loss, 0)) as profit\n  from web_sales left outer join web_returns on\n         (ws_item_sk = wr_item_sk and ws_order_number = wr_order_number),\n     date_dim,\n     web_site,\n     item,\n     promotion\n where ws_sold_date_sk = d_date_sk\n       and d_date between cast('2000-06-06' as date)\n                  and cast('2000-06-06' as date) + interval '30' day\n        and ws_web_site_sk = web_site_sk\n       and ws_item_sk = i_item_sk\n       and i_current_price > 50\n       and ws_promo_sk = p_promo_sk\n       and p_channel_email = 'Y'\n       and p_channel_tv = 'Y'\n       and p_channel_radio = 'Y'\n       and p_channel_press = 'N'\n       and p_channel_event = 'N'\n       and ws_wholesale_cost BETWEEN 85 AND 100\n       and i_category IN ('Books', 'Jewelry')\ngroup by web_site_id)\n  select  channel\n        , id\n        , sum(sales) as sales\n        , sum(\"returns\") as \"returns\"\n        , sum(profit) as profit\n from\n (select 'store channel' as channel\n        , 'store' || store_id as id\n        , sales\n        , \"returns\"\n        , profit\n from   ssr\n union all\n select 'catalog channel' as channel\n        , 'catalog_page' || catalog_page_id as id\n        , sales\n        , \"returns\"\n        , profit\n from  csr\n union all\n select 'web channel' as channel\n        , 'web_site' || web_site_id as id\n        , sales\n        , \"returns\"\n        , profit\n from   wsr\n ) x\n group by rollup (channel, id)\n order by channel\n         ,id\n limit 100;", "input_cost": 166.88, "output_sql": "SELECT \"channel\", \"id\", CASE WHEN COALESCE(SUM(\"$f3\"), 0) = 0 THEN NULL ELSE COALESCE(SUM(\"sales\"), 0) END AS \"sales1\", COALESCE(SUM(\"returns\"), 0) AS \"returns\", CASE WHEN COALESCE(SUM(\"$f6\"), 0) = 0 THEN NULL ELSE COALESCE(SUM(\"profit\"), 0) END AS \"profit1\"\r\nFROM (SELECT 'store channel' AS \"channel\", \"t6\".\"id\", COALESCE(SUM(\"t6\".\"sales\"), 0) AS \"sales\", COUNT(\"t6\".\"sales\") AS \"$f3\", COALESCE(SUM(\"t6\".\"returns\"), 0) AS \"returns\", COALESCE(SUM(\"t6\".\"profit\"), 0) AS \"profit\", COUNT(\"t6\".\"profit\") AS \"$f6\"\r\n            FROM (SELECT 'store' || \"store\".\"s_store_id\" AS \"id\", CASE WHEN COUNT(\"t\".\"ss_ext_sales_price\") = 0 THEN NULL ELSE COALESCE(SUM(\"t\".\"ss_ext_sales_price\"), 0) END AS \"sales\", COALESCE(SUM(CASE WHEN \"store_returns\".\"sr_return_amt\" IS NOT NULL THEN CAST(\"store_returns\".\"sr_return_amt\" AS DECIMAL(12, 2)) ELSE 0 END), 0) AS \"returns\", CASE WHEN COUNT(\"t\".\"ss_net_profit\" - CASE WHEN \"store_returns\".\"sr_net_loss\" IS NOT NULL THEN CAST(\"store_returns\".\"sr_net_loss\" AS DECIMAL(12, 2)) ELSE 0 END) = 0 THEN NULL ELSE COALESCE(SUM(\"t\".\"ss_net_profit\" - CASE WHEN \"store_returns\".\"sr_net_loss\" IS NOT NULL THEN CAST(\"store_returns\".\"sr_net_loss\" AS DECIMAL(12, 2)) ELSE 0 END), 0) END AS \"profit\"\r\n                    FROM (SELECT *\r\n                            FROM \"store_sales\"\r\n                            WHERE \"ss_wholesale_cost\" >= 85 AND \"ss_wholesale_cost\" <= 100) AS \"t\"\r\n                        LEFT JOIN \"store_returns\" ON \"t\".\"ss_item_sk\" = \"store_returns\".\"sr_item_sk\" AND \"t\".\"ss_ticket_number\" = \"store_returns\".\"sr_ticket_number\"\r\n                        INNER JOIN (SELECT *\r\n                            FROM \"date_dim\"\r\n                            WHERE \"d_date\" >= DATE '2000-06-06' AND \"d_date\" <= DATE '2000-07-06') AS \"t0\" ON \"t\".\"ss_sold_date_sk\" = \"t0\".\"d_date_sk\"\r\n                        INNER JOIN \"store\" ON \"t\".\"ss_store_sk\" = \"store\".\"s_store_sk\"\r\n                        INNER JOIN (SELECT *\r\n                            FROM \"item\"\r\n                            WHERE \"i_current_price\" > 50 AND (\"i_category\" = 'Books' OR \"i_category\" = 'Jewelry')) AS \"t1\" ON \"t\".\"ss_item_sk\" = \"t1\".\"i_item_sk\"\r\n                        INNER JOIN (SELECT *\r\n                            FROM \"promotion\"\r\n                            WHERE \"p_channel_email\" = 'Y' AND \"p_channel_tv\" = 'Y' AND \"p_channel_radio\" = 'Y' AND \"p_channel_press\" = 'N' AND \"p_channel_event\" = 'N') AS \"t2\" ON \"t\".\"ss_promo_sk\" = \"t2\".\"p_promo_sk\"\r\n                    GROUP BY \"store\".\"s_store_id\") AS \"t6\"\r\n            GROUP BY \"t6\".\"id\"\r\n            UNION ALL\r\n            SELECT 'catalog channel' AS \"channel\", \"t16\".\"id\", COALESCE(SUM(\"t16\".\"sales\"), 0) AS \"sales\", COUNT(\"t16\".\"sales\") AS \"$f2\", COALESCE(SUM(\"t16\".\"returns\"), 0) AS \"returns\", COALESCE(SUM(\"t16\".\"profit\"), 0) AS \"profit\", COUNT(\"t16\".\"profit\") AS \"$f5\"\r\n            FROM (SELECT 'catalog_page' || \"catalog_page\".\"cp_catalog_page_id\" AS \"id\", CASE WHEN COUNT(\"t9\".\"cs_ext_sales_price\") = 0 THEN NULL ELSE COALESCE(SUM(\"t9\".\"cs_ext_sales_price\"), 0) END AS \"sales\", COALESCE(SUM(CASE WHEN \"catalog_returns\".\"cr_return_amount\" IS NOT NULL THEN CAST(\"catalog_returns\".\"cr_return_amount\" AS DECIMAL(12, 2)) ELSE 0 END), 0) AS \"returns\", CASE WHEN COUNT(\"t9\".\"cs_net_profit\" - CASE WHEN \"catalog_returns\".\"cr_net_loss\" IS NOT NULL THEN CAST(\"catalog_returns\".\"cr_net_loss\" AS DECIMAL(12, 2)) ELSE 0 END) = 0 THEN NULL ELSE COALESCE(SUM(\"t9\".\"cs_net_profit\" - CASE WHEN \"catalog_returns\".\"cr_net_loss\" IS NOT NULL THEN CAST(\"catalog_returns\".\"cr_net_loss\" AS DECIMAL(12, 2)) ELSE 0 END), 0) END AS \"profit\"\r\n                    FROM (SELECT *\r\n                            FROM \"catalog_sales\"\r\n                            WHERE \"cs_wholesale_cost\" >= 85 AND \"cs_wholesale_cost\" <= 100) AS \"t9\"\r\n                        LEFT JOIN \"catalog_returns\" ON \"t9\".\"cs_item_sk\" = \"catalog_returns\".\"cr_item_sk\" AND \"t9\".\"cs_order_number\" = \"catalog_returns\".\"cr_order_number\"\r\n                        INNER JOIN (SELECT *\r\n                            FROM \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\")\r\n                            WHERE \"d_date0\" >= DATE '2000-06-06' AND \"d_date0\" <= DATE '2000-07-06') AS \"t10\" ON \"t9\".\"cs_sold_date_sk\" = \"t10\".\"d_date_sk0\"\r\n                        INNER JOIN \"catalog_page\" ON \"t9\".\"cs_catalog_page_sk\" = \"catalog_page\".\"cp_catalog_page_sk\"\r\n                        INNER JOIN (SELECT *\r\n                            FROM \"item\" AS \"item0\" (\"i_item_sk0\", \"i_item_id0\", \"i_rec_start_date0\", \"i_rec_end_date0\", \"i_item_desc0\", \"i_current_price0\", \"i_wholesale_cost0\", \"i_brand_id0\", \"i_brand0\", \"i_class_id0\", \"i_class0\", \"i_category_id0\", \"i_category0\", \"i_manufact_id0\", \"i_manufact0\", \"i_size0\", \"i_formulation0\", \"i_color0\", \"i_units0\", \"i_container0\", \"i_manager_id0\", \"i_product_name0\")\r\n                            WHERE \"i_current_price0\" > 50 AND (\"i_category0\" = 'Books' OR \"i_category0\" = 'Jewelry')) AS \"t11\" ON \"t9\".\"cs_item_sk\" = \"t11\".\"i_item_sk0\"\r\n                        INNER JOIN (SELECT *\r\n                            FROM \"promotion\" AS \"promotion0\" (\"p_promo_sk0\", \"p_promo_id0\", \"p_start_date_sk0\", \"p_end_date_sk0\", \"p_item_sk0\", \"p_cost0\", \"p_response_target0\", \"p_promo_name0\", \"p_channel_dmail0\", \"p_channel_email0\", \"p_channel_catalog0\", \"p_channel_tv0\", \"p_channel_radio0\", \"p_channel_press0\", \"p_channel_event0\", \"p_channel_demo0\", \"p_channel_details0\", \"p_purpose0\", \"p_discount_active0\")\r\n                            WHERE \"p_channel_email0\" = 'Y' AND \"p_channel_tv0\" = 'Y' AND \"p_channel_radio0\" = 'Y' AND \"p_channel_press0\" = 'N' AND \"p_channel_event0\" = 'N') AS \"t12\" ON \"t9\".\"cs_promo_sk\" = \"t12\".\"p_promo_sk0\"\r\n                    GROUP BY \"catalog_page\".\"cp_catalog_page_id\") AS \"t16\"\r\n            GROUP BY \"t16\".\"id\"\r\n            UNION ALL\r\n            SELECT 'web channel' AS \"channel0\", \"t26\".\"id0\", COALESCE(SUM(\"t26\".\"sales0\"), 0) AS \"sales\", COUNT(\"t26\".\"sales0\") AS \"$f2\", COALESCE(SUM(\"t26\".\"returns\"), 0) AS \"returns\", COALESCE(SUM(\"t26\".\"profit0\"), 0) AS \"profit\", COUNT(\"t26\".\"profit0\") AS \"$f5\"\r\n            FROM (SELECT 'web_site' || \"web_site\".\"web_site_id\" AS \"id0\", CASE WHEN COUNT(\"t19\".\"ws_ext_sales_price\") = 0 THEN NULL ELSE COALESCE(SUM(\"t19\".\"ws_ext_sales_price\"), 0) END AS \"sales0\", COALESCE(SUM(CASE WHEN \"web_returns\".\"wr_return_amt\" IS NOT NULL THEN CAST(\"web_returns\".\"wr_return_amt\" AS DECIMAL(12, 2)) ELSE 0 END), 0) AS \"returns\", CASE WHEN COUNT(\"t19\".\"ws_net_profit\" - CASE WHEN \"web_returns\".\"wr_net_loss\" IS NOT NULL THEN CAST(\"web_returns\".\"wr_net_loss\" AS DECIMAL(12, 2)) ELSE 0 END) = 0 THEN NULL ELSE COALESCE(SUM(\"t19\".\"ws_net_profit\" - CASE WHEN \"web_returns\".\"wr_net_loss\" IS NOT NULL THEN CAST(\"web_returns\".\"wr_net_loss\" AS DECIMAL(12, 2)) ELSE 0 END), 0) END AS \"profit0\"\r\n                    FROM (SELECT *\r\n                            FROM \"web_sales\"\r\n                            WHERE \"ws_wholesale_cost\" >= 85 AND \"ws_wholesale_cost\" <= 100) AS \"t19\"\r\n                        LEFT JOIN \"web_returns\" ON \"t19\".\"ws_item_sk\" = \"web_returns\".\"wr_item_sk\" AND \"t19\".\"ws_order_number\" = \"web_returns\".\"wr_order_number\"\r\n                        INNER JOIN (SELECT *\r\n                            FROM \"date_dim\" AS \"date_dim1\" (\"d_date_sk1\", \"d_date_id1\", \"d_date1\", \"d_month_seq1\", \"d_week_seq1\", \"d_quarter_seq1\", \"d_year1\", \"d_dow1\", \"d_moy1\", \"d_dom1\", \"d_qoy1\", \"d_fy_year1\", \"d_fy_quarter_seq1\", \"d_fy_week_seq1\", \"d_day_name1\", \"d_quarter_name1\", \"d_holiday1\", \"d_weekend1\", \"d_following_holiday1\", \"d_first_dom1\", \"d_last_dom1\", \"d_same_day_ly1\", \"d_same_day_lq1\", \"d_current_day1\", \"d_current_week1\", \"d_current_month1\", \"d_current_quarter1\", \"d_current_year1\")\r\n                            WHERE \"d_date1\" >= DATE '2000-06-06' AND \"d_date1\" <= DATE '2000-07-06') AS \"t20\" ON \"t19\".\"ws_sold_date_sk\" = \"t20\".\"d_date_sk1\"\r\n                        INNER JOIN \"web_site\" ON \"t19\".\"ws_web_site_sk\" = \"web_site\".\"web_site_sk\"\r\n                        INNER JOIN (SELECT *\r\n                            FROM \"item\" AS \"item1\" (\"i_item_sk1\", \"i_item_id1\", \"i_rec_start_date1\", \"i_rec_end_date1\", \"i_item_desc1\", \"i_current_price1\", \"i_wholesale_cost1\", \"i_brand_id1\", \"i_brand1\", \"i_class_id1\", \"i_class1\", \"i_category_id1\", \"i_category1\", \"i_manufact_id1\", \"i_manufact1\", \"i_size1\", \"i_formulation1\", \"i_color1\", \"i_units1\", \"i_container1\", \"i_manager_id1\", \"i_product_name1\")\r\n                            WHERE \"i_current_price1\" > 50 AND (\"i_category1\" = 'Books' OR \"i_category1\" = 'Jewelry')) AS \"t21\" ON \"t19\".\"ws_item_sk\" = \"t21\".\"i_item_sk1\"\r\n                        INNER JOIN (SELECT *\r\n                            FROM \"promotion\" AS \"promotion1\" (\"p_promo_sk1\", \"p_promo_id1\", \"p_start_date_sk1\", \"p_end_date_sk1\", \"p_item_sk1\", \"p_cost1\", \"p_response_target1\", \"p_promo_name1\", \"p_channel_dmail1\", \"p_channel_email1\", \"p_channel_catalog1\", \"p_channel_tv1\", \"p_channel_radio1\", \"p_channel_press1\", \"p_channel_event1\", \"p_channel_demo1\", \"p_channel_details1\", \"p_purpose1\", \"p_discount_active1\")\r\n                            WHERE \"p_channel_email1\" = 'Y' AND \"p_channel_tv1\" = 'Y' AND \"p_channel_radio1\" = 'Y' AND \"p_channel_press1\" = 'N' AND \"p_channel_event1\" = 'N') AS \"t22\" ON \"t19\".\"ws_promo_sk\" = \"t22\".\"p_promo_sk1\"\r\n                    GROUP BY \"web_site\".\"web_site_id\") AS \"t26\"\r\n            GROUP BY \"t26\".\"id0\") AS \"t29\"\r\nGROUP BY ROLLUP(\"channel\", \"id\")\r\nORDER BY \"channel\", \"id\"\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 167.19, "used_rules": ["FILTER_INTO_JOIN", "FILTER_REDUCE_EXPRESSIONS", "UNION_MERGE", "AGGREGATE_REDUCE_FUNCTIONS", "AGGREGATE_UNION_TRANSPOSE", "AGGREGATE_ANY_PULL_UP_CONSTANTS", "SORT_PROJECT_TRANSPOSE"], "rewrite_time": 6534}
{"name": "query080_1", "input_sql": "with ssr as\n (select  s_store_id as store_id,\n          sum(ss_ext_sales_price) as sales,\n          sum(coalesce(sr_return_amt, 0)) as \"returns\",\n          sum(ss_net_profit - coalesce(sr_net_loss, 0)) as profit\n  from store_sales left outer join store_returns on\n         (ss_item_sk = sr_item_sk and ss_ticket_number = sr_ticket_number),\n     date_dim,\n     store,\n     item,\n     promotion\n where ss_sold_date_sk = d_date_sk\n       and d_date between cast('1999-09-30' as date)\n                  and cast('1999-09-30' as date) + interval '30' day\n       and ss_store_sk = s_store_sk\n       and ss_item_sk = i_item_sk\n       and i_current_price > 50\n       and ss_promo_sk = p_promo_sk\n       and p_channel_email = 'Y'\n       and p_channel_tv = 'Y'\n       and p_channel_radio = 'N'\n       and p_channel_press = 'Y'\n       and p_channel_event = 'Y'\n       and ss_wholesale_cost BETWEEN 74 AND 89\n       and i_category IN ('Books', 'Electronics')\n group by s_store_id)\n ,\n csr as\n (select  cp_catalog_page_id as catalog_page_id,\n          sum(cs_ext_sales_price) as sales,\n          sum(coalesce(cr_return_amount, 0)) as \"returns\",\n          sum(cs_net_profit - coalesce(cr_net_loss, 0)) as profit\n  from catalog_sales left outer join catalog_returns on\n         (cs_item_sk = cr_item_sk and cs_order_number = cr_order_number),\n     date_dim,\n     catalog_page,\n     item,\n     promotion\n where cs_sold_date_sk = d_date_sk\n       and d_date between cast('1999-09-30' as date)\n                  and cast('1999-09-30' as date) + interval '30' day\n        and cs_catalog_page_sk = cp_catalog_page_sk\n       and cs_item_sk = i_item_sk\n       and i_current_price > 50\n       and cs_promo_sk = p_promo_sk\n       and p_channel_email = 'Y'\n       and p_channel_tv = 'Y'\n       and p_channel_radio = 'N'\n       and p_channel_press = 'Y'\n       and p_channel_event = 'Y'\n       and cs_wholesale_cost BETWEEN 74 AND 89\n       and i_category IN ('Books', 'Electronics')\ngroup by cp_catalog_page_id)\n ,\n wsr as\n (select  web_site_id,\n          sum(ws_ext_sales_price) as sales,\n          sum(coalesce(wr_return_amt, 0)) as \"returns\",\n          sum(ws_net_profit - coalesce(wr_net_loss, 0)) as profit\n  from web_sales left outer join web_returns on\n         (ws_item_sk = wr_item_sk and ws_order_number = wr_order_number),\n     date_dim,\n     web_site,\n     item,\n     promotion\n where ws_sold_date_sk = d_date_sk\n       and d_date between cast('1999-09-30' as date)\n                  and cast('1999-09-30' as date) + interval '30' day\n        and ws_web_site_sk = web_site_sk\n       and ws_item_sk = i_item_sk\n       and i_current_price > 50\n       and ws_promo_sk = p_promo_sk\n       and p_channel_email = 'Y'\n       and p_channel_tv = 'Y'\n       and p_channel_radio = 'N'\n       and p_channel_press = 'Y'\n       and p_channel_event = 'Y'\n       and ws_wholesale_cost BETWEEN 74 AND 89\n       and i_category IN ('Books', 'Electronics')\ngroup by web_site_id)\n  select  channel\n        , id\n        , sum(sales) as sales\n        , sum(\"returns\") as \"returns\"\n        , sum(profit) as profit\n from\n (select 'store channel' as channel\n        , 'store' || store_id as id\n        , sales\n        , \"returns\"\n        , profit\n from   ssr\n union all\n select 'catalog channel' as channel\n        , 'catalog_page' || catalog_page_id as id\n        , sales\n        , \"returns\"\n        , profit\n from  csr\n union all\n select 'web channel' as channel\n        , 'web_site' || web_site_id as id\n        , sales\n        , \"returns\"\n        , profit\n from   wsr\n ) x\n group by rollup (channel, id)\n order by channel\n         ,id\n limit 100;", "input_cost": 166.88, "output_sql": "SELECT \"channel\", \"id\", CASE WHEN COALESCE(SUM(\"$f3\"), 0) = 0 THEN NULL ELSE COALESCE(SUM(\"sales\"), 0) END AS \"sales1\", COALESCE(SUM(\"returns\"), 0) AS \"returns\", CASE WHEN COALESCE(SUM(\"$f6\"), 0) = 0 THEN NULL ELSE COALESCE(SUM(\"profit\"), 0) END AS \"profit1\"\r\nFROM (SELECT 'store channel' AS \"channel\", \"t6\".\"id\", COALESCE(SUM(\"t6\".\"sales\"), 0) AS \"sales\", COUNT(\"t6\".\"sales\") AS \"$f3\", COALESCE(SUM(\"t6\".\"returns\"), 0) AS \"returns\", COALESCE(SUM(\"t6\".\"profit\"), 0) AS \"profit\", COUNT(\"t6\".\"profit\") AS \"$f6\"\r\n            FROM (SELECT 'store' || \"store\".\"s_store_id\" AS \"id\", CASE WHEN COUNT(\"t\".\"ss_ext_sales_price\") = 0 THEN NULL ELSE COALESCE(SUM(\"t\".\"ss_ext_sales_price\"), 0) END AS \"sales\", COALESCE(SUM(CASE WHEN \"store_returns\".\"sr_return_amt\" IS NOT NULL THEN CAST(\"store_returns\".\"sr_return_amt\" AS DECIMAL(12, 2)) ELSE 0 END), 0) AS \"returns\", CASE WHEN COUNT(\"t\".\"ss_net_profit\" - CASE WHEN \"store_returns\".\"sr_net_loss\" IS NOT NULL THEN CAST(\"store_returns\".\"sr_net_loss\" AS DECIMAL(12, 2)) ELSE 0 END) = 0 THEN NULL ELSE COALESCE(SUM(\"t\".\"ss_net_profit\" - CASE WHEN \"store_returns\".\"sr_net_loss\" IS NOT NULL THEN CAST(\"store_returns\".\"sr_net_loss\" AS DECIMAL(12, 2)) ELSE 0 END), 0) END AS \"profit\"\r\n                    FROM (SELECT *\r\n                            FROM \"store_sales\"\r\n                            WHERE \"ss_wholesale_cost\" >= 74 AND \"ss_wholesale_cost\" <= 89) AS \"t\"\r\n                        LEFT JOIN \"store_returns\" ON \"t\".\"ss_item_sk\" = \"store_returns\".\"sr_item_sk\" AND \"t\".\"ss_ticket_number\" = \"store_returns\".\"sr_ticket_number\"\r\n                        INNER JOIN (SELECT *\r\n                            FROM \"date_dim\"\r\n                            WHERE \"d_date\" >= DATE '1999-09-30' AND \"d_date\" <= DATE '1999-10-30') AS \"t0\" ON \"t\".\"ss_sold_date_sk\" = \"t0\".\"d_date_sk\"\r\n                        INNER JOIN \"store\" ON \"t\".\"ss_store_sk\" = \"store\".\"s_store_sk\"\r\n                        INNER JOIN (SELECT *\r\n                            FROM \"item\"\r\n                            WHERE \"i_current_price\" > 50 AND (\"i_category\" = 'Books' OR \"i_category\" = 'Electronics')) AS \"t1\" ON \"t\".\"ss_item_sk\" = \"t1\".\"i_item_sk\"\r\n                        INNER JOIN (SELECT *\r\n                            FROM \"promotion\"\r\n                            WHERE \"p_channel_email\" = 'Y' AND \"p_channel_tv\" = 'Y' AND \"p_channel_radio\" = 'N' AND \"p_channel_press\" = 'Y' AND \"p_channel_event\" = 'Y') AS \"t2\" ON \"t\".\"ss_promo_sk\" = \"t2\".\"p_promo_sk\"\r\n                    GROUP BY \"store\".\"s_store_id\") AS \"t6\"\r\n            GROUP BY \"t6\".\"id\"\r\n            UNION ALL\r\n            SELECT 'catalog channel' AS \"channel\", \"t16\".\"id\", COALESCE(SUM(\"t16\".\"sales\"), 0) AS \"sales\", COUNT(\"t16\".\"sales\") AS \"$f2\", COALESCE(SUM(\"t16\".\"returns\"), 0) AS \"returns\", COALESCE(SUM(\"t16\".\"profit\"), 0) AS \"profit\", COUNT(\"t16\".\"profit\") AS \"$f5\"\r\n            FROM (SELECT 'catalog_page' || \"catalog_page\".\"cp_catalog_page_id\" AS \"id\", CASE WHEN COUNT(\"t9\".\"cs_ext_sales_price\") = 0 THEN NULL ELSE COALESCE(SUM(\"t9\".\"cs_ext_sales_price\"), 0) END AS \"sales\", COALESCE(SUM(CASE WHEN \"catalog_returns\".\"cr_return_amount\" IS NOT NULL THEN CAST(\"catalog_returns\".\"cr_return_amount\" AS DECIMAL(12, 2)) ELSE 0 END), 0) AS \"returns\", CASE WHEN COUNT(\"t9\".\"cs_net_profit\" - CASE WHEN \"catalog_returns\".\"cr_net_loss\" IS NOT NULL THEN CAST(\"catalog_returns\".\"cr_net_loss\" AS DECIMAL(12, 2)) ELSE 0 END) = 0 THEN NULL ELSE COALESCE(SUM(\"t9\".\"cs_net_profit\" - CASE WHEN \"catalog_returns\".\"cr_net_loss\" IS NOT NULL THEN CAST(\"catalog_returns\".\"cr_net_loss\" AS DECIMAL(12, 2)) ELSE 0 END), 0) END AS \"profit\"\r\n                    FROM (SELECT *\r\n                            FROM \"catalog_sales\"\r\n                            WHERE \"cs_wholesale_cost\" >= 74 AND \"cs_wholesale_cost\" <= 89) AS \"t9\"\r\n                        LEFT JOIN \"catalog_returns\" ON \"t9\".\"cs_item_sk\" = \"catalog_returns\".\"cr_item_sk\" AND \"t9\".\"cs_order_number\" = \"catalog_returns\".\"cr_order_number\"\r\n                        INNER JOIN (SELECT *\r\n                            FROM \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\")\r\n                            WHERE \"d_date0\" >= DATE '1999-09-30' AND \"d_date0\" <= DATE '1999-10-30') AS \"t10\" ON \"t9\".\"cs_sold_date_sk\" = \"t10\".\"d_date_sk0\"\r\n                        INNER JOIN \"catalog_page\" ON \"t9\".\"cs_catalog_page_sk\" = \"catalog_page\".\"cp_catalog_page_sk\"\r\n                        INNER JOIN (SELECT *\r\n                            FROM \"item\" AS \"item0\" (\"i_item_sk0\", \"i_item_id0\", \"i_rec_start_date0\", \"i_rec_end_date0\", \"i_item_desc0\", \"i_current_price0\", \"i_wholesale_cost0\", \"i_brand_id0\", \"i_brand0\", \"i_class_id0\", \"i_class0\", \"i_category_id0\", \"i_category0\", \"i_manufact_id0\", \"i_manufact0\", \"i_size0\", \"i_formulation0\", \"i_color0\", \"i_units0\", \"i_container0\", \"i_manager_id0\", \"i_product_name0\")\r\n                            WHERE \"i_current_price0\" > 50 AND (\"i_category0\" = 'Books' OR \"i_category0\" = 'Electronics')) AS \"t11\" ON \"t9\".\"cs_item_sk\" = \"t11\".\"i_item_sk0\"\r\n                        INNER JOIN (SELECT *\r\n                            FROM \"promotion\" AS \"promotion0\" (\"p_promo_sk0\", \"p_promo_id0\", \"p_start_date_sk0\", \"p_end_date_sk0\", \"p_item_sk0\", \"p_cost0\", \"p_response_target0\", \"p_promo_name0\", \"p_channel_dmail0\", \"p_channel_email0\", \"p_channel_catalog0\", \"p_channel_tv0\", \"p_channel_radio0\", \"p_channel_press0\", \"p_channel_event0\", \"p_channel_demo0\", \"p_channel_details0\", \"p_purpose0\", \"p_discount_active0\")\r\n                            WHERE \"p_channel_email0\" = 'Y' AND \"p_channel_tv0\" = 'Y' AND \"p_channel_radio0\" = 'N' AND \"p_channel_press0\" = 'Y' AND \"p_channel_event0\" = 'Y') AS \"t12\" ON \"t9\".\"cs_promo_sk\" = \"t12\".\"p_promo_sk0\"\r\n                    GROUP BY \"catalog_page\".\"cp_catalog_page_id\") AS \"t16\"\r\n            GROUP BY \"t16\".\"id\"\r\n            UNION ALL\r\n            SELECT 'web channel' AS \"channel0\", \"t26\".\"id0\", COALESCE(SUM(\"t26\".\"sales0\"), 0) AS \"sales\", COUNT(\"t26\".\"sales0\") AS \"$f2\", COALESCE(SUM(\"t26\".\"returns\"), 0) AS \"returns\", COALESCE(SUM(\"t26\".\"profit0\"), 0) AS \"profit\", COUNT(\"t26\".\"profit0\") AS \"$f5\"\r\n            FROM (SELECT 'web_site' || \"web_site\".\"web_site_id\" AS \"id0\", CASE WHEN COUNT(\"t19\".\"ws_ext_sales_price\") = 0 THEN NULL ELSE COALESCE(SUM(\"t19\".\"ws_ext_sales_price\"), 0) END AS \"sales0\", COALESCE(SUM(CASE WHEN \"web_returns\".\"wr_return_amt\" IS NOT NULL THEN CAST(\"web_returns\".\"wr_return_amt\" AS DECIMAL(12, 2)) ELSE 0 END), 0) AS \"returns\", CASE WHEN COUNT(\"t19\".\"ws_net_profit\" - CASE WHEN \"web_returns\".\"wr_net_loss\" IS NOT NULL THEN CAST(\"web_returns\".\"wr_net_loss\" AS DECIMAL(12, 2)) ELSE 0 END) = 0 THEN NULL ELSE COALESCE(SUM(\"t19\".\"ws_net_profit\" - CASE WHEN \"web_returns\".\"wr_net_loss\" IS NOT NULL THEN CAST(\"web_returns\".\"wr_net_loss\" AS DECIMAL(12, 2)) ELSE 0 END), 0) END AS \"profit0\"\r\n                    FROM (SELECT *\r\n                            FROM \"web_sales\"\r\n                            WHERE \"ws_wholesale_cost\" >= 74 AND \"ws_wholesale_cost\" <= 89) AS \"t19\"\r\n                        LEFT JOIN \"web_returns\" ON \"t19\".\"ws_item_sk\" = \"web_returns\".\"wr_item_sk\" AND \"t19\".\"ws_order_number\" = \"web_returns\".\"wr_order_number\"\r\n                        INNER JOIN (SELECT *\r\n                            FROM \"date_dim\" AS \"date_dim1\" (\"d_date_sk1\", \"d_date_id1\", \"d_date1\", \"d_month_seq1\", \"d_week_seq1\", \"d_quarter_seq1\", \"d_year1\", \"d_dow1\", \"d_moy1\", \"d_dom1\", \"d_qoy1\", \"d_fy_year1\", \"d_fy_quarter_seq1\", \"d_fy_week_seq1\", \"d_day_name1\", \"d_quarter_name1\", \"d_holiday1\", \"d_weekend1\", \"d_following_holiday1\", \"d_first_dom1\", \"d_last_dom1\", \"d_same_day_ly1\", \"d_same_day_lq1\", \"d_current_day1\", \"d_current_week1\", \"d_current_month1\", \"d_current_quarter1\", \"d_current_year1\")\r\n                            WHERE \"d_date1\" >= DATE '1999-09-30' AND \"d_date1\" <= DATE '1999-10-30') AS \"t20\" ON \"t19\".\"ws_sold_date_sk\" = \"t20\".\"d_date_sk1\"\r\n                        INNER JOIN \"web_site\" ON \"t19\".\"ws_web_site_sk\" = \"web_site\".\"web_site_sk\"\r\n                        INNER JOIN (SELECT *\r\n                            FROM \"item\" AS \"item1\" (\"i_item_sk1\", \"i_item_id1\", \"i_rec_start_date1\", \"i_rec_end_date1\", \"i_item_desc1\", \"i_current_price1\", \"i_wholesale_cost1\", \"i_brand_id1\", \"i_brand1\", \"i_class_id1\", \"i_class1\", \"i_category_id1\", \"i_category1\", \"i_manufact_id1\", \"i_manufact1\", \"i_size1\", \"i_formulation1\", \"i_color1\", \"i_units1\", \"i_container1\", \"i_manager_id1\", \"i_product_name1\")\r\n                            WHERE \"i_current_price1\" > 50 AND (\"i_category1\" = 'Books' OR \"i_category1\" = 'Electronics')) AS \"t21\" ON \"t19\".\"ws_item_sk\" = \"t21\".\"i_item_sk1\"\r\n                        INNER JOIN (SELECT *\r\n                            FROM \"promotion\" AS \"promotion1\" (\"p_promo_sk1\", \"p_promo_id1\", \"p_start_date_sk1\", \"p_end_date_sk1\", \"p_item_sk1\", \"p_cost1\", \"p_response_target1\", \"p_promo_name1\", \"p_channel_dmail1\", \"p_channel_email1\", \"p_channel_catalog1\", \"p_channel_tv1\", \"p_channel_radio1\", \"p_channel_press1\", \"p_channel_event1\", \"p_channel_demo1\", \"p_channel_details1\", \"p_purpose1\", \"p_discount_active1\")\r\n                            WHERE \"p_channel_email1\" = 'Y' AND \"p_channel_tv1\" = 'Y' AND \"p_channel_radio1\" = 'N' AND \"p_channel_press1\" = 'Y' AND \"p_channel_event1\" = 'Y') AS \"t22\" ON \"t19\".\"ws_promo_sk\" = \"t22\".\"p_promo_sk1\"\r\n                    GROUP BY \"web_site\".\"web_site_id\") AS \"t26\"\r\n            GROUP BY \"t26\".\"id0\") AS \"t29\"\r\nGROUP BY ROLLUP(\"channel\", \"id\")\r\nORDER BY \"channel\", \"id\"\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 167.19, "used_rules": ["FILTER_INTO_JOIN", "FILTER_REDUCE_EXPRESSIONS", "UNION_MERGE", "AGGREGATE_REDUCE_FUNCTIONS", "AGGREGATE_UNION_TRANSPOSE", "AGGREGATE_ANY_PULL_UP_CONSTANTS", "SORT_PROJECT_TRANSPOSE"], "rewrite_time": 6629}
{"name": "query081_0", "input_sql": "with customer_total_return as\n (select cr_returning_customer_sk as ctr_customer_sk\n        ,ca_state as ctr_state, \n \tsum(cr_return_amt_inc_tax) as ctr_total_return\n from catalog_returns\n     ,date_dim\n     ,customer_address\n where cr_returned_date_sk = d_date_sk \n   and d_year =2002\n   and cr_returning_addr_sk = ca_address_sk \n group by cr_returning_customer_sk\n         ,ca_state )\n  select  c_customer_id,c_salutation,c_first_name,c_last_name,ca_street_number,ca_street_name\n                   ,ca_street_type,ca_suite_number,ca_city,ca_county,ca_state,ca_zip,ca_country,ca_gmt_offset\n                  ,ca_location_type,ctr_total_return\n from customer_total_return ctr1\n     ,customer_address\n     ,customer\n where ctr1.ctr_total_return > (select avg(ctr_total_return)*1.2\n \t\t\t  from customer_total_return ctr2 \n                  \t  where ctr1.ctr_state = ctr2.ctr_state)\n       and ca_address_sk = c_current_addr_sk\n       and ca_state = 'MI'\n       and ctr1.ctr_customer_sk = c_customer_sk\n order by c_customer_id,c_salutation,c_first_name,c_last_name,ca_street_number,ca_street_name\n                   ,ca_street_type,ca_suite_number,ca_city,ca_county,ca_state,ca_zip,ca_country,ca_gmt_offset\n                  ,ca_location_type,ctr_total_return\n limit 100;", "input_cost": 43.55, "output_sql": "SELECT \"customer\".\"c_customer_id\" AS \"cr_returning_customer_sk\", \"customer\".\"c_salutation\" AS \"ca_state\", \"customer\".\"c_first_name\" AS \"ctr_total_return\", \"customer\".\"c_last_name\" AS \"ca_address_sk0\", \"t6\".\"ca_street_number0\" AS \"ca_address_id0\", \"t6\".\"ca_street_name0\" AS \"ca_street_number0\", \"t6\".\"ca_street_type0\" AS \"ca_street_name0\", \"t6\".\"ca_suite_number0\" AS \"ca_street_type0\", \"t6\".\"ca_city0\" AS \"ca_suite_number0\", \"t6\".\"ca_county0\" AS \"ca_city0\", \"t6\".\"ca_state0\" AS \"ca_county0\", \"t6\".\"ca_zip0\" AS \"ca_state0\", \"t6\".\"ca_country0\" AS \"ca_zip0\", \"t6\".\"ca_gmt_offset0\" AS \"ca_country0\", \"t6\".\"ca_location_type0\" AS \"ca_gmt_offset0\", \"t5\".\"ctr_total_return\" AS \"ca_location_type0\"\r\nFROM (SELECT \"t2\".\"cr_returning_customer_sk\", \"t3\".\"ca_state\", CASE WHEN COALESCE(SUM(\"t2\".\"$f3\"), 0) = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"ctr_total_return\"), 0) END AS \"ctr_total_return\"\r\n        FROM (SELECT \"t\".\"cr_returning_customer_sk\", \"t\".\"cr_returning_addr_sk\", COALESCE(SUM(\"t\".\"ctr_total_return\"), 0) AS \"ctr_total_return\", COALESCE(SUM(\"t\".\"$f4\"), 0) AS \"$f3\"\r\n                FROM (SELECT \"cr_returned_date_sk\", \"cr_returning_customer_sk\", \"cr_returning_addr_sk\", COALESCE(SUM(\"cr_return_amt_inc_tax\"), 0) AS \"ctr_total_return\", COUNT(\"cr_return_amt_inc_tax\") AS \"$f4\"\r\n                        FROM \"catalog_returns\"\r\n                        GROUP BY \"cr_returned_date_sk\", \"cr_returning_customer_sk\", \"cr_returning_addr_sk\") AS \"t\"\r\n                    INNER JOIN (SELECT \"d_date_sk\"\r\n                        FROM \"date_dim\"\r\n                        WHERE \"d_year\" = 2002) AS \"t1\" ON \"t\".\"cr_returned_date_sk\" = \"t1\".\"d_date_sk\"\r\n                GROUP BY \"t\".\"cr_returning_customer_sk\", \"t\".\"cr_returning_addr_sk\") AS \"t2\"\r\n            INNER JOIN (SELECT \"ca_address_sk\", \"ca_state\"\r\n                FROM \"customer_address\") AS \"t3\" ON \"t2\".\"cr_returning_addr_sk\" = \"t3\".\"ca_address_sk\"\r\n        GROUP BY \"t2\".\"cr_returning_customer_sk\", \"t3\".\"ca_state\") AS \"t5\"\r\n    CROSS JOIN (SELECT *\r\n        FROM \"customer_address\" AS \"customer_address0\" (\"ca_address_sk0\", \"ca_address_id0\", \"ca_street_number0\", \"ca_street_name0\", \"ca_street_type0\", \"ca_suite_number0\", \"ca_city0\", \"ca_county0\", \"ca_state0\", \"ca_zip0\", \"ca_country0\", \"ca_gmt_offset0\", \"ca_location_type0\")\r\n        WHERE \"ca_state0\" = 'MI') AS \"t6\"\r\n    INNER JOIN \"customer\" ON \"t6\".\"ca_address_sk0\" = \"customer\".\"c_current_addr_sk\" AND \"t5\".\"cr_returning_customer_sk\" = \"customer\".\"c_customer_sk\"\r\n    INNER JOIN (SELECT \"ca_address_id1\", CASE WHEN COUNT(\"ctr_total_return\") = 0 THEN NULL ELSE COALESCE(SUM(\"ctr_total_return\"), 0) END / COUNT(\"ctr_total_return\") AS \"$f1\"\r\n        FROM (SELECT \"t10\".\"cr_returning_customer_sk0\", \"t11\".\"ca_address_id1\", CASE WHEN COALESCE(SUM(\"t10\".\"$f3\"), 0) = 0 THEN NULL ELSE COALESCE(SUM(\"t10\".\"ctr_total_return\"), 0) END AS \"ctr_total_return\"\r\n                FROM (SELECT \"t7\".\"cr_returning_customer_sk0\", \"t7\".\"cr_returning_addr_sk0\", COALESCE(SUM(\"t7\".\"ctr_total_return\"), 0) AS \"ctr_total_return\", COALESCE(SUM(\"t7\".\"$f4\"), 0) AS \"$f3\"\r\n                        FROM (SELECT \"cr_returned_date_sk0\", \"cr_returning_customer_sk0\", \"cr_returning_addr_sk0\", COALESCE(SUM(\"cr_return_amt_inc_tax0\"), 0) AS \"ctr_total_return\", COUNT(\"cr_return_amt_inc_tax0\") AS \"$f4\"\r\n                                FROM \"catalog_returns\" AS \"catalog_returns0\" (\"cr_returned_date_sk0\", \"cr_returned_time_sk0\", \"cr_item_sk0\", \"cr_refunded_customer_sk0\", \"cr_refunded_cdemo_sk0\", \"cr_refunded_hdemo_sk0\", \"cr_refunded_addr_sk0\", \"cr_returning_customer_sk0\", \"cr_returning_cdemo_sk0\", \"cr_returning_hdemo_sk0\", \"cr_returning_addr_sk0\", \"cr_call_center_sk0\", \"cr_catalog_page_sk0\", \"cr_ship_mode_sk0\", \"cr_warehouse_sk0\", \"cr_reason_sk0\", \"cr_order_number0\", \"cr_return_quantity0\", \"cr_return_amount0\", \"cr_return_tax0\", \"cr_return_amt_inc_tax0\", \"cr_fee0\", \"cr_return_ship_cost0\", \"cr_refunded_cash0\", \"cr_reversed_charge0\", \"cr_store_credit0\", \"cr_net_loss0\")\r\n                                GROUP BY \"cr_returned_date_sk0\", \"cr_returning_customer_sk0\", \"cr_returning_addr_sk0\") AS \"t7\"\r\n                            INNER JOIN (SELECT \"d_date_sk0\"\r\n                                FROM \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\")\r\n                                WHERE \"d_year0\" = 2002) AS \"t9\" ON \"t7\".\"cr_returned_date_sk0\" = \"t9\".\"d_date_sk0\"\r\n                        GROUP BY \"t7\".\"cr_returning_customer_sk0\", \"t7\".\"cr_returning_addr_sk0\") AS \"t10\"\r\n                    INNER JOIN (SELECT \"ca_address_sk1\", \"ca_state1\" AS \"ca_address_id1\"\r\n                        FROM \"customer_address\" AS \"customer_address1\" (\"ca_address_sk1\", \"ca_address_id1\", \"ca_street_number1\", \"ca_street_name1\", \"ca_street_type1\", \"ca_suite_number1\", \"ca_city1\", \"ca_county1\", \"ca_state1\", \"ca_zip1\", \"ca_country1\", \"ca_gmt_offset1\", \"ca_location_type1\")) AS \"t11\" ON \"t10\".\"cr_returning_addr_sk0\" = \"t11\".\"ca_address_sk1\"\r\n                GROUP BY \"t10\".\"cr_returning_customer_sk0\", \"t11\".\"ca_address_id1\") AS \"t13\"\r\n        WHERE \"t13\".\"ca_address_id1\" IS NOT NULL\r\n        GROUP BY \"ca_address_id1\") AS \"t16\" ON \"t5\".\"ca_state\" = \"t16\".\"ca_address_id1\" AND \"t5\".\"ctr_total_return\" > \"t16\".\"$f1\" * 1.2\r\nORDER BY \"customer\".\"c_customer_id\", \"customer\".\"c_salutation\", \"customer\".\"c_first_name\", \"customer\".\"c_last_name\", \"t6\".\"ca_street_number0\", \"t6\".\"ca_street_name0\", \"t6\".\"ca_street_type0\", \"t6\".\"ca_suite_number0\", \"t6\".\"ca_city0\", \"t6\".\"ca_county0\", \"t6\".\"ca_state0\", \"t6\".\"ca_zip0\", \"t6\".\"ca_country0\", \"t6\".\"ca_gmt_offset0\", \"t6\".\"ca_location_type0\", \"t5\".\"ctr_total_return\"\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 95.95, "used_rules": ["FILTER_SUB_QUERY_TO_CORRELATE", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_REDUCE_FUNCTIONS", "AGGREGATE_JOIN_TRANSPOSE_EXTENDED", "PROJECT_TO_CALC", "CALC_MERGE"], "rewrite_time": 2387}
{"name": "query081_1", "input_sql": "with customer_total_return as\n (select cr_returning_customer_sk as ctr_customer_sk\n        ,ca_state as ctr_state, \n \tsum(cr_return_amt_inc_tax) as ctr_total_return\n from catalog_returns\n     ,date_dim\n     ,customer_address\n where cr_returned_date_sk = d_date_sk \n   and d_year =1998\n   and cr_returning_addr_sk = ca_address_sk \n group by cr_returning_customer_sk\n         ,ca_state )\n  select  c_customer_id,c_salutation,c_first_name,c_last_name,ca_street_number,ca_street_name\n                   ,ca_street_type,ca_suite_number,ca_city,ca_county,ca_state,ca_zip,ca_country,ca_gmt_offset\n                  ,ca_location_type,ctr_total_return\n from customer_total_return ctr1\n     ,customer_address\n     ,customer\n where ctr1.ctr_total_return > (select avg(ctr_total_return)*1.2\n \t\t\t  from customer_total_return ctr2 \n                  \t  where ctr1.ctr_state = ctr2.ctr_state)\n       and ca_address_sk = c_current_addr_sk\n       and ca_state = 'ME'\n       and ctr1.ctr_customer_sk = c_customer_sk\n order by c_customer_id,c_salutation,c_first_name,c_last_name,ca_street_number,ca_street_name\n                   ,ca_street_type,ca_suite_number,ca_city,ca_county,ca_state,ca_zip,ca_country,ca_gmt_offset\n                  ,ca_location_type,ctr_total_return\n limit 100;", "input_cost": 43.55, "output_sql": "SELECT \"customer\".\"c_customer_id\" AS \"cr_returning_customer_sk\", \"customer\".\"c_salutation\" AS \"ca_state\", \"customer\".\"c_first_name\" AS \"ctr_total_return\", \"customer\".\"c_last_name\" AS \"ca_address_sk0\", \"t6\".\"ca_street_number0\" AS \"ca_address_id0\", \"t6\".\"ca_street_name0\" AS \"ca_street_number0\", \"t6\".\"ca_street_type0\" AS \"ca_street_name0\", \"t6\".\"ca_suite_number0\" AS \"ca_street_type0\", \"t6\".\"ca_city0\" AS \"ca_suite_number0\", \"t6\".\"ca_county0\" AS \"ca_city0\", \"t6\".\"ca_state0\" AS \"ca_county0\", \"t6\".\"ca_zip0\" AS \"ca_state0\", \"t6\".\"ca_country0\" AS \"ca_zip0\", \"t6\".\"ca_gmt_offset0\" AS \"ca_country0\", \"t6\".\"ca_location_type0\" AS \"ca_gmt_offset0\", \"t5\".\"ctr_total_return\" AS \"ca_location_type0\"\r\nFROM (SELECT \"t2\".\"cr_returning_customer_sk\", \"t3\".\"ca_state\", CASE WHEN COALESCE(SUM(\"t2\".\"$f3\"), 0) = 0 THEN NULL ELSE COALESCE(SUM(\"t2\".\"ctr_total_return\"), 0) END AS \"ctr_total_return\"\r\n        FROM (SELECT \"t\".\"cr_returning_customer_sk\", \"t\".\"cr_returning_addr_sk\", COALESCE(SUM(\"t\".\"ctr_total_return\"), 0) AS \"ctr_total_return\", COALESCE(SUM(\"t\".\"$f4\"), 0) AS \"$f3\"\r\n                FROM (SELECT \"cr_returned_date_sk\", \"cr_returning_customer_sk\", \"cr_returning_addr_sk\", COALESCE(SUM(\"cr_return_amt_inc_tax\"), 0) AS \"ctr_total_return\", COUNT(\"cr_return_amt_inc_tax\") AS \"$f4\"\r\n                        FROM \"catalog_returns\"\r\n                        GROUP BY \"cr_returned_date_sk\", \"cr_returning_customer_sk\", \"cr_returning_addr_sk\") AS \"t\"\r\n                    INNER JOIN (SELECT \"d_date_sk\"\r\n                        FROM \"date_dim\"\r\n                        WHERE \"d_year\" = 1998) AS \"t1\" ON \"t\".\"cr_returned_date_sk\" = \"t1\".\"d_date_sk\"\r\n                GROUP BY \"t\".\"cr_returning_customer_sk\", \"t\".\"cr_returning_addr_sk\") AS \"t2\"\r\n            INNER JOIN (SELECT \"ca_address_sk\", \"ca_state\"\r\n                FROM \"customer_address\") AS \"t3\" ON \"t2\".\"cr_returning_addr_sk\" = \"t3\".\"ca_address_sk\"\r\n        GROUP BY \"t2\".\"cr_returning_customer_sk\", \"t3\".\"ca_state\") AS \"t5\"\r\n    CROSS JOIN (SELECT *\r\n        FROM \"customer_address\" AS \"customer_address0\" (\"ca_address_sk0\", \"ca_address_id0\", \"ca_street_number0\", \"ca_street_name0\", \"ca_street_type0\", \"ca_suite_number0\", \"ca_city0\", \"ca_county0\", \"ca_state0\", \"ca_zip0\", \"ca_country0\", \"ca_gmt_offset0\", \"ca_location_type0\")\r\n        WHERE \"ca_state0\" = 'ME') AS \"t6\"\r\n    INNER JOIN \"customer\" ON \"t6\".\"ca_address_sk0\" = \"customer\".\"c_current_addr_sk\" AND \"t5\".\"cr_returning_customer_sk\" = \"customer\".\"c_customer_sk\"\r\n    INNER JOIN (SELECT \"ca_address_id1\", CASE WHEN COUNT(\"ctr_total_return\") = 0 THEN NULL ELSE COALESCE(SUM(\"ctr_total_return\"), 0) END / COUNT(\"ctr_total_return\") AS \"$f1\"\r\n        FROM (SELECT \"t10\".\"cr_returning_customer_sk0\", \"t11\".\"ca_address_id1\", CASE WHEN COALESCE(SUM(\"t10\".\"$f3\"), 0) = 0 THEN NULL ELSE COALESCE(SUM(\"t10\".\"ctr_total_return\"), 0) END AS \"ctr_total_return\"\r\n                FROM (SELECT \"t7\".\"cr_returning_customer_sk0\", \"t7\".\"cr_returning_addr_sk0\", COALESCE(SUM(\"t7\".\"ctr_total_return\"), 0) AS \"ctr_total_return\", COALESCE(SUM(\"t7\".\"$f4\"), 0) AS \"$f3\"\r\n                        FROM (SELECT \"cr_returned_date_sk0\", \"cr_returning_customer_sk0\", \"cr_returning_addr_sk0\", COALESCE(SUM(\"cr_return_amt_inc_tax0\"), 0) AS \"ctr_total_return\", COUNT(\"cr_return_amt_inc_tax0\") AS \"$f4\"\r\n                                FROM \"catalog_returns\" AS \"catalog_returns0\" (\"cr_returned_date_sk0\", \"cr_returned_time_sk0\", \"cr_item_sk0\", \"cr_refunded_customer_sk0\", \"cr_refunded_cdemo_sk0\", \"cr_refunded_hdemo_sk0\", \"cr_refunded_addr_sk0\", \"cr_returning_customer_sk0\", \"cr_returning_cdemo_sk0\", \"cr_returning_hdemo_sk0\", \"cr_returning_addr_sk0\", \"cr_call_center_sk0\", \"cr_catalog_page_sk0\", \"cr_ship_mode_sk0\", \"cr_warehouse_sk0\", \"cr_reason_sk0\", \"cr_order_number0\", \"cr_return_quantity0\", \"cr_return_amount0\", \"cr_return_tax0\", \"cr_return_amt_inc_tax0\", \"cr_fee0\", \"cr_return_ship_cost0\", \"cr_refunded_cash0\", \"cr_reversed_charge0\", \"cr_store_credit0\", \"cr_net_loss0\")\r\n                                GROUP BY \"cr_returned_date_sk0\", \"cr_returning_customer_sk0\", \"cr_returning_addr_sk0\") AS \"t7\"\r\n                            INNER JOIN (SELECT \"d_date_sk0\"\r\n                                FROM \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\")\r\n                                WHERE \"d_year0\" = 1998) AS \"t9\" ON \"t7\".\"cr_returned_date_sk0\" = \"t9\".\"d_date_sk0\"\r\n                        GROUP BY \"t7\".\"cr_returning_customer_sk0\", \"t7\".\"cr_returning_addr_sk0\") AS \"t10\"\r\n                    INNER JOIN (SELECT \"ca_address_sk1\", \"ca_state1\" AS \"ca_address_id1\"\r\n                        FROM \"customer_address\" AS \"customer_address1\" (\"ca_address_sk1\", \"ca_address_id1\", \"ca_street_number1\", \"ca_street_name1\", \"ca_street_type1\", \"ca_suite_number1\", \"ca_city1\", \"ca_county1\", \"ca_state1\", \"ca_zip1\", \"ca_country1\", \"ca_gmt_offset1\", \"ca_location_type1\")) AS \"t11\" ON \"t10\".\"cr_returning_addr_sk0\" = \"t11\".\"ca_address_sk1\"\r\n                GROUP BY \"t10\".\"cr_returning_customer_sk0\", \"t11\".\"ca_address_id1\") AS \"t13\"\r\n        WHERE \"t13\".\"ca_address_id1\" IS NOT NULL\r\n        GROUP BY \"ca_address_id1\") AS \"t16\" ON \"t5\".\"ca_state\" = \"t16\".\"ca_address_id1\" AND \"t5\".\"ctr_total_return\" > \"t16\".\"$f1\" * 1.2\r\nORDER BY \"customer\".\"c_customer_id\", \"customer\".\"c_salutation\", \"customer\".\"c_first_name\", \"customer\".\"c_last_name\", \"t6\".\"ca_street_number0\", \"t6\".\"ca_street_name0\", \"t6\".\"ca_street_type0\", \"t6\".\"ca_suite_number0\", \"t6\".\"ca_city0\", \"t6\".\"ca_county0\", \"t6\".\"ca_state0\", \"t6\".\"ca_zip0\", \"t6\".\"ca_country0\", \"t6\".\"ca_gmt_offset0\", \"t6\".\"ca_location_type0\", \"t5\".\"ctr_total_return\"\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 95.95, "used_rules": ["FILTER_SUB_QUERY_TO_CORRELATE", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_REDUCE_FUNCTIONS", "AGGREGATE_JOIN_TRANSPOSE_EXTENDED", "PROJECT_TO_CALC", "CALC_MERGE"], "rewrite_time": 2410}
{"name": "query083_0", "input_sql": "with sr_items as\n (select i_item_id item_id,\n        sum(sr_return_quantity) sr_item_qty\n from store_returns,\n      item,\n      date_dim\n where sr_item_sk = i_item_sk\n and   d_date    in\n\t(select d_date\n\tfrom date_dim\n\twhere d_month_seq in\n\t\t(select d_month_seq\n\t\tfrom date_dim\n\t  where d_date in ('1998-03-15','1998-04-10','1998-08-01','1998-10-05')))\n and   sr_returned_date_sk   = d_date_sk\n and i_category IN ('Shoes', 'Sports')\n and i_manager_id BETWEEN 80 and 89\n and sr_return_amt / sr_return_quantity between 226 and 255\n and sr_reason_sk in (17, 20, 22, 65, 73)\ngroup by i_item_id),\n cr_items as\n (select i_item_id item_id,\n        sum(cr_return_quantity) cr_item_qty\n from catalog_returns,\n      item,\n      date_dim\n where cr_item_sk = i_item_sk\n and   d_date    in\n\t(select d_date\n\tfrom date_dim\n  where d_month_seq in\n\t\t(select d_month_seq\n\t\tfrom date_dim\n\t  \t  where d_date in ('1998-03-15','1998-04-10','1998-08-01','1998-10-05')))\n and   cr_returned_date_sk   = d_date_sk\n and i_category IN ('Shoes', 'Sports')\n and i_manager_id BETWEEN 80 and 89\n and cr_return_amount / cr_return_quantity between 226 and 255\n and cr_reason_sk in (17, 20, 22, 65, 73)\n group by i_item_id),\n wr_items as\n (select i_item_id item_id,\n        sum(wr_return_quantity) wr_item_qty\n from web_returns,\n      item,\n      date_dim\n where wr_item_sk = i_item_sk\n and   d_date    in\n\t(select d_date\n\tfrom date_dim\n  where d_month_seq in\n\t\t(select d_month_seq\n\t\tfrom date_dim\n\t\t\t  where d_date in ('1998-03-15','1998-04-10','1998-08-01','1998-10-05')))\n and   wr_returned_date_sk   = d_date_sk\n and i_category IN ('Shoes', 'Sports')\n and i_manager_id BETWEEN 80 and 89\n and wr_return_amt / wr_return_quantity between 226 and 255\n and wr_reason_sk in (17, 20, 22, 65, 73)\n group by i_item_id)\n  select  sr_items.item_id\n       ,sr_item_qty\n       ,sr_item_qty/(sr_item_qty+cr_item_qty+wr_item_qty)/3.0 * 100 sr_dev\n       ,cr_item_qty\n       ,cr_item_qty/(sr_item_qty+cr_item_qty+wr_item_qty)/3.0 * 100 cr_dev\n       ,wr_item_qty\n       ,wr_item_qty/(sr_item_qty+cr_item_qty+wr_item_qty)/3.0 * 100 wr_dev\n       ,(sr_item_qty+cr_item_qty+wr_item_qty)/3.0 average\n from sr_items\n     ,cr_items\n     ,wr_items\n where sr_items.item_id=cr_items.item_id\n   and sr_items.item_id=wr_items.item_id\n order by sr_items.item_id\n         ,sr_item_qty\n limit 100;", "input_cost": 125.27, "output_sql": "None", "output_cost": -1, "used_rules": [], "rewrite_time": 1648}
{"name": "query083_1", "input_sql": "with sr_items as\n (select i_item_id item_id,\n        sum(sr_return_quantity) sr_item_qty\n from store_returns,\n      item,\n      date_dim\n where sr_item_sk = i_item_sk\n and   d_date    in\n\t(select d_date\n\tfrom date_dim\n\twhere d_month_seq in\n\t\t(select d_month_seq\n\t\tfrom date_dim\n\t  where d_date in ('1998-03-09','1998-05-10','1998-07-15','1998-10-07')))\n and   sr_returned_date_sk   = d_date_sk\n and i_category IN ('Children', 'Home')\n and i_manager_id BETWEEN 47 and 56\n and sr_return_amt / sr_return_quantity between 158 and 187\n and sr_reason_sk in (9, 13, 26, 40, 44)\ngroup by i_item_id),\n cr_items as\n (select i_item_id item_id,\n        sum(cr_return_quantity) cr_item_qty\n from catalog_returns,\n      item,\n      date_dim\n where cr_item_sk = i_item_sk\n and   d_date    in\n\t(select d_date\n\tfrom date_dim\n  where d_month_seq in\n\t\t(select d_month_seq\n\t\tfrom date_dim\n\t  \t  where d_date in ('1998-03-09','1998-05-10','1998-07-15','1998-10-07')))\n and   cr_returned_date_sk   = d_date_sk\n and i_category IN ('Children', 'Home')\n and i_manager_id BETWEEN 47 and 56\n and cr_return_amount / cr_return_quantity between 158 and 187\n and cr_reason_sk in (9, 13, 26, 40, 44)\n group by i_item_id),\n wr_items as\n (select i_item_id item_id,\n        sum(wr_return_quantity) wr_item_qty\n from web_returns,\n      item,\n      date_dim\n where wr_item_sk = i_item_sk\n and   d_date    in\n\t(select d_date\n\tfrom date_dim\n  where d_month_seq in\n\t\t(select d_month_seq\n\t\tfrom date_dim\n\t\t\t  where d_date in ('1998-03-09','1998-05-10','1998-07-15','1998-10-07')))\n and   wr_returned_date_sk   = d_date_sk\n and i_category IN ('Children', 'Home')\n and i_manager_id BETWEEN 47 and 56\n and wr_return_amt / wr_return_quantity between 158 and 187\n and wr_reason_sk in (9, 13, 26, 40, 44)\n group by i_item_id)\n  select  sr_items.item_id\n       ,sr_item_qty\n       ,sr_item_qty/(sr_item_qty+cr_item_qty+wr_item_qty)/3.0 * 100 sr_dev\n       ,cr_item_qty\n       ,cr_item_qty/(sr_item_qty+cr_item_qty+wr_item_qty)/3.0 * 100 cr_dev\n       ,wr_item_qty\n       ,wr_item_qty/(sr_item_qty+cr_item_qty+wr_item_qty)/3.0 * 100 wr_dev\n       ,(sr_item_qty+cr_item_qty+wr_item_qty)/3.0 average\n from sr_items\n     ,cr_items\n     ,wr_items\n where sr_items.item_id=cr_items.item_id\n   and sr_items.item_id=wr_items.item_id\n order by sr_items.item_id\n         ,sr_item_qty\n limit 100;", "input_cost": 125.27, "output_sql": "None", "output_cost": -1, "used_rules": [], "rewrite_time": 1508}
{"name": "query084_0", "input_sql": "select  c_customer_id as customer_id\n       , coalesce(c_last_name,'') || ', ' || coalesce(c_first_name,'') as customername\n from customer\n     ,customer_address\n     ,customer_demographics\n     ,household_demographics\n     ,income_band\n     ,store_returns\n where ca_city\t        =  'Marion'\n   and c_current_addr_sk = ca_address_sk\n   and ib_lower_bound   >=  26340\n   and ib_upper_bound   <=  26340 + 50000\n   and ib_income_band_sk = hd_income_band_sk\n   and cd_demo_sk = c_current_cdemo_sk\n   and hd_demo_sk = c_current_hdemo_sk\n   and sr_cdemo_sk = cd_demo_sk\n order by c_customer_id\n limit 100;", "input_cost": 37.14, "output_sql": "SELECT \"t4\".\"c_customer_id\" AS \"customer_id\", CASE WHEN \"t4\".\"c_last_name\" IS NOT NULL THEN CAST(\"t4\".\"c_last_name\" AS CHAR) ELSE '' END || ', ' || CASE WHEN \"t4\".\"c_first_name\" IS NOT NULL THEN CAST(\"t4\".\"c_first_name\" AS CHAR) ELSE '' END AS \"customername\"\r\nFROM (SELECT *\r\n        FROM (SELECT *\r\n                FROM (SELECT *\r\n                        FROM (SELECT *\r\n                                FROM \"customer\",\r\n                                        (SELECT *\r\n                                        FROM \"customer_address\"\r\n                                        WHERE \"ca_city\" = 'Marion') AS \"t\"\r\n                                WHERE \"customer\".\"c_current_addr_sk\" = \"t\".\"ca_address_sk\") AS \"t0\",\r\n                            \"customer_demographics\"\r\n                        WHERE \"customer_demographics\".\"cd_demo_sk\" = \"t0\".\"c_current_cdemo_sk\") AS \"t1\",\r\n                    \"household_demographics\"\r\n                WHERE \"household_demographics\".\"hd_demo_sk\" = \"t1\".\"c_current_hdemo_sk\") AS \"t2\",\r\n                (SELECT *\r\n                FROM \"income_band\"\r\n                WHERE \"ib_lower_bound\" >= 26340 AND \"ib_upper_bound\" <= 76340) AS \"t3\"\r\n        WHERE \"t3\".\"ib_income_band_sk\" = \"t2\".\"hd_income_band_sk\") AS \"t4\",\r\n    \"store_returns\"\r\nWHERE \"store_returns\".\"sr_cdemo_sk\" = \"t4\".\"cd_demo_sk\"\r\nORDER BY \"t4\".\"c_customer_id\"\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 37.15, "used_rules": ["FILTER_INTO_JOIN", "FILTER_REDUCE_EXPRESSIONS", "SORT_PROJECT_TRANSPOSE", "PROJECT_TO_CALC", "JOIN_EXTRACT_FILTER"], "rewrite_time": 697}
{"name": "query084_1", "input_sql": "select  c_customer_id as customer_id\n       , coalesce(c_last_name,'') || ', ' || coalesce(c_first_name,'') as customername\n from customer\n     ,customer_address\n     ,customer_demographics\n     ,household_demographics\n     ,income_band\n     ,store_returns\n where ca_city\t        =  'Walnut Grove'\n   and c_current_addr_sk = ca_address_sk\n   and ib_lower_bound   >=  46206\n   and ib_upper_bound   <=  46206 + 50000\n   and ib_income_band_sk = hd_income_band_sk\n   and cd_demo_sk = c_current_cdemo_sk\n   and hd_demo_sk = c_current_hdemo_sk\n   and sr_cdemo_sk = cd_demo_sk\n order by c_customer_id\n limit 100;", "input_cost": 37.14, "output_sql": "SELECT \"t4\".\"c_customer_id\" AS \"customer_id\", CASE WHEN \"t4\".\"c_last_name\" IS NOT NULL THEN CAST(\"t4\".\"c_last_name\" AS CHAR) ELSE '' END || ', ' || CASE WHEN \"t4\".\"c_first_name\" IS NOT NULL THEN CAST(\"t4\".\"c_first_name\" AS CHAR) ELSE '' END AS \"customername\"\r\nFROM (SELECT *\r\n        FROM (SELECT *\r\n                FROM (SELECT *\r\n                        FROM (SELECT *\r\n                                FROM \"customer\",\r\n                                        (SELECT *\r\n                                        FROM \"customer_address\"\r\n                                        WHERE \"ca_city\" = 'Walnut Grove') AS \"t\"\r\n                                WHERE \"customer\".\"c_current_addr_sk\" = \"t\".\"ca_address_sk\") AS \"t0\",\r\n                            \"customer_demographics\"\r\n                        WHERE \"customer_demographics\".\"cd_demo_sk\" = \"t0\".\"c_current_cdemo_sk\") AS \"t1\",\r\n                    \"household_demographics\"\r\n                WHERE \"household_demographics\".\"hd_demo_sk\" = \"t1\".\"c_current_hdemo_sk\") AS \"t2\",\r\n                (SELECT *\r\n                FROM \"income_band\"\r\n                WHERE \"ib_lower_bound\" >= 46206 AND \"ib_upper_bound\" <= 96206) AS \"t3\"\r\n        WHERE \"t3\".\"ib_income_band_sk\" = \"t2\".\"hd_income_band_sk\") AS \"t4\",\r\n    \"store_returns\"\r\nWHERE \"store_returns\".\"sr_cdemo_sk\" = \"t4\".\"cd_demo_sk\"\r\nORDER BY \"t4\".\"c_customer_id\"\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 37.15, "used_rules": ["FILTER_INTO_JOIN", "FILTER_REDUCE_EXPRESSIONS", "SORT_PROJECT_TRANSPOSE", "PROJECT_TO_CALC", "JOIN_EXTRACT_FILTER"], "rewrite_time": 681}
{"name": "query085_0", "input_sql": "select  substring(r_reason_desc,1,20)\n       ,avg(ws_quantity)\n       ,avg(wr_refunded_cash)\n       ,avg(wr_fee)\n from web_sales, web_returns, web_page, customer_demographics cd1,\n      customer_demographics cd2, customer_address, date_dim, reason\n where ws_web_page_sk = wp_web_page_sk\n   and ws_item_sk = wr_item_sk\n   and ws_order_number = wr_order_number\n   and ws_sold_date_sk = d_date_sk and d_year = 2002\n   and cd1.cd_demo_sk = wr_refunded_cdemo_sk\n   and cd2.cd_demo_sk = wr_returning_cdemo_sk\n   and ca_address_sk = wr_refunded_addr_sk\n   and r_reason_sk = wr_reason_sk\n   and\n   (\n    (\n     cd1.cd_marital_status = 'S'\n     and\n     cd1.cd_marital_status = cd2.cd_marital_status\n     and\n     cd1.cd_education_status = 'Unknown'\n     and\n     cd1.cd_education_status = cd2.cd_education_status\n     and\n     ws_sales_price between 100.00 and 150.00\n    )\n   or\n    (\n     cd1.cd_marital_status = 'D'\n     and\n     cd1.cd_marital_status = cd2.cd_marital_status\n     and\n     cd1.cd_education_status = 'Advanced Degree'\n     and\n     cd1.cd_education_status = cd2.cd_education_status\n     and\n     ws_sales_price between 50.00 and 100.00\n    )\n   or\n    (\n     cd1.cd_marital_status = 'M'\n     and\n     cd1.cd_marital_status = cd2.cd_marital_status\n     and\n     cd1.cd_education_status = 'Secondary'\n     and\n     cd1.cd_education_status = cd2.cd_education_status\n     and\n     ws_sales_price between 150.00 and 200.00\n    )\n   )\n   and\n   (\n    (\n     ca_country = 'United States'\n     and\n     ca_state in ('KS', 'ND', 'OK')\n     and ws_net_profit between 100 and 200\n    )\n    or\n    (\n     ca_country = 'United States'\n     and\n     ca_state in ('GA', 'LA', 'NC')\n     and ws_net_profit between 150 and 300\n    )\n    or\n    (\n     ca_country = 'United States'\n     and\n     ca_state in ('IL', 'ME', 'MI')\n     and ws_net_profit between 50 and 250\n    )\n   )\ngroup by r_reason_desc\norder by substring(r_reason_desc,1,20)\n        ,avg(ws_quantity)\n        ,avg(wr_refunded_cash)\n        ,avg(wr_fee)\nlimit 100;", "input_cost": 49.73, "output_sql": "SELECT SUBSTRING(\"t9\".\"r_reason_desc\", 1, 20) AS \"r_reason_desc\", CAST(CASE WHEN COALESCE(SUM(\"t8\".\"$f2\"), 0) = 0 THEN NULL ELSE COALESCE(SUM(\"t8\".\"$f1\"), 0) END / COALESCE(SUM(\"t8\".\"$f2\"), 0) AS INTEGER) AS \"$f1\", CASE WHEN COALESCE(SUM(\"t8\".\"$f4\"), 0) = 0 THEN NULL ELSE COALESCE(SUM(\"t8\".\"$f3\"), 0) END / COALESCE(SUM(\"t8\".\"$f4\"), 0) AS \"$f2\", CASE WHEN COALESCE(SUM(\"t8\".\"$f6\"), 0) = 0 THEN NULL ELSE COALESCE(SUM(\"t8\".\"$f5\"), 0) END / COALESCE(SUM(\"t8\".\"$f6\"), 0) AS \"$f3\"\r\nFROM (SELECT \"t4\".\"wr_reason_sk\", COALESCE(SUM(\"t4\".\"$f2\"), 0) AS \"$f1\", COALESCE(SUM(\"t4\".\"$f3\"), 0) AS \"$f2\", COALESCE(SUM(\"t4\".\"$f4\"), 0) AS \"$f3\", COALESCE(SUM(\"t4\".\"$f5\"), 0) AS \"$f4\", COALESCE(SUM(\"t4\".\"$f6\"), 0) AS \"$f5\", COALESCE(SUM(\"t4\".\"$f7\"), 0) AS \"$f6\"\r\n        FROM (SELECT \"t2\".\"ws_sold_date_sk\", \"t2\".\"wr_reason_sk\", COALESCE(SUM(\"t2\".\"ws_quantity\"), 0) AS \"$f2\", COUNT(\"t2\".\"ws_quantity\") AS \"$f3\", COALESCE(SUM(\"t2\".\"wr_refunded_cash\"), 0) AS \"$f4\", COUNT(\"t2\".\"wr_refunded_cash\") AS \"$f5\", COALESCE(SUM(\"t2\".\"wr_fee\"), 0) AS \"$f6\", COUNT(\"t2\".\"wr_fee\") AS \"$f7\"\r\n                FROM (SELECT *\r\n                        FROM (SELECT *\r\n                                FROM (SELECT *\r\n                                        FROM (SELECT *\r\n                                                FROM \"web_sales\",\r\n                                                    \"web_returns\"\r\n                                                WHERE \"web_sales\".\"ws_item_sk\" = \"web_returns\".\"wr_item_sk\" AND \"web_sales\".\"ws_order_number\" = \"web_returns\".\"wr_order_number\") AS \"t\",\r\n                                            \"web_page\"\r\n                                        WHERE \"t\".\"ws_web_page_sk\" = \"web_page\".\"wp_web_page_sk\") AS \"t0\",\r\n                                    \"customer_demographics\"\r\n                                WHERE \"customer_demographics\".\"cd_demo_sk\" = \"t0\".\"wr_refunded_cdemo_sk\") AS \"t1\",\r\n                            \"customer_demographics\" AS \"customer_demographics0\" (\"cd_demo_sk0\", \"cd_gender0\", \"cd_marital_status0\", \"cd_education_status0\", \"cd_purchase_estimate0\", \"cd_credit_rating0\", \"cd_dep_count0\", \"cd_dep_employed_count0\", \"cd_dep_college_count0\")\r\n                        WHERE \"customer_demographics0\".\"cd_demo_sk0\" = \"t1\".\"wr_returning_cdemo_sk\" AND (\"t1\".\"cd_marital_status\" = 'S' AND \"t1\".\"cd_marital_status\" = \"customer_demographics0\".\"cd_marital_status0\" AND \"t1\".\"cd_education_status\" = 'Unknown' AND \"t1\".\"cd_education_status\" = \"customer_demographics0\".\"cd_education_status0\" AND (\"t1\".\"ws_sales_price\" >= 100.00 AND \"t1\".\"ws_sales_price\" <= 150.00) OR \"t1\".\"cd_marital_status\" = 'D' AND \"t1\".\"cd_marital_status\" = \"customer_demographics0\".\"cd_marital_status0\" AND \"t1\".\"cd_education_status\" = 'Advanced Degree' AND \"t1\".\"cd_education_status\" = \"customer_demographics0\".\"cd_education_status0\" AND (\"t1\".\"ws_sales_price\" >= 50.00 AND \"t1\".\"ws_sales_price\" <= 100.00) OR \"t1\".\"cd_marital_status\" = 'M' AND \"t1\".\"cd_marital_status\" = \"customer_demographics0\".\"cd_marital_status0\" AND \"t1\".\"cd_education_status\" = 'Secondary' AND \"t1\".\"cd_education_status\" = \"customer_demographics0\".\"cd_education_status0\" AND (\"t1\".\"ws_sales_price\" >= 150.00 AND \"t1\".\"ws_sales_price\" <= 200.00))) AS \"t2\",\r\n                    \"customer_address\"\r\n                WHERE \"customer_address\".\"ca_address_sk\" = \"t2\".\"wr_refunded_addr_sk\" AND (\"customer_address\".\"ca_country\" = 'United States' AND CAST(\"customer_address\".\"ca_state\" AS CHAR(2)) IN ('KS', 'ND', 'OK') AND (\"t2\".\"ws_net_profit\" >= 100 AND \"t2\".\"ws_net_profit\" <= 200) OR \"customer_address\".\"ca_country\" = 'United States' AND CAST(\"customer_address\".\"ca_state\" AS CHAR(2)) IN ('GA', 'LA', 'NC') AND (\"t2\".\"ws_net_profit\" >= 150 AND \"t2\".\"ws_net_profit\" <= 300) OR \"customer_address\".\"ca_country\" = 'United States' AND CAST(\"customer_address\".\"ca_state\" AS CHAR(2)) IN ('IL', 'ME', 'MI') AND (\"t2\".\"ws_net_profit\" >= 50 AND \"t2\".\"ws_net_profit\" <= 250))\r\n                GROUP BY \"t2\".\"ws_sold_date_sk\", \"t2\".\"wr_reason_sk\") AS \"t4\",\r\n                (SELECT \"d_date_sk\"\r\n                FROM \"date_dim\"\r\n                WHERE \"d_year\" = 2002) AS \"t6\"\r\n        WHERE \"t4\".\"ws_sold_date_sk\" = \"t6\".\"d_date_sk\"\r\n        GROUP BY \"t4\".\"wr_reason_sk\") AS \"t8\",\r\n        (SELECT \"r_reason_sk\", \"r_reason_desc\"\r\n        FROM \"reason\") AS \"t9\"\r\nWHERE \"t9\".\"r_reason_sk\" = \"t8\".\"wr_reason_sk\"\r\nGROUP BY \"t9\".\"r_reason_desc\"\r\nORDER BY 1, 2, 3, 4\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 66.08, "used_rules": ["FILTER_INTO_JOIN", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_REDUCE_FUNCTIONS", "AGGREGATE_JOIN_TRANSPOSE_EXTENDED", "PROJECT_TO_CALC", "CALC_MERGE", "JOIN_EXTRACT_FILTER"], "rewrite_time": 2536}
{"name": "query085_1", "input_sql": "select  substring(r_reason_desc,1,20)\n       ,avg(ws_quantity)\n       ,avg(wr_refunded_cash)\n       ,avg(wr_fee)\n from web_sales, web_returns, web_page, customer_demographics cd1,\n      customer_demographics cd2, customer_address, date_dim, reason\n where ws_web_page_sk = wp_web_page_sk\n   and ws_item_sk = wr_item_sk\n   and ws_order_number = wr_order_number\n   and ws_sold_date_sk = d_date_sk and d_year = 1998\n   and cd1.cd_demo_sk = wr_refunded_cdemo_sk\n   and cd2.cd_demo_sk = wr_returning_cdemo_sk\n   and ca_address_sk = wr_refunded_addr_sk\n   and r_reason_sk = wr_reason_sk\n   and\n   (\n    (\n     cd1.cd_marital_status = 'M'\n     and\n     cd1.cd_marital_status = cd2.cd_marital_status\n     and\n     cd1.cd_education_status = '2 yr Degree'\n     and\n     cd1.cd_education_status = cd2.cd_education_status\n     and\n     ws_sales_price between 100.00 and 150.00\n    )\n   or\n    (\n     cd1.cd_marital_status = 'S'\n     and\n     cd1.cd_marital_status = cd2.cd_marital_status\n     and\n     cd1.cd_education_status = 'Unknown'\n     and\n     cd1.cd_education_status = cd2.cd_education_status\n     and\n     ws_sales_price between 50.00 and 100.00\n    )\n   or\n    (\n     cd1.cd_marital_status = 'D'\n     and\n     cd1.cd_marital_status = cd2.cd_marital_status\n     and\n     cd1.cd_education_status = 'Advanced Degree'\n     and\n     cd1.cd_education_status = cd2.cd_education_status\n     and\n     ws_sales_price between 150.00 and 200.00\n    )\n   )\n   and\n   (\n    (\n     ca_country = 'United States'\n     and\n     ca_state in ('MN', 'OK', 'WV')\n     and ws_net_profit between 100 and 200\n    )\n    or\n    (\n     ca_country = 'United States'\n     and\n     ca_state in ('IL', 'OK', 'VA')\n     and ws_net_profit between 150 and 300\n    )\n    or\n    (\n     ca_country = 'United States'\n     and\n     ca_state in ('GA', 'KY', 'VA')\n     and ws_net_profit between 50 and 250\n    )\n   )\ngroup by r_reason_desc\norder by substring(r_reason_desc,1,20)\n        ,avg(ws_quantity)\n        ,avg(wr_refunded_cash)\n        ,avg(wr_fee)\nlimit 100;", "input_cost": 49.73, "output_sql": "SELECT SUBSTRING(\"t9\".\"r_reason_desc\", 1, 20) AS \"r_reason_desc\", CAST(CASE WHEN COALESCE(SUM(\"t8\".\"$f2\"), 0) = 0 THEN NULL ELSE COALESCE(SUM(\"t8\".\"$f1\"), 0) END / COALESCE(SUM(\"t8\".\"$f2\"), 0) AS INTEGER) AS \"$f1\", CASE WHEN COALESCE(SUM(\"t8\".\"$f4\"), 0) = 0 THEN NULL ELSE COALESCE(SUM(\"t8\".\"$f3\"), 0) END / COALESCE(SUM(\"t8\".\"$f4\"), 0) AS \"$f2\", CASE WHEN COALESCE(SUM(\"t8\".\"$f6\"), 0) = 0 THEN NULL ELSE COALESCE(SUM(\"t8\".\"$f5\"), 0) END / COALESCE(SUM(\"t8\".\"$f6\"), 0) AS \"$f3\"\r\nFROM (SELECT \"t4\".\"wr_reason_sk\", COALESCE(SUM(\"t4\".\"$f2\"), 0) AS \"$f1\", COALESCE(SUM(\"t4\".\"$f3\"), 0) AS \"$f2\", COALESCE(SUM(\"t4\".\"$f4\"), 0) AS \"$f3\", COALESCE(SUM(\"t4\".\"$f5\"), 0) AS \"$f4\", COALESCE(SUM(\"t4\".\"$f6\"), 0) AS \"$f5\", COALESCE(SUM(\"t4\".\"$f7\"), 0) AS \"$f6\"\r\n        FROM (SELECT \"t2\".\"ws_sold_date_sk\", \"t2\".\"wr_reason_sk\", COALESCE(SUM(\"t2\".\"ws_quantity\"), 0) AS \"$f2\", COUNT(\"t2\".\"ws_quantity\") AS \"$f3\", COALESCE(SUM(\"t2\".\"wr_refunded_cash\"), 0) AS \"$f4\", COUNT(\"t2\".\"wr_refunded_cash\") AS \"$f5\", COALESCE(SUM(\"t2\".\"wr_fee\"), 0) AS \"$f6\", COUNT(\"t2\".\"wr_fee\") AS \"$f7\"\r\n                FROM (SELECT *\r\n                        FROM (SELECT *\r\n                                FROM (SELECT *\r\n                                        FROM (SELECT *\r\n                                                FROM \"web_sales\",\r\n                                                    \"web_returns\"\r\n                                                WHERE \"web_sales\".\"ws_item_sk\" = \"web_returns\".\"wr_item_sk\" AND \"web_sales\".\"ws_order_number\" = \"web_returns\".\"wr_order_number\") AS \"t\",\r\n                                            \"web_page\"\r\n                                        WHERE \"t\".\"ws_web_page_sk\" = \"web_page\".\"wp_web_page_sk\") AS \"t0\",\r\n                                    \"customer_demographics\"\r\n                                WHERE \"customer_demographics\".\"cd_demo_sk\" = \"t0\".\"wr_refunded_cdemo_sk\") AS \"t1\",\r\n                            \"customer_demographics\" AS \"customer_demographics0\" (\"cd_demo_sk0\", \"cd_gender0\", \"cd_marital_status0\", \"cd_education_status0\", \"cd_purchase_estimate0\", \"cd_credit_rating0\", \"cd_dep_count0\", \"cd_dep_employed_count0\", \"cd_dep_college_count0\")\r\n                        WHERE \"customer_demographics0\".\"cd_demo_sk0\" = \"t1\".\"wr_returning_cdemo_sk\" AND (\"t1\".\"cd_marital_status\" = 'M' AND \"t1\".\"cd_marital_status\" = \"customer_demographics0\".\"cd_marital_status0\" AND \"t1\".\"cd_education_status\" = '2 yr Degree' AND \"t1\".\"cd_education_status\" = \"customer_demographics0\".\"cd_education_status0\" AND (\"t1\".\"ws_sales_price\" >= 100.00 AND \"t1\".\"ws_sales_price\" <= 150.00) OR \"t1\".\"cd_marital_status\" = 'S' AND \"t1\".\"cd_marital_status\" = \"customer_demographics0\".\"cd_marital_status0\" AND \"t1\".\"cd_education_status\" = 'Unknown' AND \"t1\".\"cd_education_status\" = \"customer_demographics0\".\"cd_education_status0\" AND (\"t1\".\"ws_sales_price\" >= 50.00 AND \"t1\".\"ws_sales_price\" <= 100.00) OR \"t1\".\"cd_marital_status\" = 'D' AND \"t1\".\"cd_marital_status\" = \"customer_demographics0\".\"cd_marital_status0\" AND \"t1\".\"cd_education_status\" = 'Advanced Degree' AND \"t1\".\"cd_education_status\" = \"customer_demographics0\".\"cd_education_status0\" AND (\"t1\".\"ws_sales_price\" >= 150.00 AND \"t1\".\"ws_sales_price\" <= 200.00))) AS \"t2\",\r\n                    \"customer_address\"\r\n                WHERE \"customer_address\".\"ca_address_sk\" = \"t2\".\"wr_refunded_addr_sk\" AND (\"customer_address\".\"ca_country\" = 'United States' AND CAST(\"customer_address\".\"ca_state\" AS CHAR(2)) IN ('MN', 'OK', 'WV') AND (\"t2\".\"ws_net_profit\" >= 100 AND \"t2\".\"ws_net_profit\" <= 200) OR \"customer_address\".\"ca_country\" = 'United States' AND CAST(\"customer_address\".\"ca_state\" AS CHAR(2)) IN ('IL', 'OK', 'VA') AND (\"t2\".\"ws_net_profit\" >= 150 AND \"t2\".\"ws_net_profit\" <= 300) OR \"customer_address\".\"ca_country\" = 'United States' AND CAST(\"customer_address\".\"ca_state\" AS CHAR(2)) IN ('GA', 'KY', 'VA') AND (\"t2\".\"ws_net_profit\" >= 50 AND \"t2\".\"ws_net_profit\" <= 250))\r\n                GROUP BY \"t2\".\"ws_sold_date_sk\", \"t2\".\"wr_reason_sk\") AS \"t4\",\r\n                (SELECT \"d_date_sk\"\r\n                FROM \"date_dim\"\r\n                WHERE \"d_year\" = 1998) AS \"t6\"\r\n        WHERE \"t4\".\"ws_sold_date_sk\" = \"t6\".\"d_date_sk\"\r\n        GROUP BY \"t4\".\"wr_reason_sk\") AS \"t8\",\r\n        (SELECT \"r_reason_sk\", \"r_reason_desc\"\r\n        FROM \"reason\") AS \"t9\"\r\nWHERE \"t9\".\"r_reason_sk\" = \"t8\".\"wr_reason_sk\"\r\nGROUP BY \"t9\".\"r_reason_desc\"\r\nORDER BY 1, 2, 3, 4\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 66.08, "used_rules": ["FILTER_INTO_JOIN", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_REDUCE_FUNCTIONS", "AGGREGATE_JOIN_TRANSPOSE_EXTENDED", "PROJECT_TO_CALC", "CALC_MERGE", "JOIN_EXTRACT_FILTER"], "rewrite_time": 2621}
{"name": "query087_0", "input_sql": "select count(*)\nfrom ((select distinct c_last_name, c_first_name, d_date\n       from store_sales, date_dim, customer\n       where store_sales.ss_sold_date_sk = date_dim.d_date_sk\n         and store_sales.ss_customer_sk = customer.c_customer_sk\n         and d_month_seq between 1206 and 1206+11\n         and ss_list_price between 271 and 300\n         and c_birth_year BETWEEN 1972 AND 1978\n         and ss_wholesale_cost BETWEEN 73 AND 83\n         )\n       except\n      (select distinct c_last_name, c_first_name, d_date\n       from catalog_sales, date_dim, customer\n       where catalog_sales.cs_sold_date_sk = date_dim.d_date_sk\n         and catalog_sales.cs_bill_customer_sk = customer.c_customer_sk\n         and d_month_seq between 1206 and 1206+11\n         and cs_list_price between 271 and 300\n         and c_birth_year BETWEEN 1972 AND 1978\n         and cs_wholesale_cost BETWEEN 73 AND 83\n         )\n       except\n      (select distinct c_last_name, c_first_name, d_date\n       from web_sales, date_dim, customer\n       where web_sales.ws_sold_date_sk = date_dim.d_date_sk\n         and web_sales.ws_bill_customer_sk = customer.c_customer_sk\n         and d_month_seq between 1206 and 1206+11\n         and ws_list_price between 271 and 300\n         and c_birth_year BETWEEN 1972 AND 1978\n         and ws_wholesale_cost BETWEEN 73 AND 83\n         )\n) cool_cust;", "input_cost": 84.2, "output_sql": "SELECT COUNT(*)\r\nFROM (SELECT *\r\n            FROM (SELECT \"t4\".\"c_last_name\", \"t4\".\"c_first_name\", \"t3\".\"d_date\"\r\n                        FROM (SELECT \"t0\".\"ss_customer_sk\", \"t1\".\"d_date\"\r\n                                FROM (SELECT \"ss_sold_date_sk\", \"ss_customer_sk\"\r\n                                        FROM \"store_sales\"\r\n                                        WHERE \"ss_list_price\" >= 271 AND \"ss_list_price\" <= 300 AND (\"ss_wholesale_cost\" >= 73 AND \"ss_wholesale_cost\" <= 83)\r\n                                        GROUP BY \"ss_sold_date_sk\", \"ss_customer_sk\") AS \"t0\",\r\n                                        (SELECT *\r\n                                        FROM \"date_dim\"\r\n                                        WHERE \"d_month_seq\" >= 1206 AND \"d_month_seq\" <= 1217) AS \"t1\"\r\n                                WHERE \"t0\".\"ss_sold_date_sk\" = \"t1\".\"d_date_sk\"\r\n                                GROUP BY \"t0\".\"ss_customer_sk\", \"t1\".\"d_date\") AS \"t3\",\r\n                                (SELECT *\r\n                                FROM \"customer\"\r\n                                WHERE \"c_birth_year\" >= 1972 AND \"c_birth_year\" <= 1978) AS \"t4\"\r\n                        WHERE \"t3\".\"ss_customer_sk\" = \"t4\".\"c_customer_sk\"\r\n                        GROUP BY \"t3\".\"d_date\", \"t4\".\"c_first_name\", \"t4\".\"c_last_name\"\r\n                        EXCEPT\r\n                        SELECT \"t13\".\"c_last_name0\", \"t13\".\"c_first_name0\", \"t12\".\"d_date0\"\r\n                        FROM (SELECT \"t9\".\"cs_bill_customer_sk\", \"t10\".\"d_date0\"\r\n                                FROM (SELECT \"cs_sold_date_sk\", \"cs_bill_customer_sk\"\r\n                                        FROM \"catalog_sales\"\r\n                                        WHERE \"cs_list_price\" >= 271 AND \"cs_list_price\" <= 300 AND (\"cs_wholesale_cost\" >= 73 AND \"cs_wholesale_cost\" <= 83)\r\n                                        GROUP BY \"cs_sold_date_sk\", \"cs_bill_customer_sk\") AS \"t9\",\r\n                                        (SELECT *\r\n                                        FROM \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\")\r\n                                        WHERE \"d_month_seq0\" >= 1206 AND \"d_month_seq0\" <= 1217) AS \"t10\"\r\n                                WHERE \"t9\".\"cs_sold_date_sk\" = \"t10\".\"d_date_sk0\"\r\n                                GROUP BY \"t9\".\"cs_bill_customer_sk\", \"t10\".\"d_date0\") AS \"t12\",\r\n                                (SELECT *\r\n                                FROM \"customer\" AS \"customer0\" (\"c_customer_sk0\", \"c_customer_id0\", \"c_current_cdemo_sk0\", \"c_current_hdemo_sk0\", \"c_current_addr_sk0\", \"c_first_shipto_date_sk0\", \"c_first_sales_date_sk0\", \"c_salutation0\", \"c_first_name0\", \"c_last_name0\", \"c_preferred_cust_flag0\", \"c_birth_day0\", \"c_birth_month0\", \"c_birth_year0\", \"c_birth_country0\", \"c_login0\", \"c_email_address0\", \"c_last_review_date_sk0\")\r\n                                WHERE \"c_birth_year0\" >= 1972 AND \"c_birth_year0\" <= 1978) AS \"t13\"\r\n                        WHERE \"t12\".\"cs_bill_customer_sk\" = \"t13\".\"c_customer_sk0\"\r\n                        GROUP BY \"t12\".\"d_date0\", \"t13\".\"c_first_name0\", \"t13\".\"c_last_name0\") AS \"t\"\r\n            EXCEPT\r\n            SELECT \"t23\".\"c_last_name1\", \"t23\".\"c_first_name1\", \"t22\".\"d_date1\"\r\n            FROM (SELECT \"t19\".\"ws_bill_customer_sk\", \"t20\".\"d_date1\"\r\n                    FROM (SELECT \"ws_sold_date_sk\", \"ws_bill_customer_sk\"\r\n                            FROM \"web_sales\"\r\n                            WHERE \"ws_list_price\" >= 271 AND \"ws_list_price\" <= 300 AND (\"ws_wholesale_cost\" >= 73 AND \"ws_wholesale_cost\" <= 83)\r\n                            GROUP BY \"ws_sold_date_sk\", \"ws_bill_customer_sk\") AS \"t19\",\r\n                            (SELECT *\r\n                            FROM \"date_dim\" AS \"date_dim1\" (\"d_date_sk1\", \"d_date_id1\", \"d_date1\", \"d_month_seq1\", \"d_week_seq1\", \"d_quarter_seq1\", \"d_year1\", \"d_dow1\", \"d_moy1\", \"d_dom1\", \"d_qoy1\", \"d_fy_year1\", \"d_fy_quarter_seq1\", \"d_fy_week_seq1\", \"d_day_name1\", \"d_quarter_name1\", \"d_holiday1\", \"d_weekend1\", \"d_following_holiday1\", \"d_first_dom1\", \"d_last_dom1\", \"d_same_day_ly1\", \"d_same_day_lq1\", \"d_current_day1\", \"d_current_week1\", \"d_current_month1\", \"d_current_quarter1\", \"d_current_year1\")\r\n                            WHERE \"d_month_seq1\" >= 1206 AND \"d_month_seq1\" <= 1217) AS \"t20\"\r\n                    WHERE \"t19\".\"ws_sold_date_sk\" = \"t20\".\"d_date_sk1\"\r\n                    GROUP BY \"t19\".\"ws_bill_customer_sk\", \"t20\".\"d_date1\") AS \"t22\",\r\n                    (SELECT *\r\n                    FROM \"customer\" AS \"customer1\" (\"c_customer_sk1\", \"c_customer_id1\", \"c_current_cdemo_sk1\", \"c_current_hdemo_sk1\", \"c_current_addr_sk1\", \"c_first_shipto_date_sk1\", \"c_first_sales_date_sk1\", \"c_salutation1\", \"c_first_name1\", \"c_last_name1\", \"c_preferred_cust_flag1\", \"c_birth_day1\", \"c_birth_month1\", \"c_birth_year1\", \"c_birth_country1\", \"c_login1\", \"c_email_address1\", \"c_last_review_date_sk1\")\r\n                    WHERE \"c_birth_year1\" >= 1972 AND \"c_birth_year1\" <= 1978) AS \"t23\"\r\n            WHERE \"t22\".\"ws_bill_customer_sk\" = \"t23\".\"c_customer_sk1\"\r\n            GROUP BY \"t22\".\"d_date1\", \"t23\".\"c_first_name1\", \"t23\".\"c_last_name1\") AS \"t27\";", "output_cost": 107.09, "used_rules": ["FILTER_INTO_JOIN", "FILTER_REDUCE_EXPRESSIONS", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_JOIN_TRANSPOSE_EXTENDED", "JOIN_EXTRACT_FILTER", "JOIN_PROJECT_RIGHT_TRANSPOSE", "FILTER_PROJECT_TRANSPOSE", "FILTER_INTO_JOIN", "AGGREGATE_PROJECT_MERGE", "JOIN_EXTRACT_FILTER"], "rewrite_time": 1696}
{"name": "query087_1", "input_sql": "select count(*)\nfrom ((select distinct c_last_name, c_first_name, d_date\n       from store_sales, date_dim, customer\n       where store_sales.ss_sold_date_sk = date_dim.d_date_sk\n         and store_sales.ss_customer_sk = customer.c_customer_sk\n         and d_month_seq between 1189 and 1189+11\n         and ss_list_price between 207 and 236\n         and c_birth_year BETWEEN 1934 AND 1940\n         and ss_wholesale_cost BETWEEN 6 AND 16\n         )\n       except\n      (select distinct c_last_name, c_first_name, d_date\n       from catalog_sales, date_dim, customer\n       where catalog_sales.cs_sold_date_sk = date_dim.d_date_sk\n         and catalog_sales.cs_bill_customer_sk = customer.c_customer_sk\n         and d_month_seq between 1189 and 1189+11\n         and cs_list_price between 207 and 236\n         and c_birth_year BETWEEN 1934 AND 1940\n         and cs_wholesale_cost BETWEEN 6 AND 16\n         )\n       except\n      (select distinct c_last_name, c_first_name, d_date\n       from web_sales, date_dim, customer\n       where web_sales.ws_sold_date_sk = date_dim.d_date_sk\n         and web_sales.ws_bill_customer_sk = customer.c_customer_sk\n         and d_month_seq between 1189 and 1189+11\n         and ws_list_price between 207 and 236\n         and c_birth_year BETWEEN 1934 AND 1940\n         and ws_wholesale_cost BETWEEN 6 AND 16\n         )\n) cool_cust;", "input_cost": 84.2, "output_sql": "SELECT COUNT(*)\r\nFROM (SELECT *\r\n            FROM (SELECT \"t4\".\"c_last_name\", \"t4\".\"c_first_name\", \"t3\".\"d_date\"\r\n                        FROM (SELECT \"t0\".\"ss_customer_sk\", \"t1\".\"d_date\"\r\n                                FROM (SELECT \"ss_sold_date_sk\", \"ss_customer_sk\"\r\n                                        FROM \"store_sales\"\r\n                                        WHERE \"ss_list_price\" >= 207 AND \"ss_list_price\" <= 236 AND (\"ss_wholesale_cost\" >= 6 AND \"ss_wholesale_cost\" <= 16)\r\n                                        GROUP BY \"ss_sold_date_sk\", \"ss_customer_sk\") AS \"t0\",\r\n                                        (SELECT *\r\n                                        FROM \"date_dim\"\r\n                                        WHERE \"d_month_seq\" >= 1189 AND \"d_month_seq\" <= 1200) AS \"t1\"\r\n                                WHERE \"t0\".\"ss_sold_date_sk\" = \"t1\".\"d_date_sk\"\r\n                                GROUP BY \"t0\".\"ss_customer_sk\", \"t1\".\"d_date\") AS \"t3\",\r\n                                (SELECT *\r\n                                FROM \"customer\"\r\n                                WHERE \"c_birth_year\" >= 1934 AND \"c_birth_year\" <= 1940) AS \"t4\"\r\n                        WHERE \"t3\".\"ss_customer_sk\" = \"t4\".\"c_customer_sk\"\r\n                        GROUP BY \"t3\".\"d_date\", \"t4\".\"c_first_name\", \"t4\".\"c_last_name\"\r\n                        EXCEPT\r\n                        SELECT \"t13\".\"c_last_name0\", \"t13\".\"c_first_name0\", \"t12\".\"d_date0\"\r\n                        FROM (SELECT \"t9\".\"cs_bill_customer_sk\", \"t10\".\"d_date0\"\r\n                                FROM (SELECT \"cs_sold_date_sk\", \"cs_bill_customer_sk\"\r\n                                        FROM \"catalog_sales\"\r\n                                        WHERE \"cs_list_price\" >= 207 AND \"cs_list_price\" <= 236 AND (\"cs_wholesale_cost\" >= 6 AND \"cs_wholesale_cost\" <= 16)\r\n                                        GROUP BY \"cs_sold_date_sk\", \"cs_bill_customer_sk\") AS \"t9\",\r\n                                        (SELECT *\r\n                                        FROM \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\")\r\n                                        WHERE \"d_month_seq0\" >= 1189 AND \"d_month_seq0\" <= 1200) AS \"t10\"\r\n                                WHERE \"t9\".\"cs_sold_date_sk\" = \"t10\".\"d_date_sk0\"\r\n                                GROUP BY \"t9\".\"cs_bill_customer_sk\", \"t10\".\"d_date0\") AS \"t12\",\r\n                                (SELECT *\r\n                                FROM \"customer\" AS \"customer0\" (\"c_customer_sk0\", \"c_customer_id0\", \"c_current_cdemo_sk0\", \"c_current_hdemo_sk0\", \"c_current_addr_sk0\", \"c_first_shipto_date_sk0\", \"c_first_sales_date_sk0\", \"c_salutation0\", \"c_first_name0\", \"c_last_name0\", \"c_preferred_cust_flag0\", \"c_birth_day0\", \"c_birth_month0\", \"c_birth_year0\", \"c_birth_country0\", \"c_login0\", \"c_email_address0\", \"c_last_review_date_sk0\")\r\n                                WHERE \"c_birth_year0\" >= 1934 AND \"c_birth_year0\" <= 1940) AS \"t13\"\r\n                        WHERE \"t12\".\"cs_bill_customer_sk\" = \"t13\".\"c_customer_sk0\"\r\n                        GROUP BY \"t12\".\"d_date0\", \"t13\".\"c_first_name0\", \"t13\".\"c_last_name0\") AS \"t\"\r\n            EXCEPT\r\n            SELECT \"t23\".\"c_last_name1\", \"t23\".\"c_first_name1\", \"t22\".\"d_date1\"\r\n            FROM (SELECT \"t19\".\"ws_bill_customer_sk\", \"t20\".\"d_date1\"\r\n                    FROM (SELECT \"ws_sold_date_sk\", \"ws_bill_customer_sk\"\r\n                            FROM \"web_sales\"\r\n                            WHERE \"ws_list_price\" >= 207 AND \"ws_list_price\" <= 236 AND (\"ws_wholesale_cost\" >= 6 AND \"ws_wholesale_cost\" <= 16)\r\n                            GROUP BY \"ws_sold_date_sk\", \"ws_bill_customer_sk\") AS \"t19\",\r\n                            (SELECT *\r\n                            FROM \"date_dim\" AS \"date_dim1\" (\"d_date_sk1\", \"d_date_id1\", \"d_date1\", \"d_month_seq1\", \"d_week_seq1\", \"d_quarter_seq1\", \"d_year1\", \"d_dow1\", \"d_moy1\", \"d_dom1\", \"d_qoy1\", \"d_fy_year1\", \"d_fy_quarter_seq1\", \"d_fy_week_seq1\", \"d_day_name1\", \"d_quarter_name1\", \"d_holiday1\", \"d_weekend1\", \"d_following_holiday1\", \"d_first_dom1\", \"d_last_dom1\", \"d_same_day_ly1\", \"d_same_day_lq1\", \"d_current_day1\", \"d_current_week1\", \"d_current_month1\", \"d_current_quarter1\", \"d_current_year1\")\r\n                            WHERE \"d_month_seq1\" >= 1189 AND \"d_month_seq1\" <= 1200) AS \"t20\"\r\n                    WHERE \"t19\".\"ws_sold_date_sk\" = \"t20\".\"d_date_sk1\"\r\n                    GROUP BY \"t19\".\"ws_bill_customer_sk\", \"t20\".\"d_date1\") AS \"t22\",\r\n                    (SELECT *\r\n                    FROM \"customer\" AS \"customer1\" (\"c_customer_sk1\", \"c_customer_id1\", \"c_current_cdemo_sk1\", \"c_current_hdemo_sk1\", \"c_current_addr_sk1\", \"c_first_shipto_date_sk1\", \"c_first_sales_date_sk1\", \"c_salutation1\", \"c_first_name1\", \"c_last_name1\", \"c_preferred_cust_flag1\", \"c_birth_day1\", \"c_birth_month1\", \"c_birth_year1\", \"c_birth_country1\", \"c_login1\", \"c_email_address1\", \"c_last_review_date_sk1\")\r\n                    WHERE \"c_birth_year1\" >= 1934 AND \"c_birth_year1\" <= 1940) AS \"t23\"\r\n            WHERE \"t22\".\"ws_bill_customer_sk\" = \"t23\".\"c_customer_sk1\"\r\n            GROUP BY \"t22\".\"d_date1\", \"t23\".\"c_first_name1\", \"t23\".\"c_last_name1\") AS \"t27\";", "output_cost": 107.09, "used_rules": ["FILTER_INTO_JOIN", "FILTER_REDUCE_EXPRESSIONS", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_JOIN_TRANSPOSE_EXTENDED", "JOIN_EXTRACT_FILTER", "JOIN_PROJECT_RIGHT_TRANSPOSE", "FILTER_PROJECT_TRANSPOSE", "FILTER_INTO_JOIN", "AGGREGATE_PROJECT_MERGE", "JOIN_EXTRACT_FILTER"], "rewrite_time": 1713}
{"name": "query091_0", "input_sql": "select  \n        cc_call_center_id Call_Center,\n        cc_name Call_Center_Name,\n        cc_manager Manager,\n        sum(cr_net_loss) Returns_Loss\nfrom\n        call_center,\n        catalog_returns,\n        date_dim,\n        customer,\n        customer_address,\n        customer_demographics,\n        household_demographics\nwhere\n        cr_call_center_sk       = cc_call_center_sk\nand     cr_returned_date_sk     = d_date_sk\nand     cr_returning_customer_sk= c_customer_sk\nand     cd_demo_sk              = c_current_cdemo_sk\nand     hd_demo_sk              = c_current_hdemo_sk\nand     ca_address_sk           = c_current_addr_sk\nand     d_year                  = 2000 \nand     d_moy                   = 3\nand     ( (cd_marital_status       = 'M' and cd_education_status     = 'Unknown')\n        or(cd_marital_status       = 'W' and cd_education_status     = 'Advanced Degree'))\nand     hd_buy_potential like '501-1000%'\nand     ca_gmt_offset           = -7\ngroup by cc_call_center_id,cc_name,cc_manager,cd_marital_status,cd_education_status\norder by sum(cr_net_loss) desc;", "input_cost": 53.68, "output_sql": "SELECT \"t7\".\"cc_call_center_id\" AS \"call_center\", \"t7\".\"cc_name\" AS \"call_center_name\", \"t7\".\"cc_manager\" AS \"manager\", CASE WHEN COALESCE(SUM(\"t7\".\"$f7\"), 0) = 0 THEN NULL ELSE COALESCE(SUM(\"t7\".\"returns_loss\"), 0) END AS \"returns_loss\"\r\nFROM (SELECT \"t5\".\"cc_call_center_id\", \"t5\".\"cc_name\", \"t5\".\"cc_manager\", \"t5\".\"c_current_hdemo_sk\", \"t6\".\"cd_marital_status\", \"t6\".\"cd_education_status\", COALESCE(SUM(\"t5\".\"returns_loss\"), 0) AS \"returns_loss\", COALESCE(SUM(\"t5\".\"$f6\"), 0) AS \"$f7\"\r\n        FROM (SELECT \"t3\".\"cc_call_center_id\", \"t3\".\"cc_name\", \"t3\".\"cc_manager\", \"t3\".\"c_current_cdemo_sk\", \"t3\".\"c_current_hdemo_sk\", COALESCE(SUM(\"t3\".\"returns_loss\"), 0) AS \"returns_loss\", COALESCE(SUM(\"t3\".\"$f7\"), 0) AS \"$f6\"\r\n                FROM (SELECT \"t2\".\"cc_call_center_id\", \"t2\".\"cc_name\", \"t2\".\"cc_manager\", \"customer\".\"c_current_cdemo_sk\", \"customer\".\"c_current_hdemo_sk\", \"customer\".\"c_current_addr_sk\", COALESCE(SUM(\"t2\".\"returns_loss\"), 0) AS \"returns_loss\", COALESCE(SUM(\"t2\".\"$f5\"), 0) AS \"$f7\"\r\n                        FROM (SELECT \"t0\".\"cc_call_center_id\", \"t0\".\"cc_name\", \"t0\".\"cc_manager\", \"t0\".\"cr_returning_customer_sk\", COALESCE(SUM(\"t0\".\"returns_loss\"), 0) AS \"returns_loss\", COALESCE(SUM(\"t0\".\"$f6\"), 0) AS \"$f5\"\r\n                                FROM (SELECT \"call_center\".\"cc_call_center_id\", \"call_center\".\"cc_name\", \"call_center\".\"cc_manager\", \"t\".\"cr_returned_date_sk\", \"t\".\"cr_returning_customer_sk\", COALESCE(SUM(\"t\".\"returns_loss\"), 0) AS \"returns_loss\", COALESCE(SUM(\"t\".\"$f4\"), 0) AS \"$f6\"\r\n                                        FROM \"call_center\"\r\n                                            INNER JOIN (SELECT \"cr_returned_date_sk\", \"cr_returning_customer_sk\", \"cr_call_center_sk\", COALESCE(SUM(\"cr_net_loss\"), 0) AS \"returns_loss\", COUNT(\"cr_net_loss\") AS \"$f4\"\r\n                                                FROM \"catalog_returns\"\r\n                                                GROUP BY \"cr_returned_date_sk\", \"cr_returning_customer_sk\", \"cr_call_center_sk\") AS \"t\" ON \"call_center\".\"cc_call_center_sk\" = \"t\".\"cr_call_center_sk\"\r\n                                        GROUP BY \"call_center\".\"cc_call_center_id\", \"call_center\".\"cc_name\", \"call_center\".\"cc_manager\", \"t\".\"cr_returned_date_sk\", \"t\".\"cr_returning_customer_sk\") AS \"t0\"\r\n                                    INNER JOIN (SELECT *\r\n                                        FROM \"date_dim\"\r\n                                        WHERE \"d_year\" = 2000 AND \"d_moy\" = 3) AS \"t1\" ON \"t0\".\"cr_returned_date_sk\" = \"t1\".\"d_date_sk\"\r\n                                GROUP BY \"t0\".\"cc_call_center_id\", \"t0\".\"cc_name\", \"t0\".\"cc_manager\", \"t0\".\"cr_returning_customer_sk\") AS \"t2\"\r\n                            INNER JOIN \"customer\" ON \"t2\".\"cr_returning_customer_sk\" = \"customer\".\"c_customer_sk\"\r\n                        GROUP BY \"t2\".\"cc_call_center_id\", \"t2\".\"cc_name\", \"t2\".\"cc_manager\", \"customer\".\"c_current_cdemo_sk\", \"customer\".\"c_current_hdemo_sk\", \"customer\".\"c_current_addr_sk\") AS \"t3\"\r\n                    INNER JOIN (SELECT *\r\n                        FROM \"customer_address\"\r\n                        WHERE CAST(\"ca_gmt_offset\" AS DECIMAL(12, 2)) = -7) AS \"t4\" ON \"t3\".\"c_current_addr_sk\" = \"t4\".\"ca_address_sk\"\r\n                GROUP BY \"t3\".\"cc_call_center_id\", \"t3\".\"cc_name\", \"t3\".\"cc_manager\", \"t3\".\"c_current_cdemo_sk\", \"t3\".\"c_current_hdemo_sk\") AS \"t5\"\r\n            INNER JOIN (SELECT *\r\n                FROM \"customer_demographics\"\r\n                WHERE \"cd_marital_status\" = 'M' AND \"cd_education_status\" = 'Unknown' OR \"cd_marital_status\" = 'W' AND \"cd_education_status\" = 'Advanced Degree') AS \"t6\" ON \"t5\".\"c_current_cdemo_sk\" = \"t6\".\"cd_demo_sk\"\r\n        GROUP BY \"t5\".\"cc_call_center_id\", \"t5\".\"cc_name\", \"t5\".\"cc_manager\", \"t5\".\"c_current_hdemo_sk\", \"t6\".\"cd_marital_status\", \"t6\".\"cd_education_status\") AS \"t7\"\r\n    INNER JOIN (SELECT *\r\n        FROM \"household_demographics\"\r\n        WHERE \"hd_buy_potential\" LIKE '501-1000%') AS \"t8\" ON \"t7\".\"c_current_hdemo_sk\" = \"t8\".\"hd_demo_sk\"\r\nGROUP BY \"t7\".\"cc_call_center_id\", \"t7\".\"cc_name\", \"t7\".\"cc_manager\", \"t7\".\"cd_marital_status\", \"t7\".\"cd_education_status\"\r\nORDER BY 4 DESC;", "output_cost": 86.34, "used_rules": ["FILTER_INTO_JOIN", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_REDUCE_FUNCTIONS", "AGGREGATE_JOIN_TRANSPOSE_EXTENDED", "JOIN_PROJECT_LEFT_TRANSPOSE", "JOIN_EXTRACT_FILTER", "JOIN_PROJECT_RIGHT_TRANSPOSE", "FILTER_INTO_JOIN", "FILTER_PROJECT_TRANSPOSE", "FILTER_INTO_JOIN", "AGGREGATE_PROJECT_MERGE"], "rewrite_time": 1809}
{"name": "query091_1", "input_sql": "select  \n        cc_call_center_id Call_Center,\n        cc_name Call_Center_Name,\n        cc_manager Manager,\n        sum(cr_net_loss) Returns_Loss\nfrom\n        call_center,\n        catalog_returns,\n        date_dim,\n        customer,\n        customer_address,\n        customer_demographics,\n        household_demographics\nwhere\n        cr_call_center_sk       = cc_call_center_sk\nand     cr_returned_date_sk     = d_date_sk\nand     cr_returning_customer_sk= c_customer_sk\nand     cd_demo_sk              = c_current_cdemo_sk\nand     hd_demo_sk              = c_current_hdemo_sk\nand     ca_address_sk           = c_current_addr_sk\nand     d_year                  = 2002 \nand     d_moy                   = 3\nand     ( (cd_marital_status       = 'M' and cd_education_status     = 'Unknown')\n        or(cd_marital_status       = 'W' and cd_education_status     = 'Advanced Degree'))\nand     hd_buy_potential like '1001-5000%'\nand     ca_gmt_offset           = -7\ngroup by cc_call_center_id,cc_name,cc_manager,cd_marital_status,cd_education_status\norder by sum(cr_net_loss) desc;", "input_cost": 53.68, "output_sql": "SELECT \"t7\".\"cc_call_center_id\" AS \"call_center\", \"t7\".\"cc_name\" AS \"call_center_name\", \"t7\".\"cc_manager\" AS \"manager\", CASE WHEN COALESCE(SUM(\"t7\".\"$f7\"), 0) = 0 THEN NULL ELSE COALESCE(SUM(\"t7\".\"returns_loss\"), 0) END AS \"returns_loss\"\r\nFROM (SELECT \"t5\".\"cc_call_center_id\", \"t5\".\"cc_name\", \"t5\".\"cc_manager\", \"t5\".\"c_current_hdemo_sk\", \"t6\".\"cd_marital_status\", \"t6\".\"cd_education_status\", COALESCE(SUM(\"t5\".\"returns_loss\"), 0) AS \"returns_loss\", COALESCE(SUM(\"t5\".\"$f6\"), 0) AS \"$f7\"\r\n        FROM (SELECT \"t3\".\"cc_call_center_id\", \"t3\".\"cc_name\", \"t3\".\"cc_manager\", \"t3\".\"c_current_cdemo_sk\", \"t3\".\"c_current_hdemo_sk\", COALESCE(SUM(\"t3\".\"returns_loss\"), 0) AS \"returns_loss\", COALESCE(SUM(\"t3\".\"$f7\"), 0) AS \"$f6\"\r\n                FROM (SELECT \"t2\".\"cc_call_center_id\", \"t2\".\"cc_name\", \"t2\".\"cc_manager\", \"customer\".\"c_current_cdemo_sk\", \"customer\".\"c_current_hdemo_sk\", \"customer\".\"c_current_addr_sk\", COALESCE(SUM(\"t2\".\"returns_loss\"), 0) AS \"returns_loss\", COALESCE(SUM(\"t2\".\"$f5\"), 0) AS \"$f7\"\r\n                        FROM (SELECT \"t0\".\"cc_call_center_id\", \"t0\".\"cc_name\", \"t0\".\"cc_manager\", \"t0\".\"cr_returning_customer_sk\", COALESCE(SUM(\"t0\".\"returns_loss\"), 0) AS \"returns_loss\", COALESCE(SUM(\"t0\".\"$f6\"), 0) AS \"$f5\"\r\n                                FROM (SELECT \"call_center\".\"cc_call_center_id\", \"call_center\".\"cc_name\", \"call_center\".\"cc_manager\", \"t\".\"cr_returned_date_sk\", \"t\".\"cr_returning_customer_sk\", COALESCE(SUM(\"t\".\"returns_loss\"), 0) AS \"returns_loss\", COALESCE(SUM(\"t\".\"$f4\"), 0) AS \"$f6\"\r\n                                        FROM \"call_center\"\r\n                                            INNER JOIN (SELECT \"cr_returned_date_sk\", \"cr_returning_customer_sk\", \"cr_call_center_sk\", COALESCE(SUM(\"cr_net_loss\"), 0) AS \"returns_loss\", COUNT(\"cr_net_loss\") AS \"$f4\"\r\n                                                FROM \"catalog_returns\"\r\n                                                GROUP BY \"cr_returned_date_sk\", \"cr_returning_customer_sk\", \"cr_call_center_sk\") AS \"t\" ON \"call_center\".\"cc_call_center_sk\" = \"t\".\"cr_call_center_sk\"\r\n                                        GROUP BY \"call_center\".\"cc_call_center_id\", \"call_center\".\"cc_name\", \"call_center\".\"cc_manager\", \"t\".\"cr_returned_date_sk\", \"t\".\"cr_returning_customer_sk\") AS \"t0\"\r\n                                    INNER JOIN (SELECT *\r\n                                        FROM \"date_dim\"\r\n                                        WHERE \"d_year\" = 2002 AND \"d_moy\" = 3) AS \"t1\" ON \"t0\".\"cr_returned_date_sk\" = \"t1\".\"d_date_sk\"\r\n                                GROUP BY \"t0\".\"cc_call_center_id\", \"t0\".\"cc_name\", \"t0\".\"cc_manager\", \"t0\".\"cr_returning_customer_sk\") AS \"t2\"\r\n                            INNER JOIN \"customer\" ON \"t2\".\"cr_returning_customer_sk\" = \"customer\".\"c_customer_sk\"\r\n                        GROUP BY \"t2\".\"cc_call_center_id\", \"t2\".\"cc_name\", \"t2\".\"cc_manager\", \"customer\".\"c_current_cdemo_sk\", \"customer\".\"c_current_hdemo_sk\", \"customer\".\"c_current_addr_sk\") AS \"t3\"\r\n                    INNER JOIN (SELECT *\r\n                        FROM \"customer_address\"\r\n                        WHERE CAST(\"ca_gmt_offset\" AS DECIMAL(12, 2)) = -7) AS \"t4\" ON \"t3\".\"c_current_addr_sk\" = \"t4\".\"ca_address_sk\"\r\n                GROUP BY \"t3\".\"cc_call_center_id\", \"t3\".\"cc_name\", \"t3\".\"cc_manager\", \"t3\".\"c_current_cdemo_sk\", \"t3\".\"c_current_hdemo_sk\") AS \"t5\"\r\n            INNER JOIN (SELECT *\r\n                FROM \"customer_demographics\"\r\n                WHERE \"cd_marital_status\" = 'M' AND \"cd_education_status\" = 'Unknown' OR \"cd_marital_status\" = 'W' AND \"cd_education_status\" = 'Advanced Degree') AS \"t6\" ON \"t5\".\"c_current_cdemo_sk\" = \"t6\".\"cd_demo_sk\"\r\n        GROUP BY \"t5\".\"cc_call_center_id\", \"t5\".\"cc_name\", \"t5\".\"cc_manager\", \"t5\".\"c_current_hdemo_sk\", \"t6\".\"cd_marital_status\", \"t6\".\"cd_education_status\") AS \"t7\"\r\n    INNER JOIN (SELECT *\r\n        FROM \"household_demographics\"\r\n        WHERE \"hd_buy_potential\" LIKE '1001-5000%') AS \"t8\" ON \"t7\".\"c_current_hdemo_sk\" = \"t8\".\"hd_demo_sk\"\r\nGROUP BY \"t7\".\"cc_call_center_id\", \"t7\".\"cc_name\", \"t7\".\"cc_manager\", \"t7\".\"cd_marital_status\", \"t7\".\"cd_education_status\"\r\nORDER BY 4 DESC;", "output_cost": 86.34, "used_rules": ["FILTER_INTO_JOIN", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_REDUCE_FUNCTIONS", "AGGREGATE_JOIN_TRANSPOSE_EXTENDED", "JOIN_PROJECT_LEFT_TRANSPOSE", "JOIN_EXTRACT_FILTER", "JOIN_PROJECT_RIGHT_TRANSPOSE", "FILTER_INTO_JOIN", "FILTER_PROJECT_TRANSPOSE", "FILTER_INTO_JOIN", "AGGREGATE_PROJECT_MERGE"], "rewrite_time": 1862}
{"name": "query092_0", "input_sql": "select \n   sum(ws_ext_discount_amt)  as \"Excess Discount Amount\"\nfrom\n    web_sales\n   ,item\n   ,date_dim\nwhere\n(i_manufact_id BETWEEN 517 and 716\nor i_category IN ('Books', 'Jewelry', 'Shoes'))\nand i_item_sk = ws_item_sk\nand d_date between '2002-01-25' and\n        cast('2002-01-25' as date) + interval '90' day\nand d_date_sk = ws_sold_date_sk\nand ws_wholesale_cost BETWEEN 71 AND 91\nand ws_ext_discount_amt\n     > (\n         SELECT\n            1.3 * avg(ws_ext_discount_amt)\n         FROM\n            web_sales\n           ,date_dim\n         WHERE\n              ws_item_sk = i_item_sk\n          and d_date between '2002-01-25' and\n                             cast('2002-01-25' as date) + interval '90' day\n          and d_date_sk = ws_sold_date_sk\n          and ws_wholesale_cost BETWEEN 71 AND 91\n          and ws_sales_price / ws_list_price BETWEEN 73 * 0.01 AND 88 * 0.01\n  )\norder by sum(ws_ext_discount_amt)\nlimit 100;", "input_cost": 29.87, "output_sql": "SELECT CASE WHEN COUNT(\"t\".\"ws_ext_discount_amt\") = 0 THEN NULL ELSE COALESCE(SUM(\"t\".\"ws_ext_discount_amt\"), 0) END AS \"Excess Discount Amount\"\r\nFROM (SELECT *\r\n        FROM \"web_sales\"\r\n        WHERE \"ws_wholesale_cost\" >= 71 AND \"ws_wholesale_cost\" <= 91) AS \"t\"\r\n    INNER JOIN (SELECT *\r\n        FROM \"item\"\r\n        WHERE \"i_manufact_id\" >= 517 AND \"i_manufact_id\" <= 716 OR CAST(\"i_category\" AS CHAR(5)) IN ('Books', 'Shoes') OR \"i_category\" = 'Jewelry') AS \"t0\" ON \"t\".\"ws_item_sk\" = \"t0\".\"i_item_sk\"\r\n    INNER JOIN (SELECT *\r\n        FROM \"date_dim\"\r\n        WHERE \"d_date\" >= DATE '2002-01-25' AND \"d_date\" <= DATE '2002-04-25') AS \"t1\" ON \"t\".\"ws_sold_date_sk\" = \"t1\".\"d_date_sk\"\r\n    INNER JOIN (SELECT \"ws_item_sk0\", CASE WHEN COUNT(\"ws_ext_discount_amt0\") = 0 THEN NULL ELSE COALESCE(SUM(\"ws_ext_discount_amt0\"), 0) END / COUNT(\"ws_ext_discount_amt0\") AS \"$f10\"\r\n        FROM (SELECT *\r\n                FROM \"web_sales\" AS \"web_sales0\" (\"ws_sold_date_sk0\", \"ws_sold_time_sk0\", \"ws_ship_date_sk0\", \"ws_item_sk0\", \"ws_bill_customer_sk0\", \"ws_bill_cdemo_sk0\", \"ws_bill_hdemo_sk0\", \"ws_bill_addr_sk0\", \"ws_ship_customer_sk0\", \"ws_ship_cdemo_sk0\", \"ws_ship_hdemo_sk0\", \"ws_ship_addr_sk0\", \"ws_web_page_sk0\", \"ws_web_site_sk0\", \"ws_ship_mode_sk0\", \"ws_warehouse_sk0\", \"ws_promo_sk0\", \"ws_order_number0\", \"ws_quantity0\", \"ws_wholesale_cost0\", \"ws_list_price0\", \"ws_sales_price0\", \"ws_ext_discount_amt0\", \"ws_ext_sales_price0\", \"ws_ext_wholesale_cost0\", \"ws_ext_list_price0\", \"ws_ext_tax0\", \"ws_coupon_amt0\", \"ws_ext_ship_cost0\", \"ws_net_paid0\", \"ws_net_paid_inc_tax0\", \"ws_net_paid_inc_ship0\", \"ws_net_paid_inc_ship_tax0\", \"ws_net_profit0\")\r\n                WHERE \"ws_wholesale_cost0\" >= 71 AND \"ws_wholesale_cost0\" <= 91 AND \"ws_sales_price0\" / \"ws_list_price0\" >= 0.73 AND \"ws_sales_price0\" / \"ws_list_price0\" <= 0.88 AND EXISTS (SELECT 1\r\n                        FROM (SELECT *\r\n                                FROM \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\")\r\n                                WHERE \"d_date0\" >= DATE '2002-01-25' AND \"d_date0\" <= DATE '2002-04-25') AS \"t3\"\r\n                        WHERE \"ws_sold_date_sk0\" = \"t3\".\"d_date_sk0\")) AS \"t2\"\r\n        GROUP BY \"ws_item_sk0\") AS \"t6\" ON \"t0\".\"i_item_sk\" = \"t6\".\"ws_item_sk0\" AND \"t\".\"ws_ext_discount_amt\" > 1.3 * \"t6\".\"$f10\"\r\nORDER BY 1\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 45.71, "used_rules": ["FILTER_SUB_QUERY_TO_CORRELATE", "FILTER_REDUCE_EXPRESSIONS", "JOIN_ON_UNIQUE_TO_SEMI_JOIN", "JOIN_EXTRACT_FILTER", "FILTER_INTO_JOIN", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_REDUCE_FUNCTIONS"], "rewrite_time": 2029}
{"name": "query092_1", "input_sql": "select \n   sum(ws_ext_discount_amt)  as \"Excess Discount Amount\"\nfrom\n    web_sales\n   ,item\n   ,date_dim\nwhere\n(i_manufact_id BETWEEN 761 and 960\nor i_category IN ('Books', 'Children', 'Home'))\nand i_item_sk = ws_item_sk\nand d_date between '1998-02-08' and\n        cast('1998-02-08' as date) + interval '90' day\nand d_date_sk = ws_sold_date_sk\nand ws_wholesale_cost BETWEEN 61 AND 81\nand ws_ext_discount_amt\n     > (\n         SELECT\n            1.3 * avg(ws_ext_discount_amt)\n         FROM\n            web_sales\n           ,date_dim\n         WHERE\n              ws_item_sk = i_item_sk\n          and d_date between '1998-02-08' and\n                             cast('1998-02-08' as date) + interval '90' day\n          and d_date_sk = ws_sold_date_sk\n          and ws_wholesale_cost BETWEEN 61 AND 81\n          and ws_sales_price / ws_list_price BETWEEN 43 * 0.01 AND 58 * 0.01\n  )\norder by sum(ws_ext_discount_amt)\nlimit 100;", "input_cost": 29.87, "output_sql": "SELECT CASE WHEN COUNT(\"t\".\"ws_ext_discount_amt\") = 0 THEN NULL ELSE COALESCE(SUM(\"t\".\"ws_ext_discount_amt\"), 0) END AS \"Excess Discount Amount\"\r\nFROM (SELECT *\r\n        FROM \"web_sales\"\r\n        WHERE \"ws_wholesale_cost\" >= 61 AND \"ws_wholesale_cost\" <= 81) AS \"t\"\r\n    INNER JOIN (SELECT *\r\n        FROM \"item\"\r\n        WHERE \"i_manufact_id\" >= 761 AND \"i_manufact_id\" <= 960 OR \"i_category\" = 'Books' OR \"i_category\" = 'Children' OR \"i_category\" = 'Home') AS \"t0\" ON \"t\".\"ws_item_sk\" = \"t0\".\"i_item_sk\"\r\n    INNER JOIN (SELECT *\r\n        FROM \"date_dim\"\r\n        WHERE \"d_date\" >= DATE '1998-02-08' AND \"d_date\" <= DATE '1998-05-09') AS \"t1\" ON \"t\".\"ws_sold_date_sk\" = \"t1\".\"d_date_sk\"\r\n    INNER JOIN (SELECT \"ws_item_sk0\", CASE WHEN COUNT(\"ws_ext_discount_amt0\") = 0 THEN NULL ELSE COALESCE(SUM(\"ws_ext_discount_amt0\"), 0) END / COUNT(\"ws_ext_discount_amt0\") AS \"$f10\"\r\n        FROM (SELECT *\r\n                FROM \"web_sales\" AS \"web_sales0\" (\"ws_sold_date_sk0\", \"ws_sold_time_sk0\", \"ws_ship_date_sk0\", \"ws_item_sk0\", \"ws_bill_customer_sk0\", \"ws_bill_cdemo_sk0\", \"ws_bill_hdemo_sk0\", \"ws_bill_addr_sk0\", \"ws_ship_customer_sk0\", \"ws_ship_cdemo_sk0\", \"ws_ship_hdemo_sk0\", \"ws_ship_addr_sk0\", \"ws_web_page_sk0\", \"ws_web_site_sk0\", \"ws_ship_mode_sk0\", \"ws_warehouse_sk0\", \"ws_promo_sk0\", \"ws_order_number0\", \"ws_quantity0\", \"ws_wholesale_cost0\", \"ws_list_price0\", \"ws_sales_price0\", \"ws_ext_discount_amt0\", \"ws_ext_sales_price0\", \"ws_ext_wholesale_cost0\", \"ws_ext_list_price0\", \"ws_ext_tax0\", \"ws_coupon_amt0\", \"ws_ext_ship_cost0\", \"ws_net_paid0\", \"ws_net_paid_inc_tax0\", \"ws_net_paid_inc_ship0\", \"ws_net_paid_inc_ship_tax0\", \"ws_net_profit0\")\r\n                WHERE \"ws_wholesale_cost0\" >= 61 AND \"ws_wholesale_cost0\" <= 81 AND \"ws_sales_price0\" / \"ws_list_price0\" >= 0.43 AND \"ws_sales_price0\" / \"ws_list_price0\" <= 0.58 AND EXISTS (SELECT 1\r\n                        FROM (SELECT *\r\n                                FROM \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\")\r\n                                WHERE \"d_date0\" >= DATE '1998-02-08' AND \"d_date0\" <= DATE '1998-05-09') AS \"t3\"\r\n                        WHERE \"ws_sold_date_sk0\" = \"t3\".\"d_date_sk0\")) AS \"t2\"\r\n        GROUP BY \"ws_item_sk0\") AS \"t6\" ON \"t0\".\"i_item_sk\" = \"t6\".\"ws_item_sk0\" AND \"t\".\"ws_ext_discount_amt\" > 1.3 * \"t6\".\"$f10\"\r\nORDER BY 1\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 45.71, "used_rules": ["FILTER_SUB_QUERY_TO_CORRELATE", "JOIN_ON_UNIQUE_TO_SEMI_JOIN", "JOIN_EXTRACT_FILTER", "FILTER_INTO_JOIN", "FILTER_REDUCE_EXPRESSIONS", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_REDUCE_FUNCTIONS"], "rewrite_time": 1972}
{"name": "query094_0", "input_sql": "select \n   count(distinct ws_order_number) as \"order count\"\n  ,sum(ws_ext_ship_cost) as \"total shipping cost\"\n  ,sum(ws_net_profit) as \"total net profit\"\nfrom\n   web_sales ws1\n  ,date_dim\n  ,customer_address\n  ,web_site\nwhere\n    d_date between '2002-6-01' and\n           cast('2002-6-01' as date) + interval '60' day\nand ws1.ws_ship_date_sk = d_date_sk\nand ws1.ws_ship_addr_sk = ca_address_sk\nand ca_state in ('DC','MO','OH'\n            ,'OK' ,'PA' ,'SD')\nand ws1.ws_web_site_sk = web_site_sk\nand web_gmt_offset >= -5\nand ws1.ws_list_price between 226 and 255\nand exists (select *\n            from web_sales ws2\n            where ws1.ws_order_number = ws2.ws_order_number\n              and ws1.ws_warehouse_sk <> ws2.ws_warehouse_sk)\nand not exists(select *\n               from web_returns wr1\n               where ws1.ws_order_number = wr1.wr_order_number\n               and wr1.wr_reason_sk in (3, 6, 18, 30, 40)\n               )\norder by count(distinct ws_order_number)\nlimit 100;", "input_cost": 61.63, "output_sql": "SELECT COUNT(\"t26\".\"ws_order_number\") FILTER (WHERE \"t26\".\"$g_0\") AS \"order count\", MIN(\"t26\".\"total shipping cost\") FILTER (WHERE \"t26\".\"$g_1\") AS \"total shipping cost\", MIN(\"t26\".\"total net profit\") FILTER (WHERE \"t26\".\"$g_1\") AS \"total net profit\"\r\nFROM (SELECT \"t19\".\"ws_order_number\", CASE WHEN COUNT(\"t19\".\"ws_ext_ship_cost\") = 0 THEN NULL ELSE COALESCE(SUM(\"t19\".\"ws_ext_ship_cost\"), 0) END AS \"total shipping cost\", CASE WHEN COUNT(\"t19\".\"ws_net_profit\") = 0 THEN NULL ELSE COALESCE(SUM(\"t19\".\"ws_net_profit\"), 0) END AS \"total net profit\", GROUPING(\"t19\".\"ws_order_number\") = 0 AS \"$g_0\", GROUPING(\"t19\".\"ws_order_number\") = 1 AS \"$g_1\"\r\n        FROM (SELECT *\r\n                FROM (SELECT *\r\n                        FROM (SELECT *\r\n                                FROM (SELECT *\r\n                                        FROM (SELECT *\r\n                                                FROM \"web_sales\"\r\n                                                WHERE \"ws_list_price\" >= 226 AND \"ws_list_price\" <= 255) AS \"t\",\r\n                                                (SELECT *\r\n                                                FROM \"date_dim\"\r\n                                                WHERE \"d_date\" >= DATE '2002-06-01' AND \"d_date\" <= DATE '2002-07-31') AS \"t0\"\r\n                                        WHERE \"t\".\"ws_ship_date_sk\" = \"t0\".\"d_date_sk\") AS \"t1\",\r\n                                        (SELECT *\r\n                                        FROM \"customer_address\"\r\n                                        WHERE CAST(\"ca_state\" AS CHAR(2)) IN ('DC', 'MO', 'OH', 'OK', 'PA', 'SD')) AS \"t2\"\r\n                                WHERE \"t1\".\"ws_ship_addr_sk\" = \"t2\".\"ca_address_sk\") AS \"t3\",\r\n                                (SELECT *\r\n                                FROM \"web_site\"\r\n                                WHERE \"web_gmt_offset\" >= -5) AS \"t4\"\r\n                        WHERE \"t3\".\"ws_web_site_sk\" = \"t4\".\"web_site_sk\") AS \"t5\",\r\n                        (SELECT \"t16\".\"ws_warehouse_sk1\", \"t16\".\"ws_order_number1\"\r\n                        FROM \"web_sales\" AS \"web_sales0\" (\"ws_sold_date_sk0\", \"ws_sold_time_sk0\", \"ws_ship_date_sk0\", \"ws_item_sk0\", \"ws_bill_customer_sk0\", \"ws_bill_cdemo_sk0\", \"ws_bill_hdemo_sk0\", \"ws_bill_addr_sk0\", \"ws_ship_customer_sk0\", \"ws_ship_cdemo_sk0\", \"ws_ship_hdemo_sk0\", \"ws_ship_addr_sk0\", \"ws_web_page_sk0\", \"ws_web_site_sk0\", \"ws_ship_mode_sk0\", \"ws_warehouse_sk0\", \"ws_promo_sk0\", \"ws_order_number0\", \"ws_quantity0\", \"ws_wholesale_cost0\", \"ws_list_price0\", \"ws_sales_price0\", \"ws_ext_discount_amt0\", \"ws_ext_sales_price0\", \"ws_ext_wholesale_cost0\", \"ws_ext_list_price0\", \"ws_ext_tax0\", \"ws_coupon_amt0\", \"ws_ext_ship_cost0\", \"ws_net_paid0\", \"ws_net_paid_inc_tax0\", \"ws_net_paid_inc_ship0\", \"ws_net_paid_inc_ship_tax0\", \"ws_net_profit0\"),\r\n                                (SELECT \"t13\".\"ws_warehouse_sk1\", \"t13\".\"ws_order_number1\"\r\n                                FROM (SELECT \"t10\".\"ws_web_site_sk1\", \"t10\".\"ws_warehouse_sk1\", \"t10\".\"ws_order_number1\"\r\n                                        FROM (SELECT \"t7\".\"ws_ship_addr_sk1\", \"t7\".\"ws_web_site_sk1\", \"t7\".\"ws_warehouse_sk1\", \"t7\".\"ws_order_number1\"\r\n                                                FROM (SELECT \"ws_ship_date_sk1\", \"ws_ship_addr_sk1\", \"ws_web_site_sk1\", \"ws_warehouse_sk1\", \"ws_order_number1\"\r\n                                                        FROM \"web_sales\" AS \"web_sales1\" (\"ws_sold_date_sk1\", \"ws_sold_time_sk1\", \"ws_ship_date_sk1\", \"ws_item_sk1\", \"ws_bill_customer_sk1\", \"ws_bill_cdemo_sk1\", \"ws_bill_hdemo_sk1\", \"ws_bill_addr_sk1\", \"ws_ship_customer_sk1\", \"ws_ship_cdemo_sk1\", \"ws_ship_hdemo_sk1\", \"ws_ship_addr_sk1\", \"ws_web_page_sk1\", \"ws_web_site_sk1\", \"ws_ship_mode_sk1\", \"ws_warehouse_sk1\", \"ws_promo_sk1\", \"ws_order_number1\", \"ws_quantity1\", \"ws_wholesale_cost1\", \"ws_list_price1\", \"ws_sales_price1\", \"ws_ext_discount_amt1\", \"ws_ext_sales_price1\", \"ws_ext_wholesale_cost1\", \"ws_ext_list_price1\", \"ws_ext_tax1\", \"ws_coupon_amt1\", \"ws_ext_ship_cost1\", \"ws_net_paid1\", \"ws_net_paid_inc_tax1\", \"ws_net_paid_inc_ship1\", \"ws_net_paid_inc_ship_tax1\", \"ws_net_profit1\")\r\n                                                        WHERE \"ws_list_price1\" >= 226 AND \"ws_list_price1\" <= 255\r\n                                                        GROUP BY \"ws_ship_date_sk1\", \"ws_ship_addr_sk1\", \"ws_web_site_sk1\", \"ws_warehouse_sk1\", \"ws_order_number1\") AS \"t7\",\r\n                                                        (SELECT *\r\n                                                        FROM \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\")\r\n                                                        WHERE \"d_date0\" >= DATE '2002-06-01' AND \"d_date0\" <= DATE '2002-07-31') AS \"t8\"\r\n                                                WHERE \"t7\".\"ws_ship_date_sk1\" = \"t8\".\"d_date_sk0\"\r\n                                                GROUP BY \"t7\".\"ws_ship_addr_sk1\", \"t7\".\"ws_web_site_sk1\", \"t7\".\"ws_warehouse_sk1\", \"t7\".\"ws_order_number1\") AS \"t10\",\r\n                                                (SELECT *\r\n                                                FROM \"customer_address\" AS \"customer_address0\" (\"ca_address_sk0\", \"ca_address_id0\", \"ca_street_number0\", \"ca_street_name0\", \"ca_street_type0\", \"ca_suite_number0\", \"ca_city0\", \"ca_county0\", \"ca_state0\", \"ca_zip0\", \"ca_country0\", \"ca_gmt_offset0\", \"ca_location_type0\")\r\n                                                WHERE CAST(\"ca_state0\" AS CHAR(2)) IN ('DC', 'MO', 'OH', 'OK', 'PA', 'SD')) AS \"t11\"\r\n                                        WHERE \"t10\".\"ws_ship_addr_sk1\" = \"t11\".\"ca_address_sk0\"\r\n                                        GROUP BY \"t10\".\"ws_web_site_sk1\", \"t10\".\"ws_warehouse_sk1\", \"t10\".\"ws_order_number1\") AS \"t13\",\r\n                                        (SELECT *\r\n                                        FROM \"web_site\" AS \"web_site0\" (\"web_site_sk0\", \"web_site_id0\", \"web_rec_start_date0\", \"web_rec_end_date0\", \"web_name0\", \"web_open_date_sk0\", \"web_close_date_sk0\", \"web_class0\", \"web_manager0\", \"web_mkt_id0\", \"web_mkt_class0\", \"web_mkt_desc0\", \"web_market_manager0\", \"web_company_id0\", \"web_company_name0\", \"web_street_number0\", \"web_street_name0\", \"web_street_type0\", \"web_suite_number0\", \"web_city0\", \"web_county0\", \"web_state0\", \"web_zip0\", \"web_country0\", \"web_gmt_offset0\", \"web_tax_percentage0\")\r\n                                        WHERE \"web_gmt_offset0\" >= -5) AS \"t14\"\r\n                                WHERE \"t13\".\"ws_web_site_sk1\" = \"t14\".\"web_site_sk0\"\r\n                                GROUP BY \"t13\".\"ws_warehouse_sk1\", \"t13\".\"ws_order_number1\") AS \"t16\"\r\n                        WHERE \"t16\".\"ws_order_number1\" = \"web_sales0\".\"ws_order_number0\" AND \"t16\".\"ws_warehouse_sk1\" <> \"web_sales0\".\"ws_warehouse_sk0\"\r\n                        GROUP BY \"t16\".\"ws_warehouse_sk1\", \"t16\".\"ws_order_number1\") AS \"t18\"\r\n                WHERE \"t5\".\"ws_warehouse_sk\" = \"t18\".\"ws_warehouse_sk1\" AND \"t5\".\"ws_order_number\" = \"t18\".\"ws_order_number1\") AS \"t19\"\r\n            LEFT JOIN (SELECT \"wr_order_number\", TRUE AS \"$f1\"\r\n                FROM \"web_returns\"\r\n                WHERE \"wr_reason_sk\" IN (3, 6, 18, 30, 40)\r\n                GROUP BY \"wr_order_number\") AS \"t22\" ON \"t19\".\"ws_order_number\" = \"t22\".\"wr_order_number\"\r\n        WHERE \"t22\".\"$f1\" IS NULL\r\n        GROUP BY ROLLUP(\"t19\".\"ws_order_number\")) AS \"t26\"\r\nORDER BY 1\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 104.96, "used_rules": ["FILTER_SUB_QUERY_TO_CORRELATE", "FILTER_REDUCE_EXPRESSIONS", "AGGREGATE_EXPAND_DISTINCT_AGGREGATES", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_REDUCE_FUNCTIONS", "AGGREGATE_JOIN_TRANSPOSE_EXTENDED", "JOIN_EXTRACT_FILTER", "JOIN_PROJECT_RIGHT_TRANSPOSE", "FILTER_INTO_JOIN", "FILTER_PROJECT_TRANSPOSE", "FILTER_INTO_JOIN", "JOIN_PROJECT_BOTH_TRANSPOSE", "JOIN_EXTRACT_FILTER", "FILTER_INTO_JOIN", "FILTER_PROJECT_TRANSPOSE", "PROJECT_REDUCE_EXPRESSIONS", "AGGREGATE_PROJECT_MERGE", "JOIN_EXTRACT_FILTER"], "rewrite_time": 3933}
{"name": "query094_1", "input_sql": "select \n   count(distinct ws_order_number) as \"order count\"\n  ,sum(ws_ext_ship_cost) as \"total shipping cost\"\n  ,sum(ws_net_profit) as \"total net profit\"\nfrom\n   web_sales ws1\n  ,date_dim\n  ,customer_address\n  ,web_site\nwhere\n    d_date between '2000-6-01' and\n           cast('2000-6-01' as date) + interval '60' day\nand ws1.ws_ship_date_sk = d_date_sk\nand ws1.ws_ship_addr_sk = ca_address_sk\nand ca_state in ('IL','KY','NE'\n            ,'PA' ,'VT' ,'WI')\nand ws1.ws_web_site_sk = web_site_sk\nand web_gmt_offset >= -7\nand ws1.ws_list_price between 158 and 187\nand exists (select *\n            from web_sales ws2\n            where ws1.ws_order_number = ws2.ws_order_number\n              and ws1.ws_warehouse_sk <> ws2.ws_warehouse_sk)\nand not exists(select *\n               from web_returns wr1\n               where ws1.ws_order_number = wr1.wr_order_number\n               and wr1.wr_reason_sk in (18, 23, 26, 35, 74)\n               )\norder by count(distinct ws_order_number)\nlimit 100;", "input_cost": 61.63, "output_sql": "SELECT COUNT(\"t26\".\"ws_order_number\") FILTER (WHERE \"t26\".\"$g_0\") AS \"order count\", MIN(\"t26\".\"total shipping cost\") FILTER (WHERE \"t26\".\"$g_1\") AS \"total shipping cost\", MIN(\"t26\".\"total net profit\") FILTER (WHERE \"t26\".\"$g_1\") AS \"total net profit\"\r\nFROM (SELECT \"t19\".\"ws_order_number\", CASE WHEN COUNT(\"t19\".\"ws_ext_ship_cost\") = 0 THEN NULL ELSE COALESCE(SUM(\"t19\".\"ws_ext_ship_cost\"), 0) END AS \"total shipping cost\", CASE WHEN COUNT(\"t19\".\"ws_net_profit\") = 0 THEN NULL ELSE COALESCE(SUM(\"t19\".\"ws_net_profit\"), 0) END AS \"total net profit\", GROUPING(\"t19\".\"ws_order_number\") = 0 AS \"$g_0\", GROUPING(\"t19\".\"ws_order_number\") = 1 AS \"$g_1\"\r\n        FROM (SELECT *\r\n                FROM (SELECT *\r\n                        FROM (SELECT *\r\n                                FROM (SELECT *\r\n                                        FROM (SELECT *\r\n                                                FROM \"web_sales\"\r\n                                                WHERE \"ws_list_price\" >= 158 AND \"ws_list_price\" <= 187) AS \"t\",\r\n                                                (SELECT *\r\n                                                FROM \"date_dim\"\r\n                                                WHERE \"d_date\" >= DATE '2000-06-01' AND \"d_date\" <= DATE '2000-07-31') AS \"t0\"\r\n                                        WHERE \"t\".\"ws_ship_date_sk\" = \"t0\".\"d_date_sk\") AS \"t1\",\r\n                                        (SELECT *\r\n                                        FROM \"customer_address\"\r\n                                        WHERE CAST(\"ca_state\" AS CHAR(2)) IN ('IL', 'KY', 'NE', 'PA', 'VT', 'WI')) AS \"t2\"\r\n                                WHERE \"t1\".\"ws_ship_addr_sk\" = \"t2\".\"ca_address_sk\") AS \"t3\",\r\n                                (SELECT *\r\n                                FROM \"web_site\"\r\n                                WHERE \"web_gmt_offset\" >= -7) AS \"t4\"\r\n                        WHERE \"t3\".\"ws_web_site_sk\" = \"t4\".\"web_site_sk\") AS \"t5\",\r\n                        (SELECT \"t16\".\"ws_warehouse_sk1\", \"t16\".\"ws_order_number1\"\r\n                        FROM \"web_sales\" AS \"web_sales0\" (\"ws_sold_date_sk0\", \"ws_sold_time_sk0\", \"ws_ship_date_sk0\", \"ws_item_sk0\", \"ws_bill_customer_sk0\", \"ws_bill_cdemo_sk0\", \"ws_bill_hdemo_sk0\", \"ws_bill_addr_sk0\", \"ws_ship_customer_sk0\", \"ws_ship_cdemo_sk0\", \"ws_ship_hdemo_sk0\", \"ws_ship_addr_sk0\", \"ws_web_page_sk0\", \"ws_web_site_sk0\", \"ws_ship_mode_sk0\", \"ws_warehouse_sk0\", \"ws_promo_sk0\", \"ws_order_number0\", \"ws_quantity0\", \"ws_wholesale_cost0\", \"ws_list_price0\", \"ws_sales_price0\", \"ws_ext_discount_amt0\", \"ws_ext_sales_price0\", \"ws_ext_wholesale_cost0\", \"ws_ext_list_price0\", \"ws_ext_tax0\", \"ws_coupon_amt0\", \"ws_ext_ship_cost0\", \"ws_net_paid0\", \"ws_net_paid_inc_tax0\", \"ws_net_paid_inc_ship0\", \"ws_net_paid_inc_ship_tax0\", \"ws_net_profit0\"),\r\n                                (SELECT \"t13\".\"ws_warehouse_sk1\", \"t13\".\"ws_order_number1\"\r\n                                FROM (SELECT \"t10\".\"ws_web_site_sk1\", \"t10\".\"ws_warehouse_sk1\", \"t10\".\"ws_order_number1\"\r\n                                        FROM (SELECT \"t7\".\"ws_ship_addr_sk1\", \"t7\".\"ws_web_site_sk1\", \"t7\".\"ws_warehouse_sk1\", \"t7\".\"ws_order_number1\"\r\n                                                FROM (SELECT \"ws_ship_date_sk1\", \"ws_ship_addr_sk1\", \"ws_web_site_sk1\", \"ws_warehouse_sk1\", \"ws_order_number1\"\r\n                                                        FROM \"web_sales\" AS \"web_sales1\" (\"ws_sold_date_sk1\", \"ws_sold_time_sk1\", \"ws_ship_date_sk1\", \"ws_item_sk1\", \"ws_bill_customer_sk1\", \"ws_bill_cdemo_sk1\", \"ws_bill_hdemo_sk1\", \"ws_bill_addr_sk1\", \"ws_ship_customer_sk1\", \"ws_ship_cdemo_sk1\", \"ws_ship_hdemo_sk1\", \"ws_ship_addr_sk1\", \"ws_web_page_sk1\", \"ws_web_site_sk1\", \"ws_ship_mode_sk1\", \"ws_warehouse_sk1\", \"ws_promo_sk1\", \"ws_order_number1\", \"ws_quantity1\", \"ws_wholesale_cost1\", \"ws_list_price1\", \"ws_sales_price1\", \"ws_ext_discount_amt1\", \"ws_ext_sales_price1\", \"ws_ext_wholesale_cost1\", \"ws_ext_list_price1\", \"ws_ext_tax1\", \"ws_coupon_amt1\", \"ws_ext_ship_cost1\", \"ws_net_paid1\", \"ws_net_paid_inc_tax1\", \"ws_net_paid_inc_ship1\", \"ws_net_paid_inc_ship_tax1\", \"ws_net_profit1\")\r\n                                                        WHERE \"ws_list_price1\" >= 158 AND \"ws_list_price1\" <= 187\r\n                                                        GROUP BY \"ws_ship_date_sk1\", \"ws_ship_addr_sk1\", \"ws_web_site_sk1\", \"ws_warehouse_sk1\", \"ws_order_number1\") AS \"t7\",\r\n                                                        (SELECT *\r\n                                                        FROM \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\")\r\n                                                        WHERE \"d_date0\" >= DATE '2000-06-01' AND \"d_date0\" <= DATE '2000-07-31') AS \"t8\"\r\n                                                WHERE \"t7\".\"ws_ship_date_sk1\" = \"t8\".\"d_date_sk0\"\r\n                                                GROUP BY \"t7\".\"ws_ship_addr_sk1\", \"t7\".\"ws_web_site_sk1\", \"t7\".\"ws_warehouse_sk1\", \"t7\".\"ws_order_number1\") AS \"t10\",\r\n                                                (SELECT *\r\n                                                FROM \"customer_address\" AS \"customer_address0\" (\"ca_address_sk0\", \"ca_address_id0\", \"ca_street_number0\", \"ca_street_name0\", \"ca_street_type0\", \"ca_suite_number0\", \"ca_city0\", \"ca_county0\", \"ca_state0\", \"ca_zip0\", \"ca_country0\", \"ca_gmt_offset0\", \"ca_location_type0\")\r\n                                                WHERE CAST(\"ca_state0\" AS CHAR(2)) IN ('IL', 'KY', 'NE', 'PA', 'VT', 'WI')) AS \"t11\"\r\n                                        WHERE \"t10\".\"ws_ship_addr_sk1\" = \"t11\".\"ca_address_sk0\"\r\n                                        GROUP BY \"t10\".\"ws_web_site_sk1\", \"t10\".\"ws_warehouse_sk1\", \"t10\".\"ws_order_number1\") AS \"t13\",\r\n                                        (SELECT *\r\n                                        FROM \"web_site\" AS \"web_site0\" (\"web_site_sk0\", \"web_site_id0\", \"web_rec_start_date0\", \"web_rec_end_date0\", \"web_name0\", \"web_open_date_sk0\", \"web_close_date_sk0\", \"web_class0\", \"web_manager0\", \"web_mkt_id0\", \"web_mkt_class0\", \"web_mkt_desc0\", \"web_market_manager0\", \"web_company_id0\", \"web_company_name0\", \"web_street_number0\", \"web_street_name0\", \"web_street_type0\", \"web_suite_number0\", \"web_city0\", \"web_county0\", \"web_state0\", \"web_zip0\", \"web_country0\", \"web_gmt_offset0\", \"web_tax_percentage0\")\r\n                                        WHERE \"web_gmt_offset0\" >= -7) AS \"t14\"\r\n                                WHERE \"t13\".\"ws_web_site_sk1\" = \"t14\".\"web_site_sk0\"\r\n                                GROUP BY \"t13\".\"ws_warehouse_sk1\", \"t13\".\"ws_order_number1\") AS \"t16\"\r\n                        WHERE \"t16\".\"ws_order_number1\" = \"web_sales0\".\"ws_order_number0\" AND \"t16\".\"ws_warehouse_sk1\" <> \"web_sales0\".\"ws_warehouse_sk0\"\r\n                        GROUP BY \"t16\".\"ws_warehouse_sk1\", \"t16\".\"ws_order_number1\") AS \"t18\"\r\n                WHERE \"t5\".\"ws_warehouse_sk\" = \"t18\".\"ws_warehouse_sk1\" AND \"t5\".\"ws_order_number\" = \"t18\".\"ws_order_number1\") AS \"t19\"\r\n            LEFT JOIN (SELECT \"wr_order_number\", TRUE AS \"$f1\"\r\n                FROM \"web_returns\"\r\n                WHERE \"wr_reason_sk\" IN (18, 23, 26, 35, 74)\r\n                GROUP BY \"wr_order_number\") AS \"t22\" ON \"t19\".\"ws_order_number\" = \"t22\".\"wr_order_number\"\r\n        WHERE \"t22\".\"$f1\" IS NULL\r\n        GROUP BY ROLLUP(\"t19\".\"ws_order_number\")) AS \"t26\"\r\nORDER BY 1\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 104.96, "used_rules": ["FILTER_SUB_QUERY_TO_CORRELATE", "FILTER_REDUCE_EXPRESSIONS", "AGGREGATE_EXPAND_DISTINCT_AGGREGATES", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_REDUCE_FUNCTIONS", "AGGREGATE_JOIN_TRANSPOSE_EXTENDED", "JOIN_EXTRACT_FILTER", "JOIN_PROJECT_RIGHT_TRANSPOSE", "FILTER_INTO_JOIN", "FILTER_PROJECT_TRANSPOSE", "FILTER_INTO_JOIN", "JOIN_PROJECT_BOTH_TRANSPOSE", "JOIN_EXTRACT_FILTER", "FILTER_INTO_JOIN", "FILTER_PROJECT_TRANSPOSE", "PROJECT_REDUCE_EXPRESSIONS", "AGGREGATE_PROJECT_MERGE", "JOIN_EXTRACT_FILTER"], "rewrite_time": 4200}
{"name": "query099_0", "input_sql": "select \n   substring(w_warehouse_name,1,20)\n  ,sm_type\n  ,cc_name\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk <= 30 ) then 1 else 0 end)  as \"30 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 30) and\n                 (cs_ship_date_sk - cs_sold_date_sk <= 60) then 1 else 0 end )  as \"31-60 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 60) and\n                 (cs_ship_date_sk - cs_sold_date_sk <= 90) then 1 else 0 end)  as \"61-90 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 90) and\n                 (cs_ship_date_sk - cs_sold_date_sk <= 120) then 1 else 0 end)  as \"91-120 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk  > 120) then 1 else 0 end)  as \">120 days\"\nfrom\n   catalog_sales\n  ,warehouse\n  ,ship_mode\n  ,call_center\n  ,date_dim\nwhere\nd_month_seq between 1201 and 1201 + 23\nand cs_ship_date_sk   = d_date_sk\nand cs_warehouse_sk   = w_warehouse_sk\nand cs_ship_mode_sk   = sm_ship_mode_sk\nand cs_call_center_sk = cc_call_center_sk\nand cs_list_price between 248 and 277\nand sm_type = 'LIBRARY'\nand cc_class = 'small'\nand w_gmt_offset = -5\ngroup by\n   substring(w_warehouse_name,1,20)\n  ,sm_type\n  ,cc_name\norder by substring(w_warehouse_name,1,20)\n        ,sm_type\n        ,cc_name\nlimit 100;", "input_cost": 50.48, "output_sql": "SELECT SUBSTRING(\"t5\".\"w_warehouse_name\", 1, 20), \"t5\".\"sm_type\", \"t5\".\"cc_name\", COALESCE(SUM(CASE WHEN \"t5\".\"cs_ship_date_sk\" - \"t5\".\"cs_sold_date_sk\" <= 30 THEN 1 ELSE 0 END), 0) AS \"30 days\", COALESCE(SUM(CASE WHEN \"t5\".\"cs_ship_date_sk\" - \"t5\".\"cs_sold_date_sk\" > 30 AND \"t5\".\"cs_ship_date_sk\" - \"t5\".\"cs_sold_date_sk\" <= 60 THEN 1 ELSE 0 END), 0) AS \"31-60 days\", COALESCE(SUM(CASE WHEN \"t5\".\"cs_ship_date_sk\" - \"t5\".\"cs_sold_date_sk\" > 60 AND \"t5\".\"cs_ship_date_sk\" - \"t5\".\"cs_sold_date_sk\" <= 90 THEN 1 ELSE 0 END), 0) AS \"61-90 days\", COALESCE(SUM(CASE WHEN \"t5\".\"cs_ship_date_sk\" - \"t5\".\"cs_sold_date_sk\" > 90 AND \"t5\".\"cs_ship_date_sk\" - \"t5\".\"cs_sold_date_sk\" <= 120 THEN 1 ELSE 0 END), 0) AS \"91-120 days\", COALESCE(SUM(CASE WHEN \"t5\".\"cs_ship_date_sk\" - \"t5\".\"cs_sold_date_sk\" > 120 THEN 1 ELSE 0 END), 0) AS \">120 days\"\r\nFROM (SELECT *\r\n        FROM (SELECT *\r\n                FROM (SELECT *\r\n                        FROM (SELECT *\r\n                                FROM \"catalog_sales\"\r\n                                WHERE \"cs_list_price\" >= 248 AND \"cs_list_price\" <= 277) AS \"t\",\r\n                                (SELECT *\r\n                                FROM \"warehouse\"\r\n                                WHERE CAST(\"w_gmt_offset\" AS DECIMAL(12, 2)) = -5) AS \"t0\"\r\n                        WHERE \"t\".\"cs_warehouse_sk\" = \"t0\".\"w_warehouse_sk\") AS \"t1\",\r\n                        (SELECT *\r\n                        FROM \"ship_mode\"\r\n                        WHERE \"sm_type\" = 'LIBRARY') AS \"t2\"\r\n                WHERE \"t1\".\"cs_ship_mode_sk\" = \"t2\".\"sm_ship_mode_sk\") AS \"t3\",\r\n                (SELECT *\r\n                FROM \"call_center\"\r\n                WHERE \"cc_class\" = 'small') AS \"t4\"\r\n        WHERE \"t3\".\"cs_call_center_sk\" = \"t4\".\"cc_call_center_sk\") AS \"t5\",\r\n        (SELECT *\r\n        FROM \"date_dim\"\r\n        WHERE \"d_month_seq\" >= 1201 AND \"d_month_seq\" <= 1224) AS \"t6\"\r\nWHERE \"t5\".\"cs_ship_date_sk\" = \"t6\".\"d_date_sk\"\r\nGROUP BY SUBSTRING(\"t5\".\"w_warehouse_name\", 1, 20), \"t5\".\"sm_type\", \"t5\".\"cc_name\"\r\nORDER BY 1, \"t5\".\"sm_type\", \"t5\".\"cc_name\"\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 50.48, "used_rules": ["FILTER_INTO_JOIN", "FILTER_REDUCE_EXPRESSIONS", "PROJECT_TO_CALC", "AGGREGATE_REDUCE_FUNCTIONS", "JOIN_EXTRACT_FILTER"], "rewrite_time": 1396}
{"name": "query099_1", "input_sql": "select \n   substring(w_warehouse_name,1,20)\n  ,sm_type\n  ,cc_name\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk <= 30 ) then 1 else 0 end)  as \"30 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 30) and\n                 (cs_ship_date_sk - cs_sold_date_sk <= 60) then 1 else 0 end )  as \"31-60 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 60) and\n                 (cs_ship_date_sk - cs_sold_date_sk <= 90) then 1 else 0 end)  as \"61-90 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 90) and\n                 (cs_ship_date_sk - cs_sold_date_sk <= 120) then 1 else 0 end)  as \"91-120 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk  > 120) then 1 else 0 end)  as \">120 days\"\nfrom\n   catalog_sales\n  ,warehouse\n  ,ship_mode\n  ,call_center\n  ,date_dim\nwhere\nd_month_seq between 1212 and 1212 + 23\nand cs_ship_date_sk   = d_date_sk\nand cs_warehouse_sk   = w_warehouse_sk\nand cs_ship_mode_sk   = sm_ship_mode_sk\nand cs_call_center_sk = cc_call_center_sk\nand cs_list_price between 13 and 42\nand sm_type = 'EXPRESS'\nand cc_class = 'small'\nand w_gmt_offset = -5\ngroup by\n   substring(w_warehouse_name,1,20)\n  ,sm_type\n  ,cc_name\norder by substring(w_warehouse_name,1,20)\n        ,sm_type\n        ,cc_name\nlimit 100;", "input_cost": 50.48, "output_sql": "SELECT SUBSTRING(\"t5\".\"w_warehouse_name\", 1, 20), \"t5\".\"sm_type\", \"t5\".\"cc_name\", COALESCE(SUM(CASE WHEN \"t5\".\"cs_ship_date_sk\" - \"t5\".\"cs_sold_date_sk\" <= 30 THEN 1 ELSE 0 END), 0) AS \"30 days\", COALESCE(SUM(CASE WHEN \"t5\".\"cs_ship_date_sk\" - \"t5\".\"cs_sold_date_sk\" > 30 AND \"t5\".\"cs_ship_date_sk\" - \"t5\".\"cs_sold_date_sk\" <= 60 THEN 1 ELSE 0 END), 0) AS \"31-60 days\", COALESCE(SUM(CASE WHEN \"t5\".\"cs_ship_date_sk\" - \"t5\".\"cs_sold_date_sk\" > 60 AND \"t5\".\"cs_ship_date_sk\" - \"t5\".\"cs_sold_date_sk\" <= 90 THEN 1 ELSE 0 END), 0) AS \"61-90 days\", COALESCE(SUM(CASE WHEN \"t5\".\"cs_ship_date_sk\" - \"t5\".\"cs_sold_date_sk\" > 90 AND \"t5\".\"cs_ship_date_sk\" - \"t5\".\"cs_sold_date_sk\" <= 120 THEN 1 ELSE 0 END), 0) AS \"91-120 days\", COALESCE(SUM(CASE WHEN \"t5\".\"cs_ship_date_sk\" - \"t5\".\"cs_sold_date_sk\" > 120 THEN 1 ELSE 0 END), 0) AS \">120 days\"\r\nFROM (SELECT *\r\n        FROM (SELECT *\r\n                FROM (SELECT *\r\n                        FROM (SELECT *\r\n                                FROM \"catalog_sales\"\r\n                                WHERE \"cs_list_price\" >= 13 AND \"cs_list_price\" <= 42) AS \"t\",\r\n                                (SELECT *\r\n                                FROM \"warehouse\"\r\n                                WHERE CAST(\"w_gmt_offset\" AS DECIMAL(12, 2)) = -5) AS \"t0\"\r\n                        WHERE \"t\".\"cs_warehouse_sk\" = \"t0\".\"w_warehouse_sk\") AS \"t1\",\r\n                        (SELECT *\r\n                        FROM \"ship_mode\"\r\n                        WHERE \"sm_type\" = 'EXPRESS') AS \"t2\"\r\n                WHERE \"t1\".\"cs_ship_mode_sk\" = \"t2\".\"sm_ship_mode_sk\") AS \"t3\",\r\n                (SELECT *\r\n                FROM \"call_center\"\r\n                WHERE \"cc_class\" = 'small') AS \"t4\"\r\n        WHERE \"t3\".\"cs_call_center_sk\" = \"t4\".\"cc_call_center_sk\") AS \"t5\",\r\n        (SELECT *\r\n        FROM \"date_dim\"\r\n        WHERE \"d_month_seq\" >= 1212 AND \"d_month_seq\" <= 1235) AS \"t6\"\r\nWHERE \"t5\".\"cs_ship_date_sk\" = \"t6\".\"d_date_sk\"\r\nGROUP BY SUBSTRING(\"t5\".\"w_warehouse_name\", 1, 20), \"t5\".\"sm_type\", \"t5\".\"cc_name\"\r\nORDER BY 1, \"t5\".\"sm_type\", \"t5\".\"cc_name\"\r\nFETCH NEXT 100 ROWS ONLY;", "output_cost": 50.48, "used_rules": ["FILTER_INTO_JOIN", "FILTER_REDUCE_EXPRESSIONS", "PROJECT_TO_CALC", "AGGREGATE_REDUCE_FUNCTIONS", "JOIN_EXTRACT_FILTER"], "rewrite_time": 1333}
{"name": "query100_0", "input_sql": "select  item1.i_item_sk, item2.i_item_sk, count(*) as cnt\nFROM item AS item1,\nitem AS item2,\nstore_sales AS s1,\nstore_sales AS s2,\ndate_dim,\ncustomer,\ncustomer_address,\ncustomer_demographics\nWHERE\nitem1.i_item_sk < item2.i_item_sk\nAND s1.ss_ticket_number = s2.ss_ticket_number\nAND s1.ss_item_sk = item1.i_item_sk and s2.ss_item_sk = item2.i_item_sk\nAND s1.ss_customer_sk = c_customer_sk\nand c_current_addr_sk = ca_address_sk\nand c_current_cdemo_sk = cd_demo_sk\nAND d_year between 2000 and 2000 + 1\nand d_date_sk = s1.ss_sold_date_sk\nand item1.i_category in ('Books', 'Shoes')\nand item2.i_manager_id between 48 and 67\nand cd_marital_status = 'W'\nand cd_education_status = '4 yr Degree'\nand s1.ss_list_price between 80 and 94\nand s2.ss_list_price between 80 and 94\nGROUP BY item1.i_item_sk, item2.i_item_sk\nORDER BY cnt;", "input_cost": 59.03, "output_sql": "SELECT \"t18\".\"i_item_sk\", \"t18\".\"i_item_sk0\", COALESCE(SUM(\"t18\".\"cnt\"), 0) AS \"cnt\"\r\nFROM (SELECT \"t15\".\"i_item_sk\", \"t15\".\"i_item_sk0\", \"t15\".\"c_current_cdemo_sk\", COALESCE(SUM(\"t15\".\"cnt\"), 0) AS \"cnt\"\r\n        FROM (SELECT \"t12\".\"i_item_sk\", \"t12\".\"i_item_sk0\", \"t13\".\"c_current_cdemo_sk\", \"t13\".\"c_current_addr_sk\", COALESCE(SUM(\"t12\".\"cnt\"), 0) AS \"cnt\"\r\n                FROM (SELECT \"t8\".\"i_item_sk\", \"t8\".\"i_item_sk0\", \"t8\".\"ss_customer_sk\", COALESCE(SUM(\"t8\".\"cnt\"), 0) AS \"cnt\"\r\n                        FROM (SELECT \"t4\".\"i_item_sk\", \"t4\".\"i_item_sk0\", \"t4\".\"ss_sold_date_sk\", \"t4\".\"ss_customer_sk\", COALESCE(SUM(\"t4\".\"cnt\"), 0) AS \"cnt\"\r\n                                FROM (SELECT \"t1\".\"i_item_sk\", \"t1\".\"i_item_sk0\", \"t2\".\"ss_sold_date_sk\", \"t2\".\"ss_customer_sk\", \"t2\".\"ss_ticket_number\", COUNT(*) AS \"cnt\"\r\n                                        FROM (SELECT *\r\n                                                FROM (SELECT *\r\n                                                        FROM \"item\"\r\n                                                        WHERE CAST(\"i_category\" AS CHAR(5)) IN ('Books', 'Shoes')) AS \"t\",\r\n                                                        (SELECT *\r\n                                                        FROM \"item\" AS \"item0\" (\"i_item_sk0\", \"i_item_id0\", \"i_rec_start_date0\", \"i_rec_end_date0\", \"i_item_desc0\", \"i_current_price0\", \"i_wholesale_cost0\", \"i_brand_id0\", \"i_brand0\", \"i_class_id0\", \"i_class0\", \"i_category_id0\", \"i_category0\", \"i_manufact_id0\", \"i_manufact0\", \"i_size0\", \"i_formulation0\", \"i_color0\", \"i_units0\", \"i_container0\", \"i_manager_id0\", \"i_product_name0\")\r\n                                                        WHERE \"i_manager_id0\" >= 48 AND \"i_manager_id0\" <= 67) AS \"t0\"\r\n                                                WHERE \"t\".\"i_item_sk\" < \"t0\".\"i_item_sk0\") AS \"t1\",\r\n                                                (SELECT *\r\n                                                FROM \"store_sales\"\r\n                                                WHERE \"ss_list_price\" >= 80 AND \"ss_list_price\" <= 94) AS \"t2\"\r\n                                        WHERE \"t2\".\"ss_item_sk\" = \"t1\".\"i_item_sk\"\r\n                                        GROUP BY \"t1\".\"i_item_sk\", \"t1\".\"i_item_sk0\", \"t2\".\"ss_sold_date_sk\", \"t2\".\"ss_customer_sk\", \"t2\".\"ss_ticket_number\") AS \"t4\",\r\n                                        (SELECT \"ss_item_sk0\" AS \"ss_sold_date_sk0\", \"ss_ticket_number0\" AS \"ss_sold_time_sk0\"\r\n                                        FROM \"store_sales\" AS \"store_sales0\" (\"ss_sold_date_sk0\", \"ss_sold_time_sk0\", \"ss_item_sk0\", \"ss_customer_sk0\", \"ss_cdemo_sk0\", \"ss_hdemo_sk0\", \"ss_addr_sk0\", \"ss_store_sk0\", \"ss_promo_sk0\", \"ss_ticket_number0\", \"ss_quantity0\", \"ss_wholesale_cost0\", \"ss_list_price0\", \"ss_sales_price0\", \"ss_ext_discount_amt0\", \"ss_ext_sales_price0\", \"ss_ext_wholesale_cost0\", \"ss_ext_list_price0\", \"ss_ext_tax0\", \"ss_coupon_amt0\", \"ss_net_paid0\", \"ss_net_paid_inc_tax0\", \"ss_net_profit0\")\r\n                                        WHERE \"ss_list_price0\" >= 80 AND \"ss_list_price0\" <= 94) AS \"t6\"\r\n                                WHERE \"t4\".\"ss_ticket_number\" = \"t6\".\"ss_sold_time_sk0\" AND \"t6\".\"ss_sold_date_sk0\" = \"t4\".\"i_item_sk0\"\r\n                                GROUP BY \"t4\".\"i_item_sk\", \"t4\".\"i_item_sk0\", \"t4\".\"ss_sold_date_sk\", \"t4\".\"ss_customer_sk\") AS \"t8\",\r\n                                (SELECT \"d_date_sk\"\r\n                                FROM \"date_dim\"\r\n                                WHERE \"d_year\" >= 2000 AND \"d_year\" <= 2001) AS \"t10\"\r\n                        WHERE \"t10\".\"d_date_sk\" = \"t8\".\"ss_sold_date_sk\"\r\n                        GROUP BY \"t8\".\"i_item_sk\", \"t8\".\"i_item_sk0\", \"t8\".\"ss_customer_sk\") AS \"t12\",\r\n                        (SELECT \"c_customer_sk\", \"c_current_cdemo_sk\", \"c_current_addr_sk\"\r\n                        FROM \"customer\") AS \"t13\"\r\n                WHERE \"t12\".\"ss_customer_sk\" = \"t13\".\"c_customer_sk\"\r\n                GROUP BY \"t12\".\"i_item_sk\", \"t12\".\"i_item_sk0\", \"t13\".\"c_current_cdemo_sk\", \"t13\".\"c_current_addr_sk\") AS \"t15\",\r\n                (SELECT \"ca_address_sk\"\r\n                FROM \"customer_address\") AS \"t16\"\r\n        WHERE \"t15\".\"c_current_addr_sk\" = \"t16\".\"ca_address_sk\"\r\n        GROUP BY \"t15\".\"i_item_sk\", \"t15\".\"i_item_sk0\", \"t15\".\"c_current_cdemo_sk\") AS \"t18\",\r\n        (SELECT \"cd_demo_sk\"\r\n        FROM \"customer_demographics\"\r\n        WHERE \"cd_marital_status\" = 'W' AND \"cd_education_status\" = '4 yr Degree') AS \"t20\"\r\nWHERE \"t18\".\"c_current_cdemo_sk\" = \"t20\".\"cd_demo_sk\"\r\nGROUP BY \"t18\".\"i_item_sk\", \"t18\".\"i_item_sk0\"\r\nORDER BY 3;", "output_cost": 76.81, "used_rules": ["FILTER_INTO_JOIN", "FILTER_REDUCE_EXPRESSIONS", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_JOIN_TRANSPOSE_EXTENDED", "PROJECT_REMOVE", "PROJECT_TO_CALC", "JOIN_EXTRACT_FILTER"], "rewrite_time": 1742}
{"name": "query100_1", "input_sql": "select  item1.i_item_sk, item2.i_item_sk, count(*) as cnt\nFROM item AS item1,\nitem AS item2,\nstore_sales AS s1,\nstore_sales AS s2,\ndate_dim,\ncustomer,\ncustomer_address,\ncustomer_demographics\nWHERE\nitem1.i_item_sk < item2.i_item_sk\nAND s1.ss_ticket_number = s2.ss_ticket_number\nAND s1.ss_item_sk = item1.i_item_sk and s2.ss_item_sk = item2.i_item_sk\nAND s1.ss_customer_sk = c_customer_sk\nand c_current_addr_sk = ca_address_sk\nand c_current_cdemo_sk = cd_demo_sk\nAND d_year between 1999 and 1999 + 1\nand d_date_sk = s1.ss_sold_date_sk\nand item1.i_category in ('Books', 'Home')\nand item2.i_manager_id between 27 and 46\nand cd_marital_status = 'S'\nand cd_education_status = '2 yr Degree'\nand s1.ss_list_price between 95 and 109\nand s2.ss_list_price between 95 and 109\nGROUP BY item1.i_item_sk, item2.i_item_sk\nORDER BY cnt;", "input_cost": 59.03, "output_sql": "SELECT \"t18\".\"i_item_sk\", \"t18\".\"i_item_sk0\", COALESCE(SUM(\"t18\".\"cnt\"), 0) AS \"cnt\"\r\nFROM (SELECT \"t15\".\"i_item_sk\", \"t15\".\"i_item_sk0\", \"t15\".\"c_current_cdemo_sk\", COALESCE(SUM(\"t15\".\"cnt\"), 0) AS \"cnt\"\r\n        FROM (SELECT \"t12\".\"i_item_sk\", \"t12\".\"i_item_sk0\", \"t13\".\"c_current_cdemo_sk\", \"t13\".\"c_current_addr_sk\", COALESCE(SUM(\"t12\".\"cnt\"), 0) AS \"cnt\"\r\n                FROM (SELECT \"t8\".\"i_item_sk\", \"t8\".\"i_item_sk0\", \"t8\".\"ss_customer_sk\", COALESCE(SUM(\"t8\".\"cnt\"), 0) AS \"cnt\"\r\n                        FROM (SELECT \"t4\".\"i_item_sk\", \"t4\".\"i_item_sk0\", \"t4\".\"ss_sold_date_sk\", \"t4\".\"ss_customer_sk\", COALESCE(SUM(\"t4\".\"cnt\"), 0) AS \"cnt\"\r\n                                FROM (SELECT \"t1\".\"i_item_sk\", \"t1\".\"i_item_sk0\", \"t2\".\"ss_sold_date_sk\", \"t2\".\"ss_customer_sk\", \"t2\".\"ss_ticket_number\", COUNT(*) AS \"cnt\"\r\n                                        FROM (SELECT *\r\n                                                FROM (SELECT *\r\n                                                        FROM \"item\"\r\n                                                        WHERE \"i_category\" = 'Books' OR \"i_category\" = 'Home') AS \"t\",\r\n                                                        (SELECT *\r\n                                                        FROM \"item\" AS \"item0\" (\"i_item_sk0\", \"i_item_id0\", \"i_rec_start_date0\", \"i_rec_end_date0\", \"i_item_desc0\", \"i_current_price0\", \"i_wholesale_cost0\", \"i_brand_id0\", \"i_brand0\", \"i_class_id0\", \"i_class0\", \"i_category_id0\", \"i_category0\", \"i_manufact_id0\", \"i_manufact0\", \"i_size0\", \"i_formulation0\", \"i_color0\", \"i_units0\", \"i_container0\", \"i_manager_id0\", \"i_product_name0\")\r\n                                                        WHERE \"i_manager_id0\" >= 27 AND \"i_manager_id0\" <= 46) AS \"t0\"\r\n                                                WHERE \"t\".\"i_item_sk\" < \"t0\".\"i_item_sk0\") AS \"t1\",\r\n                                                (SELECT *\r\n                                                FROM \"store_sales\"\r\n                                                WHERE \"ss_list_price\" >= 95 AND \"ss_list_price\" <= 109) AS \"t2\"\r\n                                        WHERE \"t2\".\"ss_item_sk\" = \"t1\".\"i_item_sk\"\r\n                                        GROUP BY \"t1\".\"i_item_sk\", \"t1\".\"i_item_sk0\", \"t2\".\"ss_sold_date_sk\", \"t2\".\"ss_customer_sk\", \"t2\".\"ss_ticket_number\") AS \"t4\",\r\n                                        (SELECT \"ss_item_sk0\" AS \"ss_sold_date_sk0\", \"ss_ticket_number0\" AS \"ss_sold_time_sk0\"\r\n                                        FROM \"store_sales\" AS \"store_sales0\" (\"ss_sold_date_sk0\", \"ss_sold_time_sk0\", \"ss_item_sk0\", \"ss_customer_sk0\", \"ss_cdemo_sk0\", \"ss_hdemo_sk0\", \"ss_addr_sk0\", \"ss_store_sk0\", \"ss_promo_sk0\", \"ss_ticket_number0\", \"ss_quantity0\", \"ss_wholesale_cost0\", \"ss_list_price0\", \"ss_sales_price0\", \"ss_ext_discount_amt0\", \"ss_ext_sales_price0\", \"ss_ext_wholesale_cost0\", \"ss_ext_list_price0\", \"ss_ext_tax0\", \"ss_coupon_amt0\", \"ss_net_paid0\", \"ss_net_paid_inc_tax0\", \"ss_net_profit0\")\r\n                                        WHERE \"ss_list_price0\" >= 95 AND \"ss_list_price0\" <= 109) AS \"t6\"\r\n                                WHERE \"t4\".\"ss_ticket_number\" = \"t6\".\"ss_sold_time_sk0\" AND \"t6\".\"ss_sold_date_sk0\" = \"t4\".\"i_item_sk0\"\r\n                                GROUP BY \"t4\".\"i_item_sk\", \"t4\".\"i_item_sk0\", \"t4\".\"ss_sold_date_sk\", \"t4\".\"ss_customer_sk\") AS \"t8\",\r\n                                (SELECT \"d_date_sk\"\r\n                                FROM \"date_dim\"\r\n                                WHERE \"d_year\" >= 1999 AND \"d_year\" <= 2000) AS \"t10\"\r\n                        WHERE \"t10\".\"d_date_sk\" = \"t8\".\"ss_sold_date_sk\"\r\n                        GROUP BY \"t8\".\"i_item_sk\", \"t8\".\"i_item_sk0\", \"t8\".\"ss_customer_sk\") AS \"t12\",\r\n                        (SELECT \"c_customer_sk\", \"c_current_cdemo_sk\", \"c_current_addr_sk\"\r\n                        FROM \"customer\") AS \"t13\"\r\n                WHERE \"t12\".\"ss_customer_sk\" = \"t13\".\"c_customer_sk\"\r\n                GROUP BY \"t12\".\"i_item_sk\", \"t12\".\"i_item_sk0\", \"t13\".\"c_current_cdemo_sk\", \"t13\".\"c_current_addr_sk\") AS \"t15\",\r\n                (SELECT \"ca_address_sk\"\r\n                FROM \"customer_address\") AS \"t16\"\r\n        WHERE \"t15\".\"c_current_addr_sk\" = \"t16\".\"ca_address_sk\"\r\n        GROUP BY \"t15\".\"i_item_sk\", \"t15\".\"i_item_sk0\", \"t15\".\"c_current_cdemo_sk\") AS \"t18\",\r\n        (SELECT \"cd_demo_sk\"\r\n        FROM \"customer_demographics\"\r\n        WHERE \"cd_marital_status\" = 'S' AND \"cd_education_status\" = '2 yr Degree') AS \"t20\"\r\nWHERE \"t18\".\"c_current_cdemo_sk\" = \"t20\".\"cd_demo_sk\"\r\nGROUP BY \"t18\".\"i_item_sk\", \"t18\".\"i_item_sk0\"\r\nORDER BY 3;", "output_cost": 74.38, "used_rules": ["FILTER_INTO_JOIN", "FILTER_REDUCE_EXPRESSIONS", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_JOIN_TRANSPOSE_EXTENDED", "PROJECT_REMOVE", "PROJECT_TO_CALC", "JOIN_EXTRACT_FILTER"], "rewrite_time": 1826}
{"name": "query101_0", "input_sql": "select  c_customer_sk, c_first_name, c_last_name, count(*) as cnt\nFROM\nstore_sales,\nstore_returns,\nweb_sales,\ndate_dim d1,\ndate_dim d2,\nitem,\ncustomer,\ncustomer_address,\nhousehold_demographics\nWHERE\nss_ticket_number = sr_ticket_number\nAND ss_customer_sk = ws_bill_customer_sk\nAND ss_customer_sk = c_customer_sk\nAND c_current_addr_sk = ca_address_sk\nAND c_current_hdemo_sk = hd_demo_sk\nAND ss_item_sk = sr_item_sk\nAND sr_item_sk = ws_item_sk\nAND i_item_sk = ss_item_sk\nAND i_category IN ('Electronics', 'Shoes', 'Sports')\nAND sr_returned_date_sk = d1.d_date_sk\nAND ws_sold_date_sk = d2.d_date_sk\nAND d2.d_date between d1.d_date AND (d1.d_date + interval '90' day)\nAND ca_state in ('GA', 'KS', 'LA', 'ME', 'NC')\nAND d1.d_year = 1999\nAND hd_income_band_sk BETWEEN 2 AND 8\nAND hd_buy_potential = '501-1000'\nAND ss_sales_price / ss_list_price BETWEEN 73 * 0.01 AND 93 * 0.01\nGROUP BY c_customer_sk, c_first_name, c_last_name\nORDER BY cnt;", "input_cost": 56.69, "output_sql": "SELECT \"t16\".\"ss_customer_sk\", \"t16\".\"c_current_hdemo_sk\", \"t16\".\"c_current_addr_sk\", COALESCE(SUM(\"t16\".\"cnt_0\"), 0) AS \"cnt\"\r\nFROM (SELECT \"t12\".\"ss_customer_sk\", \"t12\".\"cnt\", \"t12\".\"c_current_hdemo_sk\", \"t12\".\"c_current_addr_sk\", COALESCE(SUM(\"t12\".\"c_first_name\"), 0) AS \"cnt_0\"\r\n        FROM (SELECT \"t10\".\"c_customer_sk\" AS \"ss_customer_sk\", \"t10\".\"c_current_hdemo_sk\" AS \"cnt\", \"t10\".\"c_current_addr_sk\" AS \"c_customer_sk\", \"t10\".\"c_first_name\" AS \"c_current_hdemo_sk\", \"t10\".\"c_last_name\" AS \"c_current_addr_sk\", \"t9\".\"cnt\" AS \"c_first_name\"\r\n                FROM (SELECT \"t5\".\"ss_customer_sk\", COALESCE(SUM(\"t5\".\"cnt\"), 0) AS \"cnt\"\r\n                        FROM (SELECT \"t3\".\"ss_item_sk\", \"t3\".\"ss_customer_sk\", COUNT(*) AS \"cnt\"\r\n                                FROM (SELECT *\r\n                                        FROM (SELECT *\r\n                                                FROM (SELECT *\r\n                                                        FROM (SELECT *\r\n                                                                FROM \"store_sales\"\r\n                                                                WHERE \"ss_sales_price\" / \"ss_list_price\" >= 0.73 AND \"ss_sales_price\" / \"ss_list_price\" <= 0.93) AS \"t\",\r\n                                                            \"store_returns\"\r\n                                                        WHERE \"t\".\"ss_ticket_number\" = \"store_returns\".\"sr_ticket_number\" AND \"t\".\"ss_item_sk\" = \"store_returns\".\"sr_item_sk\") AS \"t0\",\r\n                                                    \"web_sales\"\r\n                                                WHERE \"t0\".\"ss_customer_sk\" = \"web_sales\".\"ws_bill_customer_sk\" AND \"t0\".\"sr_item_sk\" = \"web_sales\".\"ws_item_sk\") AS \"t1\",\r\n                                                (SELECT *\r\n                                                FROM \"date_dim\"\r\n                                                WHERE \"d_year\" = 1999) AS \"t2\"\r\n                                        WHERE \"t1\".\"sr_returned_date_sk\" = \"t2\".\"d_date_sk\") AS \"t3\",\r\n                                    \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\")\r\n                                WHERE \"t3\".\"ws_sold_date_sk\" = \"date_dim0\".\"d_date_sk0\" AND \"date_dim0\".\"d_date0\" >= \"t3\".\"d_date\" AND \"date_dim0\".\"d_date0\" <= (\"t3\".\"d_date\" + INTERVAL '90' DAY)\r\n                                GROUP BY \"t3\".\"ss_item_sk\", \"t3\".\"ss_customer_sk\") AS \"t5\",\r\n                                (SELECT \"i_item_sk\"\r\n                                FROM \"item\"\r\n                                WHERE \"i_category\" = 'Electronics' OR \"i_category\" = 'Shoes' OR \"i_category\" = 'Sports') AS \"t7\"\r\n                        WHERE \"t7\".\"i_item_sk\" = \"t5\".\"ss_item_sk\"\r\n                        GROUP BY \"t5\".\"ss_customer_sk\") AS \"t9\",\r\n                        (SELECT \"c_customer_sk\", \"c_current_hdemo_sk\", \"c_current_addr_sk\", \"c_first_name\", \"c_last_name\"\r\n                        FROM \"customer\") AS \"t10\"\r\n                WHERE \"t9\".\"ss_customer_sk\" = \"t10\".\"c_customer_sk\") AS \"t12\",\r\n                (SELECT \"ca_address_sk\"\r\n                FROM \"customer_address\"\r\n                WHERE CAST(\"ca_state\" AS CHAR(2)) IN ('GA', 'KS', 'LA', 'ME', 'NC')) AS \"t14\"\r\n        WHERE \"t12\".\"c_customer_sk\" = \"t14\".\"ca_address_sk\"\r\n        GROUP BY \"t12\".\"ss_customer_sk\", \"t12\".\"cnt\", \"t12\".\"c_current_hdemo_sk\", \"t12\".\"c_current_addr_sk\") AS \"t16\",\r\n        (SELECT \"hd_demo_sk\"\r\n        FROM \"household_demographics\"\r\n        WHERE \"hd_income_band_sk\" >= 2 AND \"hd_income_band_sk\" <= 8 AND \"hd_buy_potential\" = '501-1000') AS \"t18\"\r\nWHERE \"t16\".\"cnt\" = \"t18\".\"hd_demo_sk\"\r\nGROUP BY \"t16\".\"ss_customer_sk\", \"t16\".\"c_current_hdemo_sk\", \"t16\".\"c_current_addr_sk\"\r\nORDER BY 4;", "output_cost": 70.89, "used_rules": ["FILTER_INTO_JOIN", "FILTER_REDUCE_EXPRESSIONS", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_JOIN_TRANSPOSE_EXTENDED", "PROJECT_TO_CALC", "JOIN_EXTRACT_FILTER"], "rewrite_time": 2033}
{"name": "query101_1", "input_sql": "select  c_customer_sk, c_first_name, c_last_name, count(*) as cnt\nFROM\nstore_sales,\nstore_returns,\nweb_sales,\ndate_dim d1,\ndate_dim d2,\nitem,\ncustomer,\ncustomer_address,\nhousehold_demographics\nWHERE\nss_ticket_number = sr_ticket_number\nAND ss_customer_sk = ws_bill_customer_sk\nAND ss_customer_sk = c_customer_sk\nAND c_current_addr_sk = ca_address_sk\nAND c_current_hdemo_sk = hd_demo_sk\nAND ss_item_sk = sr_item_sk\nAND sr_item_sk = ws_item_sk\nAND i_item_sk = ss_item_sk\nAND i_category IN ('Books', 'Jewelry', 'Music')\nAND sr_returned_date_sk = d1.d_date_sk\nAND ws_sold_date_sk = d2.d_date_sk\nAND d2.d_date between d1.d_date AND (d1.d_date + interval '90' day)\nAND ca_state in ('IN', 'MN', 'PA', 'TN', 'WI')\nAND d1.d_year = 2000\nAND hd_income_band_sk BETWEEN 10 AND 16\nAND hd_buy_potential = 'Unknown'\nAND ss_sales_price / ss_list_price BETWEEN 74 * 0.01 AND 94 * 0.01\nGROUP BY c_customer_sk, c_first_name, c_last_name\nORDER BY cnt;", "input_cost": 56.69, "output_sql": "SELECT \"t16\".\"ss_customer_sk\", \"t16\".\"c_current_hdemo_sk\", \"t16\".\"c_current_addr_sk\", COALESCE(SUM(\"t16\".\"cnt_0\"), 0) AS \"cnt\"\r\nFROM (SELECT \"t12\".\"ss_customer_sk\", \"t12\".\"cnt\", \"t12\".\"c_current_hdemo_sk\", \"t12\".\"c_current_addr_sk\", COALESCE(SUM(\"t12\".\"c_first_name\"), 0) AS \"cnt_0\"\r\n        FROM (SELECT \"t10\".\"c_customer_sk\" AS \"ss_customer_sk\", \"t10\".\"c_current_hdemo_sk\" AS \"cnt\", \"t10\".\"c_current_addr_sk\" AS \"c_customer_sk\", \"t10\".\"c_first_name\" AS \"c_current_hdemo_sk\", \"t10\".\"c_last_name\" AS \"c_current_addr_sk\", \"t9\".\"cnt\" AS \"c_first_name\"\r\n                FROM (SELECT \"t5\".\"ss_customer_sk\", COALESCE(SUM(\"t5\".\"cnt\"), 0) AS \"cnt\"\r\n                        FROM (SELECT \"t3\".\"ss_item_sk\", \"t3\".\"ss_customer_sk\", COUNT(*) AS \"cnt\"\r\n                                FROM (SELECT *\r\n                                        FROM (SELECT *\r\n                                                FROM (SELECT *\r\n                                                        FROM (SELECT *\r\n                                                                FROM \"store_sales\"\r\n                                                                WHERE \"ss_sales_price\" / \"ss_list_price\" >= 0.74 AND \"ss_sales_price\" / \"ss_list_price\" <= 0.94) AS \"t\",\r\n                                                            \"store_returns\"\r\n                                                        WHERE \"t\".\"ss_ticket_number\" = \"store_returns\".\"sr_ticket_number\" AND \"t\".\"ss_item_sk\" = \"store_returns\".\"sr_item_sk\") AS \"t0\",\r\n                                                    \"web_sales\"\r\n                                                WHERE \"t0\".\"ss_customer_sk\" = \"web_sales\".\"ws_bill_customer_sk\" AND \"t0\".\"sr_item_sk\" = \"web_sales\".\"ws_item_sk\") AS \"t1\",\r\n                                                (SELECT *\r\n                                                FROM \"date_dim\"\r\n                                                WHERE \"d_year\" = 2000) AS \"t2\"\r\n                                        WHERE \"t1\".\"sr_returned_date_sk\" = \"t2\".\"d_date_sk\") AS \"t3\",\r\n                                    \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\")\r\n                                WHERE \"t3\".\"ws_sold_date_sk\" = \"date_dim0\".\"d_date_sk0\" AND \"date_dim0\".\"d_date0\" >= \"t3\".\"d_date\" AND \"date_dim0\".\"d_date0\" <= (\"t3\".\"d_date\" + INTERVAL '90' DAY)\r\n                                GROUP BY \"t3\".\"ss_item_sk\", \"t3\".\"ss_customer_sk\") AS \"t5\",\r\n                                (SELECT \"i_item_sk\"\r\n                                FROM \"item\"\r\n                                WHERE CAST(\"i_category\" AS CHAR(5)) IN ('Books', 'Music') OR \"i_category\" = 'Jewelry') AS \"t7\"\r\n                        WHERE \"t7\".\"i_item_sk\" = \"t5\".\"ss_item_sk\"\r\n                        GROUP BY \"t5\".\"ss_customer_sk\") AS \"t9\",\r\n                        (SELECT \"c_customer_sk\", \"c_current_hdemo_sk\", \"c_current_addr_sk\", \"c_first_name\", \"c_last_name\"\r\n                        FROM \"customer\") AS \"t10\"\r\n                WHERE \"t9\".\"ss_customer_sk\" = \"t10\".\"c_customer_sk\") AS \"t12\",\r\n                (SELECT \"ca_address_sk\"\r\n                FROM \"customer_address\"\r\n                WHERE CAST(\"ca_state\" AS CHAR(2)) IN ('IN', 'MN', 'PA', 'TN', 'WI')) AS \"t14\"\r\n        WHERE \"t12\".\"c_customer_sk\" = \"t14\".\"ca_address_sk\"\r\n        GROUP BY \"t12\".\"ss_customer_sk\", \"t12\".\"cnt\", \"t12\".\"c_current_hdemo_sk\", \"t12\".\"c_current_addr_sk\") AS \"t16\",\r\n        (SELECT \"hd_demo_sk\"\r\n        FROM \"household_demographics\"\r\n        WHERE \"hd_income_band_sk\" >= 10 AND \"hd_income_band_sk\" <= 16 AND \"hd_buy_potential\" = 'Unknown') AS \"t18\"\r\nWHERE \"t16\".\"cnt\" = \"t18\".\"hd_demo_sk\"\r\nGROUP BY \"t16\".\"ss_customer_sk\", \"t16\".\"c_current_hdemo_sk\", \"t16\".\"c_current_addr_sk\"\r\nORDER BY 4;", "output_cost": 70.89, "used_rules": ["FILTER_INTO_JOIN", "FILTER_REDUCE_EXPRESSIONS", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_JOIN_TRANSPOSE_EXTENDED", "PROJECT_TO_CALC", "JOIN_EXTRACT_FILTER"], "rewrite_time": 2046}
{"name": "query102_0", "input_sql": "select \n    cd_gender,\n    cd_marital_status,\n    cd_education_status,\n    hd_vehicle_count,\n    count(*) as cnt\nfrom\n    store_sales,\n    web_sales,\n    date_dim d1,\n    date_dim d2,\n    customer,\n    inventory,\n    store,\n    warehouse,\n    item,\n    customer_demographics,\n    household_demographics,\n    customer_address\n    where\n      ss_item_sk = i_item_sk\n      and ws_item_sk = ss_item_sk\n      and ss_sold_date_sk = d1.d_date_sk\n      and ws_sold_date_sk = d2.d_date_sk\n\t\t\tand d2.d_date between d1.d_date and (d1.d_date + interval '30' day)\n      and ss_customer_sk = c_customer_sk\n      and ws_bill_customer_sk = c_customer_sk\n      and ws_warehouse_sk = inv_warehouse_sk\n      and ws_warehouse_sk = w_warehouse_sk\n      and inv_item_sk = ss_item_sk\n      and inv_date_sk = ss_sold_date_sk\n      and inv_quantity_on_hand >= ss_quantity\n      and s_state = w_state\n      AND i_category IN ('Books', 'Jewelry', 'Shoes')\n      and i_manager_id IN (2, 8, 10, 12, 14, 28, 58, 77, 93, 96)\n      and c_current_cdemo_sk = cd_demo_sk\n      and c_current_hdemo_sk = hd_demo_sk\n      and c_current_addr_sk = ca_address_sk\n      and ca_state in ('AR', 'GA', 'IA', 'MN', 'NC')\n      and d1.d_year = 1999\n      and ws_wholesale_cost BETWEEN 73 AND 93\n    group by cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count\n    order by cnt;", "input_cost": 65.15, "output_sql": "SELECT \"t11\".\"cd_gender\", \"t11\".\"cd_marital_status\", \"t11\".\"cd_education_status\", \"t11\".\"hd_income_band_sk\", COALESCE(SUM(\"t11\".\"cnt\"), 0) AS \"cnt\"\r\nFROM (SELECT \"t9\".\"c_current_addr_sk\", \"t9\".\"cd_gender\", \"t9\".\"cd_marital_status\", \"t9\".\"cd_education_status\", \"household_demographics\".\"hd_vehicle_count\" AS \"hd_income_band_sk\", COALESCE(SUM(\"t9\".\"cnt\"), 0) AS \"cnt\"\r\n        FROM (SELECT \"t7\".\"c_current_hdemo_sk\", \"t7\".\"c_current_addr_sk\", \"customer_demographics\".\"cd_gender\", \"customer_demographics\".\"cd_marital_status\", \"customer_demographics\".\"cd_education_status\", COALESCE(SUM(\"t7\".\"cnt\"), 0) AS \"cnt\"\r\n                FROM (SELECT \"t4\".\"c_current_cdemo_sk\", \"t4\".\"c_current_hdemo_sk\", \"t4\".\"c_current_addr_sk\", COALESCE(SUM(\"t4\".\"cnt\"), 0) AS \"cnt\"\r\n                        FROM (SELECT \"t1\".\"ss_item_sk\", \"t1\".\"c_current_cdemo_sk\", \"t1\".\"c_current_hdemo_sk\", \"t1\".\"c_current_addr_sk\", COALESCE(SUM(\"t1\".\"cnt\" * \"t2\".\"cnt\"), 0) AS \"cnt\"\r\n                                FROM (SELECT \"store_sales\".\"ss_item_sk\", \"t\".\"ws_warehouse_sk\", \"customer\".\"c_current_cdemo_sk\", \"customer\".\"c_current_hdemo_sk\", \"customer\".\"c_current_addr_sk\", COUNT(*) AS \"cnt\"\r\n                                        FROM \"store_sales\"\r\n                                            INNER JOIN (SELECT *\r\n                                                FROM \"web_sales\"\r\n                                                WHERE \"ws_wholesale_cost\" >= 73 AND \"ws_wholesale_cost\" <= 93) AS \"t\" ON \"store_sales\".\"ss_item_sk\" = \"t\".\"ws_item_sk\" AND \"store_sales\".\"ss_customer_sk\" = \"t\".\"ws_bill_customer_sk\"\r\n                                            INNER JOIN (SELECT *\r\n                                                FROM \"date_dim\"\r\n                                                WHERE \"d_year\" = 1999) AS \"t0\" ON \"store_sales\".\"ss_sold_date_sk\" = \"t0\".\"d_date_sk\"\r\n                                            INNER JOIN \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\") ON \"t\".\"ws_sold_date_sk\" = \"date_dim0\".\"d_date_sk0\" AND \"t0\".\"d_date\" <= \"date_dim0\".\"d_date0\" AND \"date_dim0\".\"d_date0\" <= (\"t0\".\"d_date\" + INTERVAL '30' DAY)\r\n                                            INNER JOIN \"customer\" ON \"store_sales\".\"ss_customer_sk\" = \"customer\".\"c_customer_sk\"\r\n                                            INNER JOIN \"inventory\" ON \"t\".\"ws_warehouse_sk\" = \"inventory\".\"inv_warehouse_sk\" AND \"store_sales\".\"ss_item_sk\" = \"inventory\".\"inv_item_sk\" AND \"store_sales\".\"ss_sold_date_sk\" = \"inventory\".\"inv_date_sk\" AND \"store_sales\".\"ss_quantity\" <= \"inventory\".\"inv_quantity_on_hand\"\r\n                                        GROUP BY \"store_sales\".\"ss_item_sk\", \"t\".\"ws_warehouse_sk\", \"customer\".\"c_current_cdemo_sk\", \"customer\".\"c_current_hdemo_sk\", \"customer\".\"c_current_addr_sk\") AS \"t1\"\r\n                                    CROSS JOIN (SELECT \"s_state\", COUNT(*) AS \"cnt\"\r\n                                        FROM \"store\"\r\n                                        GROUP BY \"s_state\") AS \"t2\"\r\n                                    INNER JOIN \"warehouse\" ON \"t1\".\"ws_warehouse_sk\" = \"warehouse\".\"w_warehouse_sk\" AND \"t2\".\"s_state\" = \"warehouse\".\"w_state\"\r\n                                GROUP BY \"t1\".\"ss_item_sk\", \"t1\".\"c_current_cdemo_sk\", \"t1\".\"c_current_hdemo_sk\", \"t1\".\"c_current_addr_sk\") AS \"t4\"\r\n                            INNER JOIN (SELECT *\r\n                                FROM \"item\"\r\n                                WHERE (CAST(\"i_category\" AS CHAR(5)) IN ('Books', 'Shoes') OR \"i_category\" = 'Jewelry') AND \"i_manager_id\" IN (2, 8, 10, 12, 14, 28, 58, 77, 93, 96)) AS \"t5\" ON \"t4\".\"ss_item_sk\" = \"t5\".\"i_item_sk\"\r\n                        GROUP BY \"t4\".\"c_current_cdemo_sk\", \"t4\".\"c_current_hdemo_sk\", \"t4\".\"c_current_addr_sk\") AS \"t7\"\r\n                    INNER JOIN \"customer_demographics\" ON \"t7\".\"c_current_cdemo_sk\" = \"customer_demographics\".\"cd_demo_sk\"\r\n                GROUP BY \"t7\".\"c_current_hdemo_sk\", \"t7\".\"c_current_addr_sk\", \"customer_demographics\".\"cd_gender\", \"customer_demographics\".\"cd_marital_status\", \"customer_demographics\".\"cd_education_status\") AS \"t9\"\r\n            INNER JOIN \"household_demographics\" ON \"t9\".\"c_current_hdemo_sk\" = \"household_demographics\".\"hd_demo_sk\"\r\n        GROUP BY \"t9\".\"c_current_addr_sk\", \"t9\".\"cd_gender\", \"t9\".\"cd_marital_status\", \"t9\".\"cd_education_status\", \"household_demographics\".\"hd_vehicle_count\") AS \"t11\"\r\n    INNER JOIN (SELECT *\r\n        FROM \"customer_address\"\r\n        WHERE CAST(\"ca_state\" AS CHAR(2)) IN ('AR', 'GA', 'IA', 'MN', 'NC')) AS \"t12\" ON \"t11\".\"c_current_addr_sk\" = \"t12\".\"ca_address_sk\"\r\nGROUP BY \"t11\".\"cd_gender\", \"t11\".\"cd_marital_status\", \"t11\".\"cd_education_status\", \"t11\".\"hd_income_band_sk\"\r\nORDER BY 5;", "output_cost": 95.84, "used_rules": ["FILTER_INTO_JOIN", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_JOIN_TRANSPOSE_EXTENDED", "JOIN_PROJECT_BOTH_TRANSPOSE", "JOIN_EXTRACT_FILTER", "JOIN_PROJECT_RIGHT_TRANSPOSE", "FILTER_INTO_JOIN", "FILTER_PROJECT_TRANSPOSE", "FILTER_INTO_JOIN", "PROJECT_TO_CALC"], "rewrite_time": 2800}
{"name": "query102_1", "input_sql": "select \n    cd_gender,\n    cd_marital_status,\n    cd_education_status,\n    hd_vehicle_count,\n    count(*) as cnt\nfrom\n    store_sales,\n    web_sales,\n    date_dim d1,\n    date_dim d2,\n    customer,\n    inventory,\n    store,\n    warehouse,\n    item,\n    customer_demographics,\n    household_demographics,\n    customer_address\n    where\n      ss_item_sk = i_item_sk\n      and ws_item_sk = ss_item_sk\n      and ss_sold_date_sk = d1.d_date_sk\n      and ws_sold_date_sk = d2.d_date_sk\n\t\t\tand d2.d_date between d1.d_date and (d1.d_date + interval '30' day)\n      and ss_customer_sk = c_customer_sk\n      and ws_bill_customer_sk = c_customer_sk\n      and ws_warehouse_sk = inv_warehouse_sk\n      and ws_warehouse_sk = w_warehouse_sk\n      and inv_item_sk = ss_item_sk\n      and inv_date_sk = ss_sold_date_sk\n      and inv_quantity_on_hand >= ss_quantity\n      and s_state = w_state\n      AND i_category IN ('Books', 'Shoes', 'Sports')\n      and i_manager_id IN (4, 9, 26, 30, 38, 62, 81, 82, 94, 100)\n      and c_current_cdemo_sk = cd_demo_sk\n      and c_current_hdemo_sk = hd_demo_sk\n      and c_current_addr_sk = ca_address_sk\n      and ca_state in ('IL', 'NC', 'TX', 'VA', 'WY')\n      and d1.d_year = 2001\n      and ws_wholesale_cost BETWEEN 78 AND 98\n    group by cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count\n    order by cnt;", "input_cost": 65.15, "output_sql": "SELECT \"t21\".\"cd_gender\", \"t21\".\"cd_marital_status\", \"t21\".\"cd_education_status\", \"t21\".\"hd_vehicle_count\", COALESCE(SUM(\"t21\".\"cnt\"), 0) AS \"cnt\"\r\nFROM (SELECT \"t18\".\"c_current_addr_sk\", \"t18\".\"cd_gender\", \"t18\".\"cd_marital_status\", \"t18\".\"cd_education_status\", \"t19\".\"hd_vehicle_count\", COALESCE(SUM(\"t18\".\"cnt\"), 0) AS \"cnt\"\r\n        FROM (SELECT \"t15\".\"c_current_hdemo_sk\", \"t15\".\"c_current_addr_sk\", \"t16\".\"cd_gender\", \"t16\".\"cd_marital_status\", \"t16\".\"cd_education_status\", COALESCE(SUM(\"t15\".\"cnt\"), 0) AS \"cnt\"\r\n                FROM (SELECT \"t11\".\"c_current_cdemo_sk\", \"t11\".\"c_current_hdemo_sk\", \"t11\".\"c_current_addr_sk\", COALESCE(SUM(\"t11\".\"cnt\"), 0) AS \"cnt\"\r\n                        FROM (SELECT \"t8\".\"ss_item_sk\", \"t8\".\"c_current_cdemo_sk\", \"t8\".\"c_current_hdemo_sk\", \"t8\".\"c_current_addr_sk\", COALESCE(SUM(\"t8\".\"s_state\"), 0) AS \"cnt\"\r\n                                FROM (SELECT \"t6\".\"ss_item_sk\", \"t6\".\"ws_warehouse_sk\", \"t6\".\"c_current_cdemo_sk\", \"t6\".\"c_current_hdemo_sk\", \"t6\".\"c_current_addr_sk\", \"t7\".\"s_state\" AS \"cnt\", \"t6\".\"cnt\" * \"t7\".\"cnt\" AS \"s_state\"\r\n                                        FROM (SELECT \"t4\".\"ss_item_sk\", \"t4\".\"ws_warehouse_sk\", \"t4\".\"c_current_cdemo_sk\", \"t4\".\"c_current_hdemo_sk\", \"t4\".\"c_current_addr_sk\", COUNT(*) AS \"cnt\"\r\n                                                FROM (SELECT *\r\n                                                        FROM (SELECT *\r\n                                                                FROM (SELECT *\r\n                                                                        FROM (SELECT *\r\n                                                                                FROM \"store_sales\",\r\n                                                                                        (SELECT *\r\n                                                                                        FROM \"web_sales\"\r\n                                                                                        WHERE \"ws_wholesale_cost\" >= 78 AND \"ws_wholesale_cost\" <= 98) AS \"t\"\r\n                                                                                WHERE \"t\".\"ws_item_sk\" = \"store_sales\".\"ss_item_sk\" AND \"store_sales\".\"ss_customer_sk\" = \"t\".\"ws_bill_customer_sk\") AS \"t0\",\r\n                                                                                (SELECT *\r\n                                                                                FROM \"date_dim\"\r\n                                                                                WHERE \"d_year\" = 2001) AS \"t1\"\r\n                                                                        WHERE \"t0\".\"ss_sold_date_sk\" = \"t1\".\"d_date_sk\") AS \"t2\",\r\n                                                                    \"date_dim\" AS \"date_dim0\" (\"d_date_sk0\", \"d_date_id0\", \"d_date0\", \"d_month_seq0\", \"d_week_seq0\", \"d_quarter_seq0\", \"d_year0\", \"d_dow0\", \"d_moy0\", \"d_dom0\", \"d_qoy0\", \"d_fy_year0\", \"d_fy_quarter_seq0\", \"d_fy_week_seq0\", \"d_day_name0\", \"d_quarter_name0\", \"d_holiday0\", \"d_weekend0\", \"d_following_holiday0\", \"d_first_dom0\", \"d_last_dom0\", \"d_same_day_ly0\", \"d_same_day_lq0\", \"d_current_day0\", \"d_current_week0\", \"d_current_month0\", \"d_current_quarter0\", \"d_current_year0\")\r\n                                                                WHERE \"t2\".\"ws_sold_date_sk\" = \"date_dim0\".\"d_date_sk0\" AND \"date_dim0\".\"d_date0\" >= \"t2\".\"d_date\" AND \"date_dim0\".\"d_date0\" <= (\"t2\".\"d_date\" + INTERVAL '30' DAY)) AS \"t3\",\r\n                                                            \"customer\"\r\n                                                        WHERE \"t3\".\"ss_customer_sk\" = \"customer\".\"c_customer_sk\") AS \"t4\",\r\n                                                    \"inventory\"\r\n                                                WHERE \"t4\".\"ws_warehouse_sk\" = \"inventory\".\"inv_warehouse_sk\" AND \"inventory\".\"inv_item_sk\" = \"t4\".\"ss_item_sk\" AND \"inventory\".\"inv_date_sk\" = \"t4\".\"ss_sold_date_sk\" AND \"inventory\".\"inv_quantity_on_hand\" >= \"t4\".\"ss_quantity\"\r\n                                                GROUP BY \"t4\".\"ss_item_sk\", \"t4\".\"ws_warehouse_sk\", \"t4\".\"c_current_cdemo_sk\", \"t4\".\"c_current_hdemo_sk\", \"t4\".\"c_current_addr_sk\") AS \"t6\",\r\n                                                (SELECT \"s_state\", COUNT(*) AS \"cnt\"\r\n                                                FROM \"store\"\r\n                                                GROUP BY \"s_state\") AS \"t7\") AS \"t8\",\r\n                                        (SELECT \"w_warehouse_sk\", \"w_state\"\r\n                                        FROM \"warehouse\") AS \"t9\"\r\n                                WHERE \"t8\".\"ws_warehouse_sk\" = \"t9\".\"w_warehouse_sk\" AND \"t8\".\"cnt\" = \"t9\".\"w_state\"\r\n                                GROUP BY \"t8\".\"ss_item_sk\", \"t8\".\"c_current_cdemo_sk\", \"t8\".\"c_current_hdemo_sk\", \"t8\".\"c_current_addr_sk\") AS \"t11\",\r\n                                (SELECT \"i_item_sk\"\r\n                                FROM \"item\"\r\n                                WHERE (CAST(\"i_category\" AS CHAR(5)) IN ('Books', 'Shoes') OR \"i_category\" = 'Sports') AND \"i_manager_id\" IN (4, 9, 26, 30, 38, 62, 81, 82, 94, 100)) AS \"t13\"\r\n                        WHERE \"t11\".\"ss_item_sk\" = \"t13\".\"i_item_sk\"\r\n                        GROUP BY \"t11\".\"c_current_cdemo_sk\", \"t11\".\"c_current_hdemo_sk\", \"t11\".\"c_current_addr_sk\") AS \"t15\",\r\n                        (SELECT \"cd_demo_sk\", \"cd_gender\", \"cd_marital_status\", \"cd_education_status\"\r\n                        FROM \"customer_demographics\") AS \"t16\"\r\n                WHERE \"t15\".\"c_current_cdemo_sk\" = \"t16\".\"cd_demo_sk\"\r\n                GROUP BY \"t15\".\"c_current_hdemo_sk\", \"t15\".\"c_current_addr_sk\", \"t16\".\"cd_gender\", \"t16\".\"cd_marital_status\", \"t16\".\"cd_education_status\") AS \"t18\",\r\n                (SELECT \"hd_demo_sk\", \"hd_vehicle_count\"\r\n                FROM \"household_demographics\") AS \"t19\"\r\n        WHERE \"t18\".\"c_current_hdemo_sk\" = \"t19\".\"hd_demo_sk\"\r\n        GROUP BY \"t18\".\"c_current_addr_sk\", \"t18\".\"cd_gender\", \"t18\".\"cd_marital_status\", \"t18\".\"cd_education_status\", \"t19\".\"hd_vehicle_count\") AS \"t21\",\r\n        (SELECT \"ca_address_sk\"\r\n        FROM \"customer_address\"\r\n        WHERE CAST(\"ca_state\" AS CHAR(2)) IN ('IL', 'NC', 'TX', 'VA', 'WY')) AS \"t23\"\r\nWHERE \"t21\".\"c_current_addr_sk\" = \"t23\".\"ca_address_sk\"\r\nGROUP BY \"t21\".\"cd_gender\", \"t21\".\"cd_marital_status\", \"t21\".\"cd_education_status\", \"t21\".\"hd_vehicle_count\"\r\nORDER BY 5;", "output_cost": 95.84, "used_rules": ["FILTER_INTO_JOIN", "AGGREGATE_PROJECT_MERGE", "AGGREGATE_JOIN_TRANSPOSE_EXTENDED", "PROJECT_TO_CALC", "JOIN_EXTRACT_FILTER"], "rewrite_time": 2897}
